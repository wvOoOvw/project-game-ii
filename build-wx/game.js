(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},37:()=>{window.fontFamily="Courier"},70:()=>{!function(){try{wx}catch{return}!function(t){const e={};function i(n){if(e[n])return e[n].exports;const o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){n.addEventListener=n.canvas.addEventListener=function(t,e){n.document.addEventListener(t,e)},n.removeEventListener=n.canvas.removeEventListener=function(t,e){n.document.removeEventListener(t,e)};const t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(const t in n){const e=Object.getOwnPropertyDescriptor(o,t);e&&!0!==e.configurable||Object.defineProperty(window,t,{value:n[t]})}for(const t in n.document){const e=Object.getOwnPropertyDescriptor(o.document,t);e&&!0!==e.configurable||Object.defineProperty(o.document,t,{value:n.document[t]})}window.parent=window}else{for(const t in n)o[t]=n[t];o.window=n,window=o,window.top=window.parent=window}}())},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;const n=i(2);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));const o=i(3);Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})}));const s=p(i(9)),a=p(i(10)),r=p(i(17)),h=p(i(18)),l=p(i(19)),c=p(i(11)),d=p(i(12)),f=p(i(20)),u=p(i(4)),m=p(i(21)),w=p(i(22));function p(t){return t&&t.__esModule?t:{default:t}}e.document=a.default,e.navigator=r.default,e.XMLHttpRequest=h.default,e.WebSocket=l.default,e.Image=c.default,e.Audio=d.default,e.FileReader=f.default,e.HTMLElement=u.default,e.localStorage=m.default,e.location=w.default;const g=new s.default;e.canvas=g,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=wx.getSystemInfoSync(),n=i.screenWidth,o=i.screenHeight,s=i.devicePixelRatio,a=e.innerWidth=n,r=e.innerHeight=o;e.devicePixelRatio=s,e.screen={availWidth:a,availHeight:r},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;const n=(o=i(4))&&o.__esModule?o:{default:o};var o;function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return r(e,t),e}(n.default),e.HTMLCanvasElement=function(t){function e(){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return r(e,t),e}(n.default)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(s=i(5))&&s.__esModule?s:{default:s};var s;const a=i(8),r=i(2);function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}const c=function(t){function e(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";h(this,e);const i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.className="",i.childern=[],i.style={width:`${r.innerWidth}px`,height:`${r.innerHeight}px`},i.insertBefore=a.noop,i.innerHTML="",i.tagName=t.toUpperCase(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:r.innerWidth,height:r.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){const t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){const t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}(o.default);e.default=c},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(6))&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var o;const s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){const t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){const e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),e}(((o=i(7))&&o.__esModule?o:{default:o}).default);e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let o=n.get(this);o||(o={},n.set(this,o)),o[t]||(o[t]=[]),o[t].push(e),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){const i=n.get(this)[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}}},{key:"dispatchEvent",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.get(this)[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}}]),t}();e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=wx.createCanvas();return t.type="canvas",t.__proto__.__proto__=new n.default("canvas"),t.getContext,t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t},i(3);const n=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}o(i(10))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=h(i(4)),s=h(i(11)),a=h(i(12)),r=h(i(9));function h(t){return t&&t.__esModule?t:{default:t}}i(15);const l={};var c={readyState:"complete",visibilityState:"visible",documentElement:n,hidden:!1,style:{},location:n.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new o.default("head"),body:new o.default("body"),createElement:function(t){return"canvas"===t?new r.default:"audio"===t?new a.default:"img"===t?new s.default:new o.default(t)},getElementById:function(t){return t===n.canvas.id?n.canvas:null},getElementsByTagName:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[n.canvas]:[]},querySelector:function(t){return"head"===t?c.head:"body"===t?c.body:"canvas"===t||t===`#${n.canvas.id}`?n.canvas:null},querySelectorAll:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[n.canvas]:[]},addEventListener:function(t,e){l[t]||(l[t]=[]),l[t].push(e)},removeEventListener:function(t,e){const i=l[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}},dispatchEvent:function(t){const e=l[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}};e.default=c},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(s=i(13))&&s.__esModule?s:{default:s};var s;const a=new WeakMap,r=new WeakMap,h=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4,i.readyState=0,r.set(i,"");const n=wx.createInnerAudioContext();return a.set(i,n),n.onCanplay((function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=2})),n.onPlay((function(){i.dispatchEvent({type:"play"})})),n.onPause((function(){i.dispatchEvent({type:"pause"})})),n.onEnded((function(){i.dispatchEvent({type:"ended"}),i.readyState=4})),n.onError((function(){i.dispatchEvent({type:"error"})})),t&&(a.get(i).src=t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){a.get(this).play()}},{key:"pause",value:function(){a.get(this).pause()}},{key:"canPlayType",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){const t=new e;return t.loop=a.get(this).loop,t.autoplay=a.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return a.get(this).currentTime},set:function(t){a.get(this).seek(t)}},{key:"src",get:function(){return r.get(this)},set:function(t){r.set(this,t),a.get(this).src=t}},{key:"loop",get:function(){return a.get(this).loop},set:function(t){a.get(this).loop=t}},{key:"autoplay",get:function(){return a.get(this).autoplay},set:function(t){a.get(this).autoplay=t}},{key:"paused",get:function(){return a.get(this).paused}}]),e}(o.default));e.default=h},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(14))&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var o;const s=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}(((o=i(4))&&o.__esModule?o:{default:o}).default);e.default=s},function(t,e,i){i(16)},function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=(s=i(10))&&s.__esModule?s:{default:s};var s;const a=i(8),r=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=n.canvas,this.currentTarget=n.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=a.noop,this.stopPropagation=a.noop,this.type=e};function h(t){return function(e){const i=new r(t);i.touches=e.touches,i.targetTouches=Array.prototype.slice.call(e.touches),i.changedTouches=e.changedTouches,i.timeStamp=e.timeStamp,o.default.dispatchEvent(i)}}wx.onTouchStart(h("touchstart")),wx.onTouchMove(h("touchmove")),wx.onTouchEnd(h("touchend")),wx.onTouchCancel(h("touchcancel"))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),o={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:n.noop,watchPosition:n.noop,clearWatch:n.noop}};e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap;function h(t){if("function"==typeof this[`on${t}`]){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this[`on${t}`].apply(this,i)}}function l(t){this.readyState=t,h.call(this,"readystatechange")}const c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,s.set(this,{"content-type":"application/x-www-form-urlencoded"}),a.set(this,{})}return i(t,[{key:"abort",value:function(){const t=r.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){const t=a.get(this);return Object.keys(t).map((function(e){return`${e}: ${t[e]}`})).join("\n")}},{key:"getResponseHeader",value:function(t){return a.get(this)[t]}},{key:"open",value:function(e,i){o.set(this,e),n.set(this,i),l.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){const e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:i,url:n.get(this),method:o.get(this),header:s.get(this),responseType:this.responseType,success:function(i){let n=i.data;const o=i.statusCode,s=i.header;if("string"!=typeof n&&!(n instanceof ArrayBuffer))try{n=JSON.stringify(n)}catch(t){}if(e.status=o,a.set(e,s),h.call(e,"loadstart"),l.call(e,t.HEADERS_RECEIVED),l.call(e,t.LOADING),e.response=n,n instanceof ArrayBuffer){e.responseText="";const t=new Uint8Array(n),i=t.byteLength;for(let n=0;n<i;n++)e.responseText+=String.fromCharCode(t[n])}else e.responseText=n;l.call(e,t.DONE),h.call(e,"load"),h.call(e,"loadend")},fail:function(t){const i=t.errMsg;-1!==i.indexOf("abort")?h.call(e,"abort"):h.call(e,"error",i),h.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){const i=s.get(this);i[t]=e,s.set(this,i)}}]),t}();c.UNSEND=0,c.OPENED=1,c.HEADERS_RECEIVED=2,c.LOADING=3,c.DONE=4,e.default=c},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}const o=new WeakMap,s=function(){function t(e){const i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError(`Failed to construct 'WebSocket': The URL '${e}' is invalid`);this.url=e,this.readyState=t.CONNECTING;const a=wx.connectSocket({url:e,protocols:Array.isArray(s)?s:[s]});return o.set(this,a),a.onClose((function(e){i.readyState=t.CLOSED,"function"==typeof i.onclose&&i.onclose(e)})),a.onMessage((function(t){"function"==typeof i.onmessage&&i.onmessage(t)})),a.onOpen((function(){i.readyState=t.OPEN,"function"==typeof i.onopen&&i.onopen()})),a.onError((function(t){"function"==typeof i.onerror&&i.onerror(new Error(t.errMsg))})),this}return i(t,[{key:"close",value:function(e,i){this.readyState=t.CLOSING,o.get(this).close({code:e,reason:i})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError(`Failed to send message: The data ${t} is invalid`);o.get(this).send({data:t})}}]),t}();s.CONNECTING=0,s.OPEN=1,s.CLOSING=2,s.CLOSED=3,e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=i},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={href:"game.js",reload:function(){}}}])}()},293:()=>{!function(){try{if(wx)return}catch{}window.wx={_web:!0,getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.background="black",void 0===window.ontouchstart&&(t.style["max-width"]=.5*window.document.documentElement.clientHeight+"px");const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},6:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const n=this.dependentQueue[i],o=this.executeDependent(e.dependent);return o===t||Array.isArray(o)&&Array.isArray(n)&&(s=o,a=n,Array.isArray(s)&&Array.isArray(a)&&(s.length!==a.length||s.filter(((t,e)=>t===a[e])).length!==s.length))||!Array.isArray(o)&&!Array.isArray(n)&o!==n?(this.executeEvent(e.event),void(this.dependentQueue[i]=o)):void(this.dependentQueue[i]=o);var s,a}))},e.prototype.register=function(e,i=t){const n={event:e,dependent:i};return this.monitorQueue.push(n),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===n&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const n=new i;window.Imitation=n}()}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}(()=>{"use strict";i(70),i(293),i(652),i(37),i(6);const t="static/background-blur.d92af6bc.jpg",e="static/kongxian.de9b3926.png",n="static/nengtianshi.3189957b.png",o="static/w.86ab2d3c.png",s=new class{constructor(){this.map={"background-transition":"static/background.29e6b3be.jpg","background-home":t,"background-page":t,"background-loading":t,"money-1":o,"money-2":o,"money-3":o,"explore-1":n,"explore-2":n,"shop-1":e,"shop-2":e,"shop-3":e,"shop-4":e,"shop-5":e,"master-1":"static/chen.b65023b5.png","master-2":"static/cuoe.c908ed3c.png","master-3":"static/fengdi.72b31ee1.png","master-4":"static/linguang.acf5bd67.png","master-5":"static/nian.afb4fd28.png","card-1":"static/niyan.0a121257.png","card-2":"static/saileiya.1d6838fc.png","card-3":"static/senran.4ce470a9.png","card-4":"static/shan.ec3e6c6d.png","card-5":"static/shier.4eb733a9.png","card-6":"static/tuijin.5a8f324f.png","card-7":"static/yanwei.29b3239c.png","card-8":"static/yinhui.3c5f7f39.png","card-9":"static/huang.a3fc17ce.png","card-10":"static/aiyafala.37be7922.png","card-11":"static/hei.6cc6018a.png","card-12":"static/heijian.e5f9b0d1.png"}}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((e=>{const i=new Image;i.src=this.map[t[0]],i.onload=e,this.map[t[0]]=i})))))}get(t){return this.map[t]||console.error(t),this.map[t]}},a=(t,e)=>Math.floor(t*Math.pow(1.2,e-1));var r=[{key:1,name:"金币"},{key:2,name:"晶石"}],h=[{key:1,name:"故事 I",description:"可能包含: 金币 20 - 50 枚",difficulty:1,type:"alltime",boss:{master:{key:1,level:1},card:[{key:1,level:1},{key:2,level:1}]},reward:()=>[{money:!0,key:1,number:Math.floor(31*Math.random())+20}]},{key:2,name:"梦境 I",description:"可能包含: 小火把 Exp 5 - 20, 大火把 Exp 5 - 20",difficulty:2,type:"alltime",boss:{master:{key:2,level:2},card:[{key:1,level:3},{key:2,level:3},{key:3,level:3}]},reward:()=>[{card:!0,key:1,exp:Math.floor(16*Math.random())+5},{card:!0,key:2,exp:Math.floor(16*Math.random())+5}]}],l=[{key:1,name:"火系基础礼盒I",description:"可能包含: 小火把 Exp 0 - 20, 大火把 Exp 0 - 20",type:"alltime",money:{key:1,number:388},reward:()=>[{card:!0,key:1,exp:Math.floor(21*Math.random())},{card:!0,key:2,exp:Math.floor(21*Math.random())}]},{key:2,name:"火系基础礼盒II",description:"可能包含: 火焰领主 Exp 50 - 100, 炎魔 Exp 50 - 100",type:"alltime",money:{key:1,number:388},reward:()=>[{master:!0,key:2,exp:Math.floor(51*Math.random()+50)},{master:!0,key:3,exp:Math.floor(51*Math.random()+50)}]},{key:3,name:"新手礼盒I",description:"可能包含: 祭司 Exp 50 - 150",type:"alltime",money:{key:1,number:188},reward:()=>[{master:!0,key:1,exp:Math.floor(101*Math.random()+50)}]}],c=[{key:1,name:"祭司",HP:t=>a(1e4,t),ATTACT:t=>a(800,t),ACTION:2,skill:[{name:"庇护 I",description:t=>"使用卡牌后, 回复 2% HP",function:(t,e,i,n,o)=>{const s=Math.floor(.02*n.master.HP_);i.push({roleMessage:`${e.name} HP + ${s}`,target:"self"}),i.push({effect:"HP",target:"self",value:s})}},{name:"庇护 II",description:t=>"使用卡牌后, 提升 2% 基础ATTACT",function:(t,e,i,n,o)=>{const s=Math.floor(.02*n.master.ATTACT_);i.push({roleMessage:`${e.name} ATTACT + ${s}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:s})}}]},{key:2,name:"火焰领主",HP:t=>a(1e4,t),ATTACT:t=>a(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}}]},{key:3,name:"炎魔",HP:t=>a(8e3,t),ATTACT:t=>a(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}},{name:"火焰控制",description:t=>"使用火焰系卡牌后, 提升 5% ATTACT",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.05*n.master.ATTACT);i.push({roleMessage:`${e.name} ATTACT + ${t}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:t})}}}]},{key:4,name:"丛林守护者",HP:t=>a(12e3,t),ATTACT:t=>a(680,t),ACTION:2,skill:[{name:"自然之力",description:t=>"使用卡牌后, 回复 4% HP, 并有 25% 几率提升一次牌库随机一张卡牌的等级",function:(t,e,i,n,o)=>{if("自然"===t.race){const o=Math.floor(.04*n.master.HP_);if(i.push({roleMessage:`${e.name} HP + ${o}`,target:"self"}),i.push({effect:"HP",target:"self",value:o}),Math.random()>.5){const e=v(n.card.team,1)[0];i.push({roleMessage:`{skill.name} ${e.name} LEVEL + 1`,target:"opposite"}),i.push({effect:"LEVEL",target:"self",key:t.key,number:1})}}}}]}],d=[{key:1,name:"小火把",type:"进攻",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并附加给目标 1 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:1}]}},{key:2,name:"大火把",type:"进攻",race:"火焰",description:t=>`造成 ${50+2.5*(t-1)}%ATTACT 伤害, 并附加给目标 2 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(.5+.025*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:2}]}},{key:3,name:"点燃",type:"进攻",race:"火焰",description:t=>`造成目标 '燃' 层数 * ${35+2*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT*(.35+.02*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:4,name:"火焰冲击",type:"进攻",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 若目标拥有 '燃' 则伤害 * 1.5`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.find((t=>"燃"===t))?e.master.ATTACT*(1+.05*(t.level-1))*1.5:e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:5,name:"火焰聚能",type:"辅助",race:"火焰",description:t=>`消耗对手的所有 '燃' , 提升自身 '燃' 层数 * ${10+.5*(t-1)} 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"BUFF",target:"opposite",name:"燃",number:-i.master.buff.filter((t=>"燃"===t)).length}]}},{key:6,name:"火球术",type:"进攻",race:"火焰",description:t=>`造成 ${120+6*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1.2+.06*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:7,name:"火球燃烧",type:"进攻",race:"火焰",description:t=>`造成 ${60+3*(t-1)} 伤害, 提升一次牌库 '火球术' 等级`,function:(t,e,i)=>{const n=[],o=Math.floor(e.master.ATTACT*(.6+.03*(t.level-1)));return n.push({message:[t.name,w(t.level)].join(" ")}),n.push({roleMessage:`${t.name} HP - ${o}`,target:"opposite"}),n.push({animation:"red-hit",target:"opposite"}),n.push({effect:"HP",target:"opposite",value:-o}),e.card.team.some((t=>6===t.key))&&(n.push({roleMessage:`${t.name} 火球术 LEVEL + 1`,target:"self"}),n.push({effect:"LEVEL",target:"self",key:6,number:1})),n}},{key:8,name:"自燃",type:"辅助",race:"火焰",description:t=>`扣除自身当前生命值 10%, 提升 ${20+1*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.2+.01*(t.level-1))),o=Math.floor(.1*e.master.HP);return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{roleMessage:`${t.name} HP - ${o}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"HP",target:"self",value:-o}]}},{key:9,name:"火焰蓄能",type:"辅助",race:"火焰",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:10,name:"自然治愈",type:"治疗",race:"自然",description:t=>`回复 ${10+.5*(t-1)}% HP`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"HP",target:"self",value:n}]}},{key:11,name:"自然蓄能",type:"辅助",race:"自然",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:12,name:"缠绕",type:"进攻",race:"自然",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并降低目标 5% ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1))),o=Math.floor(.05*i.master.ATTACT);return[{message:[t.name,w(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{roleMessage:`${t.name} ATTACT - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"ATTACT",target:"opposite",value:-o}]}}];const f=t=>t.reduce(((t,e)=>{const i=[...t],n=d.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),u=t=>t.reduce(((t,e)=>{const i=[...t],n=c.find((t=>e.key===t.key));return i.push({...n,...e,HP:n.HP(e.level),ATTACT:n.ATTACT(e.level),HP_:n.HP(e.level),ATTACT_:n.ATTACT(e.level)}),i}),[]),m=t=>t.reduce(((t,e)=>{const i=[...t],n=r.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),w=t=>1===t?"I":2===t?"II":3===t?"III":4===t?"IV":5===t?"V":6===t?"VI":7===t?"VII":8===t?"VIII":9===t?"IX":10===t?"X":11===t?"XI":12===t?"XII":13===t?"XIII":14===t?"XIV":15===t?"XV":16===t?"XVI":void 0,p=t=>new URL(location.href).searchParams.get(t),g=async(t,e)=>{var i=0;const n=e=>{i===t&&e(),i!==t&&(i+=1,requestAnimationFrame((()=>n(e))))};e&&n(e),e||await new Promise((t=>n(t)))},y=t=>Number(Number(t).toFixed(4)),v=(t,e)=>{var i=[],n=[...t];return new Array(e).fill().forEach((()=>{const t=Math.floor(Math.random()*n.length);n[t]&&(i.push(n[t]),n=n.filter(((e,i)=>i!==t)))})),i},x=(t,e)=>{const i=e.x,n=e.y,o=e.width,s=e.height;var a=t.x||t.touches[0].clientX,r=t.y||t.touches[0].clientY;try{const t=canvas.getBoundingClientRect();a-=t.left,r-=t.top}catch{}return a>=i&&a<=i+o&&r>=n&&r<=n+s},T=(t,e)=>{const{x:i,y:n,width:o,height:s}=t,{x:a,y:r,width:h,height:l}=e;return i+o>a&&i<a+h&&n+s>r&&n<r+l},I=canvas.getContext("2d"),b=(t,e)=>{const i=e.x,n=e.y,o=e.width,s=e.height;var a=0,r=0,h=t.width,l=t.height;const c=Math.max(o/t.width,s/t.height),d=t.width*c-o,f=t.height*c-s;d&&(a=d/2/c,h-=d/c),f&&(r=f/2/c,l-=f/c),I.drawImage(t,a,r,h,l,i,n,o,s)},A=(t,e)=>{var i=e.x,n=e.y,o=e.width,s=e.height;const a=s/t.height,r=t.width*a;i+=(o-r)/2,I.drawImage(t,i,n,r,s)},S=t=>{const e=t.x,i=t.y,n=t.width,o=t.height,s=Array.isArray(t.radius)?t.radius:new Array(4).fill(t.radius);I.beginPath(),I.moveTo(e,i+s[0]),I.arcTo(e,i,e+s[0],i,s[0]),I.lineTo(e+n-s[1],i),I.arcTo(e+n,i,e+n,i+s[1],s[1]),I.lineTo(e+n,i+o-s[2]),I.arcTo(e+n,i+o,e+n-s[2],i+o,s[2]),I.lineTo(e+s[3],i+o),I.arcTo(e,i+o,e,i+o-s[3],s[3]),I.closePath()},C=t=>{const e=t.x,i=t.y,n=t.width,o=t.height,s=Array.isArray(t.radius)?t.radius:new Array(4).fill(t.radius);I.beginPath(),I.moveTo(e,i+s[0]),I.lineTo(e+s[0],i),I.lineTo(e+n-s[1],i),I.lineTo(e+n,i+s[1]),I.lineTo(e+n,i+o-s[2]),I.lineTo(e+n-s[1],i+o),I.lineTo(e+s[3],i+o),I.lineTo(e,i+o-s[3]),I.closePath()},P=t=>{const e=t.x,i=t.y,n=t.width,o=t.height;I.beginPath(),I.moveTo(e,i),I.lineTo(e+n,i),I.lineTo(e+n,i+o),I.lineTo(e,i+o),I.closePath()},k=t=>{const e=t.x,i=t.y,n=t.width,o=t.wrapSpace,s=t.text;var a="",r=[];s.split("").forEach((t=>{I.measureText(a+t).width>n&&(r.push(a),a=""),a+=t})),r.push(a),r.forEach(((t,n)=>{I.fillText(t,e,i+n*o)}))},M=canvas.getContext("2d"),E=wx.getSystemInfoSync().windowWidth,_=wx.getSystemInfoSync().windowHeight,O=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=y(this.opacity+.05),this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=y(this.opacity-.05),this.count=this.count+1),this.count>60)return window.Imitation.state.page.current=window.Imitation.state.page.next,void(window.Imitation.state.page.next="");M.globalAlpha=this.opacity,b(s.get("background-transition"),{x:0,y:0,width:E,height:_}),M.globalAlpha=1}},H=canvas.getContext("2d"),j=wx.getSystemInfoSync().windowWidth,$=wx.getSystemInfoSync().windowHeight,N=class{constructor(){this.time=0}render(){this.time=this.time+1/32,P({x:0,y:0,width:j,height:$}),H.fillStyle="rgba(0, 0, 0, 1)",H.fill(),H.textAlign="center",H.textBaseline="middle",H.font=`900 14px ${window.fontFamily}`,H.fillStyle="rgba(255, 255, 255, 1)",H.fillText(`加载中${new Array(Math.floor(this.time%4)).fill(".").join("")}`,j/2,$/2)}},D=canvas.getContext("2d"),R=wx.getSystemInfoSync().windowWidth,B=wx.getSystemInfoSync().windowHeight,L=class{constructor(){}drawButtonExplore(){const t={x:R/2-60,y:B-240,width:120,height:40,radius:8};D.textAlign="center",D.textBaseline="middle",D.font=`900 14px ${window.fontFamily}`,C(t),D.fillStyle="rgba(255, 255, 255, 1)",D.fill(),D.fillStyle="rgba(0, 0, 0, 1)",D.fillText("探索",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="explore"}),{ifTouchCover:t})}drawButtonStore(){const t={x:R/2-60,y:B-180,width:120,height:40,radius:8};D.textAlign="center",D.textBaseline="middle",D.font=`900 14px ${window.fontFamily}`,C(t),D.fillStyle="rgba(255, 255, 255, 1)",D.fill(),D.fillStyle="rgba(0, 0, 0, 1)",D.fillText("编队",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="store"}),{ifTouchCover:t})}drawButtonShop(){const t={x:R/2-60,y:B-120,width:120,height:40,radius:8};D.textAlign="center",D.textBaseline="middle",D.font=`900 14px ${window.fontFamily}`,C(t),D.fillStyle="rgba(255, 255, 255, 1)",D.fill(),D.fillStyle="rgba(0, 0, 0, 1)",D.fillText("商店",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="shop"}),{ifTouchCover:t})}render(){b(s.get("background-home"),{x:0,y:0,width:R,height:B}),this.drawButtonExplore(),this.drawButtonStore(),this.drawButtonShop()}},F=canvas.getContext("2d");class W{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.contentWidth=t.contentWidth,this.contentHeight=t.contentHeight,this.scrollPosition=t.scrollPosition||[0,0],this.mouseDownPosition=null}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var n=this.scrollPosition[0]-e,o=this.scrollPosition[1]-i;this.contentWidth||(n=this.scrollPosition[0]),this.contentHeight||(o=this.scrollPosition[1]),this.scrollPosition=[n,o]}render(t){if(!this.mouseDownPosition){const t=16;this.scrollPosition[0]<0&&(this.scrollPosition[0]=this.scrollPosition[0]/t<-1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.scrollPosition[1]<0&&(this.scrollPosition[1]=this.scrollPosition[1]/t<-1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.scrollPosition[0]>0&&((this.contentWidth-this.width<0||this.contentWidth-this.width==0)&&(this.scrollPosition[0]=this.scrollPosition[0]/t>1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.contentWidth-this.width>0&&this.scrollPosition[0]>this.contentWidth-this.width&&(this.scrollPosition[0]=(this.scrollPosition[0]-(this.contentWidth-this.width))/t>1/t?this.scrollPosition[0]-(this.scrollPosition[0]-(this.contentWidth-this.width))/t:this.contentWidth-this.width)),this.scrollPosition[1]>0&&((this.contentHeight-this.height<0||this.contentHeight-this.height==0)&&(this.scrollPosition[1]=this.scrollPosition[1]/t>1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.contentHeight-this.height>0&&this.scrollPosition[1]>this.contentHeight-this.height&&(this.scrollPosition[1]=(this.scrollPosition[1]-(this.contentHeight-this.height))/t>1/t?this.scrollPosition[1]-(this.scrollPosition[1]-(this.contentHeight-this.height))/t:this.contentHeight-this.height))}F.save();const e={x:this.x,y:this.y,width:this.width,height:this.height};P(e),F.clip(),t(this.scrollPosition),F.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:e}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}const X=canvas.getContext("2d"),Y=wx.getSystemInfoSync().windowWidth,q=wx.getSystemInfoSync().windowHeight;class U{constructor(t){this.content=t.content,this.itemWidth=t.itemWidth||64,this.itemHeight=t.itemHeight||30,this.itemRadius=t.itemRadius||4,this.itemBackgroundColor=t.itemBackgroundColor||["rgba(255, 255, 255, 1)","rgba(0, 0, 0, 1)"],this.itemTextColor=t.itemTextColor||["rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"]}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get height(){return this.content.length*this.itemHeight+12*(this.content.length-1)+24}drawBackground(){S({x:12,y:q-this.height-12,width:Y-24,height:this.height,radius:4}),X.fillStyle="rgba(255, 255, 255, 0.5)",X.fill()}drawContent(){X.textAlign="center",X.textBaseline="middle",X.font=`900 10px ${window.fontFamily}`,this.content.forEach(((t,e)=>{const i={left:0,right:0};t.forEach(((n,o)=>{var s={};if(s.y=q-36-this.itemHeight-e*this.itemHeight-12*(e-1),s.width=n.width||this.itemWidth,s.height=n.height||this.itemHeight,s.radius=n.radius||this.itemRadius,s.backgroundColor=n.backgroundColor||this.itemBackgroundColor,s.textColor=n.textColor||this.itemTextColor,"left"===n.justifyContent&&(s.x=24+i[n.justifyContent]*(s.width+12)),"right"===n.justifyContent&&(s.x=Y-24-i[n.justifyContent]*(s.width+12)-s.width),"center"===n.justifyContent){s.x=(Y-s.width)/2;const e=(o-(t.length/2-.5))*(s.width+12);s.x=s.x+e}i[n.justifyContent]=i[n.justifyContent]+1,s.x=n.x||s.x,s={...s,...n},X.fillStyle=s.active?s.backgroundColor[1]:s.backgroundColor[0],S(s),X.fill(),X.fillStyle=s.active?s.textColor[1]:s.textColor[0],X.fillText(s.text,s.x+s.width/2,s.y+s.height/2),window.Imitation.state.function.event("touchstart",(t=>s.event?s.event(t):null),{ifTouchCover:s})}))}))}render(){X.save(),this.drawBackground(),this.drawContent(),X.restore()}}const V=canvas.getContext("2d"),G=wx.getSystemInfoSync().safeArea.top,Q=wx.getSystemInfoSync().windowWidth,z=wx.getSystemInfoSync().windowHeight;class K{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.money=t.money,this.novaTime=0}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=(this.money,.35*i),s=.07*i,a=t+.03*i,r=e+.03*i;S({x:a,y:r,width:o,height:s,radius:.02*i}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText("MONEY 货币",a+o/2,r+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.money,s=.35*i,a=.2*n,r=t+i-s-.1*n,h=e+n-a-.1*n;S({x:r,y:h,width:s,height:a,radius:a/2}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText([master.name,o.number].join(" "),r+s/2,h+a/2)}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.money;V.save(),S({x:t,y:e,width:i,height:n,radius:8}),V.clip(),b(o.imageDOM,{x:t,y:e,width:i,height:n}),V.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),V.restore()}}class J{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.explore=t.explore,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!x(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.35*i,a=.2*n,r=t+.1*n,h=e+.1*n,l=a/2;V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,C({x:r,y:h,width:s,height:a,radius:l}),V.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",V.fill(),V.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",V.fillText("EXPLORE 探索",r+s/2,h+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.35*i,a=.2*n,r=t+i-s-.1*n,h=e+n-a-.1*n;C({x:r,y:h,width:s,height:a,radius:a/2}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(o.name,r+s/2,h+a/2)}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.explore;V.save(),S({x:t,y:e,width:i,height:n,radius:8}),V.clip(),b(o.imageDOM,{x:t,y:e,width:i,height:n}),V.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),V.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Z{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.shop=t.shop,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!x(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.35*i,a=.2*n,r=t+.1*n,h=e+.1*n,l=a/2;V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,C({x:r,y:h,width:s,height:a,radius:l}),V.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",V.fill(),V.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",V.fillText("SHOP 礼盒",r+s/2,h+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.35*i,a=.2*n,r=t+i-s-.1*n,h=e+n-a-.1*n;C({x:r,y:h,width:s,height:a,radius:a/2}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(o.name,r+s/2,h+a/2)}drawExtra(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.35*i,a=.2*n,r=t+i-s-.1*n,h=e+n-a-.4*n;C({x:r,y:h,width:s,height:a,radius:a/2}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText([o.money.name,o.money.number].join(" "),r+s/2,h+a/2)}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.shop;V.save(),S({x:t,y:e,width:i,height:n,radius:8}),V.clip(),b(o.imageDOM,{x:t,y:e,width:i,height:n}),V.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawExtra(),V.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class tt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!x(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.7*i,a=.12*i,r=t+.05*i,h=e+.05*i,l=a/2;V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.045*i}px ${window.fontFamily}`,C({x:r,y:h,width:s,height:a,radius:l}),V.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",V.fill(),V.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",V.fillText("CARD 卡牌",r+s/2,h+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.7*i,a=.12*i,r=t+i-s-.05*i,h=e+n-a-.05*i,l=a/2,c=[o.name,w(o.level)];C({x:r,y:h,width:s,height:a,radius:l}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.045*i}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(c.join(" "),r+s/2,h+a/2)}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.card;V.save(),S({x:t,y:e,width:i,height:n,radius:8}),V.clip(),b(o.imageDOM,{x:t,y:e,width:i,height:n}),V.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),V.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class et{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.master=t.master,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!x(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.35*i,a=.2*n,r=t+.1*n,h=e+.1*n,l=a/2;V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,C({x:r,y:h,width:s,height:a,radius:l}),V.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",V.fill(),V.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",V.fillText("MASTER 队长",r+s/2,h+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.35*i,a=.2*n,r=t+i-s-.1*n,h=e+n-a-.1*n;C({x:r,y:h,width:s,height:a,radius:a/2}),V.fillStyle="rgba(255, 255, 255, 0.75)",V.fill(),V.textAlign="center",V.textBaseline="middle",V.font=`900 ${.075*n}px ${window.fontFamily}`,V.fillStyle="rgba(0, 0, 0, 1)",V.fillText([o.name,w(o.level)].join(" "),r+s/2,h+a/2)}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.master;V.save(),S({x:t,y:e,width:i,height:n,radius:8}),V.clip(),b(o.imageDOM,{x:t,y:e,width:i,height:n}),V.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),V.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class it{constructor(){this.x=0,this.y=G,this.width=Q,this.height=z-G,this.skillIndex=0,this.novaTime=0,this.explore,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore;A(o.imageDOM,{x:t,y:e,width:i,height:.4*n})}drawContent(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore;V.font=`900 ${.014*n}px ${window.fontFamily}`;const s=["EXPLORE 探索",o.name,["难度",o.difficulty].join(" ")];s.forEach(((e,o)=>{const s=.04*n,a=t+.05*i,r=.4*n+.02*n+o*n*.06;C({x:a,y:r,width:i-.1*i,height:s,radius:s/2}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="middle",V.fillStyle="rgba(255, 255, 255, 1)",V.fillText(e,a+s,r+s/2)}));{const e=i-.04*n,a=.25*n,r=t+.05*i,h=.4*n+.02*n+s.length*n*.06;C({x:r,y:h,width:e,height:a,radius:.02*n}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="top",V.fillStyle="rgba(255, 255, 255, 1)",k({x:r+.04*n,y:h+.02*n,width:e-.08*n,wrapSpace:.021*n,text:o.description}),this.extra&&this.extra.forEach(((t,e)=>{var i=.12*n,o=.04*n,s=o/2,r=(Q-i)/2,l=h+a+.02*n;V.textAlign="center",V.textBaseline="middle";const c=this.extra.length;C({x:r+=(e-(c/2-.5))*(i+.02*n),y:l,width:i,height:o,radius:s}),V.fillStyle="rgba(255, 255, 255, 1)",V.fill(),V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(t.name,r+i/2,l+o/2),window.Imitation.state.function.event("touchstart",(()=>t.event()),{ifTouchCover:{x:r,y:l,width:i,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),V.save(),V.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),V.restore(),window.Imitation.state.function.event("touchstart",this.close)}}class nt{constructor(){this.x=0,this.y=G,this.width=Q,this.height=z-G,this.skillIndex=0,this.novaTime=0,this.shop,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop;A(o.imageDOM,{x:t,y:e,width:i,height:.4*n})}drawContent(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop;V.font=`900 ${.014*n}px ${window.fontFamily}`;const s=["SHOP 礼盒",o.name,[o.money.name,":","售价",o.money.number,"/","拥有",window.Imitation.state.info.money.find((t=>t.key===o.money.key)).number].join(" ")];s.forEach(((e,o)=>{const s=.04*n,a=t+.05*i,r=.4*n+.02*n+o*n*.06;C({x:a,y:r,width:i-.1*i,height:s,radius:s/2}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="middle",V.fillStyle="rgba(255, 255, 255, 1)",V.fillText(e,a+s,r+s/2)}));{const e=i-.04*n,a=.25*n,r=t+.05*i,h=.4*n+.02*n+s.length*n*.06;C({x:r,y:h,width:e,height:a,radius:.02*n}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="top",V.fillStyle="rgba(255, 255, 255, 1)",k({x:r+.04*n,y:h+.02*n,width:e-.08*n,wrapSpace:.021*n,text:o.description}),this.extra&&this.extra.forEach(((t,e)=>{var i=.12*n,o=.04*n,s=o/2,r=(Q-i)/2,l=h+a+.02*n;V.textAlign="center",V.textBaseline="middle";const c=this.extra.length;C({x:r+=(e-(c/2-.5))*(i+.02*n),y:l,width:i,height:o,radius:s}),V.fillStyle="rgba(255, 255, 255, 1)",V.fill(),V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(t.name,r+i/2,l+o/2),window.Imitation.state.function.event("touchstart",(()=>t.event()),{ifTouchCover:{x:r,y:l,width:i,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),V.save(),V.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),V.restore(),window.Imitation.state.function.event("touchstart",this.close)}}class ot{constructor(){this.x=0,this.y=G,this.width=Q,this.height=z-G,this.skillIndex=0,this.novaTime=0,this.card,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card;A(o.imageDOM,{x:t,y:e,width:i,height:.4*n})}drawContent(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card;V.font=`900 ${.014*n}px ${window.fontFamily}`;const s=["CARD 卡牌",[o.name,w(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),[o.race,"·",o.type].join(" ")];s.forEach(((e,o)=>{const s=.04*n,a=t+.05*i,r=.4*n+.02*n+o*n*.06;C({x:a,y:r,width:i-.1*i,height:s,radius:s/2}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="middle",V.fillStyle="rgba(255, 255, 255, 1)",V.fillText(e,a+s,r+s/2)}));{const e=i-.04*n,a=.25*n,r=t+.05*i,h=.4*n+.02*n+s.length*n*.06;C({x:r,y:h,width:e,height:a,radius:.02*n}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="top",V.fillStyle="rgba(255, 255, 255, 1)",k({x:r+.04*n,y:h+.02*n,width:e-.08*n,wrapSpace:.021*n,text:o.description(o.level)}),this.extra&&this.extra.forEach(((t,e)=>{var i=.12*n,o=.04*n,s=o/2,r=(Q-i)/2,l=h+a+.02*n;V.textAlign="center",V.textBaseline="middle";const c=this.extra.length;C({x:r+=(e-(c/2-.5))*(i+.02*n),y:l,width:i,height:o,radius:s}),V.fillStyle="rgba(255, 255, 255, 1)",V.fill(),V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(t.name,r+i/2,l+o/2),window.Imitation.state.function.event("touchstart",(()=>t.event()),{ifTouchCover:{x:r,y:l,width:i,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),V.save(),V.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),V.restore(),window.Imitation.state.function.event("touchstart",this.close)}}class st{constructor(){this.x=0,this.y=G,this.width=Q,this.height=z-G,this.skillIndex=0,this.novaTime=0,this.master,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master;A(o.imageDOM,{x:t,y:e,width:i,height:.4*n})}drawContent(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=this.skillIndex;V.font=`900 ${.014*n}px ${window.fontFamily}`;const a=["MASTER 队长",[o.name,w(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),["HP",o.HP].join(" "),["ATTACT",o.ATTACT].join(" ")];a.forEach(((e,o)=>{const s=.04*n,a=t+.05*i,r=.4*n+.02*n+o*n*.06;C({x:a,y:r,width:i-.1*i,height:s,radius:s/2}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="middle",V.fillStyle="rgba(255, 255, 255, 1)",V.fillText(e,a+s,r+s/2)}));{const e=i-.1*i,r=.25*n,h=t+.05*i,l=.4*n+.02*n+a.length*n*.06;C({x:h,y:l,width:e,height:r,radius:.02*n}),V.fillStyle="rgba(0, 0, 0, 1)",V.fill(),V.textAlign="start",V.textBaseline="top",V.fillStyle="rgba(255, 255, 255, 1)",k({x:h+.04*n,y:l+.02*n,width:e-.08*n,wrapSpace:.021*n,text:o.skill[this.skillIndex].description(o.level)}),o.skill.forEach(((t,e)=>{var i=.12*n,a=.04*n,h=a/2,c=(Q-i)/2,d=l+r-a-12;V.textAlign="center",V.textBaseline="middle";const f=o.skill.length;C({x:c+=(e-(f/2-.5))*(i+.02*n),y:d,width:i,height:a,radius:h}),V.fillStyle=e===s?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",V.fill(),V.fillStyle=e===s?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",V.fillText(t.name,c+i/2,d+a/2),window.Imitation.state.function.event("touchstart",(()=>this.skillIndex=e),{ifTouchCover:{x:c,y:d,width:i,height:a},stop:!0})})),this.extra&&this.extra.forEach(((t,e)=>{var i=.12*n,o=.04*n,s=o/2,a=(Q-i)/2,h=l+r+.02*n;V.textAlign="center",V.textBaseline="middle";const c=this.extra.length;C({x:a+=(e-(c/2-.5))*(i+.02*n),y:h,width:i,height:o,radius:s}),V.fillStyle="rgba(255, 255, 255, 1)",V.fill(),V.fillStyle="rgba(0, 0, 0, 1)",V.fillText(t.name,a+i/2,h+o/2),window.Imitation.state.function.event("touchstart",(()=>t.event()),{ifTouchCover:{x:a,y:h,width:i,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),V.save(),V.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),V.restore(),window.Imitation.state.function.event("touchstart",this.close)}}canvas.getContext("2d");const at=wx.getSystemInfoSync().safeArea.top,rt=wx.getSystemInfoSync().windowWidth,ht=wx.getSystemInfoSync().windowHeight,lt=class{constructor(){this.preview=null,this.type="alltime",this.explore,this.InstanceNavigation,this.InstanceScroll,this.InstanceExplore,this.InstanceExplorePreview,this.init()}get exploreHeight(){const t=this.explore.length;return(rt-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.explore=window.Imitation.state.explore.filter((t=>t.type===this.type)),this.instanceNavigation(),this.instanceScroll(),this.instanceExplore(),this.instanceExplorePreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"alltime"!==this.type||(t="week_"+(new Date).getDay()),t||this.type!=="week_"+(new Date).getDay()||(t="alltime"),this.type=t,this.init()}},{justifyContent:"right",text:"探索"}]]};this.InstanceNavigation=new U(t)}instanceScroll(){const t={x:12,y:12+at,width:rt-24,height:ht-this.InstanceNavigation.height-36-at,contentHeight:this.exploreHeight};this.InstanceScroll=new W(t)}instanceExplore(){this.InstanceExplore=this.explore.map(((t,e)=>{const i={width:rt-24,explore:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(rt-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+at,new J(i)}))}instanceExplorePreview(){const t={};t.width=.7*rt,t.height=1.35*t.width,t.x=.15*rt,t.y=(ht-1.5*t.width)/2-60,this.InstanceExplorePreview=new it(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceExplore.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){this.preview.inTeam||(this.InstanceExplorePreview.extra=[{name:"战斗",event:()=>this.enter(this.preview)}]),this.InstanceExplorePreview.close=t=>{this.preview=null,this.InstanceExplorePreview.novaTime=0,this.InstanceExplore.forEach((t=>t.novaTime=0))},this.InstanceExplorePreview.explore=this.preview,this.InstanceExplorePreview.render()}enter(t){window.Imitation.state.battle={self:{master:{...u([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:f(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...u([t.boss.master])[0],buff:[]},card:{team:f(t.boss.card),hand:[]},AI:t.AI},reward:t.reward},window.Imitation.state.battle.self.card.team.length<8?window.Imitation.state.function.message("卡组数量满足8张","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(window.Imitation.state.page.current="transition",window.Imitation.state.page.next="pve")}render(){b(s.get("background-page"),{x:0,y:0,width:rt,height:ht}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},ct=canvas.getContext("2d"),dt=wx.getSystemInfoSync().safeArea.top,ft=wx.getSystemInfoSync().windowWidth,ut=wx.getSystemInfoSync().windowHeight,mt=(t,e,i)=>{const n=new Array(e).fill(t/e),o=()=>{requestAnimationFrame((()=>{i(n.shift()),n[0]&&o()}))};o()};class wt{constructor(){this.width=Math.min(.7*ft,.5*(ut-dt)),this.height=1.35*this.width,this.x=(ft-this.width)/2,this.y=(ut-dt-this.height)/2,this.card,this.nova=!1,this.novaTime=0,this.novaOverTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}play(t){this.card=t,this.nova=!0}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.7*i,s=.12*i,a=t+.05*i,r=e+.05*i;C({x:a,y:r,width:o,height:s,radius:s/2}),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText("CARD 卡牌",a+o/2,r+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.7*i,a=.12*i,r=t+i-s-.05*i,h=e+n-a-.05*i,l=a/2,c=[o.name,w(o.level)];o.number&&c.push("x"+o.number),C({x:r,y:h,width:s,height:a,radius:l}),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText(c.join(" "),r+s/2,h+a/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=.12*i,r=t+.05*i,h=e+.22*i;C({x:r,y:h,width:s,height:a,radius:4}),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText(o.race+" · "+o.type,r+s/2,h+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=t+.05*i,r=e+.56*i;C({x:a,y:r,width:s,height:.57*i,radius:4}),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),ct.textAlign="start",ct.textBaseline="top",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle="rgba(255, 255, 255, 1)",k({x:a+.05*i,y:r+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description(o.level)})}render(){if(this.nova&&this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),1===this.novaTime&&(this.novaOverTime=this.novaOverTime+1,this.nova=!1),!this.nova&&this.novaTime>0&&40===this.novaOverTime&&(this.novaTime=y(this.novaTime-.05)),0===this.novaTime)return void(this.novaOverTime=0);const t=this.card,{x:e,y:i,width:n,height:o}=this.option;ct.save(),ct.globalAlpha=this.novaTime,P({x:0,y:0,width:ft,height:ut}),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),C({x:e,y:i,width:n,height:o,radius:16}),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fill(),b(t.imageDOM,{x:e,y:i,width:n,height:o}),this.drawTitle(),this.drawName(),this.drawRaceType(),this.drawDescription(),ct.restore()}}class pt{constructor(){this.queqe=[],this.time=60}play(t){this.queqe.push({...t,time:this.time})}render(){this.queqe.forEach((t=>{const e=t.fontSize,i=t.text,n=(t.time-this.time)/4,o=(t.time-this.time)/2;ct.save(),ct.globalAlpha=t.time/this.time,ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${e}px ${window.fontFamily}`;const s=ct.measureText(i).width+48;S({x:t.x-s/2+n,y:t.y-e+o,width:s,height:2*e,radius:.5*e}),ct.fillStyle="rgba(255, 255, 255, 0.75)",ct.fill(),ct.fillStyle="rgba(0, 0, 0, 1)",ct.fillText(i,t.x+n,t.y+o),ct.restore(),t.time=y(t.time-1),0===t.time&&(this.queqe=this.queqe.filter((t=>t.time)))}))}}class gt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.novaTime=0,this.card=t.card}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05));const t=this.x,e=this.y,i=this.width,n=this.height;ct.save(),ct.globalAlpha=this.novaTime,C({x:t,y:e,width:i,height:n,radius:8}),ct.clip(),ct.fillStyle="rgba(0, 0, 0, 0.5)",ct.fill(),ct.restore()}}class yt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.touchStart=t.touchStart,this.touchEnd=t.touchEnd,this.mouseDownPosition=null,this.novaTime=0,this.ifTouchEndTime=0,this.mouseDownPositionTime=0}get ifTouchEnd(){return this.offsetY<0-this.height/2}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}get optionDiff(){const t=.5*-this.width,e=.5*-this.height,i=this.width,n=this.height;return{x:this.x+this.offsetX+t*this.mouseDownPositionTime,y:this.y+this.offsetY+e*this.mouseDownPositionTime,width:this.width+i*this.mouseDownPositionTime,height:this.height+n*this.mouseDownPositionTime}}get color(){const t=this.ifTouchEndTime,e=[0,0,0];return[`rgba(${Math.floor(255-t*(255-e[0]))}, ${Math.floor(255-t*(255-e[1]))}, ${Math.floor(255-t*(255-e[2]))}, 0.75)`,`rgba(${Math.floor(t*(255-e[0])+e[0])}, ${Math.floor(t*(255-e[1])+e[1])}, ${Math.floor(t*(255-e[2])+e[2])}, 1)`]}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.ifTouchEnd&&this.touchEnd(),this.mouseDownPosition=null,this.offsetX=0,this.offsetY=0}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i],this.offsetX=this.offsetX+e,this.offsetY=this.offsetY+i}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=.7*i,a=.12*i,r=t+.05*i,h=e+.05*i;C({x:r,y:h,width:s,height:a,radius:a/2}),ct.fillStyle=o[0],ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle=o[1],ct.fillText("CARD 卡牌",r+s/2,h+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.7*i,r=.12*i,h=t+i-a-.05*i,l=e+n-r-.05*i,c=r/2,d=[s.name,w(s.level)];s.number&&d.push("x"+s.number),C({x:h,y:l,width:a,height:r,radius:c}),ct.fillStyle=o[0],ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle=o[1],ct.fillText(d.join(" "),h+a/2,l+r/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.9*i,r=.12*i,h=t+.05*i,l=e+.22*i;C({x:h,y:l,width:a,height:r,radius:2}),ct.fillStyle=o[0],ct.fill(),ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle=o[1],ct.fillText(s.race+" · "+s.type,h+a/2,l+r/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.9*i,r=t+.05*i,h=e+.56*i;C({x:r,y:h,width:a,height:.57*i,radius:2}),ct.fillStyle=o[0],ct.fill(),ct.textAlign="start",ct.textBaseline="top",ct.font=`900 ${.045*i}px ${window.fontFamily}`,ct.fillStyle=o[1],k({x:r+.05*i,y:h+.05*i,width:a-.1*i,wrapSpace:.075*i,text:s.description(s.level)})}render(){this.novaTime<1&&(this.novaTime=y(this.novaTime+.05)),this.mouseDownPosition&&this.mouseDownPositionTime<1&&(this.mouseDownPositionTime=y(this.mouseDownPositionTime+.05)),!this.mouseDownPosition&&this.mouseDownPositionTime>0&&(this.mouseDownPositionTime=y(this.mouseDownPositionTime-.05)),this.ifTouchEnd&&this.ifTouchEndTime<1&&(this.ifTouchEndTime=y(this.ifTouchEndTime+.05)),!this.ifTouchEnd&&this.ifTouchEndTime>0&&(this.ifTouchEndTime=y(this.ifTouchEndTime-.05));const t=this.card,{x:e,y:i,width:n,height:o}=this.option;ct.save(),ct.translate(e+n/2,i+o/2),ct.scale(this.mouseDownPositionTime+1,this.mouseDownPositionTime+1),ct.translate(-(e+n/2),-(i+o/2)),ct.globalAlpha=this.novaTime,C({x:e,y:i,width:n,height:o,radius:8}),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fill(),ct.clip(),b(t.imageDOM,{x:e,y:i,width:n,height:o}),0!==this.mouseDownPositionTime&&(ct.globalAlpha=this.mouseDownPositionTime,this.drawTitle(),this.drawName(),this.drawRaceType(),this.drawDescription()),ct.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class vt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.type=t.type,this.information=t.information,this.useCard=t.useCard,this.InstanceCards=[],this.touchCard,this.show="card"}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawBackground(){const{x:t,y:e,width:i,height:n,information:o}=this;A(o.master.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:t,y:e,width:i,height:n,information:o}=this,s={width:.4*i,height:.12*i};s.x=t+i/2-s.width/2,s.y=e+.02*i,s.radius=s.height/4,ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.04*i}px ${window.fontFamily}`,S(s),ct.fillStyle="rgba(0, 0, 0, 0.5)",ct.fill(),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText([o.master.name,w(o.master.level)].join(" "),s.x+s.width/2,s.y+s.height/2)}drawACTION(){const{x:t,y:e,width:i,height:n,information:o}=this,s={width:.04*i,height:.04*i};s.x=t+i/2+.2*i+.04*i,s.y=e+.06*i,s.radius=s.height/2,o.master._ACTION&&o.master._ACTION>0&&new Array(o.master._ACTION).fill().forEach(((t,e)=>{const n={...s,x:s.x+e*(s.width+.04*i)};S(n),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fill()}))}drawHA(){const{x:t,y:e,width:i,height:n,information:o}=this;ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 ${.04*i}px ${window.fontFamily}`;const s={width:1.2*i,height:.12*i};s.x=t+(i-s.width)/2,s.y=e+n-s.height-.02*i,s.radius=s.height/2,ct.save(),S(s),ct.clip(),ct.fillStyle="rgba(0, 0, 0, 0.5)",ct.fill(),P({...s,width:o.master.HP/o.master.HP_*s.width}),ct.fillStyle="rgba(185, 0, 0, 0.5)",ct.fill(),ct.restore(),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText(`HP ${Math.floor(o.master.HP)} / ${o.master.HP_} - ATTACT ${Math.floor(o.master.ATTACT)}`,s.x+s.width/2,s.y+s.height/2)}drawBuff(){const{x:t,y:e,width:i,height:n,information:o}=this;ct.textAlign="center",ct.textBaseline="middle",ct.fillStyle="rgba(0, 0, 0, 1)",ct.font=`900 ${.03*i}px ${window.fontFamily}`;var s=o.master.buff.reduce(((t,e)=>{const i=t.find((t=>t.name===e));return i&&(i.number=i.number+1),i||t.push({name:e,number:1}),t}),[]);0===s.length&&(s=[{name:"BUFF"}]),s.forEach(((o,a)=>{const r={width:.16*i,height:.08*i},h=a-(s.length/2-.5);r.radius=r.height/4,r.x=t+(i-r.width)/2+h*(r.width+.02*i),r.y=e+n+.02*i,S(r),ct.fillStyle="rgba(0, 0, 0, 0.75)",ct.fill(),ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText(o.number?`${o.name} X${o.number}`:o.name,r.x+r.width/2,r.y+r.height/2)}))}drawCard(){const t=this.width,e=this.height,i=this.x-(t-this.width)/2,n=this.y;this.InstanceCards=this.InstanceCards.filter((t=>this.information.card.hand.find((e=>e===t.card)))),this.information.card.hand.forEach(((o,s)=>{const a=s-(this.information.card.hand.length/2-.5),r={};r.width=.42*t,r.height=1.35*r.width,r.x=i+(t-r.width)/2+a*t*.45,r.y=n+(e-r.height)/2,r.touchStart=()=>this.touchCard=o,r.touchEnd=()=>this.useCard(o);const h=this.InstanceCards.find((t=>t.card===o));if(h&&(h.x=r.x),!h){const t="self"===this.type?yt:gt;this.InstanceCards.push(new t({card:o,...r}))}})),this.InstanceCards.forEach((t=>t.card!==this.touchCard?t.render():null)),this.InstanceCards.forEach((t=>t.card===this.touchCard?t.render():null))}render(){this.drawBackground(),this.drawTitle(),this.drawACTION(),this.drawHA(),this.drawBuff(),this.drawCard()}}const xt=class{constructor(){this.currentUseCard=!1,this.currentRole,this.round=.5,this.auto=!1,this.InstanceNavigation,this.InstanceRoleSelf,this.InstanceRoleOpposite,this.InstanceRoleMessage=new pt,this.InstanceCardMessage=new wt,this.instanceNavigation(),this.instanceRoleSelf(),this.instanceRoleOpposite(),this.currentRole=this.InstanceRoleSelf,this.roundStart()}instanceRoleSelf(){const t=(ut-this.InstanceNavigation.height-36-dt)/2,e={width:Math.min(.75*ft,.75*t),height:Math.min(.75*ft,.75*t),type:"self",information:window.Imitation.state.battle.self,useCard:this.useCard};e.x=(ft-e.width)/2,e.y=ut-this.InstanceNavigation.height-24-t+(t-e.height)/2,this.InstanceRoleSelf=new vt(e)}instanceRoleOpposite(){const t=(ut-this.InstanceNavigation.height-36-dt)/2,e={width:Math.min(.75*ft,.75*t),height:Math.min(.75*ft,.75*t),type:"opposite",information:window.Imitation.state.battle.opposite,useCard:this.useCard};e.x=(ft-e.width)/2,e.y=(t-e.height)/2+24+dt,this.InstanceRoleOpposite=new vt(e)}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"退出战斗",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="explore"}},{justifyContent:"left",text:"自动战斗",active:this.auto,event:()=>{this.auto=!this.auto,this.instanceNavigation(),this.oppositeAI()}},{justifyContent:"right",text:"结束回合",event:this.roundOver}]]};this.InstanceNavigation=new U(t)}drawRound(){const t={width:120,height:12};t.y=12+dt,t.x=(ft-t.width)/2,ct.textAlign="center",ct.textBaseline="middle",ct.font=`900 24px ${window.fontFamily}`,ct.fillStyle="rgba(0, 0, 0, 0.5)",ct.fillText("ROUND",t.x+t.width/2,t.y+t.height/2),ct.font=`900 14px ${window.fontFamily}`,ct.fillStyle="rgba(255, 255, 255, 1)",ct.fillText(`${Math.floor(this.round)}/99`,t.x+t.width/2,t.y+t.height/2+2)}pumpCard=(t,e)=>{2===e.information.card.hand.length&&e.information.card.cemetery.push(t),e.information.card.hand.length<2&&e.information.card.hand.push(t)};useCard=async t=>{if(this.currentUseCard)return;const e=this.currentRole,[i,n]=e===this.InstanceRoleSelf?[this.InstanceRoleSelf,this.InstanceRoleOpposite]:[this.InstanceRoleOpposite,this.InstanceRoleSelf];this.currentUseCard=!0,i.information.card.hand=i.information.card.hand.filter((e=>e!==t)),i.information.master._ACTION=i.information.master._ACTION-1,this.InstanceCardMessage.play(t),await g(120);var o=t.function(t,i.information,n.information);i.information.master.skill.forEach((e=>e.function(t,e,o,i.information,n.information)));for(var s=0,a=0;o.length;){const e=o.shift();if(e.custom&&e.custom(t,o,i.information,n.information),e.message&&window.Imitation.state.function.message(e.message,"rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),e.animation&&("self"===e.target&&window.Imitation.state.function.animation(e.animation,(t=>[i.x+i.width/2-t.width/2,i.y+i.height/2-t.height/2])),"opposite"===e.target&&window.Imitation.state.function.animation(e.animation,(t=>[n.x+n.width/2-t.width/2,n.y+n.height/2-t.height/2]))),e.roleMessage&&("self"===e.target&&(g(30*s,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:i.x+i.width/2,y:i.y+i.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),s+=1),"opposite"===e.target&&(g(30*a,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:n.x+n.width/2,y:n.y+n.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),a+=1)),e.effect){if("HP"===e.effect&&("self"===e.target&&mt(e.value,32,(t=>i.information.master.HP=Math.min(i.information.master.HP+t,i.information.master.HP_))),"opposite"===e.target&&mt(e.value,32,(t=>n.information.master.HP=Math.min(n.information.master.HP+t,n.information.master.HP_)))),"ATTACT"===e.effect&&("self"===e.target&&mt(e.value,32,(t=>i.information.master.ATTACT=i.information.master.ATTACT+t)),"opposite"===e.target&&mt(e.value,32,(t=>n.information.master.ATTACT=n.information.master.ATTACT+t))),"BUFF"===e.effect){if("self"===e.target&&(e.number>0&&i.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;i.information.master.buff=i.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}if("opposite"===e.target&&(e.number>0&&n.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;n.information.master.buff=n.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}}(e.effect="LEVEL")&&("self"===e.target&&i.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})),"opposite"===e.target&&n.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})))}}await g(120),this.roundContinue()};oppositeAI=async()=>{const t=this.currentRole;var e;t.information.AI&&(e=t.information.AI(t.information,this.InstanceRoleSelf.information)),t.information.AI||(e=v(t.information.card.hand,1)[0]),await g(60),await this.useCard(e),await g(60)};roundStart=async()=>{this.round=this.round+.5;const t=this.currentRole;t.information.roundCache=null,t.information.master._ACTION=t.information.master.ACTION,t.information.card.hand=v(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()};roundContinue=async()=>{const t=this.currentRole;t.information.master._ACTION>0&&(t.information.card.hand=v(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()),0===t.information.master._ACTION&&this.roundOver(),this.currentUseCard=!1};roundOver=async()=>{const t=this.currentRole;return t.information.master._ACTION=0,t.information.card.hand=[],this.currentRole===this.InstanceRoleSelf?(this.currentRole=this.InstanceRoleOpposite,void await this.roundStart()):this.currentRole===this.InstanceRoleOpposite?(this.currentRole=this.InstanceRoleSelf,void await this.roundStart()):void 0};battlerOver=()=>{if(this.InstanceRoleOpposite.information.master.HP<=0){const t=window.Imitation.state.battle.reward();return window.Imitation.state.function.message("战斗胜利","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:t,back:"explore",title:"战斗胜利"},window.Imitation.state.page.current="transition",void(window.Imitation.state.page.next="reward")}if(this.InstanceRoleSelf.information.master.HP<=0)return window.Imitation.state.function.message("战斗失败","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:[],back:"explore",title:"战斗失败"},window.Imitation.state.page.current="transition",void(window.Imitation.state.page.next="reward")};render(){b(s.get("background-page"),{x:0,y:0,width:ft,height:ut}),this.drawRound(),this.InstanceNavigation.render(),this.InstanceRoleOpposite.render(),this.InstanceRoleSelf.render(),this.InstanceCardMessage.render(),this.InstanceRoleMessage.render(),this.battlerOver()}},Tt=(canvas.getContext("2d"),wx.getSystemInfoSync().safeArea.top),It=wx.getSystemInfoSync().windowWidth,bt=wx.getSystemInfoSync().windowHeight,At=class{constructor(){this.preview=null,this.type="card",this.master,this.card,this.InstanceNavigation,this.InstanceScroll,this.InstanceMasterList,this.InstanceMasterPreview,this.InstanceCardList,this.InstanceCardPreview,this.init()}get masterHeight(){const t=this.master.length;return(It-60)/4*1.35*t+(t?12*(t-1):0)}get cardHeight(){const t=Math.ceil(this.card.length/4);return(It-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.master=[],this.card=[],"card"===this.type&&(this.master=u([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))]).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key===t.key,t))),this.card=f(window.Imitation.state.info.library.card).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i}))),"master"===this.type&&(this.master=u(window.Imitation.state.info.library.master).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key===t.key,t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i})),this.card=f(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))).sort(((t,e)=>t.key-e.key))),this.instanceNavigation(),this.instanceScroll(),this.instanceMasterList(),this.instanceCardList(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["card","卡牌"],["master","队长"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"card"!==this.type||(t="master"),t||"master"!==this.type||(t="card"),this.type=t,this.init()}},{active:!0,justifyContent:"left",text:w(window.Imitation.state.info.teamIndex+1),event:()=>{window.Imitation.state.info.teamIndex=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex+1]?window.Imitation.state.info.teamIndex+1:0,this.init()}},{justifyContent:"right",text:"编队"}]]};this.InstanceNavigation=new U(t)}instanceScroll(){const t={x:12,y:12+Tt,width:It-24,height:bt-this.InstanceNavigation.height-36-Tt,contentHeight:this.masterHeight+this.cardHeight+12};this.InstanceScroll=new W(t)}instanceMasterList(){this.InstanceMasterList=this.master.map(((t,e)=>{const i={width:It-24,master:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(It-60)/4*1.35,i.x=12,"master"===this.type&&(i.y=24+e*(i.height+12)+this.cardHeight+Tt),"card"===this.type&&(i.y=12+e*(i.height+12)+Tt),new et(i)}))}instanceCardList(){this.InstanceCardList=this.card.map(((t,e)=>{const i={width:(It-60)/4,card:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),"master"===this.type&&(i.y=12+parseInt(e/4)*(i.height+12)+Tt),"card"===this.type&&(i.y=24+parseInt(e/4)*(i.height+12)+this.masterHeight+Tt),new tt(i)}))}instanceCardPreview(){this.InstanceCardPreview=new ot}instanceMasterPreview(){this.InstanceMasterPreview=new st}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceCardList.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMasterList.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=()=>{this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0,this.InstanceCardList.forEach((t=>t.novaTime=0)),this.InstanceMasterList.forEach((t=>t.novaTime=0))};this.InstanceCardList.find((t=>t.card===this.preview))&&(this.preview.inTeam&&(this.InstanceCardPreview.extra=[{name:"卸载",event:()=>this.unloadCard(this.preview)}]),this.preview.inTeam||(this.InstanceCardPreview.extra=[{name:"装载",event:()=>this.loadCard(this.preview)}]),this.InstanceCardPreview.close=t,this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.render()),this.InstanceMasterList.find((t=>t.master===this.preview))&&(this.preview.inTeam||(this.InstanceMasterPreview.extra=[{name:"装载",event:()=>this.loadMaster(this.preview)}]),this.InstanceMasterPreview.close=t,this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.render())}loadCard(t){const e=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));8!==e.length?i?window.Imitation.state.function.message("卡牌已装载","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(i||e.push({key:t.key}),this.init(),this.preview=null,window.Imitation.state.function.message("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.setInfo()):window.Imitation.state.function.message("超出卡组数量限制","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}unloadCard(t){const e=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));i?(e.splice(e.indexOf(i),1),this.init(),this.preview=null,window.Imitation.state.function.message("卸载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.setInfo()):window.Imitation.state.function.message("未装载当前卡牌","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}loadMaster(t){window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key=t.key,this.init(),this.preview=null,window.Imitation.state.function.message("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.setInfo()}render(){b(s.get("background-page"),{x:0,y:0,width:It,height:bt}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},St=(canvas.getContext("2d"),wx.getSystemInfoSync().safeArea.top),Ct=wx.getSystemInfoSync().windowWidth,Pt=wx.getSystemInfoSync().windowHeight,kt=class{constructor(){this.preview=null,this.money=1,this.type="alltime",this.shop,this.InstanceNavigation,this.InstanceScroll,this.InstanceShop,this.InstanceShopPreview,this.init()}get shopHeight(){const t=this.shop.length;return(Ct-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.shop=window.Imitation.state.shop.filter((t=>t.type===this.type)).map((t=>(t.money=m([t.money])[0],t))),this.instanceNavigation(),this.instanceScroll(),this.instanceShop(),this.instanceShopPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"alltime"!==this.type||(t="week_"+(new Date).getDay()),t||this.type!=="week_"+(new Date).getDay()||(t="alltime"),this.type=t,this.init()}},{justifyContent:"right",text:"商店"}]]};this.InstanceNavigation=new U(t)}instanceScroll(){const t={x:12,y:12+St,width:Ct-24,height:Pt-this.InstanceNavigation.height-36-St,contentHeight:this.shopHeight};this.InstanceScroll=new W(t)}instanceShop(){this.InstanceShop=this.shop.map(((t,e)=>{const i={width:Ct-24,shop:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(Ct-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+St,new Z(i)}))}instanceShopPreview(){this.InstanceShopPreview=new nt}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceShop.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=()=>{this.buy(this.preview),this.preview=null,this.InstanceShopPreview.novaTime=0};this.preview.inTeam||(this.InstanceShopPreview.extra=[{name:"购买",event:()=>t()}]),this.InstanceShopPreview.close=t=>{this.preview=null,this.InstanceShopPreview.novaTime=0,this.InstanceShop.forEach((t=>t.novaTime=0))},this.InstanceShopPreview.shop=this.preview,this.InstanceShopPreview.render()}buy(t){const e=window.Imitation.state.info.money.find((e=>e.key===t.money.key));if(e.number<t.money.number)return void window.Imitation.state.function.message("货币不足","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)");e.number=e.number-t.money.number;const i=t.reward();window.Imitation.state.function.message("购买成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:i,back:"shop",title:"购买获得"},window.Imitation.state.page.current="transition",window.Imitation.state.page.next="reward"}render(){b(s.get("background-page"),{x:0,y:0,width:Ct,height:Pt}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},Mt=(canvas.getContext("2d"),wx.getSystemInfoSync().safeArea.top),Et=wx.getSystemInfoSync().windowWidth,_t=wx.getSystemInfoSync().windowHeight,Ot=class{constructor(){this.preview=null,this.type,this.card=[],this.master=[],this.money=[],this.InstanceNavigation,this.InstanceScroll,this.InstanceCard,this.InstanceCardPreview,this.InstanceMaster,this.InstanceMasterPreview,this.InstanceMoney,this.init(),this.compute()}get masterHeight(){const t=this.master.length;return(Et-60)/4*1.35*t+(t?12*(t-1):0)}get cardHeight(){const t=Math.ceil(this.card.length/4);return(Et-60)/4*1.35*t+(t?12*(t-1):0)}get moneyHeight(){const t=Math.ceil(this.money.length/4);return(Et-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.card=[],this.master=[],this.money=[],!this.type&&window.Imitation.state.reward.value.some((t=>t.card))&&(this.type="card"),!this.type&&window.Imitation.state.reward.value.some((t=>t.master))&&(this.type="master"),!this.type&&window.Imitation.state.reward.value.some((t=>t.money))&&(this.type="money"),"card"===this.type&&(this.card=f(window.Imitation.state.reward.value.filter((t=>t.card)).map((t=>({...t,level:1}))))),"master"===this.type&&(this.master=u(window.Imitation.state.reward.value.filter((t=>t.master)).map((t=>({...t,level:1}))))),"money"===this.type&&(this.money=m(window.Imitation.state.reward.value.filter((t=>t.money)))),this.instanceNavigation(),this.instanceScroll(),this.instanceCard(),this.instanceMaster(),this.instanceMoney(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next=window.Imitation.state.reward.back}},{active:!0,justifyContent:"left",text:new Array(["card","卡牌"],["master","队长"],["money","资源"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"card"!==this.type||(t="master"),t||"master"!==this.type||(t="money"),t||"money"!==this.type||(t="card"),this.type=t,this.init()}},{justifyContent:"right",text:window.Imitation.state.reward.title}]]};this.InstanceNavigation=new U(t)}instanceScroll(){const t={x:12,y:12+Mt,width:Et-24,height:_t-this.InstanceNavigation.height-36-Mt,contentHeight:this.masterHeight+this.cardHeight+this.moneyHeight+12};this.InstanceScroll=new W(t)}instanceMaster(){this.InstanceMaster=this.master.map(((t,e)=>{const i={width:Et-24,master:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(Et-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+Mt,new et(i)}))}instanceCard(){this.InstanceCard=this.card.map(((t,e)=>{const i={width:(Et-60)/4,card:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),i.y=12+parseInt(e/4)*(i.height+12)+Mt,new tt(i)}))}instanceMoney(){this.InstanceMoney=this.money.map(((t,e)=>{const i={width:Et-24,money:t};return i.height=(Et-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+Mt,new K(i)}))}instanceCardPreview(){this.InstanceCardPreview=new ot}instanceMasterPreview(){this.InstanceMasterPreview=new st}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceMaster.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceCard.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMoney.forEach((t=>{t.offsetY=0-e;const i=T(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=t=>{this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0,this.InstanceCard.forEach((t=>t.novaTime=0)),this.InstanceMaster.forEach((t=>t.novaTime=0)),this.InstanceMoney.forEach((t=>t.novaTime=0))};this.InstanceCard.find((t=>t.card===this.preview))&&(this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.close=t,this.InstanceCardPreview.render()),this.InstanceMaster.find((t=>t.master===this.preview))&&(this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.close=t,this.InstanceMasterPreview.render())}compute(){const t=window.Imitation.state.info.library;window.Imitation.state.reward.value.forEach((e=>{if(e.card){const i=t.card.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.card.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}if(e.master){const i=t.master.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.master.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}})),window.Imitation.state.function.setInfo()}render(){b(s.get("background-page"),{x:0,y:0,width:Et,height:_t}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},Ht=canvas.getContext("2d"),jt=(wx.getSystemInfoSync().safeArea.top,wx.getSystemInfoSync().windowWidth),$t=wx.getSystemInfoSync().windowHeight;class Nt{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeoutRef=null,this.show=!1,this.opacity=0,this.width=Math.min(jt-24,200),this.height=32,this.x=(jt-this.width)/2,this.y=$t}send(t,e="rgba(255, 255, 255, 1)",i="rgba(0, 0, 0, 1)"){clearTimeout(this.timeoutRef),this.message=t,this.backgroundColor=e,this.textColor=i,this.show=!0,this.timeoutRef=g(60,(()=>{this.show=!1,this.timeoutRef=null}))}render(){this.show&&this.opacity<1&&(this.opacity=y(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=y(this.opacity-.05)),this.show&&this.y>$t-44&&(this.y=y(this.y-4)),!this.show&&this.y<$t&&(this.y=y(this.y+4)),(this.show||0!==this.opacity)&&(Ht.save(),Ht.globalAlpha=this.opacity,Ht.textAlign="center",Ht.textBaseline="middle",Ht.font=`900 10px ${window.fontFamily}`,Ht.fillStyle=this.backgroundColor,S({x:this.x,y:this.y,width:this.width,height:this.height,radius:8}),Ht.fill(),Ht.fillStyle=this.textColor,Ht.fillText(this.message,this.x+this.width/2,this.y+this.height/2),Ht.restore())}}const Dt="static/0.png",Rt="static/1.png",Bt="static/2.png",Lt="static/3.png",Ft="static/4.png",Wt="static/5.png",Xt=canvas.getContext("2d");class Yt{constructor(){var t;this.map={"red-hit":[Dt,Dt,Rt,Rt,Bt,Bt,Lt,Lt,Ft,Ft,Wt,Wt]},this.queqe=[],t=this.map,Object.entries(t).forEach((t=>{t[1].forEach(((e,i)=>{const n=new Image;n.src=t[1][i],t[1][i]=n}))}))}play(t,e){this.map[t]&&this.queqe.push({index:0,imgs:this.map[t],option:e,option:e})}render(){this.queqe.forEach(((t,e)=>{const i=t.imgs[t.index];i&&(Xt.drawImage(i,...t.option(i)),t.index=t.index+1),i||this.queqe.splice(e,1)}))}}const qt=new class{constructor(){this.map={},this.audioQueue=new Array(8).fill().map((t=>new Audio))}play(t,e=!1){const i=this.audioQueue.find((t=>!t.playing));i.onended=()=>i.playing=!1,i.playing=!0,i.loop=e,i.src=this.map[t],i.play()}},Ut=new class{constructor(){this.event=[],this.init()}init=()=>{const t=(t,e)=>{const i=this.event.filter((t=>t.type===e)).sort(((t,e)=>e.priority-t.priority));var n=!1;i.forEach((e=>{n||e.option&&e.option.ifTouchCover&&!x(t,e.option.ifTouchCover)||(e.option&&e.option.stop&&(n=!0),"function"==typeof e.callback&&e.callback(t))}))};new Array("touchstart","touchmove","touchend","mousedown","mousemove","mouseup").forEach((e=>{canvas.addEventListener(e,(i=>t(i,e)),{passive:!0})}))};addEventListener=(t,e,i)=>{try{window.wx._web&&void 0===window.ontouchstart&&"touchstart"===t&&(t="mousedown"),window.wx._web&&void 0===window.ontouchmove&&"touchmove"===t&&(t="mousemove"),window.wx._web&&void 0===window.ontouchend&&"touchend"===t&&(t="mouseup")}catch{}this.event.push({type:t,callback:e,option:i})};removeEventListener=(t,e)=>{this.event=this.event.filter((i=>i.type!==t&&i.callback!==e))};clearEventListener=()=>{this.event=[]}},Vt=canvas.getContext("2d");new class{constructor(){this.loadingInformation=!1,this.animationFrameId,this.instance,this.instanceMessage=new Nt,this.instanceAnimation=new Yt,this.init(),this.loopStart()}render(){Vt.clearRect(0,0,canvas.width,canvas.height),Ut.clearEventListener();const t=window.Imitation.state.page.map[window.Imitation.state.page.current];t&&(this.instance instanceof t||(this.instance=new t),this.instance.render(),this.instanceMessage.render(),this.instanceAnimation.render())}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}async init(){window.Imitation.state={page:{current:"",next:"",map:{transition:O,loading:N,home:L,explore:lt,pve:xt,store:At,shop:kt,reward:Ot}},function:{render:this.render,loopStart:this.loopStart,loopEnd:this.loopEnd,message:(...t)=>this.instanceMessage.send(...t),animation:(...t)=>this.instanceAnimation.play(...t),sound:(...t)=>qt.play(...t),event:(...t)=>Ut.addEventListener(...t),setInfo:async()=>{localStorage.setItem("info",JSON.stringify(window.Imitation.state.info))},getInfo:async()=>{localStorage.removeItem("info");const t=localStorage.getItem("info");t&&(window.Imitation.state.info=JSON.parse(t)),t||window.Imitation.state.function.initInfo()},initInfo:async()=>{const t={library:{master:c.map((t=>({key:t.key,level:1,exp:0}))),card:d.map((t=>({key:t.key,level:1,exp:0})))},team:[{master:{key:3},card:d.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:d.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:d.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:d.map((t=>({key:t.key}))).filter(((t,e)=>e<8))}],teamIndex:0,money:[{key:1,number:88888},{key:2,number:12888}]};window.Imitation.state.info=t}},info:null,battle:null,explore:h,shop:l,reward:null},window.Imitation.state.function.getInfo(),window.Imitation.state.page.current="loading",await s.load(),await g(60),r.forEach((t=>t.imageDOM=s.get("money-"+t.key))),h.forEach((t=>t.imageDOM=s.get("explore-"+t.key))),l.forEach((t=>t.imageDOM=s.get("shop-"+t.key))),c.forEach((t=>t.imageDOM=s.get("master-"+t.key))),d.forEach((t=>t.imageDOM=s.get("card-"+t.key))),window.Imitation.state.page.current="transition",window.Imitation.state.page.next=window.wx._web&&p("path")?p("path"):"home",window.wx._web&&"pve"===p("path")&&(window.Imitation.state.battle={self:{master:{...u([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:f(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...u([h[0].boss.master])[0],buff:[]},card:{team:f(h[0].boss.card),hand:[]},AI:h[0].AI},reward:h[0].reward})}}})()})();