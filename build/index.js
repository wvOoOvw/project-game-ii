(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},293:()=>{!function(){if(window.wx)return;window.wx={getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style["max-width"]="425px";const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},6:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const s=this.dependentQueue[i],h=this.executeDependent(e.dependent);return h===t||Array.isArray(h)&&Array.isArray(s)&&(n=h,o=s,Array.isArray(n)&&Array.isArray(o)&&(n.length!==o.length||n.filter(((t,e)=>t===o[e])).length!==n.length))||!Array.isArray(h)&&!Array.isArray(s)&h!==s?(this.executeEvent(e.event),void(this.dependentQueue[i]=h)):void(this.dependentQueue[i]=h);var n,o}))},e.prototype.register=function(e,i=t){const s={event:e,dependent:i};return this.monitorQueue.push(s),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===s&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const s=new i;window.Imitation=s}()}},e={};function i(s){var h=e[s];if(void 0!==h)return h.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}(()=>{"use strict";i(293),i(652),i(6);const t=(t,e,i)=>{const h=t=>s(t,i)?e(t):null;canvas.addEventListener(t,h,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,h)))},e=(t,e)=>{const i=t=>e(t);canvas.addEventListener(t,i,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,i)))},s=(t,e)=>{const i=e.x,s=e.y,h=e.width,n=e.height,o=t.x||t.touches[0].clientX,a=t.y||t.touches[0].clientY;return o>=i&&o<=i+h&&a>=s&&a<=s+n},h=(t,e)=>{const{x:i,y:s,width:h,height:n}=t,{x:o,y:a,width:r,height:c}=e;return i+h>o&&i<o+r&&s+n>a&&s<a+c},n=t=>{const e=new Image;return e.src=t,e},o=canvas.getContext("2d"),a=(t,e)=>{const i=e.x,s=e.y,h=e.width,n=e.height;var a=0,r=0,c=t.width,l=t.height;const d=Math.max(h/t.width,n/t.height),u=t.width*d-h,f=t.height*d-n;u&&(a=u/2/d,c-=u/d),f&&(r=f/2/d,l-=f/d),o.drawImage(t,a,r,c,l,i,s,h,n)},r=t=>{const e=t.x,i=t.y,s=t.width,h=t.height,n=t.radius;o.beginPath(),o.moveTo(e,i+n),o.arcTo(e,i,e+n,i,n),o.lineTo(e+s-n,i),o.arcTo(e+s,i,e+s,i+n,n),o.lineTo(e+s,i+h-n),o.arcTo(e+s,i+h,e+s-n,i+h,n),o.lineTo(e+n,i+h),o.arcTo(e,i+h,e,i+h-n,n),o.closePath()},c=t=>{const e=t.x,i=t.y,s=t.width,h=t.height;o.beginPath(),o.moveTo(e,i),o.lineTo(e+s,i),o.lineTo(e+s,i+h),o.lineTo(e,i+h),o.closePath()},l=t=>{const e=t.x,i=t.y,s=t.width,h=t.fontHeight;let n=t.text.split(""),a="",r=[];n.forEach((t=>{o.measureText(a).width>s&&(r.push(a),a=""),a+=t})),r.push(a),r.forEach(((t,s)=>{o.fillText(t,e,i+(s+1)*h)}))},d="build/162926_76690565815.jpg",u=canvas.getContext("2d"),f=n(d),m=wx.getSystemInfoSync().windowWidth,w=wx.getSystemInfoSync().windowHeight,y=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=this.opacity+.05,this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=this.opacity-.05,this.count=this.count+1),this.count>60)return Imitation.state.page.current=Imitation.state.page.next,void(Imitation.state.page.next="");u.globalAlpha=this.opacity,a(f,{x:0,y:0,width:m,height:w}),u.globalAlpha=1}};class g{constructor(){}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}const p=canvas.getContext("2d");class x extends g{constructor(t){super(t),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius||8,this.text=t.text,this.font=t.font||14,this.lineWidth=t.lineWidth||1,this.fillStyle=t.fillStyle||"white",this.strokeStyle=t.strokeStyle||"white"}render(){p.textAlign="center",p.textBaseline="middle",p.font=`bold ${this.font}px monospace`,p.lineWidth=this.lineWidth,p.strokeStyle=this.strokeStyle,p.fillStyle=this.fillStyle,r({x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius}),p.stroke(),p.fillText(this.text,this.x+this.width/2,this.y+this.height/2)}}canvas.getContext("2d");const v=n("build/234521_92189037316.jpg"),I=wx.getSystemInfoSync().windowWidth,S=wx.getSystemInfoSync().windowHeight,b=class{constructor(){}drawButtonBattle(){const e={x:I/2-60,y:.7*S,width:120,height:40,text:"探索"};new x(e).render(),t("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="explore"}),e)}drawButtonStore(){const e={x:I/2-60,y:.7*S+60,width:120,height:40,text:"仓库"};new x(e).render(),t("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="store"}),e)}drawBackground(){a(v,{x:0,y:0,width:I,height:S})}render(){this.drawBackground(),this.drawButtonBattle(),this.drawButtonStore()}},T=canvas.getContext("2d");class A extends g{constructor(t){super(t),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.scrollbar=t.scrollbar||!0,this.scrollbarOffset=t.scrollbarOffset,this.scrollbarThick=t.scrollbarThick,this.scrollbarColor=t.scrollbarColor||"rgba(0, 0, 0, opacity)",this.scrollbarOpacity=0,this.scrollbarTimeout=!1,this.scrollPosition=[0,0],this.clipFunction=()=>(t={x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius},r(t),t),this.mouseDownPosition=null}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;if(this.max<0)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var s=this.scrollPosition[0]-e,h=this.scrollPosition[1]-i;this.offsetX>0&&(s<0&&(s=0),s>this.offsetX&&(s=this.offsetX)),this.offsetY>0&&(h<0&&(h=0),h>this.offsetY&&(h=this.offsetY)),this.scrollPosition=[s,h]}render(i){T.save();const s=this.clipFunction();if(t("touchstart",this.eventDown.bind(this),s),e("touchmove",this.eventMove.bind(this)),e("touchend",this.eventUp.bind(this)),T.clip(),i(this.scrollPosition),this.scrollbar){if(this.offsetX>0){const t=this.width*(this.width/(this.offsetX+this.width)),e=this.x+(this.width-t)*(this.scrollPosition[0]/this.offsetX);c({x:e,y:this.y+this.height-this.scrollbarOffset,width:t,height:this.scrollbarThick})}if(this.offsetY>0){const t=this.height*(this.height/(this.offsetY+this.height)),e=this.y+(this.height-t)*(this.scrollPosition[1]/this.offsetY);c({x:this.x+this.width-this.scrollbarOffset,y:e,width:this.scrollbarThick,height:t})}(this.offsetX>0||this.offsetY>0)&&(this.scrollbarTimeout&&this.scrollbarOpacity<1&&(this.scrollbarOpacity=this.scrollbarOpacity+.05),!this.scrollbarTimeout&&this.scrollbarOpacity>0&&(this.scrollbarOpacity=this.scrollbarOpacity-.05),T.fillStyle=this.scrollbarColor.replace("opacity",this.scrollbarOpacity),T.fill())}T.restore()}}const k=canvas.getContext("2d"),H=wx.getSystemInfoSync().windowWidth,M=wx.getSystemInfoSync().windowHeight;class P extends g{constructor(t){super(t),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.fillStyle=t.fillStyle||"white",this.fontSize=t.fontSize||.075*t.width,this.radius=t.radius||.08*t.width,this.card=t.card,this.touchAble=t.touchAble,this.touchMode=t.touchMode,this.touchEvent=t.touchEvent,this.touchDelayTime=t.touchDelayTime,this.touchArea=t.touchArea,this.touchTimeout=null,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.displayMode=t.displayMode,this.imageMode=t.imageMode,this.imageIns=t.imageIns}render(){const i=this.x+(this.offsetX?this.offsetX:0),h=this.y+(this.offsetY?this.offsetY:0),n=this.width,o=this.height,c=this.radius,d=this.card;if(k.save(),r({x:i,y:h,width:n,height:o,radius:c}),k.clip(),"center"===this.imageMode&&a(this.imageIns,{x:i+n,y:h+n,width:n,height:o}),"overspread"===this.imageMode&&a(this.imageIns,{x:0,y:0,width:H,height:M}),k.fillStyle=this.fillStyle,k.textAlign="center",k.textBaseline="middle",k.font=`bold ${this.fontSize}px monospace`,"library"===this.displayMode&&(k.fillText(d.name,i+n/2,h+.12*n),d.number&&k.fillText("X"+d.number,i+n-.12*n,h+.12*n),k.textAlign="start",k.fillText("Lv"+d.level,i+.08*n,h+.12*n+.24*n),l({x:i+.08*n,y:h+.48*n,text:d.description(1),width:n-.25*n,fontHeight:.12*n})),"team"===this.displayMode&&(k.textAlign="start",k.fillText(d.name,i+.05*n,h+o/2),k.textAlign="end",k.fillText("Lv"+d.level,i+n-.05*n,h+o/2)),"preview"===this.displayMode&&(k.fillText(d.name,i+n/2,h+.12*n),d.number&&k.fillText("X"+d.number,i+n-.12*n,h+.12*n),k.textAlign="start",k.fillText("Lv"+d.level,i+.08*n,h+.12*n+.24*n),k.fillText(d.type,i+.08*n,h+.12*n+.36*n),k.fillText(d.attribute,i+.08*n,h+.12*n+.48*n),l({x:i+.08*n,y:h+.72*n,text:d.description(1),width:n-.25*n,fontHeight:.12*n})),k.restore(),"immediate"===this.touchMode&&this.touchAble&&t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||this.touchEvent()}),{x:i,y:h,width:n,height:o}),"delay"===this.touchMode&&this.touchAble){t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=setTimeout((()=>this.touchEvent()),this.touchDelayTime))}),{x:i,y:h,width:n,height:o});const a=()=>{clearTimeout(this.touchTimeout)};e("touchmove",a),e("touchend",a)}"click"===this.touchMode&&this.touchAble&&(t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=!0)}),{x:i,y:h,width:n,height:o}),e("touchmove",(()=>{this.touchTimeout=!1})),e("touchend",(()=>{!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1})))}}canvas.getContext("2d");const Y=n("build/153344_22433013228.jpg"),E=wx.getSystemInfoSync().safeArea.top,B=wx.getSystemInfoSync().windowWidth,C=wx.getSystemInfoSync().windowHeight,X=class{constructor(){this.InstanceScrollBox,this.offsetY,this.instance()}instance(){this.instanceScrollBox()}instanceScrollBox(){const t={x:12,y:60+E,width:B-24,height:C-72-E,radius:12,scrollbar:!1};this.InstanceScrollBox=new A(t),this.InstanceScrollBox.offsetY=600}drawScroll(){this.InstanceScrollBox.render((t=>{this.offsetY=t[1]}))}drawButtonHome(){const e={x:12,y:12+E,width:72,height:36,text:"Back"};new x(e).render(),t("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),e)}drawBackground(){a(Y,{x:0,y:0,width:B,height:C})}render(){this.drawBackground(),this.drawButtonHome(),this.drawScroll()}},D=[{key:1,name:"燃烧",type:"进攻卡",attribute:"火",image:d,description:t=>`消耗10MP，造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,e,i)=>{}},{key:2,name:"冰冻",type:"魔法卡",attribute:"水",image:d,description:t=>`造成 ${15*t+30} 伤害，恢复 30MP。`,function:(t,e,i)=>{}},{key:3,name:"自然",type:"治疗卡",attribute:"木",image:d,description:t=>"恢复 50HP、20MP",function:(t,e,i)=>{}}],L=t=>({...D.find((e=>t.key===e.key)),...t}),O=canvas.getContext("2d"),Q=n("build/205624_78456047248.jpg"),W=wx.getSystemInfoSync().safeArea.top,F=wx.getSystemInfoSync().windowWidth,N=wx.getSystemInfoSync().windowHeight,j=class{constructor(){this.preview=null,this.offsetY=0,this.card,this.team,this.InstanceScroll,this.InstanceCard,this.InstanceTeam,this.InstancePreview,this.instance()}get cardHeight(){const t=Math.ceil(this.card.length/4);return 0===t?0:(F-84)/4*1.25*t+(t?12*(t-1):0)+24}get teamHeight(){const t=Math.ceil(this.team.length/4);return 0===t?0:(F-66)/4*.2*t+(t?6*(t-1):0)+24}get teamSelectHeight(){return 60}get emptyHeight(){var t=0;return 0===this.team.length&&(t+=12),t}instance(){this.card=Imitation.state.info.cardLibrary.map((t=>L(t))),this.team=Imitation.state.info.team[Imitation.state.info.teamIndex].map((t=>L(t))),this.instanceScroll(),this.instanceCard(),this.instanceTeam(),this.instancePreview()}instanceScroll(){const t={x:12,y:60+W,width:F-24,height:N-72-W,radius:12,scrollbarOffset:4,scrollbarThick:2};this.InstanceScroll=new A(t),this.InstanceScroll.offsetY=this.teamSelectHeight+this.cardHeight+this.teamHeight-this.emptyHeight-this.InstanceScroll.height+24}instanceTeam(){this.InstanceTeam=this.team.map(((t,e)=>{const i={width:(F-66)/4,card:t,touchMode:"click",touchEvent:()=>this.preview=t,displayMode:"team",imageMode:"overspread",imageIns:Q};return i.height=.2*i.width,i.x=24+parseInt(e%4)*(i.width+6),i.y=84+parseInt(e/4)*(i.height+6)+this.teamSelectHeight+W,new P(i)}))}instanceCard(){this.InstanceCard=this.card.map(((t,e)=>{t.image=Q;const i={width:(F-84)/4,card:t,touchMode:"click",touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t,displayMode:"library",imageMode:"overspread",imageIns:Q};return i.height=1.25*i.width,i.x=24+parseInt(e%4)*(i.width+12),i.y=96+parseInt(e/4)*(i.height+12)+this.teamSelectHeight+this.teamHeight-this.emptyHeight+W,new P(i)}))}instancePreview(){const t={width:.7*F,card:this.preview,displayMode:"preview",imageMode:"overspread",imageIns:Q};t.height=1.5*t.width,t.x=.15*F,t.y=(N-1.5*t.width)/2-80,this.InstancePreview=new P(t)}drawScroll(){this.InstanceScroll.render((t=>{this.offsetY=t[1],this.drawTeamSelect(),this.drawTeam(),this.drawCard()}))}drawTeam(){if(0===this.team.length)return;const t={x:12,y:72+W+this.teamSelectHeight-this.offsetY,width:F-24,height:this.teamHeight,radius:12};h(t,this.InstanceScroll.option)&&(r(t),O.fillStyle="rgba(255, 255, 255, 0.7)",O.fill(),this.InstanceTeam.forEach((e=>{h({...t,y:e.y-this.offsetY},this.InstanceScroll.option)&&(e.offsetY=0-this.offsetY,e.touchAble=!this.preview,e.render())})))}drawCard(){const t={x:12,y:84+this.teamSelectHeight+this.teamHeight-this.emptyHeight+W-this.offsetY,width:F-24,height:this.cardHeight,radius:12};h(t,this.InstanceScroll.option)&&(r(t),O.fillStyle="rgba(255, 255, 255, 0.7)",O.fill(),this.InstanceCard.forEach((e=>{h({...t,y:e.y-this.offsetY},this.InstanceScroll.option)&&(e.offsetY=0-this.offsetY,e.touchAble=!this.preview,e.render())})))}drawTeamSelect(){const e={x:12,y:60-this.offsetY+W,width:F-24,height:this.teamSelectHeight,radius:12};h(e,this.InstanceScroll.option)&&(r(e),O.fillStyle="rgba(255, 255, 255, 0.7)",O.fill(),new Array(4).fill().forEach(((e,i)=>{const s={y:72-this.offsetY+W,width:36,height:36,fillStyle:"black",strokeStyle:"black",text:i+1};if(s.x=24+i%4*(s.width+12),i===Imitation.state.info.teamIndex&&new x({...s,lineWidth:4}).render(),i!==Imitation.state.info.teamIndex){if(new x(s).render(),this.preview)return;t("touchstart",(()=>{Imitation.state.info.teamIndex=i,this.instance()}),s)}})))}drawPreview(){if(!this.preview)return;c({x:0,y:0,width:F,height:N}),O.fillStyle="rgba(0, 0, 0, 0.75)",O.fill(),this.InstancePreview.card=this.preview,this.InstancePreview.render();const i=N-this.InstancePreview.y-160;var h,n;if(this.card.includes(this.preview)&&(new x(h={x:F/2-60,y:i+40,width:120,height:40,radius:8,text:"装载"}).render(),t("touchstart",(()=>{this.load(this.preview),this.preview=null}),h),new x(n={x:F/2-60,y:i+100,width:120,height:40,radius:8,text:"合成"}).render(),t("touchstart",(()=>{this.compose(this.preview),this.preview=null}),n)),this.team.includes(this.preview)){const e={x:F/2-60,y:i+40,width:120,height:40,radius:8,text:"卸载"};new x(e).render(),t("touchstart",(()=>{this.unload(this.preview),this.preview=null}),e)}e("touchstart",(t=>{h&&s(t,h)||n&&s(t,n)||(this.preview=null)}))}drawBackground(){a(Q,{x:0,y:0,width:F,height:N})}drawButtonHome(){const e={x:12,y:12+W,width:72,height:36,text:"Back"};new x(e).render(),t("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),e)}compose(t){}load(t){const e=Imitation.state.info.cardLibrary,i=Imitation.state.info.team[Imitation.state.info.teamIndex],s=e.filter((e=>e.key===t.key&&e.level===t.level)),h=i.filter((e=>e.key===t.key&&e.level===t.level));s.length!==h.length&&(i.push({key:t.key,level:t.level}),this.instance())}unload(t){const e=Imitation.state.info.team[Imitation.state.info.teamIndex],i=e.find((e=>e.key===t.key&&e.level===t.level));Imitation.state.info.team[Imitation.state.info.teamIndex]=e.filter((t=>t!==i)),console.log(Imitation.state.info.team[Imitation.state.info.teamIndex].length),this.instance()}render(){this.drawBackground(),this.drawButtonHome(),this.drawScroll(),this.drawPreview()}},_=canvas.getContext("2d");new class{constructor(){this.animationFrameId,this.instance,this.ImitationInit(),this.loopStart()}render(){_.clearRect(0,0,canvas.width,canvas.height),Imitation.state.removeEventListener.forEach((t=>t())),Imitation.state.removeEventListener=[];const t=Imitation.state.page.map[Imitation.state.page.current];this.instance instanceof t||(this.instance=new t),this.instance.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){Imitation.state={page:{current:"home",next:"",map:{transition:y,home:b,explore:X,store:j}},removeEventListener:[],info:{cardLibrary:[],team:new Array(4).fill([]),teamIndex:0},action:!1},Imitation.state.info.cardLibrary=((t=12)=>new Array(t).fill(D).reduce(((t,e)=>[...t,...e]),[]))(15).map((t=>({key:t.key,level:1,number:4}))),Imitation.state.info.team[0]=[...Imitation.state.info.cardLibrary].filter(((t,e)=>e<40)).map((t=>({key:t.key,level:t.level})))}}})()})();