(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},293:()=>{!function(){if(window.wx)return;window.wx={getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style["max-width"]="425px";const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},6:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const s=this.dependentQueue[i],n=this.executeDependent(e.dependent);return n===t||Array.isArray(n)&&Array.isArray(s)&&(a=n,o=s,Array.isArray(a)&&Array.isArray(o)&&(a.length!==o.length||a.filter(((t,e)=>t===o[e])).length!==a.length))||!Array.isArray(n)&&!Array.isArray(s)&n!==s?(this.executeEvent(e.event),void(this.dependentQueue[i]=n)):void(this.dependentQueue[i]=n);var a,o}))},e.prototype.register=function(e,i=t){const s={event:e,dependent:i};return this.monitorQueue.push(s),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===s&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const s=new i;window.Imitation=s}()}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={exports:{}};return t[s](a,a.exports,i),a.exports}(()=>{"use strict";i(293),i(652),i(6);const t="build/162926_76690565815.jpg",e=[{key:1,name:"燃烧",type:"进攻卡",attribute:"火",image:t,description:t=>`消耗10MP，造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,e,i)=>{}},{key:2,name:"冰冻",type:"魔法卡",attribute:"水",image:t,description:t=>`造成 ${15*t+30} 伤害，恢复 30MP。`,function:(t,e,i)=>{}},{key:3,name:"自然",type:"治疗卡",attribute:"木",image:t,description:t=>"恢复 50HP、20MP",function:(t,e,i)=>{}},{key:4,name:"堕天",type:"进攻卡",attribute:"暗",image:t,description:t=>`消耗50MP，造成 ${30*t+300} 伤害`,function:(t,e,i)=>{}}],s=(t,i)=>{const s=t.reduce(((t,s)=>{const n=[...t],a=e.find((t=>s.key===t.key));return s.value.forEach((t=>{if(i){const e={...a,...t};delete e.number,n.push(...new Array(t.number).fill(e))}i||n.push({...a,...t})})),n}),[]);return s},n=t=>t.sort(((t,e)=>t.name-e.name)),a=t=>Number(Number(t).toFixed(2)),o=t=>{for(var e=[],i=t;i.length;){const t=Math.floor(Math.random()*i.length);e.push(i[t]),i=i.filter(((e,i)=>i!==t))}return e},r=(t,e,i)=>{const s=t=>c(t,i)?e(t):null;canvas.addEventListener(t,s,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,s)))},h=(t,e)=>{const i=t=>e(t);canvas.addEventListener(t,i,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,i)))},c=(t,e)=>{const i=e.x,s=e.y,n=e.width,a=e.height,o=t.x||t.touches[0].clientX,r=t.y||t.touches[0].clientY;return o>=i&&o<=i+n&&r>=s&&r<=s+a},l=(t,e)=>{const{x:i,y:s,width:n,height:a}=t,{x:o,y:r,width:h,height:c}=e;return i+n>o&&i<o+h&&s+a>r&&s<r+c},d=t=>{const e=new Image;return e.src=t,e},u=canvas.getContext("2d"),w=(t,e)=>{const i=e.x,s=e.y,n=e.width,a=e.height;var o=0,r=0,h=t.width,c=t.height;const l=Math.max(n/t.width,a/t.height),d=t.width*l-n,w=t.height*l-a;d&&(o=d/2/l,h-=d/l),w&&(r=w/2/l,c-=w/l),u.drawImage(t,o,r,h,c,i,s,n,a)},m=t=>{const e=t.x,i=t.y,s=t.width,n=t.height,a=t.radius;u.beginPath(),u.moveTo(e,i+a),u.arcTo(e,i,e+a,i,a),u.lineTo(e+s-a,i),u.arcTo(e+s,i,e+s,i+a,a),u.lineTo(e+s,i+n-a),u.arcTo(e+s,i+n,e+s-a,i+n,a),u.lineTo(e+a,i+n),u.arcTo(e,i+n,e,i+n-a,a),u.closePath()},g=t=>{const e=t.x,i=t.y,s=t.width,n=t.height;u.beginPath(),u.moveTo(e,i),u.lineTo(e+s,i),u.lineTo(e+s,i+n),u.lineTo(e,i+n),u.closePath()},y=t=>{const e=t.x,i=t.y,s=t.width,n=t.fontHeight;let a=t.text.split(""),o="",r=[];a.forEach((t=>{u.measureText(o).width>s&&(r.push(o),o=""),o+=t})),r.push(o),r.forEach(((t,s)=>{u.fillText(t,e,i+(s+1)*n)}))},p=canvas.getContext("2d"),x=d(t),f=wx.getSystemInfoSync().windowWidth,I=wx.getSystemInfoSync().windowHeight,S=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=a(this.opacity+.05),this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=a(this.opacity-.05),this.count=this.count+1),this.count>60)return Imitation.state.page.current=Imitation.state.page.next,void(Imitation.state.page.next="");p.globalAlpha=this.opacity,w(x,{x:0,y:0,width:f,height:I}),p.globalAlpha=1}};class v{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get resultX(){return this.x+(this.offsetX?this.offsetX:0)}get resultY(){return this.y+(this.offsetY?this.offsetY:0)}}const b=canvas.getContext("2d");class B extends v{constructor(t){super(t),this.radius=t.radius||8,this.text=t.text,this.font=t.font||14,this.lineWidth=t.lineWidth||1,this.fillStyle=t.fillStyle||"white",this.strokeStyle=t.strokeStyle||"white"}render(){b.textAlign="center",b.textBaseline="middle",b.font=`bold ${this.font}px monospace`,b.lineWidth=this.lineWidth,b.strokeStyle=this.strokeStyle,b.fillStyle=this.fillStyle,m({x:this.resultX,y:this.resultY,width:this.width,height:this.height,radius:this.radius}),b.stroke(),b.fillText(this.text,this.resultX+this.width/2,this.resultY+this.height/2)}}const T="build/234521_92189037316.jpg",A=(canvas.getContext("2d"),d(T)),M=wx.getSystemInfoSync().windowWidth,H=wx.getSystemInfoSync().windowHeight,P=class{constructor(){}drawButtonBattle(){const t={x:M/2-60,y:.7*H-60,width:120,height:40,text:"战斗"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="battle"}),t)}drawButtonExplore(){const t={x:M/2-60,y:.7*H,width:120,height:40,text:"探索"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="explore"}),t)}drawButtonStore(){const t={x:M/2-60,y:.7*H+60,width:120,height:40,text:"仓库"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="store"}),t)}drawBackground(){w(A,{x:0,y:0,width:M,height:H})}render(){this.drawBackground(),this.drawButtonBattle(),this.drawButtonExplore(),this.drawButtonStore()}},k=canvas.getContext("2d");class E extends v{constructor(t){super(t),this.scrollX=t.scrollX||0,this.scrollY=t.scrollY||0,this.scrollbarHidden=t.scrollbarHidden||!1,this.scrollbarOffset=t.scrollbarOffset||4,this.scrollbarThick=t.scrollbarThick||2,this.scrollbarColor=t.scrollbarColor||"rgba(0, 0, 0, opacity)",this.scrollbarOpacity=0,this.scrollbarTimeout=!1,this.scrollPosition=[0,0],this.mouseDownPosition=null,this.clipFunction=()=>{const t={x:this.resultX,y:this.resultY,width:this.width,height:this.height,radius:this.radius};return m(t),t}}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;if(this.scrollX<=0&&this.scrollY<=0)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var s=this.scrollPosition[0]-e,n=this.scrollPosition[1]-i;this.scrollX>0&&(s<=0&&(s=0),s>this.scrollX&&(s=this.scrollX)),this.scrollY>0&&(n<=0&&(n=0),n>this.scrollY&&(n=this.scrollY)),this.scrollPosition=[s,n]}render(t){k.save();const e=this.clipFunction();if(r("touchstart",this.eventDown.bind(this),e),h("touchmove",this.eventMove.bind(this)),h("touchend",this.eventUp.bind(this)),k.clip(),t(this.scrollPosition),!this.scrollbarHidden){if(this.scrollX>0){const t=this.width*(this.width/(this.scrollX+this.width)),e=this.resultX+(this.width-t)*(this.scrollPosition[0]/this.scrollX);g({x:e,y:this.resultY+this.height-this.scrollbarOffset,width:t,height:this.scrollbarThick})}if(this.scrollY>0){const t=this.height*(this.height/(this.scrollY+this.height)),e=this.resultY+(this.height-t)*(this.scrollPosition[1]/this.scrollY);g({x:this.resultX+this.width-this.scrollbarOffset,y:e,width:this.scrollbarThick,height:t})}(this.scrollX>0||this.scrollY>0)&&(this.scrollbarTimeout&&this.scrollbarOpacity<1&&(this.scrollbarOpacity=this.scrollbarOpacity+.05),!this.scrollbarTimeout&&this.scrollbarOpacity>0&&(this.scrollbarOpacity=this.scrollbarOpacity-.05),k.fillStyle=this.scrollbarColor.replace("opacity",this.scrollbarOpacity),k.fill())}k.restore()}}const C=canvas.getContext("2d"),Y=d("build/153344_22433013228.jpg"),L=wx.getSystemInfoSync().safeArea.top,X=wx.getSystemInfoSync().windowWidth,W=wx.getSystemInfoSync().windowHeight,D=class{constructor(){this.exploreMap,this.InstanceScrollBox,this.InstanceScrollList,this.instance()}get scrollListHeight(){const t=this.exploreMap.length;return 0===t?0:160*t+(t?12*(t-1):0)}instance(){this.exploreMap=Imitation.state.explore.map,this.instanceScrollBox(),this.instanceScrollList()}instanceScrollBox(){const t={x:12,y:60+L,width:X-24,height:W-72-L,radius:12,scrollbarHidden:!0};this.InstanceScrollBox=new E(t),this.InstanceScrollBox.scrollY=this.scrollListHeight-this.InstanceScrollBox.height}instanceScrollList(){this.InstanceScrollList=this.exploreMap.map(((t,e)=>{const i=new E({x:12,y:60+172*e+L,width:X-24,height:160,radius:12,scrollbarHidden:!0});return i.extra=t,i.scrollX=92*t.list.length+12-i.width,i}))}drawScrollBox(){this.InstanceScrollBox.render((t=>{const e=t[1];this.drawScrollList(e)}))}drawScrollList(t){this.InstanceScrollList.forEach(((e,i)=>{const s={...e.option,y:e.y-t,radius:e.radius};m(s),C.fillStyle="rgba(255, 255, 255, 0.7)",C.fill(),e.offsetY=0-t,e.render((s=>{const n=s[0];this.drawScrollContent(e.extra,n,t,i)}))}))}drawScrollContent(t,e,i,s){C.textAlign="start",C.textBaseline="top",C.fillStyle="black",C.font="bold 12px monospace",C.fillText(t.name,24,72+172*s-i+L),t.list.forEach(((t,n)=>{const a={width:80,height:80,y:108+172*s-i+L,fillStyle:"black",strokeStyle:"black",font:12,text:t.name};a.x=24+(a.width+12)*n-e,new B(a).render()}))}drawButtonHome(){const t={x:12,y:12+L,width:72,height:36,text:"Back"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}drawBackground(){w(Y,{x:0,y:0,width:X,height:W})}render(){this.drawBackground(),this.drawButtonHome(),this.drawScrollBox()}},$=canvas.getContext("2d");wx.getSystemInfoSync().safeArea.top,wx.getSystemInfoSync().windowWidth,wx.getSystemInfoSync().windowHeight;class O extends v{constructor(t){super(t),this.battler=t.battler,this.imageIns=t.imageIns}render(){const t=this.resultX,e=this.resultY,i=this.width,s=this.height,n=this.battler;$.save(),m({x:t,y:e,width:i,height:s,radius:12}),$.clip(),w(this.imageIns,{x:t,y:e,width:i,height:s}),$.fillStyle="white",$.font="bold 12px monospace",$.textAlign="start",$.textBaseline="top",$.fillText(`HP: ${n.HP}`,t+12,e+12),$.fillText(`MP: ${n.MP}`,t+12,e+30),$.fillText(`牌库: ${n.card.store.length}`,t+12,e+48),$.fillText(`手牌: ${n.card.hand.length}`,t+12,e+66),$.fillText(`墓地: ${n.card.cemetery.length}`,t+12,e+84),$.restore()}}const Q="build/205624_78456047248.jpg",j="build/music_1c31bcc267a545ef971109512053f3e50.jpeg",F="build/music_47a83799595b4a5b97145a6e594620310.jpeg",N=(canvas.getContext("2d"),d(Q)),_=d(F),R=d(j),q=wx.getSystemInfoSync().safeArea.top,U=wx.getSystemInfoSync().windowWidth,z=wx.getSystemInfoSync().windowHeight,G=class{constructor(){this.left=0,this.InstanceSelfBattler,this.InstanceTargetBattler,this.instance()}instance(){const t=.5*z/2;this.InstanceSelfBattler=new O({x:12,y:72+t+q,width:U-24,height:t,imageIns:R,battler:Imitation.state.battle.self}),this.InstanceSelfBattler.battler.card.team=o(s(Imitation.state.info.team[0],!0)),this.InstanceTargetBattler=new O({x:12,y:60+q,width:U-24,height:t,imageIns:_,battler:Imitation.state.battle.target}),this.InstanceTargetBattler.battler.card.team=o(s(Imitation.state.info.team[0],!0)),this.battleInit()}drawSelfBattler(){this.InstanceSelfBattler.render()}drawTargetBattler(){this.InstanceTargetBattler.render()}drawBackground(){w(N,{x:0,y:0,width:U,height:z})}drawButtonHome(){const t={x:12,y:12+q,width:72,height:36,text:"Home"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}battleInit(){this.InstanceSelfBattler.battler.card.store=this.InstanceSelfBattler.battler.card.team,this.InstanceSelfBattler.battler.card.hand=this.InstanceSelfBattler.battler.card.store.filter(((t,e)=>e<4)),this.InstanceTargetBattler.battler.card.store=this.InstanceTargetBattler.battler.card.team,this.InstanceTargetBattler.battler.card.hand=this.InstanceTargetBattler.battler.card.store.filter(((t,e)=>e<4))}render(){this.drawBackground(),this.drawButtonHome(),this.drawSelfBattler(),this.drawTargetBattler()}},J=canvas.getContext("2d"),K=wx.getSystemInfoSync().windowWidth,V=wx.getSystemInfoSync().windowHeight;class Z extends v{constructor(t){super(t),this.card=t.card,this.touchAble=t.touchAble,this.touchMode=t.touchMode,this.touchEvent=t.touchEvent,this.touchDelayTime=t.touchDelayTime,this.touchArea=t.touchArea,this.touchTimeout=null,this.displayMode=t.displayMode,this.imageMode=t.imageMode,this.imageIns=t.imageIns}render(){const t=this.resultX,e=this.resultY,i=this.width,s=this.height,n=this.card;if(J.save(),m({x:t,y:e,width:i,height:s,radius:.08*i}),J.clip(),"center"===this.imageMode&&w(this.imageIns,{x:t,y:e,width:i,height:s}),"overspread"===this.imageMode&&w(this.imageIns,{x:0,y:0,width:K,height:V}),J.fillStyle="rgba(255, 255, 255, 1)",J.textAlign="center",J.textBaseline="middle",J.font=`bold ${.075*this.width}px monospace`,"library"===this.displayMode&&(J.fillText(n.name,t+i/2,e+.12*i),n.number&&J.fillText("X"+n.number,t+i-.12*i,e+.12*i),J.textAlign="start",J.fillText("Lv"+n.level,t+.08*i,e+.36*i),y({x:t+.08*i,y:e+.48*i,width:i-.25*i,fontHeight:.12*i,text:n.description(1)})),"team"===this.displayMode&&J.fillText(`${n.name} · Lv.${n.level}`,t+i/2,e+s/2),"preview"===this.displayMode&&(J.fillText(n.name,t+i/2,e+.12*i),n.number&&J.fillText("X"+n.number,t+i-.12*i,e+.12*i),J.textAlign="start",J.fillText("Lv"+n.level,t+.08*i,e+.36*i),J.fillText(`${n.attribute} · ${n.type}`,t+.08*i,e+.48*i),y({x:t+.08*i,y:e+.6*i,text:n.description(1),width:i-.25*i,fontHeight:.12*i})),J.restore(),"immediate"===this.touchMode&&this.touchAble&&r("touchstart",(t=>{this.touchArea&&!c(t,this.touchArea)||this.touchEvent()}),{x:t,y:e,width:i,height:s}),"delay"===this.touchMode&&this.touchAble){r("touchstart",(t=>{this.touchArea&&!c(t,this.touchArea)||(this.touchTimeout=setTimeout((()=>this.touchEvent()),this.touchDelayTime))}),{x:t,y:e,width:i,height:s});const n=()=>{clearTimeout(this.touchTimeout)};h("touchmove",n),h("touchend",n)}"click"===this.touchMode&&this.touchAble&&(r("touchstart",(t=>{this.touchArea&&!c(t,this.touchArea)||(this.touchTimeout=!0)}),{x:t,y:e,width:i,height:s}),h("touchmove",(()=>{this.touchTimeout=!1})),h("touchend",(()=>{!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1})))}}const tt=canvas.getContext("2d"),et=d(Q),it=d(F),st=wx.getSystemInfoSync().safeArea.top,nt=wx.getSystemInfoSync().windowWidth,at=wx.getSystemInfoSync().windowHeight,ot=class{constructor(){this.preview=null,this.card=n(s(Imitation.state.info.cardLibrary)),this.InstanceScroll=this.instanceScroll(),this.InstanceCard=this.instanceCard(),this.InstancePreview=this.instancePreview()}get cardHeight(){const t=Math.ceil(this.card.length/3);return 0===t?0:(nt-48)/3*1.25*t+(t?12*(t-1):0)}instanceScroll(){const t={x:12,y:60+st,width:nt-24,height:at-72-st,radius:12,scrollbarHidden:!0};return t.scrollY=this.cardHeight-t.height,new E(t)}instanceCard(){return this.card.map(((t,e)=>{const i={width:(nt-48)/3,card:t,touchAble:!0,touchMode:"click",touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t,displayMode:"library",imageMode:"center",imageIns:it};return i.height=1.25*i.width,i.x=12+parseInt(e%3)*(i.width+12),i.y=60+parseInt(e/3)*(i.height+12)+st,new Z(i)}))}instancePreview(){const t={width:.7*nt,card:this.preview,displayMode:"preview",imageMode:"overspread",imageIns:et};return t.height=1.5*t.width,t.x=.15*nt,t.y=(at-1.5*t.width)/2-80,new Z(t)}drawScroll(){this.InstanceScroll.render((t=>this.drawCard(t[1])))}drawCard(t){this.InstanceCard.forEach((e=>{l({...e.option,y:e.y-t},this.InstanceScroll.option)&&(e.offsetY=0-t,e.touchAble=!this.preview,e.render())}))}drawPreview(){if(!this.preview)return;g({x:0,y:0,width:nt,height:at}),tt.fillStyle="rgba(0, 0, 0, 0.75)",tt.fill(),this.InstancePreview.card=this.preview,this.InstancePreview.render();const t=at-this.InstancePreview.y-160,e={x:nt/2-60,y:t+40,width:120,height:40,radius:8,text:"卸载"};new B(e).render(),r("touchstart",(()=>{this.compose(this.preview),this.preview=null}),e),h("touchstart",(t=>{e&&c(t,e)||(this.preview=null)}))}drawBackground(){w(et,{x:0,y:0,width:nt,height:at})}drawButtonHome(){const t={x:96,y:12+st,width:72,height:36,text:"Home"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}drawButtonBack(){const t={x:12,y:12+st,width:72,height:36,text:"Back"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="store"}),t)}compose(t){}render(){this.drawBackground(),this.drawButtonHome(),this.drawButtonBack(),this.drawScroll(),this.drawPreview()}},rt=canvas.getContext("2d"),ht=d(Q),ct=d(T),lt=wx.getSystemInfoSync().safeArea.top,dt=wx.getSystemInfoSync().windowWidth,ut=wx.getSystemInfoSync().windowHeight,wt=class{constructor(){this.preview=null,this.team=n(s(Imitation.state.info.team[Imitation.state.info.teamIndex],!0)),this.InstanceScroll=this.instanceScroll(),this.InstanceCard=this.instanceCard(),this.InstancePreview=this.instancePreview()}get cardHeight(){const t=Math.ceil(this.team.length/2);return 0===t?0:(dt-36)/2*.5*t+(t?12*(t-1):0)}instanceScroll(){const t={x:12,y:60+lt,width:dt-24,height:ut-72-lt,radius:12,scrollbarHidden:!0};return t.scrollY=this.cardHeight-t.height,new E(t)}instanceCard(){return this.team.map(((t,e)=>{const i={width:(dt-36)/2,card:t,touchAble:!0,touchMode:"click",touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t,displayMode:"team",imageMode:"center",imageIns:ct};return i.height=1*i.width,i.x=12+parseInt(e%2)*(i.width+12),i.y=60+parseInt(e/2)*(i.height+12)+lt,new Z(i)}))}instancePreview(){const t={width:.7*dt,card:this.preview,displayMode:"preview",imageMode:"overspread",imageIns:ht};return t.height=1.5*t.width,t.x=.15*dt,t.y=(ut-1.5*t.width)/2-80,new Z(t)}drawScroll(){this.InstanceScroll.render((t=>this.drawCard(t[1])))}drawCard(t){this.InstanceCard.forEach((e=>{l({...e.option,y:e.y-t},this.InstanceScroll.option)&&(e.offsetY=0-t,e.touchAble=!this.preview,e.render())}))}drawPreview(){if(!this.preview)return;g({x:0,y:0,width:dt,height:ut}),rt.fillStyle="rgba(0, 0, 0, 0.75)",rt.fill(),this.InstancePreview.card=this.preview,this.InstancePreview.render();const t=ut-this.InstancePreview.y-160,e={x:dt/2-60,y:t+40,width:120,height:40,radius:8,text:"卸载"};new B(e).render(),r("touchstart",(()=>{this.compose(this.preview),this.preview=null}),e),h("touchstart",(t=>{e&&c(t,e)||(this.preview=null)}))}drawBackground(){w(ht,{x:0,y:0,width:dt,height:ut})}drawButtonHome(){const t={x:96,y:12+lt,width:72,height:36,text:"Home"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}drawButtonBack(){const t={x:12,y:12+lt,width:72,height:36,text:"Back"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="store"}),t)}compose(t){}render(){this.drawBackground(),this.drawButtonHome(),this.drawButtonBack(),this.drawScroll(),this.drawPreview()}},mt=canvas.getContext("2d");wx.getSystemInfoSync().safeArea.top,wx.getSystemInfoSync().windowWidth,wx.getSystemInfoSync().windowHeight;class gt extends v{constructor(t){super(t),this.team=t.team,this.index=t.index,this.imageIns=t.imageIns}render(){const t=this.resultX,e=this.resultY,i=this.width,s=this.height,n=this.team,a=this.index;mt.save(),m({x:t,y:e,width:i,height:s,radius:12}),mt.clip(),w(this.imageIns,{x:t,y:e,width:i,height:s}),mt.fillStyle="white",mt.font="bold 12px monospace",mt.textAlign="start",mt.textBaseline="top",n&&(mt.fillText(`队伍 ${new Array(a+1).fill("I").join("")}`,t+12,e+12),mt.fillText(`卡牌 ${n.length}`,t+12,e+36)),n||mt.fillText("仓库",t+12,e+12),mt.restore()}}canvas.getContext("2d");const yt=d(Q),pt=d(j),xt=d(F),ft=wx.getSystemInfoSync().safeArea.top,It=wx.getSystemInfoSync().windowWidth,St=wx.getSystemInfoSync().windowHeight,vt=class{constructor(){}drawList(){const t=(St-60)/(Imitation.state.info.team.length+1),e=e=>({x:12,y:60+t*e+ft,width:It-24,height:t-12});new gt({...e(0),imageIns:pt}).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="library"}),e(0)),Imitation.state.info.team.forEach(((t,i)=>{new gt({...e(i+1),imageIns:xt,team:n(s(t,!0)),index:i}).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="team",Imitation.state.page.params={index:i}}),e(i+1))}))}drawBackground(){w(yt,{x:0,y:0,width:It,height:St})}drawButtonHome(){const t={x:12,y:12+ft,width:72,height:36,text:"Home"};new B(t).render(),r("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}render(){this.drawBackground(),this.drawButtonHome(),this.drawList()}},bt=canvas.getContext("2d"),Bt=wx.getSystemInfoSync().windowWidth;wx.getSystemInfoSync().windowHeight;class Tt{constructor(){this.message="",this.timeout=1e3,this.timeoutRef=null,this.show=!1,this.opacity=0}send(t){clearTimeout(this.timeoutRef),this.message=t,this.show=!0,this.timeoutRef=setTimeout((()=>{this.show=!1,this.timeoutRef=null}),this.timeout)}render(){this.show&&this.opacity<1&&(this.opacity=a(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=a(this.opacity-.05)),(this.show||0!==this.opacity)&&(bt.textAlign="center",bt.textBaseline="middle",bt.font="bold 14px monospace",bt.lineWidth=1,bt.fillStyle=`rgba(0, 0, 0, ${this.opacity})`,bt.fillText(this.message,Bt/2,24))}}const At=[{name:"主线挑战",list:[{name:"挑战一",boss:{},card:[],reward:[]},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"}]},{name:"主线挑战",list:[{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"},{name:"挑战"}]},{name:"主线挑战",list:[{name:"挑战"}]},{name:"主线挑战",list:[{name:"挑战"}]},{name:"主线挑战",list:[{name:"挑战"}]}],Mt=canvas.getContext("2d");new class{constructor(){this.animationFrameId,this.instance,this.instanceMessage=new Tt,this.ImitationInit(),this.loopStart()}render(){Mt.clearRect(0,0,canvas.width,canvas.height),Imitation.state.removeEventListener.forEach((t=>t())),Imitation.state.removeEventListener=[];const t=Imitation.state.page.map[Imitation.state.page.current];this.instance instanceof t||(this.instance=new t),this.instance.render(),this.instanceMessage.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){Imitation.state={page:{current:"library",next:"",params:{index:1},map:{transition:S,home:P,explore:D,battle:G,store:vt,team:wt,library:ot}},removeEventListener:[],info:{cardLibrary:[],team:[[],[],[],[]],teamIndex:0},explore:{map:[]},battle:{self:{HP:1e3,MP:1e3,card:{team:[],store:[],hand:[],cemetery:[],consume:[]},buff:[]},target:{HP:1e3,MP:1e3,card:{team:[],store:[],hand:[],cemetery:[],consume:[]},buff:[]}},function:{render:this.render,loopStart:this.loopStart,loopEnd:this.loopEnd,message:t=>this.instanceMessage.send(t)}},Imitation.state.info.cardLibrary=e.map((t=>({key:t.key,value:[{level:1,number:10},{level:2,number:4}]}))),Imitation.state.info.cardLibrary=[...Imitation.state.info.cardLibrary,...Imitation.state.info.cardLibrary,...Imitation.state.info.cardLibrary,...Imitation.state.info.cardLibrary],Imitation.state.info.team[0]=e.map((t=>({key:t.key,value:[{level:1,number:10}]}))),Imitation.state.explore.map=At}}})()})();