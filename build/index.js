(()=>{var t={652:()=>{!function(){const t=canvas.width,i=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*i),canvas.style.width=t+"px",canvas.style.height=i+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},293:()=>{!function(){if(window.wx)return;window.wx={getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style["max-width"]="425px";const i=document.createElement("canvas");i.width=t.clientWidth,i.height=t.clientHeight,i.style.display="block",i.style.touchAction="none",t.appendChild(i),window.canvas=i}()},45:()=>{!function(){const t=Symbol("_Allow");function i(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function e(t){this.state=t,this.MonitorINS=new i(this)}i.prototype.dispatch=function(){this.monitorQueue.forEach(((i,e)=>{const s=this.dependentQueue[e],o=this.executeDependent(i.dependent);return o===t||Array.isArray(o)&&Array.isArray(s)&&(n=o,h=s,Array.isArray(n)&&Array.isArray(h)&&(n.length!==h.length||n.filter(((t,i)=>t===h[i])).length!==n.length))||!Array.isArray(o)&&!Array.isArray(s)&o!==s?(this.executeEvent(i.event),void(this.dependentQueue[e]=o)):void(this.dependentQueue[e]=o);var n,h}))},i.prototype.register=function(i,e=t){const s={event:i,dependent:e};return this.monitorQueue.push(s),this.dependentQueue.push(this.executeDependent(e)),()=>{this.monitorQueue.forEach(((t,i)=>{t===s&&(this.monitorQueue=this.monitorQueue.filter(((t,e)=>e!==i)),this.dependentQueue=this.dependentQueue.filter(((t,e)=>e!==i)))}))}},i.prototype.executeEvent=function(t){t(this.ImitationINS.state)},i.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},e.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},e.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},e.prototype.register=function(){return this.MonitorINS.register(...arguments)},e.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const s=new e;window.Imitation=s}()}},i={};function e(s){var o=i[s];if(void 0!==o)return o.exports;var n=i[s]={exports:{}};return t[s](n,n.exports,e),n.exports}(()=>{"use strict";e(293),e(652),e(45);const t=(t,i,e)=>{const o=t=>s(t,e)?i(t):null;canvas.addEventListener(t,o,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,o)))},i=(t,i)=>{const e=t=>i(t);canvas.addEventListener(t,e,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,e)))},s=(t,i)=>{const e=i.x,s=i.y,o=i.width,n=i.height,h=t.x||t.touches[0].clientX,r=t.y||t.touches[0].clientY;return h>=e&&h<=e+o&&r>=s&&r<=s+n},o=t=>{const i=new Image;return i.src=t,i},n=canvas.getContext("2d"),h=(t,i)=>{const e=i.x,s=i.y,o=i.width,h=i.height;var r=0,a=0,c=t.width,l=t.height;const d=Math.max(o/t.width,h/t.height),u=t.width*d-o,w=t.height*d-h;u&&(r=u/2/d,c-=u/d),w&&(a=w/2/d,l-=w/d),n.drawImage(t,r,a,c,l,e,s,o,h)},r=t=>{const i=t.x,e=t.y,s=t.width,o=t.height,h=t.radius;n.beginPath(),n.moveTo(i,e+h),n.arcTo(i,e,i+h,e,h),n.lineTo(i+s-h,e),n.arcTo(i+s,e,i+s,e+h,h),n.lineTo(i+s,e+o-h),n.arcTo(i+s,e+o,i+s-h,e+o,h),n.lineTo(i+h,e+o),n.arcTo(i,e+o,i,e+o-h,h),n.closePath()},a=t=>{const i=t.x,e=t.y,s=t.width,o=t.height;n.beginPath(),n.moveTo(i,e),n.lineTo(i+s,e),n.lineTo(i+s,e+o),n.lineTo(i,e+o),n.closePath()},c="build/162926_76690565815.jpg",l=canvas.getContext("2d"),d=o(c),u=wx.getSystemInfoSync().windowWidth,w=wx.getSystemInfoSync().windowHeight,y=class{constructor(){this.opacity=0,this.count=0}render(){this.count<=20&&(this.opacity=this.opacity+.05,this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=this.opacity-.05,this.count=this.count+1),this.count>60?Imitation.state.page.current=Imitation.state.page.next:(l.globalAlpha=this.opacity,h(d,{x:0,y:0,width:u,height:w}),l.globalAlpha=1)}},m=canvas.getContext("2d");class p{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius||8,this.text=t.text,this.font=t.font||14,this.lineWidth=t.lineWidth||1,this.fillStyle=t.fillStyle||"white",this.strokeStyle=t.strokeStyle||"white"}render(){m.textAlign="center",m.textBaseline="middle",m.font=`bold ${this.font}px monospace`,m.lineWidth=this.lineWidth,m.strokeStyle=this.strokeStyle,m.fillStyle=this.fillStyle,r({x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius}),m.stroke(),m.fillText(this.text,this.x+this.width/2,this.y+this.height/2)}}canvas.getContext("2d");const g=o("build/153344_22433013228.jpg"),f=wx.getSystemInfoSync().windowWidth,x=wx.getSystemInfoSync().windowHeight,v=class{constructor(){}drawButtonBattle(){const i={x:f/2-60,y:.7*x,width:120,height:40,text:"战斗"};new p(i).render(),t("touchstart",(()=>{}),i)}drawButtonStore(){const i={x:f/2-60,y:.7*x+60,width:120,height:40,text:"仓库"};new p(i).render(),t("touchstart",(()=>{Imitation.state.page.current="store",Imitation.dispatch()}),i)}drawBackground(){h(g,{x:0,y:0,width:f,height:x})}render(){this.drawBackground(),this.drawButtonBattle(),this.drawButtonStore()}},I=canvas.getContext("2d");class b{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.min=t.min,this.max=t.max,this.backgroundColor=t.backgroundColor||"white",this.scrollbarOffset=t.scrollbarOffset,this.scrollbarThick=t.scrollbarThick,this.scrollbarColor=t.scrollbarColor||"rgba(0, 0, 0, opacity)",this.scrollbarOpacity=0,this.scrollbarTimeout=!1,this.scrollPosition=0,this.mouseDownPosition=null}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const i=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],e=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+i,this.mouseDownPosition[1]+e];const s=this.scrollPosition-e;s<this.min?this.scrollPosition=this.min:s>this.max?this.scrollPosition=this.max:this.scrollPosition=this.scrollPosition-e}render(e){I.save();const s={x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius};if(r(s),I.fillStyle=this.backgroundColor,I.fill(),t("touchstart",this.eventDown.bind(this),s),i("touchmove",this.eventMove.bind(this)),i("touchend",this.eventUp.bind(this)),I.clip(),this.max>0){const t=this.height*(this.height/(this.max+this.height)),i=this.y+(this.height-t)*(this.scrollPosition/this.max);this.scrollbarTimeout&&this.scrollbarOpacity<1&&(this.scrollbarOpacity=this.scrollbarOpacity+.05),!this.scrollbarTimeout&&this.scrollbarOpacity>0&&(this.scrollbarOpacity=this.scrollbarOpacity-.05),I.fillStyle=this.scrollbarColor.replace("opacity",this.scrollbarOpacity),a({x:this.x+this.width-this.scrollbarOffset,y:i,width:this.scrollbarThick,height:t}),I.fill()}e(this.scrollPosition),I.restore()}}const S=canvas.getContext("2d"),T=wx.getSystemInfoSync().windowWidth,A=wx.getSystemInfoSync().windowHeight;class k{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.fillStyle=t.fillStyle||"white",this.card=t.card,this.touchAble=t.touchAble,this.touchMode=t.touchMode,this.touchEvent=t.touchEvent,this.touchDelayTime=t.touchDelayTime,this.touchArea=t.touchArea,this.touchTimeout=null,this.scrollTop=t.scrollTop,this.scrollLeft=t.scrollLeft,this.displayMode=t.displayMode,this.imageMode=t.imageMode,this.imageIns=t.imageIns}render(){const e=this.x-(this.scrollLeft?this.scrollLeft:0),o=this.y-(this.scrollTop?this.scrollTop:0),a=this.width,c=this.height,l=this.card;S.save(),"normal"===this.displayMode&&r({x:e,y:o,width:a,height:c,radius:.08*a}),"line"===this.displayMode&&r({x:e,y:o,width:a,height:c,radius:.06*a}),S.clip(),"normal"===this.imageMode&&h(this.imageIns,{x:e+a,y:o+a,width:a,height:c}),"full"===this.imageMode&&h(this.imageIns,{x:0,y:0,width:T,height:A}),S.fillStyle=this.fillStyle,S.textAlign="center",S.textBaseline="middle";const d=.075*a;if(S.font=`bold ${d}px monospace`,"normal"===this.displayMode&&(S.fillText(l.name,e+a/2,o+.12*a),l.number&&S.fillText("X"+l.number,e+a-.12*a,o+.12*a),S.textAlign="start",S.fillText("Lv"+l.level,e+.08*a,o+.12*a+.24*a),S.fillText(l.type,e+.08*a,o+.12*a+.36*a),S.fillText(l.attribute,e+.08*a,o+.12*a+.48*a),S.fillText(`消耗：${l.cost}`,e+.08*a,o+.12*a+.6*a),(t=>{const i=t.x,e=t.y,s=t.width,o=t.fontHeight;let h=t.text.split(""),r="",a=[];h.forEach((t=>{n.measureText(r).width>s&&(a.push(r),r=""),r+=t})),a.push(r),a.forEach(((t,s)=>{n.fillText(t,i,e+(s+1)*o)}))})({x:e+.08*a,y:o+.84*a,text:l.description(1),width:a-.25*a,fontHeight:.12*a})),"line"===this.displayMode&&(S.fillText(l.name,e+.12*a,o+c/2),S.fillText("Lv"+l.level,e+a-.12*a,o+c/2)),S.restore(),"immediate"===this.touchMode&&this.touchAble&&t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||this.touchEvent()}),{x:e,y:o,width:a,height:c}),"delay"===this.touchMode&&this.touchAble){t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=setTimeout((()=>this.touchEvent()),this.touchDelayTime))}),{x:e,y:o,width:a,height:c});const n=()=>{clearTimeout(this.touchTimeout)};i("touchmove",n),i("touchend",n)}"click"===this.touchMode&&this.touchAble&&(t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=!0)}),{x:e,y:o,width:a,height:c}),i("touchmove",(()=>{this.touchTimeout=!1})),i("touchend",(()=>{!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1})))}}const M=[{key:1,name:"燃烧",type:"进攻卡",attribute:"火",cost:0,image:c,description:t=>`造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,i,e)=>{}},{key:2,name:"冰冻",type:"魔法卡",attribute:"水",cost:0,image:c,description:t=>`造成 ${15*t+30} 伤害，恢复 30MP。`,function:(t,i,e)=>{}},{key:3,name:"缠绕",type:"治疗卡",attribute:"木",cost:0,image:c,description:t=>"恢复 50HP、20MP",function:(t,i,e)=>{}}],C=t=>({...M.find((i=>t.key===i.key)),...t}),E="build/205624_78456047248.jpg";console.log(E);const H=canvas.getContext("2d"),P=o(E);console.log(P),P.onload=()=>{console.log(1)},P.onerror=()=>{console.log(2)};const _=wx.getSystemInfoSync().safeArea.top,D=wx.getSystemInfoSync().windowWidth,O=wx.getSystemInfoSync().windowHeight,L=class{constructor(){this.preview=null,this.previewType=null,this.scroll_I,this.cards_I,this.cardss_I,this.preview_I,this.instance()}get cards(){return Imitation.state.info.cards}get cardss(){return Imitation.state.info.cardss[Imitation.state.info.cardssIndex]}get cardsH(){const t=Math.ceil(this.cards.length/4);return(D-24-60)/4*1.25*t+(t?12*(t-1):0)}get cardssH(){const t=Math.ceil(this.cardss.length/3);return(D-24-48)/3*.175*t+(t?6*(t-1):0)}get cardssHH(){return 0===this.cardss.length?-12:this.cardssH+24}get scrollOption(){return{x:this.scroll_I.x,y:this.scroll_I.y,width:this.scroll_I.width,height:this.scroll_I.height}}setScrollOptionH(){this.scroll_I.max=this.cardsH-this.scroll_I.height+24}instance(){this.instanceScroll(),this.instanceCards(),this.instanceCardss(),this.instancePreview()}instanceScroll(){const t={x:12,y:76+this.cardssHH+_,width:D-24,height:O-88-this.cardssHH-_,radius:12,scrollbarOffset:4,scrollbarThick:2,min:0};this.scroll_I=new b(t),this.setScrollOptionH()}instanceCards(){const t=t=>{this.previewType="cards",this.preview=t};this.cards_I=this.cards.map(((i,e)=>{(i=C(i)).image=P;const s={width:(D-24-60)/4,card:i,touchMode:"click",touchArea:this.scrollOption,touchEvent:()=>t(i),displayMode:"normal",imageMode:"full",imageIns:P};return s.height=1.25*s.width,s.x=24+e%4*(s.width+12),s.y=88+parseInt(e/4)*(s.height+12)+this.cardssHH+_,new k(s)}))}instanceCardss(){const t=t=>{this.previewType="cardss",this.preview=t};this.cardss_I=this.cardss.map(((i,e)=>{i=C(i);const s={width:(D-24-48)/3,card:i,touchMode:"click",touchEvent:()=>t(i),displayMode:"line",imageMode:"full",imageIns:P};return s.height=.175*s.width,s.x=24+e%3*(s.width+12),s.y=76+parseInt(e/3)*(s.height+6)+_,new k(s)}))}instancePreview(){const t={width:.7*D,card:this.preview,displayMode:"normal",imageMode:"full",imageIns:P};t.height=1.5*t.width,t.x=.15*D,t.y=(O-1.5*t.width)/2-80,this.preview_I=new k(t)}drawButtonHome(){const i={x:12,y:12+_,width:40,height:40,radius:20,text:"H"};new p(i).render(),t("touchstart",(()=>{Imitation.state.page.current="home",Imitation.dispatch()}),i)}drawPreview(){if(this.preview){if(a({x:0,y:0,width:D,height:O}),H.fillStyle="rgba(0, 0, 0, 0.75)",H.fill(),this.preview_I.card=this.preview,this.preview_I.render(),"cards"===this.previewType){const e={x:D/2-60,y:.75*O,width:120,height:40,radius:8,text:"装载"};new p(e).render(),t("touchstart",(()=>{this.load(this.preview),this.preview=null}),e);const o={x:D/2-60,y:.75*O+60,width:120,height:40,radius:8,text:"合成"};new p(o).render(),t("touchstart",(()=>{this.compose(this.preview),this.preview=null}),o),i("touchstart",(t=>{s(t,e)||s(t,o)||(this.preview=null)}))}if("cardss"===this.previewType){const e={x:D/2-60,y:.75*O,width:120,height:40,radius:8,text:"卸载"};new p(e).render(),t("touchstart",(()=>{this.unload(this.preview),this.preview=null}),e),i("touchstart",(t=>{s(t,e)||(this.preview=null)}))}}}drawScroll(){this.scroll_I.render((t=>{this.drawCards(t)}))}drawCards(t){this.cards_I.forEach((i=>{i.scrollTop=t,i.touchAble=!this.preview,i.render()}))}drawCardss(t){if(0===this.cardss.length)return;const i={x:12,y:64+_,width:D-24,height:this.cardssH+24,radius:12};r(i),H.fillStyle="white",H.fill(),this.cardss_I.forEach((i=>{i.scrollTop=t,i.touchAble=!this.preview,i.render()}))}drawCardssSelect(){new Array(4).fill().forEach(((i,e)=>{const s={y:12+_,width:40,height:40,radius:20,font:14,lineWidth:1,text:e};if(s.x=72+e%4*(s.width+12),e===Imitation.state.info.cardssIndex&&new p({...s,fillStyle:"black",strokeStyle:"black"}).render(),e!==Imitation.state.info.cardssIndex){if(new p(s).render(),this.preview)return;t("touchstart",(()=>{Imitation.state.info.cardssIndex=e,this.instance()}),s)}}))}drawBackground(){h(P,{x:0,y:0,width:D,height:O})}compose(t){}load(t){const i=Imitation.state.info.cards,e=Imitation.state.info.cardss[Imitation.state.info.cardssIndex],s=i.filter((i=>i.key===t.key&&i.level===t.level)),o=e.filter((i=>i.key===t.key&&i.level===t.level));s.length!==o.length&&(e.push({key:t.key,level:t.level}),this.instance())}unload(t){const i=Imitation.state.info.cardss[Imitation.state.info.cardssIndex],e=i.find((i=>i.key===t.key&&i.level===t.level));Imitation.state.info.cardss[Imitation.state.info.cardssIndex]=i.filter((t=>t!==e)),this.instance()}render(){this.drawBackground(),this.drawButtonHome(),this.drawCardssSelect(),this.drawCardss(),this.drawScroll(),this.drawPreview()}},B=canvas.getContext("2d");new class{constructor(){this.animationFrameId,this.ImitationInit(),this.loopStart()}render(){B.clearRect(0,0,canvas.width,canvas.height),Imitation.state.removeEventListener.forEach((t=>t())),Imitation.state.removeEventListener=[];const t=Imitation.state.page;t.instance&&t.instance instanceof t.map[t.current]||(!t.instance||t.instance instanceof y||(t.currentCache=t.current,t.current="transition"),t.instance=new t.map[t.current]),t.instance.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){Imitation.state={page:{current:"store",currentCache:"",map:{transition:y,home:v,store:L},instance:null},removeEventListener:[],info:{cards:[],cardss:[[],[],[],[]],cardssIndex:0}},Imitation.state.info.cards=((t=12)=>new Array(t).fill(M).reduce(((t,i)=>[...t,...i]),[]))(12).map((t=>({key:t.key,level:1,number:4}))),Imitation.state.info.cardss[0]=[...Imitation.state.info.cards].filter(((t,i)=>i<23)),Imitation.register((()=>{Imitation.state.page.next=Imitation.state.page.current,Imitation.state.page.current="transition"}),(t=>t.page.current))}}})()})();