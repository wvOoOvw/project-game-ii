(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},293:()=>{!function(){if(window.wx)return;window.wx={getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%";const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},6:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const s=this.dependentQueue[i],n=this.executeDependent(e.dependent);return n===t||Array.isArray(n)&&Array.isArray(s)&&(h=n,a=s,Array.isArray(h)&&Array.isArray(a)&&(h.length!==a.length||h.filter(((t,e)=>t===a[e])).length!==h.length))||!Array.isArray(n)&&!Array.isArray(s)&n!==s?(this.executeEvent(e.event),void(this.dependentQueue[i]=n)):void(this.dependentQueue[i]=n);var h,a}))},e.prototype.register=function(e,i=t){const s={event:e,dependent:i};return this.monitorQueue.push(s),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===s&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const s=new i;window.Imitation=s}()}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var h=e[s]={exports:{}};return t[s](h,h.exports,i),h.exports}(()=>{"use strict";i(293),i(652),i(6);const t="build/music_6e9e96c75cf04411baa154b1d6a3c7360.jpeg",e="build/music_8abd849fe01a4fb68dceacc6018190fc0.jpeg",s="build/music_47a83799595b4a5b97145a6e594620310.jpeg";var n=[{key:1,name:"燃烧",type:"进攻卡",race:"火",limit:3,image:"build/music_88c8411d068c455099456851ec84f65c0.jpeg",description:t=>`消耗10MP，造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,e,i,s)=>[{type:"cost-mp",target:"self",value:-10},{type:"hit",target:"opposite",value:-(15*t.level+100)},{type:"buff",target:"opposite",value:"燃"}]},{key:2,name:"冰冻",type:"魔法卡",race:"水",limit:3,image:"build/music_2fec7f9242b44b64a914f7cc19d25abe0.jpeg",description:t=>`造成 ${15*t+30} 伤害，恢复 30MP。`,function:(t,e,i,s)=>[{type:"cost-mp",target:"self",value:30},{type:"hit",target:"opposite",value:-(15*t.level+30)}]},{key:3,name:"自然",type:"治疗卡",race:"木",limit:3,image:"build/music_4d7f219082ba4d86b1543c982d1156560.jpeg",description:t=>"恢复 50HP、20MP，抽一张卡",function:(t,e,i,s)=>[{type:"cure-hp",target:"self",value:50},{type:"cure-mp",target:"self",value:20},{type:"pump-positive",target:"self",value:1}]},{key:4,name:"堕天",type:"进攻卡",race:"暗",limit:3,image:"build/music_98a7a38ce58546a7841d18c96e41e3760.jpeg",description:t=>`消耗50MP，造成 ${30*t+300} 伤害`,function:(t,e,i,s)=>[{type:"cost-mp",target:"self",value:-50},{type:"hit",target:"opposite",value:-(30*t.level+300)}]},{key:5,name:"坠地",type:"进攻卡",race:"暗",limit:3,image:t,description:t=>`消耗50MP，造成 ${50*t+200} 伤害`,function:(t,e,i,s)=>[{type:"cost-mp",target:"self",value:-50},{type:"hit",target:"opposite",value:-(50*t.level+200)}]}],h=[{key:1,name:"梦境守卫",image:e,HP:1,MP:1e3,card:[{...(n=n.map((t=>(t.imageDOM=new Image,t.imageDOM.src=t.image,t)))).find((t=>1===t.key)),level:3},{...n.find((t=>2===t.key)),level:3}]},{key:2,name:"梦魇",image:e,HP:1500,MP:1e3,card:[{...n.find((t=>1===t.key)),level:8},{...n.find((t=>2===t.key)),level:8}]}],a=[{name:"梦境 I",image:s,boss:{...(h=h.map((t=>(t.imageDOM=new Image,t.imageDOM.src=t.image,t)))).find((t=>1===t.key))},reward:()=>[{...n.find((t=>1===t.key)),level:1},{...n.find((t=>2===t.key)),level:1}]},{name:"梦境 II",image:"build/music_072c59684f6c401dad40cadf0d0dd6290.jpeg",boss:{...h.find((t=>2===t.key))},reward:()=>[{...n.find((t=>1===t.key)),level:1},{...n.find((t=>2===t.key)),level:1}]}];a=a.map((t=>(t.imageDOM=new Image,t.imageDOM.src=t.image,t)));const r=(t,e)=>t.reduce(((t,i)=>{const s=[...t],h=n.find((t=>i.key===t.key));if(e){const t={...h,...i};delete t.number,s.push(...new Array(i.number).fill().map((e=>({...t}))))}return e||s.push({...h,...i}),s}),[]),o=t=>1===t?"I":2===t?"II":3===t?"III":4===t?"IV":5===t?"V":6===t?"VI":7===t?"VII":8===t?"VIII":9===t?"IX":10===t?"X":11===t?"XI":12===t?"XII":13===t?"XIII":14===t?"XIV":15===t?"XV":void 0,l=t=>Number(Number(t).toFixed(2)),c=(t,e,i)=>{const s=t=>u(t,i)?e(t):null;canvas.addEventListener(t,s,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,s)))},d=(t,e)=>{const i=t=>e(t);canvas.addEventListener(t,i,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,i)))},u=(t,e)=>{const i=e.x,s=e.y,n=e.width,h=e.height,a=t.x||t.touches[0].clientX,r=t.y||t.touches[0].clientY;return a>=i&&a<=i+n&&r>=s&&r<=s+h},m=(t,e)=>{const{x:i,y:s,width:n,height:h}=t,{x:a,y:r,width:o,height:l}=e;return i+n>a&&i<a+o&&s+h>r&&s<r+l},g=t=>{const e=new Image;return e.src=t,e},w=canvas.getContext("2d"),p=(t,e)=>{const i=e.x,s=e.y,n=e.width,h=e.height;var a=0,r=0,o=t.width,l=t.height;const c=Math.max(n/t.width,h/t.height),d=t.width*c-n,u=t.height*c-h;d&&(a=d/2/c,o-=d/c),u&&(r=u/2/c,l-=u/c),w.drawImage(t,a,r,o,l,i,s,n,h)},f=t=>{const e=t.x,i=t.y,s=t.width,n=t.height,h=Array.isArray(t.radius)?t.radius:new Array(4).fill(t.radius);w.beginPath(),w.moveTo(e,i+h[0]),w.arcTo(e,i,e+h[0],i,h[0]),w.lineTo(e+s-h[1],i),w.arcTo(e+s,i,e+s,i+h[1],h[1]),w.lineTo(e+s,i+n-h[2]),w.arcTo(e+s,i+n,e+s-h[2],i+n,h[2]),w.lineTo(e+h[3],i+n),w.arcTo(e,i+n,e,i+n-h[3],h[3]),w.closePath()},y=t=>{const e=t.x,i=t.y,s=t.width,n=t.fontHeight;let h=t.text.split(""),a="",r=[];h.forEach((t=>{w.measureText(a).width>s&&(r.push(a),a=""),a+=t})),r.push(a),r.forEach(((t,s)=>{w.fillText(t,e,i+(s+1)*n)}))},x=canvas.getContext("2d"),b=g("build/162926_76690565815.jpeg"),v=wx.getSystemInfoSync().windowWidth,I=wx.getSystemInfoSync().windowHeight,S=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=l(this.opacity+.05),this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=l(this.opacity-.05),this.count=this.count+1),this.count>60)return Imitation.state.page.current=Imitation.state.page.next,void(Imitation.state.page.next="");x.globalAlpha=this.opacity,p(b,{x:0,y:0,width:v,height:I}),x.globalAlpha=1}},B=canvas.getContext("2d");class T{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius||8,this.font=t.font||14,this.opacity=t.opacity||1,this.text=t.text}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}render(){B.textAlign="center",B.textBaseline="middle",B.font=`bold ${this.font}px monospace`,B.fillStyle=`rgba(255, 255, 255, ${this.opacity})`,f({x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius}),B.fill(),B.fillStyle="rgba(0, 0, 0, 1)",B.fillText(this.text,this.x+this.width/2,this.y+this.height/2)}}canvas.getContext("2d");const A=g("build/music_56280e428411459c823ce172d97da20c0.jpeg"),C=wx.getSystemInfoSync().windowWidth,P=wx.getSystemInfoSync().windowHeight,k=class{constructor(){}drawButtonExplore(){const t={x:C/2-60,y:.7*P,width:120,height:40,text:"探索"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="explore"}),t)}drawButtonStore(){const t={x:C/2-60,y:.7*P+60,width:120,height:40,text:"仓库"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="store"}),t)}drawBackground(){p(A,{x:0,y:0,width:C,height:P})}render(){this.drawBackground(),this.drawButtonExplore(),this.drawButtonStore()}},M=canvas.getContext("2d");class H{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.scrollX=t.scrollX||0,this.scrollY=t.scrollY||0,this.scrollPosition=[0,0],this.mouseDownPosition=null,this.clipFunction=()=>{const t={x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius};return f(t),t}}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;if(this.scrollX<=0&&this.scrollY<=0)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var s=this.scrollPosition[0]-e,n=this.scrollPosition[1]-i;this.scrollX>0&&(s<=0&&(s=0),s>this.scrollX&&(s=this.scrollX)),this.scrollY>0&&(n<=0&&(n=0),n>this.scrollY&&(n=this.scrollY)),this.scrollPosition=[s,n]}render(t){M.save();const e=this.clipFunction();M.clip(),t(this.scrollPosition),M.restore(),c("touchstart",this.eventDown.bind(this),e),d("touchmove",this.eventMove.bind(this)),d("touchend",this.eventUp.bind(this))}}const D="build/music_1c31bcc267a545ef971109512053f3e50.jpeg",E=canvas.getContext("2d"),O=g(D),X=wx.getSystemInfoSync().safeArea.top,Y=wx.getSystemInfoSync().windowWidth,$=wx.getSystemInfoSync().windowHeight,L=class{constructor(){this.exploreMap,this.InstanceScroll,this.instance()}get scrollListHeight(){const t=this.exploreMap.length;return 0===t?0:160*t+(t?12*(t-1):0)}instance(){this.exploreMap=Imitation.state.explore.map,this.instanceScroll()}instanceScroll(){const t={x:12,y:60+X,width:Y-24,height:$-72-X,radius:12,scrollbarHidden:!0};this.InstanceScroll=new H(t),this.InstanceScroll.scrollY=this.scrollListHeight-this.InstanceScroll.height}drawScrollBox(){this.InstanceScroll.render((t=>{const e=t[1];this.drawScrollContent(e)}))}drawScrollContent(t){E.textAlign="start",E.textBaseline="top",E.fillStyle="rgba(0, 0, 0, 1)",E.font="bold 12px monospace",this.exploreMap.forEach(((e,i)=>{const s=60+172*i+X-t,n=Y-24,h=160;m({x:12,y:s,width:n,height:h},this.InstanceScroll.option)&&(E.save(),f({x:12,y:s,width:n,height:h,radius:12}),E.clip(),p(e.imageDOM,{x:12,y:s,width:n,height:h}),E.fillText(e.name,24,s+12),E.restore(),c("touchstart",(()=>{this.enter(e)}),{x:12,y:s,width:n,height:h}))}))}enter(t){Imitation.state.battle={self:{HP:1e3,MP:1e3,card:{team:r(Imitation.state.info.team[Imitation.state.info.teamIndex],!0),store:r(Imitation.state.info.team[Imitation.state.info.teamIndex],!0),hand:[],cemetery:[],consume:[]},buff:[]},opposite:{...t.boss,buff:[]},reward:t.reward},Imitation.state.page.current="transition",Imitation.state.page.next="battle-pve"}drawButtonHome(){const t={x:12,y:12+X,width:72,height:36,text:"返回"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}drawBackground(){p(O,{x:0,y:0,width:Y,height:$})}render(){this.drawBackground(),this.drawButtonHome(),this.drawScrollBox()}},_=canvas.getContext("2d"),R=g(D),j=g(t),Q=g("build/music_b40316005b55465b80ae4eecad8447960.jpeg"),W=wx.getSystemInfoSync().safeArea.top,N=wx.getSystemInfoSync().windowWidth,U=wx.getSystemInfoSync().windowHeight,F=t=>t>1?1:t<0?0:t;class V{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.battler=t.battler,this.imageIns=t.imageIns}render(){const t=this.x,e=this.y,i=this.width,s=this.height,n=this.battler;_.save(),f({x:t,y:e,width:i,height:s,radius:12}),_.clip(),p(this.imageIns,{x:t,y:e,width:i,height:s}),_.font="bold 12px monospace",_.textAlign="start",_.textBaseline="top",_.fillText(this.battler.name,this.x+12,this.y+12),_.textAlign="center",_.textBaseline="center",f({x:this.x+12,y:this.y+36,width:this.width-24,height:24,radius:12}),_.fillStyle="rgba(0, 0, 0, 0.7)",_.fill(),f({x:this.x+12,y:this.y+36,width:(this.width-24)*F(n.HP/1e3),height:24,radius:12}),_.fillStyle="rgba(255, 0, 0, 0.7)",_.fill(),_.fillStyle="rgba(255, 255, 255, 1)",_.fillText(`HP: ${n.HP}`,this.x+this.width/2,e+42),f({x:this.x+12,y:this.y+72,width:this.width-24,height:24,radius:12}),_.fillStyle="rgba(0, 0, 0, 0.7)",_.fill(),f({x:this.x+12,y:this.y+72,width:(this.width-24)*F(n.MP/1e3),height:24,radius:12}),_.fillStyle="rgba(0, 0, 255, 0.7)",_.fill(),_.fillStyle="rgba(255, 255, 255, 1)",_.fillText(`MP: ${n.MP}`,this.x+this.width/2,e+78),this.battler.buff.reduce(((t,e)=>{const i=t.find((t=>t.name===e));return i&&(i.number=i.number+1),i||t.push({name:e,number:1}),t}),[]).forEach(((t,e)=>{new T({x:12+this.x+48*e,y:this.y+106,width:36,height:36,radius:18,font:10,text:t.name+"x"+t.number}).render()})),_.restore()}}class q{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.battler=t.battler,this.imageIns=t.imageIns}render(){const t=this.x,e=this.y,i=this.width,s=this.height,n=this.battler;_.save(),f({x:t,y:e,width:i,height:s,radius:12}),_.clip(),p(this.imageIns,{x:t,y:e,width:i,height:s}),_.font="bold 12px monospace",_.textAlign="center",_.textBaseline="center",f({x:this.x+12,y:this.y+12,width:this.width-24,height:24,radius:12}),_.fillStyle="rgba(0, 0, 0, 0.7)",_.fill(),f({x:this.x+12,y:this.y+12,width:(this.width-24)*F(n.HP/1e3),height:24,radius:12}),_.fillStyle="rgba(255, 0, 0, 0.7)",_.fill(),_.fillStyle="rgba(255, 255, 255, 1)",_.fillText(`HP: ${n.HP}`,this.x+this.width/2,e+24),f({x:this.x+12,y:this.y+48,width:this.width-24,height:24,radius:12}),_.fillStyle="rgba(0, 0, 0, 0.7)",_.fill(),f({x:this.x+12,y:this.y+48,width:(this.width-24)*F(n.MP/1e3),height:24,radius:12}),_.fillStyle="rgba(0, 0, 255, 0.7)",_.fill(),_.fillStyle="rgba(255, 255, 255, 1)",_.fillText(`MP: ${n.MP}`,this.x+this.width/2,e+60),this.battler.buff.reduce(((t,e)=>{const i=t.find((t=>t.name===e));return i&&(i.number=i.number+1),i||t.push({name:e,number:1}),t}),[]).forEach(((t,e)=>{new T({x:12+this.x+48*e,y:this.y+84,width:36,height:36,radius:18,font:10,text:t.name+"x"+t.number}).render()})),_.restore()}}class J{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.novaTime=0,this.card=t.card,this.touchStart=t.touchStart,this.touchEnd=t.touchEnd,this.actionHeight=t.actionHeight,this.useAbleTime=0,this.mouseDownPosition=null,this.mouseDownPositionTime=0}get useAble(){return this.offsetY<0-this.actionHeight/2}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.useAble&&this.touchEnd(),this.mouseDownPosition=null,this.offsetX=0,this.offsetY=0}eventMove(t){if(!this.mouseDownPosition)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i],this.offsetX=this.offsetX+e,this.offsetY=this.offsetY+i}render(){this.novaTime<1&&(this.novaTime=l(this.novaTime+.05)),this.mouseDownPosition&&this.mouseDownPositionTime<1&&(this.mouseDownPositionTime=l(this.mouseDownPositionTime+.05)),!this.mouseDownPosition&&this.mouseDownPositionTime>0&&(this.mouseDownPositionTime=0),this.useAble&&this.useAbleTime<1&&(this.useAbleTime=l(this.useAbleTime+.05)),!this.useAble&&this.useAbleTime>0&&(this.useAbleTime=l(this.useAbleTime-.05));const t=this.card,e=.5*-this.width,i=.5*-this.height,s=this.width,n=this.height,h=this.x+this.offsetX+e*this.mouseDownPositionTime,a=this.y+this.offsetY+i*this.mouseDownPositionTime,r=this.width+s*this.mouseDownPositionTime,u=this.height+n*this.mouseDownPositionTime;_.save(),_.globalAlpha=this.novaTime,f({x:h,y:a,width:r,height:u,radius:.08*r}),_.clip(),p(this.card.imageDOM,{x:h,y:a,width:r,height:u});const m=u*this.useAbleTime,g=u*this.useAbleTime;if(f({x:h+(r-m)/2,y:a+(u-g)/2,width:m,height:g,radius:m/2}),_.fillStyle="rgba(255, 255, 255, 0.5)",_.fill(),this.mouseDownPositionTime&&(_.textAlign="center",_.textBaseline="middle",_.font=`bold ${.075*r}px monospace`,_.fillStyle="rgba(0, 0, 0, 1)",_.fillText(t.name,h+r/2,a+.12*r),t.number&&_.fillText("X"+t.number,h+r-.12*r,a+.12*r),_.textAlign="start",_.fillText("Lv"+t.level,h+.08*r,a+.36*r),_.fillText(`${t.race} · ${t.type}`,h+.08*r,a+.48*r),y({x:h+.08*r,y:a+.6*r,width:r-.25*r,fontHeight:.12*r,text:t.description(1)})),!this.mouseDownPositionTime){const e=.6*r,i=.2*r,s=h+r/2-e/2,n=a+u-i-(s-h),l=.08*r,c=[t.name,o(t.level)];t.number&&c.push("x"+t.number),f({x:s,y:n,width:e,height:i,radius:l}),_.fillStyle="rgba(255, 255, 255, 0.5)",_.fill(),_.textAlign="center",_.textBaseline="middle",_.font=`bold ${.075*r}px monospace`,_.fillStyle="rgba(0, 0, 0, 1)",_.fillText(c.join(" "),s+e/2,n+i/2)}_.restore(),c("touchstart",this.eventDown.bind(this),{x:h,y:a,width:r,height:u}),d("touchmove",this.eventMove.bind(this)),d("touchend",this.eventUp.bind(this))}}class K{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.InstanceBattlerSelf=t.InstanceBattlerSelf,this.InstanceBattlerOpposite=t.InstanceBattlerOpposite,this.cards=t.cards,this.env=t.env,this.useCard=t.useCard,this.overRound=t.overRound,this.watchStore=t.watchStore,this.watchCemetery=t.watchCemetery,this.touchCard,this.InstanceCards=[]}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get cardHeight(){return 1.35*(this.width/4-12)}updateCards(t){this.cards=t;const e=this.x,i=this.y,s=this.width,n=this.height;this.InstanceCards=this.InstanceCards.filter((t=>this.cards.find((e=>e===t.card)))),this.cards.forEach(((h,a)=>{const r=a-(t.length/2-.5),o={width:s/4-4-s/48};o.height=1.35*o.width,o.x=e+(s-o.width)/2+r*(s/4-4),o.y=i+(n-o.height)/2,o.touchStart=()=>this.touchCard=h,o.touchEnd=()=>this.useCard(h,this.InstanceBattlerSelf),o.actionHeight=this.height;const l=this.InstanceCards.find((t=>t.card===h));l&&(l.x=o.x),l||this.InstanceCards.push(new J({card:h,...o}))}))}updateEnv(t){this.env=t}drawEnv(){const t={x:this.x+12,y:this.y+this.height/2-this.cardHeight/2-42,width:this.width-24,height:30,font:10,text:`ROUND ${this.env.round}`};new T(t).render()}drawButtonOverRound(){const t={x:this.x+this.width-84,y:this.y+this.height/2+this.cardHeight/2+12,width:72,height:30,font:10,text:"结束回合"};new T(t).render(),c("touchstart",(()=>{this.overRound()}),t)}drawButtonStore(){const t={x:this.x+12,y:this.y+this.height/2+this.cardHeight/2+12,width:72,height:30,font:10,text:`查看牌库x${this.InstanceBattlerSelf.battler.card.store.length}`};new T(t).render(),c("touchstart",(()=>{this.watchStore()}),t)}drawButtonCemetery(){const t={x:this.x+96,y:this.y+this.height/2+this.cardHeight/2+12,width:72,height:30,font:10,text:`查看墓地x${this.InstanceBattlerSelf.battler.card.cemetery.length}`};new T(t).render(),c("touchstart",(()=>{this.watchCemetery()}),t)}drawBackground(){f({...this.option,radius:12,x:12,width:N-24}),_.fillStyle="rgba(255, 255, 255, 0.5)",_.fill()}render(){this.drawBackground(),this.drawEnv(),this.drawButtonOverRound(),this.drawButtonStore(),this.drawButtonCemetery(),this.InstanceCards.forEach((t=>t.card!==this.touchCard?t.render():null)),this.InstanceCards.forEach((t=>t.card===this.touchCard?t.render():null))}}class z{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}render(){const t=this.x+this.offsetX,e=this.y+this.offsetY,i=this.width,s=this.height,n=this.card;_.save(),f({x:t,y:e,width:i,height:s,radius:.08*i}),_.clip(),p(this.card.imageDOM,{x:t,y:e,width:i,height:s}),_.fillStyle="rgba(255, 255, 255, 0.25)",_.fill(),_.fillStyle="rgba(0, 0, 0, 1)",_.textAlign="center",_.textBaseline="middle",_.font=`bold ${.075*i}px monospace`,_.fillText(n.name,t+i/2,e+.12*i),n.number&&_.fillText("X"+n.number,t+i-.12*i,e+.12*i),_.textAlign="start",_.fillText("Lv"+n.level,t+.08*i,e+.36*i),y({x:t+.08*i,y:e+.48*i,width:i-.25*i,fontHeight:.12*i,text:n.description(1)}),_.restore()}}class G{constructor(t){this.cards=[],this.back=t.back,this.InstanceScroll,this.instanceScroll()}get cardHeight(){const t=Math.ceil(this.cards.length/4);return 0===t?0:(N-60)/4*1.35*t+(t?12*(t-1):0)}updateScrollY(){this.InstanceScroll.scrollY=this.cardHeight-this.InstanceScroll.height+12}instanceScroll(){const t={x:12,y:60+W,width:N-24,height:U-120-W,radius:12};f(t),_.fillStyle="black",_.fill(),this.InstanceScroll=new H(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.drawCard(e)}))}drawCard(t){this.InstanceCard=this.cards.map(((t,e)=>{const i={width:(N-60)/4,card:t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),i.y=72+parseInt(e/4)*(i.height+12)+W,new z(i)})),this.InstanceCard.forEach((e=>{m({...e.option,y:e.y-t},this.InstanceScroll.option)&&(e.offsetY=0-t,e.render())}))}drawButtonBack(){const t={x:12,y:12+W,width:72,height:36,font:12,text:"返回"};new T(t).render(),c("touchstart",this.back,t)}render(){this.drawButtonBack(),this.drawScroll()}}class Z{constructor(){this.over,this.reward}drawContent(){"win"===this.over&&this.reward.forEach(((t,e)=>{const i={width:(N-60)/4,card:t};i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),i.y=72+parseInt(e/4)*(i.height+12)+W,new z(i).render()})),"lose"===this.over&&(_.textAlign="center",_.textBaseline="middle",_.font="bold 12px monospace",_.fillStyle="rgba(0, 0, 0, 1)",_.fillText("战斗失败",N/2,(U-W)/2))}drawButtonHome(){const t={x:12,y:12+W,width:72,height:36,font:12,text:"返回"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}render(){this.drawButtonHome(),this.drawContent()}}const tt=class{constructor(){this.animationing=!1,this.modal=null,this.over=null,this.env={round:1},this.InstanceBattlerSelf,this.InstanceBattlerOpposite,this.InstanceAction,this.InstanceModal,this.InstanceOver,this.instanceBattlerSelf(),this.instanceBattlerOpposite(),this.instanceAction(),this.instanceModal(),this.instanceOver(),this.initBattler()}initBattler(){new Array(4).fill().forEach((t=>{this.pumpCard(this.InstanceBattlerSelf.battler.card.store.shift(),this.InstanceBattlerSelf)})),this.InstanceAction.updateCards(this.InstanceBattlerSelf.battler.card.hand)}instanceBattlerSelf(){const t=.5*U/2;this.InstanceBattlerSelf=new q({x:12,y:72+t+W,width:N-24,height:t,imageIns:Q,battler:Imitation.state.battle.self})}instanceBattlerOpposite(){const t=.5*U/2;this.InstanceBattlerOpposite=new V({x:12,y:60+W,width:N-24,height:t,imageIns:j,battler:Imitation.state.battle.opposite})}instanceAction(){var t=N-24,e=.5*U-96;t>U-160&&(t=U-160),e>t/2+60&&(e=t/2+60),this.InstanceAction=new K({x:(N-t)/2,y:U-e-12,width:t,height:e,cards:this.InstanceBattlerSelf.battler.card.hand,env:this.env,InstanceBattlerSelf:this.InstanceBattlerSelf,InstanceBattlerOpposite:this.InstanceBattlerOpposite,useCard:this.useCard,overRound:this.overRound,watchStore:()=>{this.modal=!0,this.InstanceModal.cards=this.InstanceBattlerSelf.battler.card.store,this.InstanceModal.updateScrollY()},watchCemetery:()=>{this.modal=!0,this.InstanceModal.cards=this.InstanceBattlerSelf.battler.card.cemetery,this.InstanceModal.updateScrollY()}})}instanceModal(){this.InstanceModal=new G({back:()=>this.modal=!1})}instanceOver(){this.InstanceOver=new Z({})}drawBattlerSelf(){this.InstanceBattlerSelf.render()}drawBattlerOpposite(){this.InstanceBattlerOpposite.render()}drawAction(){this.InstanceAction.render()}drawModal(){this.InstanceModal.render()}drawOver(){this.InstanceOver.render()}drawBackground(){p(R,{x:0,y:0,width:N,height:U})}drawButtonHome(){const t={x:12,y:12+W,width:72,height:36,font:12,text:"返回"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}pumpCard=(t,e)=>{4===e.battler.card.hand.length&&e.battler.card.cemetery.push(t),e.battler.card.hand.length<4&&e.battler.card.hand.push(t)};useCard=(t,e)=>{this.animationing=!0;const[i,s]=e===this.InstanceBattlerSelf?[this.InstanceBattlerSelf,this.InstanceBattlerOpposite]:[this.InstanceBattlerOpposite,this.InstanceBattlerSelf],n=t.function(t,i.battler,s.battler,this.env);for(Imitation.state.function.message(t.name,"rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)");n.length;){const t=n.shift();"cost-mp"===t.type&&"self"===t.target&&(i.battler.MP=i.battler.MP+t.value),"hit"===t.type&&(Imitation.state.function.sound("hit"),"opposite"===t.target&&(s.battler.HP=s.battler.HP+t.value)),"buff"===t.type&&("self"===t.target&&i.battler.buff.push(t.value),"opposite"===t.target&&s.battler.buff.push(t.value)),"cure-hp"===t.type&&"self"===t.target&&(i.battler.HP=i.battler.HP+t.value),"cure-mp"===t.type&&"self"===t.target&&(i.battler.MP=i.battler.MP+t.value),"pump-positive"===t.type&&"self"===t.target&&e===this.InstanceBattlerSelf&&new Array(t.value).fill().forEach((t=>{this.InstanceBattlerSelf.battler.card.hand.push(this.InstanceBattlerSelf.battler.card.store.shift())}))}e===this.InstanceBattlerSelf&&(i.battler.card.hand=i.battler.card.hand.filter((e=>e!==t)),i.battler.card.cemetery.push(t),i.battler.card.consume.push(t),this.InstanceAction.updateCards(this.InstanceBattlerSelf.battler.card.hand)),this.animationing=!1,this.overBattle()};overRound=async()=>{this.useCard(((t,e)=>{if(t.length<=1)return t;var i=[],s=t.map((t=>t));return new Array(1).fill().forEach((()=>{const t=Math.floor(Math.random()*s.length);i.push(s[t]),s=s.filter(((e,i)=>i!==t))})),i})(this.InstanceBattlerOpposite.battler.card)[0],this.InstanceBattlerOpposite),this.env.round=this.env.round+1,new Array(2).fill().forEach((t=>{this.pumpCard(this.InstanceBattlerSelf.battler.card.store.shift(),this.InstanceBattlerSelf)})),this.InstanceAction.updateCards(this.InstanceBattlerSelf.battler.card.hand)};overBattle=()=>{if(this.InstanceBattlerOpposite.battler.HP<=0){this.over="win",this.InstanceOver.reward=Imitation.state.battle.reward();const t=Imitation.state.info.cardLibrary;return this.InstanceOver.reward.forEach((e=>{const i=t.find((t=>t.key===e.key));i&&(i.number=i.number+1),i||t.push({key:e.key,level:e.level,number:1})})),Imitation.state.function.saveInfo(),void(this.InstanceOver.over=this.over)}if(this.InstanceBattlerSelf.battler.HP<=0)return this.over="lose",void(this.InstanceOver.over=this.over)};render(){this.drawBackground(),this.modal&&this.drawModal(),this.over&&this.drawOver(),this.modal||this.over||(this.drawButtonHome(),this.drawBattlerSelf(),this.drawBattlerOpposite(),this.drawAction())}},et=canvas.getContext("2d"),it=g(D),st=g(s),nt=wx.getSystemInfoSync().safeArea.top,ht=wx.getSystemInfoSync().windowWidth,at=wx.getSystemInfoSync().windowHeight;class rt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.touchEvent=t.touchEvent,this.touchDelayTime=t.touchDelayTime,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!u(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}render(){const t=this.x+this.offsetX,e=this.y+this.offsetY,i=this.width,s=this.height,n=this.card;et.save(),f({x:t,y:e,width:i,height:s,radius:.08*i}),et.clip(),p(this.card.imageDOM,{x:t,y:e,width:i,height:s});const h=.6*i,a=.2*i,r=t+i/2-h/2,l=e+s-a-(r-t),u=.08*i,m=[n.name,o(n.level)];n.number&&m.push("x"+n.number),f({x:r,y:l,width:h,height:a,radius:u}),et.fillStyle="rgba(255, 255, 255, 0.5)",et.fill(),et.textAlign="center",et.textBaseline="middle",et.font=`bold ${.075*i}px monospace`,et.fillStyle="rgba(0, 0, 0, 1)",et.fillText(m.join(" "),r+h/2,l+a/2),et.restore(),c("touchstart",this.eventDown.bind(this),{x:t,y:e,width:i,height:s}),d("touchmove",this.eventMove.bind(this)),d("touchend",this.eventUp.bind(this))}}class ot{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.card=t.card,this.novaTime=0}render(){this.novaTime<1&&(this.novaTime=l(this.novaTime+.05));const t=this.x,e=this.y,i=this.width,s=this.height,n=this.card;et.save(),f({x:t,y:e,width:i,height:s,radius:.08*i}),et.clip(),p(this.card.imageDOM,{x:t,y:e,width:i,height:s});const h=s*this.novaTime,a=s*this.novaTime;f({x:t+(i-h)/2,y:e+(s-a)/2,width:h,height:a,radius:h/2}),et.fillStyle="rgba(255, 255, 255, 0.5)",et.fill(),et.textAlign="center",et.textBaseline="middle",et.font=`bold ${.075*i}px monospace`,et.fillStyle="rgba(0, 0, 0, 1)",et.fillText(n.name,t+i/2,e+.12*i),n.number&&et.fillText("X"+n.number,t+i-.12*i,e+.12*i),et.textAlign="start",et.fillText("Lv"+n.level,t+.08*i,e+.36*i),et.fillText(`${n.race} · ${n.type}`,t+.08*i,e+.48*i),y({x:t+.08*i,y:e+.6*i,width:i-.25*i,fontHeight:.12*i,text:n.description(1)}),et.restore()}}const lt=class{constructor(){this.preview=null,this.type="team",this.sort="name",this.card,this.InstanceScroll,this.InstanceCard,this.InstancePreview,this.initCard(),this.instanceScroll(),this.instanceCard(),this.instancePreview()}get bannerHeight(){return 180}get cardHeight(){const t=Math.ceil(this.card.length/4);return 0===t?0:(ht-60)/4*1.35*t+(t?12*(t-1):0)}initCard(){"team"===this.type&&(this.card=r(Imitation.state.info.team[Imitation.state.info.teamIndex],!0)),"library"===this.type&&(this.card=r(Imitation.state.info.cardLibrary)),this.card=this.card.sort(((t,e)=>{const i=String(t[this.sort]).split("").reduce(((t,e)=>t+String(e).charCodeAt(0)),0);return String(e[this.sort]).split("").reduce(((t,e)=>t+String(e).charCodeAt(0)),0)-i}))}instanceScroll(){const t={x:12,y:60+nt,width:ht-24,height:at-72-nt,radius:12};this.InstanceScroll=new H(t),this.InstanceScroll.scrollY=this.bannerHeight+this.cardHeight-this.InstanceScroll.height+12}instanceCard(){this.InstanceCard=this.card.map(((t,e)=>{const i={width:(ht-60)/4,card:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),i.y=72+parseInt(e/4)*(i.height+12)+this.bannerHeight+nt,new rt(i)}))}instancePreview(){const t={width:.7*ht,card:this.preview};t.height=1.35*t.width,t.x=.15*ht,t.y=(at-1.5*t.width)/2-60,this.InstancePreview=new ot(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.drawBanner(e),this.drawCard(e)}))}drawBanner(t){const e={x:12,y:60-t+nt,width:ht-24,height:this.bannerHeight,radius:12};m(e,this.InstanceScroll.option)&&(et.save(),f(e),et.clip(),p(st,e),(()=>{new Array(Imitation.state.info.team.length).fill().forEach(((t,i)=>{const s={x:24+72*i,y:12+e.y,width:60,height:30,font:10,opacity:.5,text:`队伍 ${i+1}`};m(s,this.InstanceScroll.option)&&(i===Imitation.state.info.teamIndex&&(s.opacity=1),new T(s).render(),c("touchstart",(t=>{u(t,this.InstanceScroll.option)&&(Imitation.state.info.teamIndex=i,this.type="team",this.initCard(),this.instanceScroll(),this.instanceCard())}),s))}))})(),(()=>{const t={x:24,y:e.y+e.height-42,width:60,height:30,font:10,opacity:.5,text:"查看仓库"};m(t,this.InstanceScroll.option)&&("library"===this.type&&(t.opacity=1),new T(t).render(),c("touchstart",(t=>{if(u(t,this.InstanceScroll.option))return"team"===this.type?(this.type="library",this.initCard(),this.instanceScroll(),void this.instanceCard()):"library"===this.type?(this.type="team",this.initCard(),this.instanceScroll(),void this.instanceCard()):void 0}),t))})(),(()=>{new Array(...[["name","名称"],["level","等级"],["type","类型"],["race","种类"]]).forEach(((t,i)=>{const s={x:24+72*i,y:54+e.y,width:60,height:30,font:10,opacity:.5,text:t[1]};m(s,this.InstanceScroll.option)&&(t[0]===this.sort&&(s.opacity=1),new T(s).render(),c("touchstart",(e=>{u(e,this.InstanceScroll.option)&&(this.sort=t[0],this.initCard(),this.instanceScroll(),this.instanceCard())}),s))}))})(),et.restore())}drawCard(t){this.InstanceCard.forEach((e=>{m({...e.option,y:e.y-t},this.InstanceScroll.option)&&(e.offsetY=0-t,e.render())}))}drawPreview(){this.InstancePreview.card=this.preview,this.InstancePreview.render();const t=at-this.InstancePreview.y-120;var e,i;if("library"===this.type&&(new T(e={x:ht/2-60,y:t,width:120,height:40,radius:8,text:"装载"}).render(),c("touchstart",(()=>{this.load(this.preview),this.preview=null}),e),new T(i={x:ht/2-60,y:t+60,width:120,height:40,radius:8,text:"合成"}).render(),c("touchstart",(()=>{this.compose(this.preview),this.preview=null}),i)),"team"===this.type){const e={x:ht/2-60,y:t,width:120,height:40,radius:8,text:"卸载"};new T(e).render(),c("touchstart",(()=>{this.unload(this.preview),this.preview=null}),e)}d("touchstart",(t=>{e&&u(t,e)||i&&u(t,i)||(this.preview=null,this.InstancePreview.novaTime=0)}))}drawBackground(){p(it,{x:0,y:0,width:ht,height:at})}drawButtonHome(){const t={x:12,y:12+nt,width:72,height:36,font:12,text:"返回"};new T(t).render(),c("touchstart",(()=>{Imitation.state.page.current="transition",Imitation.state.page.next="home"}),t)}compose(t){const e=Imitation.state.info.cardLibrary,i=Imitation.state.info.team[Imitation.state.info.teamIndex],s=e.find((e=>e.key===t.key&&e.level===t.level)),n=e.find((e=>e.key===t.key&&e.level===t.level+1)),h=i.find((e=>e.key===t.key&&e.level===t.level));if(s.number<3)Imitation.state.function.message("卡牌数量不足","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)");else{if(s.number=s.number-3,0===s.number){const t=e.indexOf(s);e.splice(t,1)}if(n&&(n.number=n.number+1),n||e.push({key:t.key,level:t.level+1,number:1}),h&&(h.number>s.number&&(h.number=s.number),0===h.number)){const t=i.indexOf(h);i.splice(t,1)}this.initCard(),this.instanceScroll(),this.instanceCard(),Imitation.state.function.message("合成成功","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)")}}load(t){const e=Imitation.state.info.cardLibrary,i=Imitation.state.info.team[Imitation.state.info.teamIndex],s=e.find((e=>e.key===t.key&&e.level===t.level)),n=i.find((e=>e.key===t.key&&e.level===t.level));i.reduce(((t,e)=>t+e.number),0)>40?Imitation.state.function.message("超出卡组数量限制","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)"):i.filter((e=>e.key===t.key)).reduce(((t,e)=>t+e.number),0)>=t.limit?Imitation.state.function.message("超出卡牌数量限制","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)"):n&&n.number===s.number?Imitation.state.function.message("卡组数量不足","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)"):(n&&(find.number=find.number+1),n||i.push({key:t.key,level:t.level,number:1}),this.initCard(),this.instanceScroll(),this.instanceCard(),Imitation.state.function.message("装载成功","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)"))}unload(t){const e=Imitation.state.info.team[Imitation.state.info.teamIndex],i=e.find((e=>e.key===t.key&&e.level===t.level));if(i.number=i.number-1,0===i.number){const t=e.indexOf(i);e.splice(t,1)}this.initCard(),this.instanceScroll(),this.instanceCard(),Imitation.state.function.message("卸载成功","rgba(0, 0, 255, 1)","rgba(255, 255, 255, 1)")}render(){this.drawBackground(),this.preview&&this.drawPreview(),this.preview||(this.drawButtonHome(),this.drawScroll())}},ct=canvas.getContext("2d"),dt=(wx.getSystemInfoSync().safeArea.top,wx.getSystemInfoSync().windowWidth),ut=wx.getSystemInfoSync().windowHeight;class mt{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeout=1e3,this.timeoutRef=null,this.show=!1,this.opacity=0,this.width=dt-24,this.height=36,this.x=(dt-this.width)/2,this.y=ut-48}send(t,e="rgba(255, 255, 255, 1)",i="rgba(0, 0, 0, 1)"){clearTimeout(this.timeoutRef),this.message=t,this.backgroundColor=e,this.textColor=i,this.show=!0,this.timeoutRef=setTimeout((()=>{this.show=!1,this.timeoutRef=null}),this.timeout)}render(){this.show&&this.opacity<1&&(this.opacity=l(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=l(this.opacity-.05)),this.show&&this.y>ut-48&&(this.y=l(this.y-4)),!this.show&&this.y<ut&&(this.y=l(this.y+4)),(this.show||0!==this.opacity)&&(ct.save(),ct.globalAlpha=this.opacity,ct.textAlign="center",ct.textBaseline="middle",ct.font="bold 12px monospace",ct.fillStyle=this.backgroundColor,f({x:this.x,y:this.y,width:this.width,height:this.height,radius:12}),ct.fill(),ct.fillStyle=this.textColor,ct.fillText(this.message,this.x+this.width/2,this.y+this.height/2),ct.restore())}}class gt{constructor(){this.map={JOJO_HBY:"build/_storages_386a-audiofreehighqps_DA_B0_CKwRINsEIkYTAAWoHgCR2Utt.mp3",hit:"build/5c88acd3ccdc817369.mp3"},this.audioQueue=new Array(8).fill().map((t=>new Audio))}play(t,e=!1){const i=this.audioQueue.find((t=>!t.playing));i.onended=()=>i.playing=!1,i.playing=!0,i.loop=e,i.src=this.map[t],i.play()}}const wt=canvas.getContext("2d"),pt=wx.getSystemInfoSync().windowWidth,ft=wx.getSystemInfoSync().windowHeight;class yt{constructor(){window.SaveImage=()=>{const t=document.createElement("a");t.href=canvas.toDataURL(),t.download="image",t.click()},this.card={key:1,name:"燃烧",type:"进攻卡",race:"火",limit:3,image:g("https://img2.huashi6.com/images/resource/f196633863275/2022/09/05/13842_52253234441.jpg"),description:t=>`消耗10MP，造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,e,i,s)=>[{type:"cost-mp",target:"self",value:-10},{type:"hit",target:"opposite",value:-(15*t.level+100)},{type:"buff",target:"opposite",value:"fire"}]}}render(){const t=pt,e=ft,i=this.card;f({x:0,y:0,width:t,height:e,radius:.08*t}),wt.clip(),p(i.image,{x:0,y:0,width:t,height:e}),wt.fillStyle="rgba(255, 255, 255, 1)",wt.textAlign="center",wt.textBaseline="middle",wt.font=`bold ${.075*t}px monospace`,wt.fillText(i.name,0+t/2,0+.12*t),i.number&&wt.fillText("X"+i.number,0+t-.12*t,0+.12*t),wt.textAlign="start",wt.fillText(`${i.race} · ${i.type}`,0+.08*t,0+.48*t),y({x:0+.08*t,y:0+.6*t,width:t-.25*t,fontHeight:.12*t,text:i.description(1)})}}const xt=canvas.getContext("2d");new class{constructor(){this.loadingInformation=!1,this.animationFrameId,this.instance,this.instanceMessage=new mt,this.instanceSound=new gt,this.ImitationInit(),this.loopStart()}render(){xt.clearRect(0,0,canvas.width,canvas.height),Imitation.state.removeEventListener.forEach((t=>t())),Imitation.state.removeEventListener=[];const t=Imitation.state.page.map[Imitation.state.page.current];this.instance instanceof t||(this.instance=new t),this.instance.render(),this.instanceMessage.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){Imitation.state={page:{current:"home",next:"",map:{"save-image":yt,transition:S,home:k,explore:L,"battle-pve":tt,store:lt}},removeEventListener:[],info:{cardLibrary:null,team:null,teamIndex:null},explore:{map:null},battle:{},function:{render:this.render,loopStart:this.loopStart,loopEnd:this.loopEnd,message:(t,e,i)=>this.instanceMessage.send(t,e,i),sound:t=>this.instanceSound.play(t),saveInfo:()=>{}}};const t={cardLibrary:n.map((t=>({key:t.key,level:1,number:10}))),team:[n.map((t=>({key:t.key,level:1,number:3}))),[],[],[]],teamIndex:0};Imitation.state.info=t,Imitation.state.explore.map=a}}})()})();