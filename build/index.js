(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2}()},293:()=>{!function(){if(window.wx)return;window.wx={getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style["max-width"]="425px";const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},45:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const s=this.dependentQueue[i],o=this.executeDependent(e.dependent);return o===t||Array.isArray(o)&&Array.isArray(s)&&(n=o,h=s,Array.isArray(n)&&Array.isArray(h)&&(n.length!==h.length||n.filter(((t,e)=>t===h[e])).length!==n.length))||!Array.isArray(o)&&!Array.isArray(s)&o!==s?(this.executeEvent(e.event),void(this.dependentQueue[i]=o)):void(this.dependentQueue[i]=o);var n,h}))},e.prototype.register=function(e,i=t){const s={event:e,dependent:i};return this.monitorQueue.push(s),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===s&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const s=new i;window.Imitation=s}()}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}(()=>{"use strict";i(293),i(652),i(45);const t=(t,e,i)=>{const o=t=>s(t,i)?e(t):null;canvas.addEventListener(t,o,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,o)))},e=(t,e)=>{const i=t=>e(t);canvas.addEventListener(t,i,{passive:!0}),Imitation.state.removeEventListener.push((()=>canvas.removeEventListener(t,i)))},s=(t,e)=>{const i=e.x,s=e.y,o=e.width,n=e.height,h=t.x||t.touches[0].clientX,r=t.y||t.touches[0].clientY;return h>=i&&h<=i+o&&r>=s&&r<=s+n},o=t=>{const e=new Image;return e.src=t,e},n=canvas.getContext("2d"),h=()=>{n.setTransform(1,0,0,1,0,0),n.scale(dpr,dpr),n.globalAlpha=1,n.fillStyle="#000000",n.strokeStyle="#000000",n.shadowBlur=0,n.shadowColor="#000000",n.shadowOffsetX=0,n.shadowOffsetY=0,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.font="bold 14px monospace",n.textAlign="start",n.textBaseline="alphabetic"},r=(t,e)=>{const i=e.x,s=e.y,o=e.width,h=e.height;var r=0,a=0,c=t.width,l=t.height;const d=Math.max(o/t.width,h/t.height),u=t.width*d-o,p=t.height*d-h;u&&(r=u/2/d,c-=u/d),p&&(a=p/2/d,l-=p/d),n.drawImage(t,r,a,c,l,i,s,o,h)},a=t=>{const e=t.x,i=t.y,s=t.width,o=t.height,h=t.radius;n.beginPath(),n.moveTo(e,i+h),n.arcTo(e,i,e+h,i,h),n.lineTo(e+s-h,i),n.arcTo(e+s,i,e+s,i+h,h),n.lineTo(e+s,i+o-h),n.arcTo(e+s,i+o,e+s-h,i+o,h),n.lineTo(e+h,i+o),n.arcTo(e,i+o,e,i+o-h,h),n.closePath()},c=t=>{const e=t.x,i=t.y,s=t.width,o=t.height,r=t.text,c=t.font,l=t.lineWidth;n.save(),a(t),n.lineWidth=l,n.strokeStyle="rgba(255, 255, 255, 1)",n.stroke(),n.textAlign="center",n.textBaseline="middle",n.font=`bold ${c}px monospace`,n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(r,e+s/2,i+o/2),h(),n.restore()},l=(canvas.getContext("2d"),o("build/234521_92189037316.jpeg")),d=wx.getSystemInfoSync().windowWidth,u=wx.getSystemInfoSync().windowHeight,p=class{constructor(){}drawButtonBattle(){const e={x:d/2-60,y:.7*u,width:120,height:40,radius:8,font:14,lineWidth:1,text:"战斗"};c(e),t("touchstart",(()=>{}),e)}drawButtonStore(){const e={x:d/2-60,y:.7*u+60,width:120,height:40,radius:8,font:14,lineWidth:1,text:"仓库"};c(e),t("touchstart",(()=>{Imitation.state.page.current="store",Imitation.dispatch()}),e)}render(){r(l,{x:0,y:0,width:d,height:u}),this.drawButtonBattle(),this.drawButtonStore()}},m=canvas.getContext("2d");class w{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.min=t.min,this.max=t.max,this.backgroundColor="rgba(255, 255, 255, 1)",this.scrollbarOffset=t.scrollbarOffset,this.scrollbarThick=t.scrollbarThick,this.scrollbarColor="rgba(0, 0, 0, opacity)",this.scrollbarOpacity=0,this.scrollbarTimeout=!1,this.scrollPosition=0,this.mouseDownPosition=null}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;clearTimeout(this.scrollbarTimeout),this.scrollbarTimeout=setTimeout((()=>this.scrollbarTimeout=null),1e3);const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];const s=this.scrollPosition-i;s<this.min?this.scrollPosition=this.min:s>this.max?this.scrollPosition=this.max:this.scrollPosition=this.scrollPosition-i}render(i){m.fillStyle=this.backgroundColor,a({x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius}),m.fill(),h(),m.save();const s={x:this.x,y:this.y,width:this.width,height:this.height,radius:this.radius};if(a(s),t("touchstart",this.eventDown.bind(this),s),e("touchmove",this.eventMove.bind(this)),e("touchend",this.eventUp.bind(this)),m.clip(),this.max>0){const t=this.height*(this.height/(this.max+this.height)),e=this.y+(this.height-t)*(this.scrollPosition/this.max);this.scrollbarTimeout&&this.scrollbarOpacity<1&&(this.scrollbarOpacity=this.scrollbarOpacity+.05),!this.scrollbarTimeout&&this.scrollbarOpacity>0&&(this.scrollbarOpacity=this.scrollbarOpacity-.05),m.fillStyle=this.scrollbarColor.replace("opacity",this.scrollbarOpacity),a({x:this.x+this.width-this.scrollbarOffset,y:e,width:this.scrollbarThick,height:t,radius:0}),m.fill(),h()}i(this.scrollPosition),m.restore()}}const y=canvas.getContext("2d");wx.getSystemInfoSync().windowWidth,wx.getSystemInfoSync().windowHeight;class g{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.card=t.card,this.touchAble=t.touchAble,this.touchMode=t.touchMode,this.touchEvent=t.touchEvent,this.touchDelayTime=t.touchDelayTime,this.touchArea=t.touchArea,this.touchTimeout=null,this.scrollTop=t.scrollTop,this.scrollLeft=t.scrollLeft,this.displayMode=t.displayMode,this.imageMode=t.imageMode,this.imageIns=t.imageIns}render(){const i=this.x-(this.scrollLeft?this.scrollLeft:0),o=this.y-(this.scrollTop?this.scrollTop:0),r=this.width,c=this.height,l=this.card;y.save(),"normal"===this.displayMode&&a({x:i,y:o,width:r,height:c,radius:.08*r}),"line"===this.displayMode&&a({x:i,y:o,width:r,height:c,radius:.06*r}),y.clip(),y.fillStyle="rgba(255, 255, 255, 0.5)",y.fillRect(i,o,r,c),y.fillStyle="rgba(0, 0, 0, 1)",y.textAlign="center",y.textBaseline="middle";const d=.075*r;if(y.font=`bold ${d}px monospace`,"normal"===this.displayMode&&(y.fillText(l.name,i+r/2,o+.12*r),l.number&&y.fillText("X"+l.number,i+r-.12*r,o+.12*r),y.textAlign="start",y.fillText("Lv"+l.level,i+.08*r,o+.12*r+.24*r),y.fillText(l.type,i+.08*r,o+.12*r+.36*r),y.fillText(l.attribute,i+.08*r,o+.12*r+.48*r),y.fillText(`消耗：${l.cost}`,i+.08*r,o+.12*r+.6*r),(t=>{const e=t.x,i=t.y,s=t.width,o=t.fontHeight;let h=t.text.split(""),r="",a=[];h.forEach((t=>{n.measureText(r).width>s&&(a.push(r),r=""),r+=t})),a.push(r),a.forEach(((t,s)=>{n.fillText(t,e,i+(s+1)*o)}))})({x:i+.08*r,y:o+.84*r,text:l.description(1),width:r-.25*r,fontHeight:.12*r})),"line"===this.displayMode&&(y.fillText(l.name,i+.12*r,o+c/2),y.fillText("Lv"+l.level,i+r-.12*r,o+c/2)),h(),y.restore(),"immediate"===this.touchMode&&this.touchAble&&t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||this.touchEvent()}),{x:i,y:o,width:r,height:c}),"delay"===this.touchMode&&this.touchAble){t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=setTimeout((()=>this.touchEvent()),this.touchDelayTime))}),{x:i,y:o,width:r,height:c});const n=()=>{clearTimeout(this.touchTimeout)};e("touchmove",n),e("touchend",n)}"click"===this.touchMode&&this.touchAble&&(t("touchstart",(t=>{this.touchArea&&!s(t,this.touchArea)||(this.touchTimeout=!0)}),{x:i,y:o,width:r,height:c}),e("touchmove",(()=>{this.touchTimeout=!1})),e("touchend",(()=>{!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1})))}}const f="build/162926_76690565815.jpeg",x=[{key:1,name:"燃烧",type:"进攻卡",attribute:"火",cost:0,image:f,description:t=>`造成 ${15*t+100} 伤害，并附加给目标一层灼烧印记。`,function:(t,e,i)=>{}},{key:2,name:"冰冻",type:"魔法卡",attribute:"水",cost:0,image:f,description:t=>`造成 ${15*t+30} 伤害，恢复 30MP。`,function:(t,e,i)=>{}},{key:3,name:"缠绕",type:"治疗卡",attribute:"木",cost:0,image:f,description:t=>"恢复 50HP、20MP",function:(t,e,i)=>{}}],v=t=>({...x.find((e=>t.key===e.key)),...t}),I=canvas.getContext("2d"),b=o("build/205624_78456047248.jpeg"),T=wx.getSystemInfoSync().safeArea.top,S=wx.getSystemInfoSync().windowWidth,A=wx.getSystemInfoSync().windowHeight,M=class{constructor(){this.preview=null,this.previewType=null,this.scroll_I,this.cards_I,this.cardss_I,this.preview_I,this.instance()}get cards(){return Imitation.state.info.cards}get cardss(){return Imitation.state.info.cardss[Imitation.state.info.cardssIndex]}get cardsH(){const t=Math.ceil(this.cards.length/4);return(S-24-60)/4*1.25*t+(t?12*(t-1):0)}get cardssH(){const t=Math.ceil(this.cardss.length/3);return(S-24-48)/3*.175*t+(t?6*(t-1):0)}get cardssHH(){return 0===this.cardss.length?-12:this.cardssH+24}get scrollOption(){return{x:this.scroll_I.x,y:this.scroll_I.y,width:this.scroll_I.width,height:this.scroll_I.height}}setScrollOptionH(){this.scroll_I.max=this.cardsH-this.scroll_I.height+24}instance(){this.instanceScroll(),this.instanceCards(),this.instanceCardss(),this.instancePreview()}instanceScroll(){const t={x:12,y:76+this.cardssHH+T,width:S-24,height:A-88-this.cardssHH-T,radius:12,scrollbarOffset:4,scrollbarThick:2,min:0};this.scroll_I=new w(t),this.setScrollOptionH()}instanceCards(){const t=t=>{this.previewType="cards",this.preview=t};this.cards_I=this.cards.map(((e,i)=>{(e=v(e)).image=b;const s={width:(S-24-60)/4,card:e,touchMode:"click",touchArea:this.scrollOption,touchEvent:()=>t(e),displayMode:"normal",imageMode:"full",imageIns:b};return s.height=1.25*s.width,s.x=24+i%4*(s.width+12),s.y=88+parseInt(i/4)*(s.height+12)+this.cardssHH+T,new g(s)}))}instanceCardss(){const t=t=>{this.previewType="cardss",this.preview=t};this.cardss_I=this.cardss.map(((e,i)=>{e=v(e);const s={width:(S-24-48)/3,card:e,touchMode:"click",touchEvent:()=>t(e),displayMode:"line",imageMode:"full",imageIns:b};return s.height=.175*s.width,s.x=24+i%3*(s.width+12),s.y=76+parseInt(i/3)*(s.height+6)+T,new g(s)}))}instancePreview(){const t={width:.7*S,card:this.preview,displayMode:"normal",imageMode:"full",imageIns:b};t.height=1.5*t.width,t.x=.15*S,t.y=(A-1.5*t.width)/2-80,this.preview_I=new g(t)}drawButtonHome(){const e={x:12,y:12+T,width:40,height:40,radius:20,font:14,lineWidth:1,text:"H"};c(e),this.preview||t("touchstart",(()=>{Imitation.state.page.current="home",Imitation.dispatch()}),e)}drawPreview(){if(this.preview){if(I.fillStyle="rgba(0, 0, 0, 0.75)",I.rect(0,0,S,A),I.fill(),h(),this.preview_I.card=this.preview,this.preview_I.render(),"cards"===this.previewType){const i={x:S/2-60,y:.75*A,width:120,height:40,radius:8,font:14,lineWidth:1,text:"合成"};c(i);const o={x:S/2-60,y:.75*A+60,width:120,height:40,radius:8,font:14,lineWidth:1,text:"装载"};c(o),t("touchstart",(()=>{this.compose(this.preview),this.preview=null}),i),t("touchstart",(()=>{this.load(this.preview),this.preview=null}),o),e("touchstart",(t=>{s(t,i)||s(t,o)||(this.preview=null)}))}if("cardss"===this.previewType){const i={x:S/2-60,y:.75*A,width:120,height:40,radius:8,font:14,lineWidth:1,text:"卸载"};c(i),t("touchstart",(()=>{this.unload(this.preview),this.preview=null}),i),e("touchstart",(t=>{s(t,i)||(this.preview=null)}))}}}drawScroll(){this.scroll_I.render((t=>{this.drawCards(t)}))}drawCards(t){this.cards_I.forEach((e=>{e.scrollTop=t,e.touchAble=!this.preview,e.render()}))}drawCardss(t){if(0===this.cardss.length)return;const e={x:12,y:64+T,width:S-24,height:this.cardssH+24,radius:12};I.save(),a(e),I.fillStyle="rgba(255, 255, 255, 1)",I.fill(),h(),I.restore(),this.cardss_I.forEach((e=>{e.scrollTop=t,e.touchAble=!this.preview,e.render()}))}drawCardssSelect(){new Array(4).fill().forEach(((e,i)=>{const s={y:12+T,width:40,height:40,radius:20,font:14,lineWidth:1,text:i};if(s.x=72+i%4*(s.width+12),i===Imitation.state.info.cardssIndex&&(t=>{const e=t.x,i=t.y,s=t.width,o=t.height,r=t.text,c=t.font,l=t.lineWidth;n.save(),a(t),n.lineWidth=l,n.strokeStyle="rgba(0, 0, 0, 1)",n.stroke(),n.textAlign="center",n.textBaseline="middle",n.font=`bold ${c}px monospace`,n.fillStyle="rgba(0, 0, 0, 1)",n.fillText(r,e+s/2,i+o/2),h(),n.restore()})(s),i!==Imitation.state.info.cardssIndex){if(c(s),this.preview)return;t("touchstart",(()=>{Imitation.state.info.cardssIndex=i,this.instance()}),s)}}))}drawBackground(){r(b,{x:0,y:0,width:S,height:A})}compose(t){}load(t){const e=Imitation.state.info.cards,i=Imitation.state.info.cardss[Imitation.state.info.cardssIndex],s=e.filter((e=>e.key===t.key&&e.level===t.level)),o=i.filter((e=>e.key===t.key&&e.level===t.level));s.length!==o.length&&(i.push({key:t.key,level:t.level}),this.instance())}unload(t){const e=Imitation.state.info.cardss[Imitation.state.info.cardssIndex],i=e.find((e=>e.key===t.key&&e.level===t.level));Imitation.state.info.cardss[Imitation.state.info.cardssIndex]=e.filter((t=>t!==i)),this.instance()}render(){this.drawBackground(),this.drawButtonHome(),this.drawCardssSelect(),this.drawCardss(),this.drawScroll(),this.drawPreview()}},k=canvas.getContext("2d");new class{constructor(){h(canvas),this.animationFrameId,this.pageInstance,this.ImitationInit(),this.loopStart()}render(){k.clearRect(0,0,canvas.width,canvas.height),Imitation.state.removeEventListener.forEach((t=>t())),Imitation.state.removeEventListener=[],this.pageInstance&&this.pageInstance instanceof Imitation.state.page.map[Imitation.state.page.current]||(this.pageInstance=new Imitation.state.page.map[Imitation.state.page.current]),this.pageInstance.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){Imitation.state={page:{current:"store",map:{home:p,store:M}},removeEventListener:[],info:{cards:[],cardss:[[],[],[],[]],cardssIndex:0}},Imitation.state.info.cards=((t=12)=>new Array(t).fill(x).reduce(((t,e)=>[...t,...e]),[]))(12).map((t=>({key:t.key,level:1,number:4}))),Imitation.state.info.cardss[0]=[...Imitation.state.info.cards].filter(((t,e)=>e<23)),Imitation.register((()=>{}),(t=>t.page.current))}}})()})();