(()=>{var t={70:()=>{!function(){try{wx}catch{return}!function(t){const e={};function i(n){if(e[n])return e[n].exports;const s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){n.addEventListener=n.canvas.addEventListener=function(t,e){n.document.addEventListener(t,e)},n.removeEventListener=n.canvas.removeEventListener=function(t,e){n.document.removeEventListener(t,e)};const t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(const t in n){const e=Object.getOwnPropertyDescriptor(s,t);e&&!0!==e.configurable||Object.defineProperty(window,t,{value:n[t]})}for(const t in n.document){const e=Object.getOwnPropertyDescriptor(s.document,t);e&&!0!==e.configurable||Object.defineProperty(s.document,t,{value:n.document[t]})}window.parent=window}else{for(const t in n)s[t]=n[t];s.window=n,window=s,window.top=window.parent=window}}())},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;const n=i(2);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));const s=i(3);Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})}));const h=w(i(9)),o=w(i(10)),a=w(i(17)),r=w(i(18)),c=w(i(19)),l=w(i(11)),u=w(i(12)),d=w(i(20)),f=w(i(4)),p=w(i(21)),m=w(i(22));function w(t){return t&&t.__esModule?t:{default:t}}e.document=o.default,e.navigator=a.default,e.XMLHttpRequest=r.default,e.WebSocket=c.default,e.Image=l.default,e.Audio=u.default,e.FileReader=d.default,e.HTMLElement=f.default,e.localStorage=p.default,e.location=m.default;const y=new h.default;e.canvas=y,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=wx.getSystemInfoSync(),n=i.screenWidth,s=i.screenHeight,h=i.devicePixelRatio,o=e.innerWidth=n,a=e.innerHeight=s;e.devicePixelRatio=h,e.screen={availWidth:o,availHeight:a},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;const n=(s=i(4))&&s.__esModule?s:{default:s};var s;function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return h(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return a(e,t),e}(n.default),e.HTMLCanvasElement=function(t){function e(){return h(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return a(e,t),e}(n.default)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(h=i(5))&&h.__esModule?h:{default:h};var h;const o=i(8),a=i(2);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}const l=function(t){function e(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,e);const i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.className="",i.childern=[],i.style={width:`${a.innerWidth}px`,height:`${a.innerHeight}px`},i.insertBefore=o.noop,i.innerHTML="",i.tagName=t.toUpperCase(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:a.innerWidth,height:a.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){const t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){const t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}(s.default);e.default=l},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(6))&&n.__esModule?n:{default:n}).default);e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s;const h=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){const t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){const e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),e}(((s=i(7))&&s.__esModule?s:{default:s}).default);e.default=h},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let s=n.get(this);s||(s={},n.set(this,s)),s[t]||(s[t]=[]),s[t].push(e),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){const i=n.get(this)[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}}},{key:"dispatchEvent",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.get(this)[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}}]),t}();e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=wx.createCanvas();return t.type="canvas",t.__proto__.__proto__=new n.default("canvas"),t.getContext,t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t},i(3);const n=s(i(4));function s(t){return t&&t.__esModule?t:{default:t}}s(i(10))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=r(i(4)),h=r(i(11)),o=r(i(12)),a=r(i(9));function r(t){return t&&t.__esModule?t:{default:t}}i(15);const c={};var l={readyState:"complete",visibilityState:"visible",documentElement:n,hidden:!1,style:{},location:n.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new s.default("head"),body:new s.default("body"),createElement:function(t){return"canvas"===t?new a.default:"audio"===t?new o.default:"img"===t?new h.default:new s.default(t)},getElementById:function(t){return t===n.canvas.id?n.canvas:null},getElementsByTagName:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[n.canvas]:[]},querySelector:function(t){return"head"===t?l.head:"body"===t?l.body:"canvas"===t||t===`#${n.canvas.id}`?n.canvas:null},querySelectorAll:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[n.canvas]:[]},addEventListener:function(t,e){c[t]||(c[t]=[]),c[t].push(e)},removeEventListener:function(t,e){const i=c[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}},dispatchEvent:function(t){const e=c[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}};e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(h=i(13))&&h.__esModule?h:{default:h};var h;const o=new WeakMap,a=new WeakMap,r=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4,i.readyState=0,a.set(i,"");const n=wx.createInnerAudioContext();return o.set(i,n),n.onCanplay((function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=2})),n.onPlay((function(){i.dispatchEvent({type:"play"})})),n.onPause((function(){i.dispatchEvent({type:"pause"})})),n.onEnded((function(){i.dispatchEvent({type:"ended"}),i.readyState=4})),n.onError((function(){i.dispatchEvent({type:"error"})})),t&&(o.get(i).src=t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){o.get(this).play()}},{key:"pause",value:function(){o.get(this).pause()}},{key:"canPlayType",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){const t=new e;return t.loop=o.get(this).loop,t.autoplay=o.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return o.get(this).currentTime},set:function(t){o.get(this).seek(t)}},{key:"src",get:function(){return a.get(this)},set:function(t){a.set(this,t),o.get(this).src=t}},{key:"loop",get:function(){return o.get(this).loop},set:function(t){o.get(this).loop=t}},{key:"autoplay",get:function(){return o.get(this).autoplay},set:function(t){o.get(this).autoplay=t}},{key:"paused",get:function(){return o.get(this).paused}}]),e}(s.default));e.default=r},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const s=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(14))&&n.__esModule?n:{default:n}).default);e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s;const h=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}(((s=i(4))&&s.__esModule?s:{default:s}).default);e.default=h},function(t,e,i){i(16)},function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=(h=i(10))&&h.__esModule?h:{default:h};var h;const o=i(8),a=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=n.canvas,this.currentTarget=n.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=o.noop,this.stopPropagation=o.noop,this.type=e};function r(t){return function(e){const i=new a(t);i.touches=e.touches,i.targetTouches=Array.prototype.slice.call(e.touches),i.changedTouches=e.changedTouches,i.timeStamp=e.timeStamp,s.default.dispatchEvent(i)}}wx.onTouchStart(r("touchstart")),wx.onTouchMove(r("touchmove")),wx.onTouchEnd(r("touchend")),wx.onTouchCancel(r("touchcancel"))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),s={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:n.noop,watchPosition:n.noop,clearWatch:n.noop}};e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,s=new WeakMap,h=new WeakMap,o=new WeakMap,a=new WeakMap;function r(t){if("function"==typeof this[`on${t}`]){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this[`on${t}`].apply(this,i)}}function c(t){this.readyState=t,r.call(this,"readystatechange")}const l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,h.set(this,{"content-type":"application/x-www-form-urlencoded"}),o.set(this,{})}return i(t,[{key:"abort",value:function(){const t=a.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){const t=o.get(this);return Object.keys(t).map((function(e){return`${e}: ${t[e]}`})).join("\n")}},{key:"getResponseHeader",value:function(t){return o.get(this)[t]}},{key:"open",value:function(e,i){s.set(this,e),n.set(this,i),c.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){const e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:i,url:n.get(this),method:s.get(this),header:h.get(this),responseType:this.responseType,success:function(i){let n=i.data;const s=i.statusCode,h=i.header;if("string"!=typeof n&&!(n instanceof ArrayBuffer))try{n=JSON.stringify(n)}catch(t){}if(e.status=s,o.set(e,h),r.call(e,"loadstart"),c.call(e,t.HEADERS_RECEIVED),c.call(e,t.LOADING),e.response=n,n instanceof ArrayBuffer){e.responseText="";const t=new Uint8Array(n),i=t.byteLength;for(let n=0;n<i;n++)e.responseText+=String.fromCharCode(t[n])}else e.responseText=n;c.call(e,t.DONE),r.call(e,"load"),r.call(e,"loadend")},fail:function(t){const i=t.errMsg;-1!==i.indexOf("abort")?r.call(e,"abort"):r.call(e,"error",i),r.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){const i=h.get(this);i[t]=e,h.set(this,i)}}]),t}();l.UNSEND=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}const s=new WeakMap,h=function(){function t(e){const i=this,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError(`Failed to construct 'WebSocket': The URL '${e}' is invalid`);this.url=e,this.readyState=t.CONNECTING;const o=wx.connectSocket({url:e,protocols:Array.isArray(h)?h:[h]});return s.set(this,o),o.onClose((function(e){i.readyState=t.CLOSED,"function"==typeof i.onclose&&i.onclose(e)})),o.onMessage((function(t){"function"==typeof i.onmessage&&i.onmessage(t)})),o.onOpen((function(){i.readyState=t.OPEN,"function"==typeof i.onopen&&i.onopen()})),o.onError((function(t){"function"==typeof i.onerror&&i.onerror(new Error(t.errMsg))})),this}return i(t,[{key:"close",value:function(e,i){this.readyState=t.CLOSING,s.get(this).close({code:e,reason:i})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError(`Failed to send message: The data ${t} is invalid`);s.get(this).send({data:t})}}]),t}();h.CONNECTING=0,h.OPEN=1,h.CLOSING=2,h.CLOSED=3,e.default=h},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=i},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={href:"game.js",reload:function(){}}}])}()}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var h=e[n]={exports:{}};return t[n](h,h.exports,i),h.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";i(70);const t=new class{constructor(){this.canvas_,this.create(),this.flex()}create(){const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.background="black";const e=document.createElement("canvas");this.canvas_=e,t.appendChild(e)}flex(){const t=this.safeArea;this.canvas_.setAttribute("oncontextmenu","return false"),this.canvas_.style.display="block",this.canvas_.style.touchAction="none",this.canvas_.style.position="absolute",this.canvas_.width=t.width,this.canvas_.height=t.height,this.canvas_.style.top=t.top+"px",this.canvas_.style.left=t.left+"px";const e=this.canvas_.width,i=this.canvas_.height;this.canvas_.width=2*e,this.canvas_.height=2*i,this.canvas_.style.width=e+"px",this.canvas_.style.height=i+"px",this.canvas_.getContext("2d").scale(2,2)}get canvas(){return this.canvas_}get ctx(){return this.canvas_.getContext("2d")}get width(){try{if(wx)return window.canvas.clientWidth}catch{}return this.canvas_.clientWidth}get height(){try{if(wx)return window.canvas.clientHeight}catch{}return this.canvas_.clientHeight}get maxWidth(){return void 0===window.ontouchstart?.5*this.safeArea.height:this.width}get safeArea(){try{if(wx)return wx.getSystemInfoSync().safeArea}catch{}const t=window.document.documentElement.clientWidth,e=window.document.documentElement.clientHeight,i=e;return{top:0,left:window.document.documentElement.clientWidth/2-t/2,right:window.document.documentElement.clientWidth/2+t/2,bottom:i,width:t,height:e}}},e=i.p+"static/0.png",n=i.p+"static/1.png",s=i.p+"static/2.png",h=i.p+"static/3.png",o=i.p+"static/4.png",a=i.p+"static/5.png",r=new class{constructor(){this.map={"red-hit":[e,e,n,n,s,s,h,h,o,o,a,a]},this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>Promise.all(t[1].map(((e,i)=>new Promise((e=>{const n=new Image;n.src=t[1][i],n.onload=e,t[1][i]=n}))))))))}play(t,e){this.map[t]||console.error(t),this.queqe.push({key:t,src:this.map[t],option:e,index:0})}stop(t){this.queqe=this.queqe.filter((e=>e.key!==t))}clear(){this.queqe=[]}find(t){return this.queqe.filter((e=>e.key===t))}render(){this.queqe.forEach(((e,i)=>{const n=e.src[e.index];n&&(t.ctx.drawImage(n,...e.option(n)),e.index=e.index+1),n||this.queqe.splice(i,1)}))}},c=new class{constructor(){this.event=[];const e=(t,e)=>{const i=this.event.filter((t=>t.type===e)).sort(((t,e)=>{const i=void 0===t.option||void 0===t.option.priority?0:t.option.priority;return(void 0===e.option||void 0===e.option.priority?0:e.option.priority)-i}));var n=!1;i.forEach((e=>{n||e.option&&e.option.ifTouchCover&&!X(t,e.option.ifTouchCover)||(e.option&&e.option.stop&&(n=!0),"function"==typeof e.callback&&e.callback(t))}))};new Array("touchstart","touchmove","touchend","mousedown","mousemove","mouseup").forEach((i=>{t.canvas.addEventListener(i,(t=>e(t,i)),{passive:!0})}))}addEventListener=(t,e,i)=>{try{void 0===window.ontouchstart&&"touchstart"===t&&(t="mousedown"),void 0===window.ontouchmove&&"touchmove"===t&&(t="mousemove"),void 0===window.ontouchend&&"touchend"===t&&(t="mouseup")}catch{}this.event.push({type:t,callback:e,option:i})};removeEventListener=(t,e)=>{this.event=this.event.filter((i=>i.type!==t&&i.callback!==e))};clearEventListener=()=>{this.event=[]}},l=Symbol("_Allow");function u(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function d(t){this.state=t,this.MonitorINS=new u(this)}u.prototype.dispatch=function(){this.monitorQueue.forEach(((t,e)=>{const i=this.dependentQueue[e],n=this.executeDependent(t.dependent);return n===l||Array.isArray(n)&&Array.isArray(i)&&(s=n,h=i,Array.isArray(s)&&Array.isArray(h)&&(s.length!==h.length||s.filter(((t,e)=>t===h[e])).length!==s.length))||!Array.isArray(n)&&!Array.isArray(i)&n!==i?(this.executeEvent(t.event),void(this.dependentQueue[e]=n)):void(this.dependentQueue[e]=n);var s,h}))},u.prototype.register=function(t,e=l){const i={event:t,dependent:e};return this.monitorQueue.push(i),this.dependentQueue.push(this.executeDependent(e)),()=>{this.monitorQueue.forEach(((t,e)=>{t===i&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},u.prototype.executeEvent=function(t){t(this.ImitationINS.state)},u.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},d.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},d.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},d.prototype.register=function(){return this.MonitorINS.register(...arguments)},d.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const f=new d,p=(e,i)=>{var n=i.x,s=i.y,h=i.width,o=i.height;const a=o/e.height,r=e.width*a;n+=(h-r)/2,t.ctx.drawImage(e,n,s,r,o)},m=e=>{const i=e.x,n=e.y,s=e.width,h=e.height,o=Array.isArray(e.radius)?e.radius:new Array(4).fill(e.radius);t.ctx.beginPath(),t.ctx.moveTo(i,n+o[0]),t.ctx.arcTo(i,n,i+o[0],n,o[0]),t.ctx.lineTo(i+s-o[1],n),t.ctx.arcTo(i+s,n,i+s,n+o[1],o[1]),t.ctx.lineTo(i+s,n+h-o[2]),t.ctx.arcTo(i+s,n+h,i+s-o[2],n+h,o[2]),t.ctx.lineTo(i+o[3],n+h),t.ctx.arcTo(i,n+h,i,n+h-o[3],o[3]),t.ctx.closePath()},w=e=>{const i=e.x,n=e.y,s=e.width,h=e.height;t.ctx.beginPath(),t.ctx.moveTo(i,n),t.ctx.lineTo(i+s,n),t.ctx.lineTo(i+s,n+h),t.ctx.lineTo(i,n+h),t.ctx.closePath()},y=e=>{const i=e.x,n=e.y,s=e.width,h=e.wrapSpace,o=e.text,a=e.onlyread;var r="",c=[];if(o.split("").forEach((e=>{t.ctx.measureText(r+e).width>s&&(c.push(r),r=""),r+=e})),c.push(r),a)return c.length;c.forEach(((e,s)=>{t.ctx.fillText(e,i,n+s*h)}))},g=new class{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeoutRef=null,this.show=!1,this.opacity=0,this.width=Math.min(t.width-24,200),this.x=(t.width-this.width)/2,this.height=25,this.y=-this.height}play(t,e="rgba(255, 255, 255, 1)",i="rgba(0, 0, 0, 1)"){clearTimeout(this.timeoutRef),this.message=t,this.backgroundColor=e,this.textColor=i,this.show=!0,this.timeoutRef=q(60,(()=>{this.show=!1,this.timeoutRef=null}))}render(){this.show&&this.opacity<1&&(this.opacity=F(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=F(this.opacity-.05)),this.show&&this.y<12&&(this.y=F(this.y+2)),!this.show&&this.y>-this.height&&(this.y=F(this.y-2)),(this.show||0!==this.opacity)&&(t.ctx.save(),t.ctx.globalAlpha=this.opacity,t.ctx.fillStyle=this.backgroundColor,m({x:this.x,y:this.y,width:this.width,height:this.height,radius:4}),t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 10px Courier",t.ctx.fillStyle=this.textColor,t.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2),t.ctx.restore())}},x=i.p+"static/aiyafala.37be7922.png",v=(i.p,i.p+"static/cuoe.c908ed3c.png"),b=(i.p,i.p,i.p,i.p,i.p,i.p+"static/linguang.acf5bd67.png"),T=(i.p,i.p,i.p+"static/niyan.0a121257.png"),_=i.p+"static/saileiya.1d6838fc.png",M=(i.p,i.p+"static/shan.ec3e6c6d.png"),k=(i.p,i.p+"static/tuijin.5a8f324f.png"),P=i.p+"static/w.86ab2d3c.png",E=i.p+"static/xi.f1b31093.png",I=i.p+"static/yanwei.29b3239c.png",N=i.p+"static/yifulite.8bc864d4.png",O=new class{constructor(){this.map={home:T,"monster-1":_,"witch-1":x,"witch-skill-1":[M,_],"witch-2":k,"witch-skill-2":[M,_],"witch-3":v,"witch-skill-3":[M,_],"witch-4":b,"witch-skill-4":[M,_],"witch-5":N,"witch-skill-5":[M,_],"witch-6":I,"witch-skill-6":[M,_],"witch-7":E,"witch-skill-7":[M,_],"witch-8":P,"witch-skill-8":[M,_]}}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((e=>{if("string"==typeof this.map[t[0]]){const i=new Image;return i.onload=e,i.src=this.map[t[0]],void(this.map[t[0]]=i)}"object"!=typeof this.map[t[0]]||Promise.all(this.map[t[0]].map(((e,i)=>new Promise((n=>{const s=new Image;s.onload=n,s.src=e,this.map[t[0]][i]=s}))))).then(e)})))))}get(t){return this.map[t]||console.error(t),this.map[t]}},S=i.p+"static/1011_ch4_act1.mp3",D=(i.p,i.p+"static/Vo1002_Lup01.mp3"),A=i.p+"static/bgm.m4a",W=i.p+"static/pve.m4a",j=new class{constructor(){this.map={"background-main":A,"background-pve":W,"master-main-1":D,"master-main-2":D,"master-main-3":D,"master-main-4":D,"master-main-5":D,"master-action-1":S,"master-action-2":S,"master-action-3":S,"master-action-4":S,"master-action-5":S,"card-main-1":D,"card-main-2":D,"card-main-3":D,"card-main-4":D,"card-main-5":D,"card-main-6":D,"card-main-7":D,"card-main-8":D,"card-main-9":D,"card-main-10":D,"card-main-11":D,"card-main-12":D,"card-action-1":S,"card-action-2":S,"card-action-3":S,"card-action-4":S,"card-action-5":S,"card-action-6":S,"card-action-7":S,"card-action-8":S,"card-action-9":S,"card-action-10":S,"card-action-11":S,"card-action-12":S},this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((e=>{const i=new Audio;i.onloadeddata=e,i.src=this.map[t[0]],this.map[t[0]]=i,i.load()})))))}get(t){return this.map[t]||console.error(t),this.map[t]}};var R=[{key:1,name:"被污染的野猪",description:"在丛林中被污染的野猪，具备一定的攻击性。",dirty:1200,skill:[{name:"冲撞",type:"伤害",description:"蓄势待发，准备向你冲来！做好防御的准备！！！",function:(t,e,i)=>[{effect:"Damage",target:e,value:Math.floor(100+50*Math.random())}]},{name:"休息",type:"回复",description:"躺在了地上！",function:(t,e,i)=>[{effect:"Damage",target:e,value:Math.floor(20+50*Math.random())}]}]}],C=[{key:1,name:"自由滑轮",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"圆舞",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"零落",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:2,name:"甜食守卫",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"舜生",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"刹那",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:3,name:"疯人院",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"绯红之刃",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"齿红连击",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:4,name:"致命音符",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"闪光独奏",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"爆裂节拍",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:5,name:"晚安故事",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"放音",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"夜半",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:6,name:"场外焦点",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"偶像身姿",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"闪烁打击",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:7,name:"纯真",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"飞叶",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"香气",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]},{key:8,name:"不良",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"惩戒",type:"伤害",description:"以理性值20%的数值攻击目标",function:(t,e,i)=>[{effect:"Damage",target:e,value:.2*t.rational}]},{name:"利刃回旋",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%的数值攻击目标",function:(t,e,i)=>[{effect:"Improve-Rational",target:t,value:.1*t.rational},{effect:"Damage",target:e,value:.15*t.rational}]}]}];const L=()=>{R.forEach((t=>t.imageDOM=O.get("monster-"+t.key))),C.forEach((t=>{t.imageDOM=O.get("witch-"+t.key),t.skill.forEach(((e,i)=>{e.imageDOM=O.get("witch-skill-"+t.key)[i]}))}))},H=t=>t.reduce(((t,e)=>{const i=[...t],n=C.find((t=>e.key===t.key));return i.push({...n,...e,purity_:n.purity,rational_:n.rational,perceptual_:n.perceptual}),i}),[]),$=t=>{try{if(wx)return null}catch{}return new URL(location.href).searchParams.get(t)},q=async(t,e)=>{var i=0;const n=e=>{i===t&&e(),i!==t&&(i+=1,requestAnimationFrame((()=>n(e))))};e&&n(e),e||await new Promise((t=>n(t)))},F=t=>Number(Number(t).toFixed(5)),B=(t,e,i)=>{const n=new Array(e).fill(Number((t/e).toFixed(5))),s=()=>{requestAnimationFrame((()=>{i(n.shift()),n[0]&&s()}))};s()},U=(t,e)=>{var i=[],n=[...t];return new Array(e).fill().forEach((()=>{const t=Math.floor(Math.random()*n.length);n[t]&&(i.push(n[t]),n=n.filter(((e,i)=>i!==t)))})),i},X=(e,i)=>{const n=i.x,s=i.y,h=i.width,o=i.height;var a=e.x||e.touches[0].clientX,r=e.y||e.touches[0].clientY;try{const e=t.safeArea;a-=e.left,r-=e.top}catch{}return a>=n&&a<=n+h&&r>=s&&r<=s+o},V=e=>class{constructor(){this.time=0,this.component=new e}render(){this.time<1&&(this.time=F(this.time+.05)),this.component.render(),this.time<1&&(t.ctx.save(),t.ctx.globalAlpha=1-this.time,w({x:0,y:0,width:t.width,height:t.height}),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fill(),t.ctx.restore(),c.addEventListener("touchstart",void 0,{stop:!0,priority:1e3}),c.addEventListener("touchmove",void 0,{stop:!0,priority:1e3}),c.addEventListener("touchend",void 0,{stop:!0,priority:1e3}))}},G=V(class{constructor(){this.width=Math.min(.75*t.width,.75*t.maxWidth),this.height=Math.min(.75*t.width,.75*t.maxWidth),this.x=.5*(t.width-this.width),this.y=.5*(t.height-this.height),this.mouseDownPosition=null,this.rotateNumber=0,this.loadingNumber=0,this.randomColor=3*Math.random(),this.randomColor<1&&(this.randomColor="rgba(40, 90, 90, 1)"),this.randomColor<2&&(this.randomColor="rgba(90, 40, 90, 1)"),this.randomColor<3&&(this.randomColor="rgba(90, 90, 40, 1)")}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateNumber(){return this.width/4}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){Math.abs(this.rotateNumber)===this.maxRotateNumber&&(f.state.page.current="pve"),this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];const n=this.rotateNumber+e;this.rotateNumber=n,n>this.maxRotateNumber&&(this.rotateNumber=this.maxRotateNumber),n<-this.maxRotateNumber&&(this.rotateNumber=-this.maxRotateNumber)}async init(){await Promise.all([j.load(),O.load(),r.load()]),L(),this.loading=!1}render(){if(f.state.loading){this.loadingNumber=this.loadingNumber+1;const t=240,e=t/4,i=this.loadingNumber%t;i<=e&&(this.rotateNumber=i),i>e&&i<=3*e&&(this.rotateNumber=2*e-i),i>3*e&&i<=4*e&&(this.rotateNumber=i-4*e),this.rotateNumber=this.rotateNumber*(this.maxRotateNumber/e)}if(!f.state.loading){if(0!==this.rotateNumber&&!this.mouseDownPosition){const t=16;this.rotateNumber<0&&(this.rotateNumber=this.rotateNumber/t<-this.minDiff?this.rotateNumber-this.rotateNumber/t:0),this.rotateNumber>0&&(this.rotateNumber=this.rotateNumber/t>this.minDiff?this.rotateNumber-this.rotateNumber/t:0)}c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}w({x:0,y:0,width:t.width,height:t.height}),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fill();const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),m({...this.option,radius:8}),t.ctx.fillStyle=this.randomColor,t.ctx.fill(),t.ctx.globalAlpha=1,t.ctx.translate(e+.5*n,i+.5*s),t.ctx.rotate(this.rotateNumber/200),t.ctx.translate(-(e+.5*n),-(i+.5*s)),m({...this.option,radius:8}),t.ctx.clip(),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.globalAlpha=Math.min((this.maxRotateNumber-Math.abs(this.rotateNumber))/this.maxRotateNumber,1),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.05*n}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText("魔女的冒险 污秽篇",this.x+.5*this.width,this.y+.4*this.height),f.state.loading&&t.ctx.fillText("加载资源中",this.x+.5*this.width,this.y+.6*this.height),f.state.loading||t.ctx.fillText("滑动 开始游戏",this.x+.5*this.width,this.y+.6*this.height),m({x:e+.1*n,y:i+.5*s-1,width:.8*n,height:2,radius:2}),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fill(),t.ctx.globalAlpha=Math.min(Math.abs(this.rotateNumber)/this.maxRotateNumber,1),p(O.get("home"),this.option),t.ctx.restore()}});class Y{constructor(){this.content=[],this.mouseDownPosition=null,this.visible=!1,this.visibleTime=0}get minDiff(){return.01}get maxVisibleTime(){return 42}render(){if(!this.visible){const t=16;this.visibleTime=this.visibleTime/t>this.minDiff?this.visibleTime-this.visibleTime/t:0}if(this.visible){const t=16;this.visibleTime=(this.maxVisibleTime-this.visibleTime)/t>this.minDiff?this.visibleTime+(this.maxVisibleTime-this.visibleTime)/t:this.maxVisibleTime}t.ctx.save(),t.ctx.globalAlpha=this.visibleTime/this.maxVisibleTime,w({x:0,y:0,width:t.width,height:t.height}),t.ctx.fillStyle="rgba(0, 0, 0, 0.5)",t.ctx.fill(),m({x:(t.width-t.maxWidth)/2,y:t.height-this.visibleTime-24,width:t.maxWidth,height:this.visibleTime+24,radius:[8,8,0,0]}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),this.content.forEach(((e,i)=>{var n=72,s=30,h=(t.width-n)/2,o=t.height-this.visibleTime;h+=(i-(this.content.length/2-.5))*(n+4),e.active&&(m({x:h,y:o,width:n,height:s,radius:4}),t.ctx.fillStyle="rgba(40, 90, 90, 1)",t.ctx.fill()),e.active||(h+=t.ctx.lineWidth/2,o+=t.ctx.lineWidth/2,n-=t.ctx.lineWidth,s-=t.ctx.lineWidth,m({x:h,y:o,width:n,height:s,radius:4}),t.ctx.strokeStyle="rgba(40, 90, 90, 1)",t.ctx.stroke()),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 10px Courier",t.ctx.fillStyle=e.active?"rgba(255, 255, 255, 1)":"rgba(40, 90, 90, 1)",t.ctx.fillText(e.name,h+n/2,o+s/2),c.addEventListener("touchstart",e.event,{ifTouchCover:{x:h,y:o,width:n,height:s},stop:!0,priority:900})})),t.ctx.globalAlpha=1;const e={y:t.height-this.visibleTime-12,width:180,height:2,radius:1};e.x=(t.width-e.width)/2,m(e),t.ctx.fillStyle=`rgba(${255-this.visibleTime/this.maxVisibleTime*255}, ${255-this.visibleTime/this.maxVisibleTime*255}, ${255-this.visibleTime/this.maxVisibleTime*255}, 1)`,t.ctx.fill(),t.ctx.restore(),c.addEventListener("touchstart",(()=>this.visible=!1),{priority:898}),c.addEventListener("touchstart",(()=>this.visible=!this.visible),{ifTouchCover:{...e,y:e.y-4,height:e.height+8},stop:!0,priority:899})}}class Q{constructor(){this.x,this.y,this.width,this.height,this.witch,this.previous,this.next,this.use,this.mouseDownPosition=null,this.rotateTime=0,this.fadeTime=0,this.touchEnd=new Function}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateNumber(){return this.width/4}get skillDescriptionHeight(){var e;if(this.rotateTime>0&&(e=this.witch.skill[0]),this.rotateTime<0&&(e=this.witch.skill[1]),!e)return 0;t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`;const i=y({width:.9*this.width,text:e.description,onlyread:!0});return(.06*this.width+.06*this.width*i)*Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1)}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.rotateTime===this.maxRotateNumber&&this.touchEnd(this.witch.skill[0],this.next[0]),this.rotateTime===-this.maxRotateNumber&&this.touchEnd(this.witch.skill[1],this.next[1]),this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];const n=this.rotateTime+e;this.rotateTime=n,n>this.maxRotateNumber&&(this.rotateTime=this.maxRotateNumber),n<-this.maxRotateNumber&&(this.rotateTime=-this.maxRotateNumber)}render(){if(!this.mouseDownPosition&&0!==this.rotateTime){const t=16;this.rotateTime<0&&(this.rotateTime=this.rotateTime/t<-this.minDiff?this.rotateTime-this.rotateTime/t:0),this.rotateTime>0&&(this.rotateTime=this.rotateTime/t>this.minDiff?this.rotateTime-this.rotateTime/t:0)}var e;if(this.fadeTime<1&&(this.fadeTime=F(this.fadeTime+.02)),t.ctx.save(),m({...this.option,radius:8}),t.ctx.fillStyle="rgba(40, 90, 90, 1)",t.ctx.fill(),this.rotateTime>0&&(e=this.witch.skill[0]),this.rotateTime<0&&(e=this.witch.skill[1]),e){t.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1),t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)";const i=[e.name,e.type];this.rotateTime>0&&(t.ctx.textAlign="start",i.forEach(((e,i)=>{m({x:this.x+.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(e,this.x+.07*this.width,this.y+.045*this.width+i*this.width*.08)})),m({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText("使用",this.x+.07*this.width,this.y+this.height-.085*this.width),t.ctx.textAlign="center",y({x:this.x+this.width/2,y:this.y+this.height+.04*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1),width:.9*this.width,wrapSpace:.06*this.width,text:`切换 / ${this.next[1].name}`})),this.rotateTime<0&&(t.ctx.textAlign="end",i.forEach(((e,i)=>{m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(e,this.x+this.width-.07*this.width,this.y+.045*this.width+i*this.width*.08)})),m({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText("使用",this.x+this.width-.07*this.width,this.y+this.height-.085*this.width),t.ctx.textAlign="center",y({x:this.x+this.width/2,y:this.y+this.height+.04*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1),width:.9*this.width,wrapSpace:.06*this.width,text:`切换 / ${this.next[0].name}`})),t.ctx.textAlign="center";const n=y({width:.9*this.width,text:e.description,onlyread:!0});y({x:this.x+this.width/2,y:this.y-(.06*this.width+.06*this.width*n)*Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1),width:.9*this.width,wrapSpace:.06*this.width,text:e.description})}t.ctx.translate(this.x+.5*this.width,this.y+2*this.height),t.ctx.rotate(this.rotateTime/400),t.ctx.translate(-(this.x+.5*this.width),-(this.y+2*this.height)),m({...this.option,radius:8}),t.ctx.clip(),t.ctx.globalAlpha=1,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.globalAlpha=Math.min((this.maxRotateNumber-Math.abs(this.rotateTime))/this.maxRotateNumber,1),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",m({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`清醒 ${Math.ceil(this.witch.purity)}`,this.x+.07*this.width,this.y+.045*this.width),m({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`理性 ${Math.ceil(this.witch.rational)}`,this.x+.07*this.width,this.y+.125*this.width),m({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`感性 ${Math.ceil(this.witch.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),t.ctx.textAlign="end",m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.witch.name,this.x+this.width-.07*this.width,this.y+.045*this.width),m({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.witch.type,this.x+this.width-.07*this.width,this.y+.125*this.width),p(this.witch.imageDOM,{...this.option,y:this.y+.25*this.height,height:this.height-.25*this.height}),this.fadeTime<1&&this.previous&&(t.ctx.globalAlpha=1-this.fadeTime,t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",m({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`清醒 ${Math.ceil(this.previous.purity)}`,this.x+.07*this.width,this.y+.045*this.width),m({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`理性 ${Math.ceil(this.previous.rational)}`,this.x+.07*this.width,this.y+.125*this.width),m({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`感性 ${Math.ceil(this.previous.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),t.ctx.textAlign="end",m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.previous.name,this.x+this.width-.07*this.width,this.y+.045*this.width),m({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.previous.type,this.x+this.width-.07*this.width,this.y+.125*this.width),p(this.previous.imageDOM,{...this.option,y:this.y+.25*this.height,height:this.height-.25*this.height})),e&&(t.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateNumber,1),p(e.imageDOM,this.option)),t.ctx.restore(),this.use||(c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this)))}}class z{constructor(){this.x,this.y,this.width,this.height,this.monster,this.skill,this.skillTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get skillDescriptionHeight(){if(!this.skill)return 0;t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`;const e=y({width:.9*this.width,text:this.skill.description,onlyread:!0});return(.04*this.width+.06*this.width*e)*this.skillTime}render(){this.skillTime<1&&(this.skillTime=F(this.skillTime+.05)),t.ctx.save(),m({...this.option,radius:8}),t.ctx.fillStyle="rgba(90, 0, 40, 1)",t.ctx.fill(),p(this.monster.imageDOM,{...this.option,y:this.y+.1*this.width,height:this.height-.1*this.width}),t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.textAlign="start",m({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`污秽 ${Math.ceil(this.monster.dirty)}`,this.x+.07*this.width,this.y+.045*this.width),t.ctx.textAlign="end",m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.monster.name,this.x+this.width-.07*this.width,this.y+.045*this.width),t.ctx.globalAlpha=this.skillTime,t.ctx.textAlign="center",y({x:this.x+this.width/2,y:this.y+this.height+.04*this.width*this.skillTime,width:.9*this.width,wrapSpace:.06*this.width,text:this.skill.description}),t.ctx.restore()}}const K=V(class{constructor(){this.team=H(f.state.info.team),this.monster=R.reduce(((t,e)=>{const i=[...t],n=R.find((t=>e.key===t.key));return i.push({...n,...e,dirty_:n.dirty}),i}),[]),this.InstanceNavigation=new Y,this.InstanceNavigation.content=[{name:"战斗",active:!0},{name:"仓库",event:()=>f.state.page.current="store"}],this.InstanceWitch=new Q,this.InstanceWitch.width=Math.min(.75*t.width,.75*t.maxWidth),this.InstanceWitch.height=Math.min(.75*t.width,.75*t.maxWidth),this.InstanceWitch.x=.5*(t.width-this.InstanceWitch.width),this.InstanceWitch.y=t.height/2,this.InstanceMonster=new z,this.InstanceMonster.width=Math.min(.75*t.width,.75*t.maxWidth),this.InstanceMonster.height=Math.min(.5*t.width,.5*t.maxWidth),this.InstanceMonster.x=.5*(t.width-this.InstanceWitch.width),this.InstanceMonster.y=t.height/2-this.InstanceMonster.height,this.InstanceMonster.monster=U(R,1)[0],this.round()}async round(t){t&&(this.InstanceWitch.previous=this.InstanceWitch.witch,this.InstanceWitch.witch=t,this.InstanceWitch.next=U(this.team.filter((t=>t.key!==this.InstanceWitch.witch.key)),2),this.InstanceWitch.fadeTime=0),t||(this.InstanceWitch.witch=U(this.team,1)[0],this.InstanceWitch.next=U(this.team.filter((t=>t.key!==this.InstanceWitch.witch.key)),2)),this.InstanceMonster.skill=U(this.InstanceMonster.monster.skill,1)[0],this.InstanceMonster.skillTime=0,this.InstanceWitch.touchEnd=async(t,e)=>{this.InstanceWitch.use=!0,await this.compute(this.InstanceWitch.witch,this.InstanceMonster.monster,t,this.InstanceMonster.skill),await this.round(e),await q(60),this.InstanceWitch.use=!1}}async compute(t,e,i,n){const s=i.function(t,e,this.team);for(g.play(`使用 ${i.name}`),await q(60);s.length;){const i=s.shift();i.animation&&(i.target===t&&r.play(i.animation,(t=>[this.InstanceWitch.x+this.InstanceWitch.width/2-t.width/2,this.InstanceWitch.y+this.InstanceWitch.height/2-t.height/2])),i.target===e&&r.play(i.animation,(t=>[this.InstanceMonster.x+this.InstanceMonster.width/2-t.width/2,this.InstanceMonster.y+this.InstanceMonster.height/2-t.height/2]))),"Damage"===i.effect&&B(i.value,32,(t=>i.target.dirty=i.target.dirty-t),i.target.dirty),"Improve-Rational"===i.effect&&B(i.value,32,(t=>i.target.rational=i.target.rational+t),i.target.rational)}const h=n.function(e,t,this.team);for(;h.length;){const i=h.shift();i.animation&&(i.target===t&&r.play(i.animation,(t=>[this.InstanceWitch.x+this.InstanceWitch.width/2-t.width/2,this.InstanceWitch.y+this.InstanceWitch.height/2-t.height/2])),i.target===e&&r.play(i.animation,(t=>[this.InstanceMonster.x+this.InstanceMonster.width/2-t.width/2,this.InstanceMonster.y+this.InstanceMonster.height/2-t.height/2]))),"Damage"===i.effect&&B(i.value,32,(t=>i.target.purity=i.target.purity-t),i.target.purity)}await q(60)}render(){this.InstanceMonster.y=t.height/2-1.1*this.InstanceMonster.height-this.InstanceMonster.skillDescriptionHeight-this.InstanceWitch.skillDescriptionHeight,this.InstanceMonster.render(),this.InstanceWitch.render(),this.InstanceNavigation.render()}});class J{constructor(){this.x,this.y,this.width,this.height,this.contentWidth=null,this.contentHeight=null,this.scrollPosition=[0,0],this.mouseDownPosition=null}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.2}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var n=this.scrollPosition[0]-e,s=this.scrollPosition[1]-i;this.contentWidth||(n=this.scrollPosition[0]),this.contentHeight||(s=this.scrollPosition[1]),this.scrollPosition=[n,s]}render(e){if(!this.mouseDownPosition){const t=16;this.scrollPosition[0]<0&&(this.scrollPosition[0]=this.scrollPosition[0]/t<-this.minDiff/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.scrollPosition[1]<0&&(this.scrollPosition[1]=this.scrollPosition[1]/t<-this.minDiff/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.scrollPosition[0]>0&&((this.contentWidth-this.width<0||this.contentWidth-this.width==0)&&(this.scrollPosition[0]=this.scrollPosition[0]/t>this.minDiff/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.contentWidth-this.width>0&&this.scrollPosition[0]>this.contentWidth-this.width&&(this.scrollPosition[0]=(this.scrollPosition[0]-(this.contentWidth-this.width))/t>this.minDiff/t?this.scrollPosition[0]-(this.scrollPosition[0]-(this.contentWidth-this.width))/t:this.contentWidth-this.width)),this.scrollPosition[1]>0&&((this.contentHeight-this.height<0||this.contentHeight-this.height==0)&&(this.scrollPosition[1]=this.scrollPosition[1]/t>this.minDiff/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.contentHeight-this.height>0&&this.scrollPosition[1]>this.contentHeight-this.height&&(this.scrollPosition[1]=(this.scrollPosition[1]-(this.contentHeight-this.height))/t>this.minDiff/t?this.scrollPosition[1]-(this.scrollPosition[1]-(this.contentHeight-this.height))/t:this.contentHeight-this.height))}t.ctx.save();const i={x:this.x,y:this.y,width:this.width,height:this.height};w(i),t.ctx.clip(),e(this.scrollPosition),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:i}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class Z{constructor(){this.x,this.y,this.width,this.height,this.offsetY=0,this.witch,this.touchEvent=null,this.touchArea=null,this.touchTimeout=null}get option(){return{x:this.x,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!X(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}render(){const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),m({x:e,y:i,width:n,height:s,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),((e,i)=>{const n=i.x,s=i.y,h=i.width,o=i.height;var a=0,r=0,c=e.width,l=e.height;const u=Math.max(h/e.width,o/e.height),d=e.width*u-h,f=e.height*u-o;d&&(a=d/2/u,c-=d/u),f&&(r=f/2/u,l-=f/u),t.ctx.drawImage(e,a,r,c,l,n,s,h,o)})(this.witch.imageDOM,this.option),this.witch.inTeam&&(m({x:e+.05*s,y:i+.05*s,width:.075*s,height:.075*s,radius:.075*s/2}),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fill()),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class tt{constructor(){this.x,this.y,this.width,this.height,this.witch=H(f.state.info.library),this.InstanceScroll=new J,this.InstanceWitch=[]}get option(){return{x:this.x,y:this.y+this.offsetY,width:this.width,height:this.height}}get itemHeight(){const t=Math.ceil(this.witch.length/2);return(this.width-36)/4*1.5*t+(t?12*(t-1):0)}init(){this.InstanceScroll.x=this.x,this.InstanceScroll.y=this.y,this.InstanceScroll.width=this.width,this.InstanceScroll.height=this.height,this.InstanceScroll.contentHeight=this.itemHeight+12,this.InstanceWitch=this.witch.map(((t,e)=>{const i=new Z;return i.width=(this.width-36)/4,i.height=(this.width-36)/4*1.35,i.x=this.x+parseInt(e%4)*(i.width+12),i.y=this.y+parseInt(e/4)*(i.height+12),i.witch=t,i.touchAble=!0,i.touchArea=this.InstanceScroll.option,i.touchEvent=()=>{f.state.page.current="preview",f.state.cache=t},i}))}render(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceWitch.forEach((t=>{t.offsetY=0-e,((t,e)=>{const{x:i,y:n,width:s,height:h}=t,{x:o,y:a,width:r,height:c}=e;return i+s>o&&i<o+r&&n+h>a&&n<a+c})(t.option,this.InstanceScroll.option)&&t.render()}))}))}}const et=V(class{constructor(){this.InstanceNavigation=new Y,this.InstanceNavigation.content=[{name:"战斗",event:()=>f.state.page.current="pve"},{name:"仓库",active:!0}],this.InstanceList=new tt,this.InstanceList.width=Math.min(t.width-24,t.maxWidth-24),this.InstanceList.height=t.height-12,this.InstanceList.x=(t.width-this.InstanceList.width)/2,this.InstanceList.y=12,this.InstanceList.witch=H(f.state.info.library).map((t=>(t.inTeam=f.state.info.team.find((e=>e.key===t.key)),t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i})),this.InstanceList.init()}render(){this.InstanceList.render(),this.InstanceNavigation.render()}});class it{constructor(){this.x,this.y,this.width,this.height,this.witch=f.state.cache,this.ifInTeam=!!f.state.info.team.find((t=>t.key===f.state.cache.key)),this.mouseDownPosition=null,this.rotateNumber=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateNumber(){return this.width/4}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){Math.abs(this.rotateNumber)===this.maxRotateNumber&&this.use(),this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];const n=this.rotateNumber+e;this.rotateNumber=n,n>this.maxRotateNumber&&(this.rotateNumber=this.maxRotateNumber),n<-this.maxRotateNumber&&(this.rotateNumber=-this.maxRotateNumber)}use(){return this.ifInTeam?(f.state.info.team=f.state.info.team.filter((t=>t.key!==f.state.cache.key)),f.state.page.current="store",void g.play("卸载成功")):this.ifInTeam?void 0:4===f.state.info.team.length?void g.play("装载失败 超过最大数量"):(f.state.info.team.push({key:f.state.cache.key}),f.state.page.current="store",void g.play("装载成功"))}render(){if(0!==this.rotateNumber&&!this.mouseDownPosition){const t=16;this.rotateNumber<0&&(this.rotateNumber=this.rotateNumber/t<-this.minDiff?this.rotateNumber-this.rotateNumber/t:0),this.rotateNumber>0&&(this.rotateNumber=this.rotateNumber/t>this.minDiff?this.rotateNumber-this.rotateNumber/t:0)}var e;if(this.rotateNumber>0&&(e=this.witch.skill[0]),this.rotateNumber<0&&(e=this.witch.skill[1]),t.ctx.save(),m({...this.option,radius:8}),t.ctx.fillStyle="rgba(40, 90, 90, 1)",t.ctx.fill(),e){t.ctx.globalAlpha=Math.min(Math.abs(this.rotateNumber)/this.maxRotateNumber,1),t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)";const i=[e.name,e.type];this.rotateNumber>0&&(t.ctx.textAlign="start",i.forEach(((e,i)=>{m({x:this.x+.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(e,this.x+.07*this.width,this.y+.045*this.width+i*this.width*.08)})),m({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.ifInTeam?"卸载":"装载",this.x+.07*this.width,this.y+this.height-.085*this.width)),this.rotateNumber<0&&(t.ctx.textAlign="end",i.forEach(((e,i)=>{m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(e,this.x+this.width-.07*this.width,this.y+.045*this.width+i*this.width*.08)})),m({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.ifInTeam?"卸载":"装载",this.x+this.width-.07*this.width,this.y+this.height-.085*this.width)),t.ctx.textAlign="center";const n=y({x:this.x+this.width/2,y:this.y-.12*this.width,width:.9*this.width,wrapSpace:.06*this.width,text:e.description,onlyread:!0});y({x:this.x+this.width/2,y:this.y-(.06*this.width+.06*this.width*n)*Math.min(Math.abs(this.rotateNumber)/this.maxRotateNumber,1),width:.9*this.width,wrapSpace:.06*this.width,text:e.description})}t.ctx.globalAlpha=1,t.ctx.translate(this.x+.5*this.width,this.y+2*this.height),t.ctx.rotate(this.rotateNumber/400),t.ctx.translate(-(this.x+.5*this.width),-(this.y+2*this.height)),m({...this.option,radius:8}),t.ctx.clip(),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.globalAlpha=Math.min((this.maxRotateNumber-Math.abs(this.rotateNumber))/this.maxRotateNumber,1),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.04*this.width}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",m({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`清醒 ${this.witch.purity}`,this.x+.07*this.width,this.y+.045*this.width),m({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`理性 ${this.witch.rational}`,this.x+.07*this.width,this.y+.125*this.width),m({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(`感性 ${this.witch.perceptual}`,this.x+.07*this.width,this.y+.205*this.width),t.ctx.textAlign="end",m({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.witch.name,this.x+this.width-.07*this.width,this.y+.045*this.width),m({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),t.ctx.fill(),t.ctx.fillText(this.witch.type,this.x+this.width-.07*this.width,this.y+.125*this.width),p(this.witch.imageDOM,{...this.option,y:this.y+.25*this.height,height:this.height-.25*this.height}),e&&(t.ctx.globalAlpha=Math.min(Math.abs(this.rotateNumber)/this.maxRotateNumber,1),p(e.imageDOM,this.option)),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}const nt=V(class{constructor(){this.InstanceNavigation=new Y,this.InstanceNavigation.content=[{name:"战斗",event:()=>f.state.page.current="pve"},{name:"仓库",event:()=>f.state.page.current="store"}],this.InstanceWitch=new it,this.InstanceWitch.width=Math.min(.75*t.width,.75*t.maxWidth),this.InstanceWitch.height=Math.min(.75*t.width,.75*t.maxWidth),this.InstanceWitch.x=.5*(t.width-this.InstanceWitch.width),this.InstanceWitch.y=t.height/2}render(){this.InstanceWitch.render(),this.InstanceNavigation.render()}});new class{constructor(){this.animationFrameId,this.instance,this.init(),this.loopStart()}render(){if(t.ctx.clearRect(0,0,t.width,t.height),c.clearEventListener(),"home"!==f.state.page&&f.state.loading)return;const e=f.state.page.map[f.state.page.current];e&&(this.instance instanceof e||(this.instance=new e),this.instance.render(),g.render(),r.render())}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}async init(){f.state={page:{current:$("path")?$("path"):"home",map:{home:G,pve:K,store:et,preview:nt}},info:null,setInfo:async()=>{localStorage.setItem("info",JSON.stringify(f.state.info))},getInfo:async()=>{const t=localStorage.getItem("info");if(t&&(f.state.info=JSON.parse(t)),!t){const t={library:C.map((t=>({key:t.key,level:1,exp:0}))),team:C.map((t=>({key:t.key}))).filter(((t,e)=>e<4))};f.state.info=t}},loading:!0,sound:{ifBackground:!1,ifSource:!1},cache:null},f.state.getInfo(),await Promise.all([j.load(),O.load(),r.load()]),L(),f.state.loading=!1}}})()})();