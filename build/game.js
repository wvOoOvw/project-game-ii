(()=>{var t={70:()=>{!function(){try{wx}catch{return}!function(t){const i={};function e(s){if(i[s])return i[s].exports;const h=i[s]={exports:{},id:s,loaded:!1};return t[s].call(h.exports,h,h.exports,e),h.loaded=!0,h.exports}e.m=t,e.c=i,e.p="",e(0)}([function(t,i,e){const s=function(t){if(t&&t.__esModule)return t;{const i={};if(null!=t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}}(e(1)),h=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){s.addEventListener=s.canvas.addEventListener=function(t,i){s.document.addEventListener(t,i)},s.removeEventListener=s.canvas.removeEventListener=function(t,i){s.document.removeEventListener(t,i)};const t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(const t in s){const i=Object.getOwnPropertyDescriptor(h,t);i&&!0!==i.configurable||Object.defineProperty(window,t,{value:s[t]})}for(const t in s.document){const i=Object.getOwnPropertyDescriptor(h.document,t);i&&!0!==i.configurable||Object.defineProperty(h.document,t,{value:s.document[t]})}window.parent=window}else{for(const t in s)h[t]=s[t];h.window=s,window=h,window.top=window.parent=window}}())},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.cancelAnimationFrame=i.requestAnimationFrame=i.clearInterval=i.clearTimeout=i.setInterval=i.setTimeout=i.canvas=i.location=i.localStorage=i.HTMLElement=i.FileReader=i.Audio=i.Image=i.WebSocket=i.XMLHttpRequest=i.navigator=i.document=void 0;const s=e(2);Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(i,t,{enumerable:!0,get:function(){return s[t]}})}));const h=e(3);Object.keys(h).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(i,t,{enumerable:!0,get:function(){return h[t]}})}));const n=m(e(9)),o=m(e(10)),a=m(e(17)),c=m(e(18)),r=m(e(19)),l=m(e(11)),u=m(e(12)),d=m(e(20)),f=m(e(4)),w=m(e(21)),p=m(e(22));function m(t){return t&&t.__esModule?t:{default:t}}i.document=o.default,i.navigator=a.default,i.XMLHttpRequest=c.default,i.WebSocket=r.default,i.Image=l.default,i.Audio=u.default,i.FileReader=d.default,i.HTMLElement=f.default,i.localStorage=w.default,i.location=p.default;const x=new n.default;i.canvas=x,i.setTimeout=setTimeout,i.setInterval=setInterval,i.clearTimeout=clearTimeout,i.clearInterval=clearInterval,i.requestAnimationFrame=requestAnimationFrame,i.cancelAnimationFrame=cancelAnimationFrame},function(t,i){Object.defineProperty(i,"__esModule",{value:!0});const e=wx.getSystemInfoSync(),s=e.screenWidth,h=e.screenHeight,n=e.devicePixelRatio,o=i.innerWidth=s,a=i.innerHeight=h;i.devicePixelRatio=n,i.screen={availWidth:o,availHeight:a},i.performance={now:function(){return Date.now()/1e3}},i.ontouchstart=null,i.ontouchmove=null,i.ontouchend=null},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLCanvasElement=i.HTMLImageElement=void 0;const s=(h=e(4))&&h.__esModule?h:{default:h};var h;function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function o(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function a(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}i.HTMLImageElement=function(t){function i(){return n(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"img"))}return a(i,t),i}(s.default),i.HTMLCanvasElement=function(t){function i(){return n(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"canvas"))}return a(i,t),i}(s.default)},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=(n=e(5))&&n.__esModule?n:{default:n};var n;const o=e(8),a=e(2);function c(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function r(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}const l=function(t){function i(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(this,i);const e=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.className="",e.childern=[],e.style={width:`${a.innerWidth}px`,height:`${a.innerHeight}px`},e.insertBefore=o.noop,e.innerHTML="",e.tagName=t.toUpperCase(),e}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),s(i,[{key:"setAttribute",value:function(t,i){this[t]=i}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:a.innerWidth,height:a.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){const t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){const t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),i}(h.default);i.default=l},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});var s;const h=function(t){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);const t=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.className="",t.children=[],t}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),i}(((s=e(6))&&s.__esModule?s:{default:s}).default);i.default=h},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();var h;const n=function(t){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);const t=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.childNodes=[],t}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),s(i,[{key:"appendChild",value:function(t){if(!(t instanceof i))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){const t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){const i=this.childNodes.findIndex((function(i){return i===t}));return i>-1?this.childNodes.splice(i,1):null}}]),i}(((h=e(7))&&h.__esModule?h:{default:h}).default);i.default=n},function(t,i){Object.defineProperty(i,"__esModule",{value:!0});const e=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),s=new WeakMap,h=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),s.set(this,{})}return e(t,[{key:"addEventListener",value:function(t,i){const e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let h=s.get(this);h||(h={},s.set(this,h)),h[t]||(h[t]=[]),h[t].push(i),e.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),e.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),e.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,i){const e=s.get(this)[t];if(e&&e.length>0)for(let t=e.length;t--;t>0)if(e[t]===i){e.splice(t,1);break}}},{key:"dispatchEvent",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=s.get(this)[t.type];if(i)for(let e=0;e<i.length;e++)i[e](t)}}]),t}();i.default=h},function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.noop=function(){}},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){const t=wx.createCanvas();return t.type="canvas",t.__proto__.__proto__=new s.default("canvas"),t.getContext,t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t},e(3);const s=h(e(4));function h(t){return t&&t.__esModule?t:{default:t}}h(e(10))},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=function(t){if(t&&t.__esModule)return t;{const i={};if(null!=t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}}(e(1)),h=c(e(4)),n=c(e(11)),o=c(e(12)),a=c(e(9));function c(t){return t&&t.__esModule?t:{default:t}}e(15);const r={};var l={readyState:"complete",visibilityState:"visible",documentElement:s,hidden:!1,style:{},location:s.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new h.default("head"),body:new h.default("body"),createElement:function(t){return"canvas"===t?new a.default:"audio"===t?new o.default:"img"===t?new n.default:new h.default(t)},getElementById:function(t){return t===s.canvas.id?s.canvas:null},getElementsByTagName:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[s.canvas]:[]},querySelector:function(t){return"head"===t?l.head:"body"===t?l.body:"canvas"===t||t===`#${s.canvas.id}`?s.canvas:null},querySelectorAll:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[s.canvas]:[]},addEventListener:function(t,i){r[t]||(r[t]=[]),r[t].push(i)},removeEventListener:function(t,i){const e=r[t];if(e&&e.length>0)for(let t=e.length;t--;t>0)if(e[t]===i){e.splice(t,1);break}},dispatchEvent:function(t){const i=r[t.type];if(i)for(let e=0;e<i.length;e++)i[e](t)}};i.default=l},function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){return wx.createImage()}},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=(n=e(13))&&n.__esModule?n:{default:n};var n;const o=new WeakMap,a=new WeakMap,c=(new WeakMap,new WeakMap,function(t){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);const e=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));e.HAVE_NOTHING=0,e.HAVE_METADATA=1,e.HAVE_CURRENT_DATA=2,e.HAVE_FUTURE_DATA=3,e.HAVE_ENOUGH_DATA=4,e.readyState=0,a.set(e,"");const s=wx.createInnerAudioContext();return o.set(e,s),s.onCanplay((function(){e.dispatchEvent({type:"load"}),e.dispatchEvent({type:"loadend"}),e.dispatchEvent({type:"canplay"}),e.dispatchEvent({type:"canplaythrough"}),e.dispatchEvent({type:"loadedmetadata"}),e.readyState=2})),s.onPlay((function(){e.dispatchEvent({type:"play"})})),s.onPause((function(){e.dispatchEvent({type:"pause"})})),s.onEnded((function(){e.dispatchEvent({type:"ended"}),e.readyState=4})),s.onError((function(){e.dispatchEvent({type:"error"})})),t&&(o.get(e).src=t),e}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),s(i,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){o.get(this).play()}},{key:"pause",value:function(){o.get(this).pause()}},{key:"canPlayType",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){const t=new i;return t.loop=o.get(this).loop,t.autoplay=o.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return o.get(this).currentTime},set:function(t){o.get(this).seek(t)}},{key:"src",get:function(){return a.get(this)},set:function(t){a.set(this,t),o.get(this).src=t}},{key:"loop",get:function(){return o.get(this).loop},set:function(t){o.get(this).loop=t}},{key:"autoplay",get:function(){return o.get(this).autoplay},set:function(t){o.get(this).autoplay=t}},{key:"paused",get:function(){return o.get(this).paused}}]),i}(h.default));i.default=c},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});var s;const h=function(t){function i(){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"audio"))}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),i}(((s=e(14))&&s.__esModule?s:{default:s}).default);i.default=h},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();var h;const n=function(t){function i(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,t),s(i,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),i}(((h=e(4))&&h.__esModule?h:{default:h}).default);i.default=n},function(t,i,e){e(16)},function(t,i,e){const s=function(t){if(t&&t.__esModule)return t;{const i={};if(null!=t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}}(e(1)),h=(n=e(10))&&n.__esModule?n:{default:n};var n;const o=e(8),a=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=s.canvas,this.currentTarget=s.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=o.noop,this.stopPropagation=o.noop,this.type=i};function c(t){return function(i){const e=new a(t);e.touches=i.touches,e.targetTouches=Array.prototype.slice.call(i.touches),e.changedTouches=i.changedTouches,e.timeStamp=i.timeStamp,h.default.dispatchEvent(e)}}wx.onTouchStart(c("touchstart")),wx.onTouchMove(c("touchmove")),wx.onTouchEnd(c("touchend")),wx.onTouchCancel(c("touchcancel"))},function(t,i,e){Object.defineProperty(i,"__esModule",{value:!0});const s=e(8),h={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:s.noop,watchPosition:s.noop,clearWatch:s.noop}};i.default=h},function(t,i){Object.defineProperty(i,"__esModule",{value:!0});const e=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),s=new WeakMap,h=new WeakMap,n=new WeakMap,o=new WeakMap,a=new WeakMap;function c(t){if("function"==typeof this[`on${t}`]){for(var i=arguments.length,e=Array(i>1?i-1:0),s=1;s<i;s++)e[s-1]=arguments[s];this[`on${t}`].apply(this,e)}}function r(t){this.readyState=t,c.call(this,"readystatechange")}const l=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,n.set(this,{"content-type":"application/x-www-form-urlencoded"}),o.set(this,{})}return e(t,[{key:"abort",value:function(){const t=a.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){const t=o.get(this);return Object.keys(t).map((function(i){return`${i}: ${t[i]}`})).join("\n")}},{key:"getResponseHeader",value:function(t){return o.get(this)[t]}},{key:"open",value:function(i,e){h.set(this,i),s.set(this,e),r.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){const i=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:e,url:s.get(this),method:h.get(this),header:n.get(this),responseType:this.responseType,success:function(e){let s=e.data;const h=e.statusCode,n=e.header;if("string"!=typeof s&&!(s instanceof ArrayBuffer))try{s=JSON.stringify(s)}catch(t){}if(i.status=h,o.set(i,n),c.call(i,"loadstart"),r.call(i,t.HEADERS_RECEIVED),r.call(i,t.LOADING),i.response=s,s instanceof ArrayBuffer){i.responseText="";const t=new Uint8Array(s),e=t.byteLength;for(let s=0;s<e;s++)i.responseText+=String.fromCharCode(t[s])}else i.responseText=s;r.call(i,t.DONE),c.call(i,"load"),c.call(i,"loadend")},fail:function(t){const e=t.errMsg;-1!==e.indexOf("abort")?c.call(i,"abort"):c.call(i,"error",e),c.call(i,"loadend")}})}},{key:"setRequestHeader",value:function(t,i){const e=n.get(this);e[t]=i,n.set(this,e)}}]),t}();l.UNSEND=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,i.default=l},function(t,i){Object.defineProperty(i,"__esModule",{value:!0});const e=function(){function t(t,i){for(let e=0;e<i.length;e++){const s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();function s(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}const h=new WeakMap,n=function(){function t(i){const e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(s(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof i||!/(^ws:\/\/)|(^wss:\/\/)/.test(i))throw new TypeError(`Failed to construct 'WebSocket': The URL '${i}' is invalid`);this.url=i,this.readyState=t.CONNECTING;const o=wx.connectSocket({url:i,protocols:Array.isArray(n)?n:[n]});return h.set(this,o),o.onClose((function(i){e.readyState=t.CLOSED,"function"==typeof e.onclose&&e.onclose(i)})),o.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})),o.onOpen((function(){e.readyState=t.OPEN,"function"==typeof e.onopen&&e.onopen()})),o.onError((function(t){"function"==typeof e.onerror&&e.onerror(new Error(t.errMsg))})),this}return e(t,[{key:"close",value:function(i,e){this.readyState=t.CLOSING,h.get(this).close({code:i,reason:e})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError(`Failed to send message: The data ${t} is invalid`);h.get(this).send({data:t})}}]),t}();n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,i.default=n},function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,i){Object.defineProperty(i,"__esModule",{value:!0});const e={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,i){return wx.setStorageSync(t,i)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};i.default=e},function(t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={href:"game.js",reload:function(){}}}])}()}},i={};function e(s){var h=i[s];if(void 0!==h)return h.exports;var n=i[s]={exports:{}};return t[s](n,n.exports,e),n.exports}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var i=e.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var s=i.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),(()=>{"use strict";e(70);const t=t=>1===t?"I":2===t?"II":3===t?"III":4===t?"IV":5===t?"V":6===t?"VI":7===t?"VII":8===t?"VIII":9===t?"IX":10===t?"X":11===t?"XI":12===t?"XII":13===t?"XIII":14===t?"XIV":15===t?"XV":16===t?"XVI":void 0,i=t=>{try{if(wx)return null}catch{}return new URL(location.href).searchParams.get(t)},s=async(t,i)=>{var e=0;const s=i=>{e===t&&i(),e!==t&&(e+=1,requestAnimationFrame((()=>s(i))))};i&&s(i),i||await new Promise((t=>s(t)))},h=t=>Number(Number(t).toFixed(8)),n=(t,i,e)=>{const s=new Array(i).fill(Number((t/i).toFixed(5))),h=()=>{requestAnimationFrame((()=>{e(s.shift()),s[0]&&h()}))};h()},o=(t,i)=>{var e=[],s=[...t];return new Array(i).fill().forEach((()=>{const t=Math.floor(Math.random()*s.length);s[t]&&(e.push(s[t]),s=s.filter(((i,e)=>e!==t)))})),e},a=(t,i)=>{const e=i.x,s=i.y,h=i.width,n=i.height;var o=t.x||t.touches[0].clientX,a=t.y||t.touches[0].clientY;return o>=e&&o<=e+h&&a>=s&&a<=s+n},c=new class{constructor(){this.canvas_,this.create(),this.flex()}create(){try{if(wx)return this.canvas_=window.canvas}catch{}const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.background="black",t.style.overflow="hidden";const i=document.createElement("canvas");i.width=window.innerWidth,i.height=window.innerHeight,i.style.touchAction="none",i.setAttribute("oncontextmenu","return false"),this.canvas_=i,t.appendChild(i)}flex(){const t=this.canvas_.width,i=this.canvas_.height;this.canvas_.width=2*t,this.canvas_.height=2*i,this.canvas_.style.width=t+"px",this.canvas_.style.height=i+"px",this.canvas_.getContext("2d").scale(2,2)}get canvas(){return this.canvas_}get ctx(){return this.canvas_.getContext("2d")}get width(){return this.canvas_.offsetWidth}get height(){return this.canvas_.offsetHeight}get maxWidth(){return void 0===window.ontouchstart?.5*this.height:this.width}get safeArea(){try{if(wx)return this.wx_safeArea||(this.wx_safeArea=wx.getSystemInfoSync().safeArea),this.wx_safeArea}catch{}return{top:0,left:0,right:this.width,bottom:this.height,width:this.width,height:this.height}}},r=(t,i)=>{var e=i.x,s=i.y,h=i.width,n=i.height;const o=n/t.height,a=t.width*o;e+=(h-a)/2,c.ctx.drawImage(t,e,s,a,n)},l=t=>{const i=t.x,e=t.y,s=t.width,h=t.height,n=Array.isArray(t.radius)?t.radius:new Array(4).fill(t.radius);c.ctx.beginPath(),c.ctx.moveTo(i,e+n[0]),c.ctx.arcTo(i,e,i+n[0],e,n[0]),c.ctx.lineTo(i+s-n[1],e),c.ctx.arcTo(i+s,e,i+s,e+n[1],n[1]),c.ctx.lineTo(i+s,e+h-n[2]),c.ctx.arcTo(i+s,e+h,i+s-n[2],e+h,n[2]),c.ctx.lineTo(i+n[3],e+h),c.ctx.arcTo(i,e+h,i,e+h-n[3],n[3]),c.ctx.closePath()},u=t=>{const i=t.x,e=t.y,s=t.width,h=t.height;c.ctx.beginPath(),c.ctx.moveTo(i,e),c.ctx.lineTo(i+s,e),c.ctx.lineTo(i+s,e+h),c.ctx.lineTo(i,e+h),c.ctx.closePath()},d=t=>{const i=t.x,e=t.y,s=t.width,h=t.wrapSpace,n=t.text,o=t.onlyread;var a="",r=[];if(n.split("").forEach((t=>{c.ctx.measureText(a+t).width>s&&(r.push(a),a=""),a+=t})),r.push(a),o)return r.length;r.forEach(((t,s)=>{c.ctx.fillText(t,i,e+s*h)}))},f=new class{constructor(){this.map={},Object.keys(this.map).forEach((t=>{this.map[t]=this.map[t].reduce(((t,i)=>[...t,...new Array(4).fill(i)]),[])})),this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>Promise.all(t[1].map(((i,e)=>new Promise((i=>{const s=new Image;s.src=t[1][e],s.onload=i,t[1][e]=s}))))))))}play(t,i){this.map[t]||console.error(t),this.queqe.push({key:t,src:this.map[t],option:i,index:0})}render(){this.queqe.forEach(((t,i)=>{const e=t.src[t.index];e&&(c.ctx.drawImage(e,...t.option(e)),t.index=t.index+1),e||this.queqe.splice(i,1)}))}},w=new class{constructor(){this.event=[];const t=(t,i)=>{const e=this.event.filter((t=>t.type===i)).sort(((t,i)=>{const e=void 0===t.option||void 0===t.option.priority?0:t.option.priority;return(void 0===i.option||void 0===i.option.priority?0:i.option.priority)-e}));var s=!1;e.forEach((i=>{s||i.option&&i.option.ifTouchCover&&!a(t,i.option.ifTouchCover)||(i.option&&i.option.stop&&(s=!0),"function"==typeof i.callback&&i.callback(t))}))};new Array("touchstart","touchmove","touchend","mousedown","mousemove","mouseup").forEach((i=>{c.canvas.addEventListener(i,(e=>t(e,i)),{passive:!0})}))}addEventListener=(t,i,e)=>{try{void 0===window.ontouchstart&&"touchstart"===t&&(t="mousedown"),void 0===window.ontouchmove&&"touchmove"===t&&(t="mousemove"),void 0===window.ontouchend&&"touchend"===t&&(t="mouseup")}catch{}this.event.push({type:t,callback:i,option:e})};removeEventListener=(t,i)=>{this.event=this.event.filter((e=>e.type!==t&&e.callback!==i))};clearEventListener=()=>{this.event=[]}},p=Symbol("_Allow");function m(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function x(t){this.state=t,this.MonitorINS=new m(this)}m.prototype.dispatch=function(){this.monitorQueue.forEach(((t,i)=>{const e=this.dependentQueue[i],s=this.executeDependent(t.dependent);return s===p||Array.isArray(s)&&Array.isArray(e)&&(h=s,n=e,Array.isArray(h)&&Array.isArray(n)&&(h.length!==n.length||h.filter(((t,i)=>t===n[i])).length!==h.length))||!Array.isArray(s)&&!Array.isArray(e)&s!==e?(this.executeEvent(t.event),void(this.dependentQueue[i]=s)):void(this.dependentQueue[i]=s);var h,n}))},m.prototype.register=function(t,i=p){const e={event:t,dependent:i};return this.monitorQueue.push(e),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,i)=>{t===e&&(this.monitorQueue=this.monitorQueue.filter(((t,e)=>e!==i)),this.dependentQueue=this.dependentQueue.filter(((t,e)=>e!==i)))}))}},m.prototype.executeEvent=function(t){t(this.ImitationINS.state)},m.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},x.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},x.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},x.prototype.register=function(){return this.MonitorINS.register(...arguments)},x.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const y=new x,g=new class{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeoutRef=null,this.showIf=!1,this.opacity=0,this.width=Math.min(c.width-24,200),this.x=(c.width-this.width)/2,this.height=25,this.y=c.height}play(t,i="rgba(255, 255, 255, 1)",e="rgba(0, 0, 0, 1)"){this.message=t,this.backgroundColor=i,this.textColor=e,this.showIf=!0,this.timeoutRef||(this.timeoutRef=s(64,(()=>{this.showIf=!1,this.timeoutRef=null})))}render(){this.showIf&&this.opacity<1&&(this.opacity=h(this.opacity+.05)),!this.showIf&&this.opacity>0&&(this.opacity=h(this.opacity-.05)),this.showIf&&this.y>c.height-this.height-12&&(this.y=h(this.y-2)),!this.showIf&&this.y<c.height&&(this.y=h(this.y+2)),(this.showIf||0!==this.opacity)&&(c.ctx.save(),c.ctx.globalAlpha=this.opacity,c.ctx.fillStyle=this.backgroundColor,l({x:this.x,y:this.y,width:this.width,height:this.height,radius:4}),c.ctx.fill(),c.ctx.textAlign="center",c.ctx.textBaseline="middle",c.ctx.font="900 10px Courier",c.ctx.fillStyle=this.textColor,c.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2),c.ctx.restore())}},v=e.p+"static/07249160f149c93f0b5bdb6a0150b6be-aiyafala.37be7922.png",b=e.p+"static/6cf79ad608811cae41e84c3f6cb56e4c-chen.b65023b5.png",T=e.p+"static/2d89e216ff73e2057406325c2ab8b9bd-cuoe.c908ed3c.png",I=e.p+"static/7ff383462917efd5d2caed4bd35ed3f3-fengdi.72b31ee1.png",M=e.p+"static/c5049d00f09d4816bafe36c862d851f8-hei.6cc6018a.png",k=e.p+"static/66f791088e87e86e1f5dba187ca9e9d7-heijian.e5f9b0d1.png",E=e.p+"static/e94a1ee480e0a06667a60e8de6fd3b9b-huang.a3fc17ce.png",_=e.p+"static/e53a276478564fbb5845d630a9508cdb-kongxian.de9b3926.png",P=e.p+"static/959b46c8b977c2f8b33ce2a567019598-linguang.acf5bd67.png",O=e.p+"static/dc9efc949140c0483a772fbd989f6b80-niyan.0a121257.png",S=e.p+"static/5f7dd2cb0a8254f0d1920ba23848d3eb-yanwei.29b3239c.png",D=e.p+"static/380bccd9c68a9c393d4aca8872e8c699-yifulite.8bc864d4.png",A=new class{constructor(){this.map={home:O,"monster-1":v,"witch-1":b,"witch-skill-1":[S,D],"witch-2":T,"witch-skill-2":[S,D],"witch-3":I,"witch-skill-3":[S,D],"witch-4":M,"witch-skill-4":[S,D],"witch-5":k,"witch-skill-5":[S,D],"witch-6":E,"witch-skill-6":[S,D],"witch-7":_,"witch-skill-7":[S,D],"witch-8":P,"witch-skill-8":[S,D]}}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((i=>{if("string"==typeof this.map[t[0]]){const e=new Image;return e.onload=i,e.src=this.map[t[0]],void(this.map[t[0]]=e)}"object"!=typeof this.map[t[0]]||Promise.all(this.map[t[0]].map(((i,e)=>new Promise((s=>{const h=new Image;h.onload=s,h.src=i,this.map[t[0]][e]=h}))))).then(i)})))))}get(t){return this.map[t]||console.error(t),this.map[t]}},W=new class{constructor(){this.map={},this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((i=>{const e=new Audio;e.onloadeddata=i,e.src=this.map[t[0]],this.map[t[0]]=e,e.load()})))))}get(t){return this.map[t]||console.error(t),this.map[t]}},$=t=>class{constructor(){this.time=0,this.component=new t}render(){this.time<1&&(this.time=h(this.time+.05)),this.component.render(),this.time<1&&(c.ctx.save(),c.ctx.globalAlpha=1-this.time,u({x:0,y:0,width:c.width,height:c.height}),c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fill(),c.ctx.restore(),w.addEventListener("touchstart",void 0,{stop:!0,priority:1e3}),w.addEventListener("touchmove",void 0,{stop:!0,priority:1e3}),w.addEventListener("touchend",void 0,{stop:!0,priority:1e3}))}};var N=[{key:1,name:"勇敢",description:"提升理性值",function:(t,i)=>{i.rational=(1+.04*t.level)*i.rational,i.rational_=(1+.04*t.level)*i.rational_}},{key:2,name:"冷静",description:"提升感性值",function:(t,i)=>{i.perceptual=(1+.04*t.level)*i.perceptual,i.perceptual_=(1+.04*t.level)*i.perceptual_}}],Y=[{key:1,name:"被污染的野猪",description:"在丛林中被污染的野猪，具备一定的攻击性。",dirty:1200,reward:[{name:"exp",value:20}],skill:[{name:"冲撞",type:"伤害",description:"蓄势待发，准备向你冲来！做好防御的准备！！！",function:(t,i,e)=>[{effect:"Damage-Purity",target:[i],value:Math.floor(100+50*Math.random())}]},{name:"休息",type:"回复",description:"躺在了地上！",function:(t,i,e)=>[{effect:"Damage-Purity",target:[i],value:Math.floor(20+50*Math.random())}]}],characteristic:[]}],j=[{key:1,name:"自由滑轮",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"圆舞",type:"伤害",description:"以理性值20%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.2*t.rational}]},{name:"零落",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Improve-Rational",target:[t],value:.1*t.rational},{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]}]},{key:2,name:"甜食守卫",type:"进攻",description:"",purity:1150,rational:960,perceptual:1040,skill:[{name:"舜生",type:"伤害",description:"以感性值18%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.18*t.perceptual}]},{name:"刹那",type:"伤害",description:"以理性值18%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.18*t.rational}]}]},{key:3,name:"疯人院",type:"辅助",description:"",purity:1e3,rational:820,perceptual:1200,skill:[{name:"绯红之刃",type:"伤害",description:"以感性值12%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.12*t.perceptual}]},{name:"绯红治疗",type:"回复",description:"以感性值8%治疗友方全体",function:(t,i,e)=>[{effect:"Cure",target:e,value:.08*t.perceptual}]}]},{key:4,name:"致命音符",type:"防御",description:"",purity:1500,rational:920,perceptual:700,skill:[{name:"闪光独奏",type:"伤害",description:"以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]},{name:"爆裂节拍",type:"防御",description:"3回合内提升自身减伤70%",function:(t,i,e)=>[{effect:"Buff",target:[t],value:i=>{"Damage"===i.effect&&i.target===t&&(i.value=h(.3*i.value))},name:"减伤",time:3}]}]},{key:5,name:"晚安故事",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"放音",type:"伤害",description:"以理性值20%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.2*t.rational}]},{name:"夜半",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Improve-Rational",target:[t],value:.1*t.rational},{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]}]},{key:6,name:"场外焦点",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"偶像身姿",type:"伤害",description:"以理性值20%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.2*t.rational}]},{name:"闪烁打击",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Improve-Rational",target:[t],value:.1*t.rational},{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]}]},{key:7,name:"纯真",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"飞叶",type:"伤害",description:"以理性值20%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.2*t.rational}]},{name:"香气",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Improve-Rational",target:[t],value:.1*t.rational},{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]}]},{key:8,name:"不良",type:"进攻",description:"",purity:1200,rational:1180,perceptual:880,skill:[{name:"惩戒",type:"伤害",description:"以理性值20%攻击目标",function:(t,i,e)=>[{effect:"Damage-Dirty",target:[i],value:.2*t.rational}]},{name:"利刃回旋",type:"伤害 提升",description:"提升自身理性值10%，并以理性值15%攻击目标",function:(t,i,e)=>[{effect:"Improve-Rational",target:[t],value:.1*t.rational},{effect:"Damage-Dirty",target:[i],value:.15*t.rational}]}]}];const L=()=>{Y.forEach((t=>t.imageDOM=A.get("monster-"+t.key))),j.forEach((t=>{t.imageDOM=A.get("witch-"+t.key),t.skill.forEach(((i,e)=>{i.imageDOM=A.get("witch-skill-"+t.key)[e]}))}))},R=t=>t.reduce(((t,i)=>{const e=[...t],s={...N.find((t=>i.key===t.key)),...i};return e.push(s),e}),[]),C=t=>t.reduce(((t,i)=>{const e=[...t],s={...j.find((t=>i.key===t.key)),...i};return s.purity=s.purity*Math.pow(1.2,i.level),s.rational=s.rational*Math.pow(1.2,i.level),s.perceptual=s.perceptual*Math.pow(1.2,i.level),s.purity_=s.purity,s.rational_=s.rational,s.perceptual_=s.perceptual,s.buff=[],s.buff_=[],s.characteristic=R(s.characteristic),s.characteristic.forEach((t=>t.function(t,s))),e.push(s),e}),[]),H=$(class{constructor(){this.width=Math.min(.75*c.width,.75*c.maxWidth),this.height=Math.min(.75*c.width,.75*c.maxWidth),this.x=.5*(c.width-this.width),this.y=.5*(c.height-this.height),this.mouseDownPosition=null,this.rotateNumber=0,this.loadingNumber=0,this.randomColor=3*Math.random(),this.randomColor<1&&(this.randomColor="rgba(90, 0, 40, 1)"),this.randomColor<2&&(this.randomColor="rgba(40, 40, 90, 1)"),this.randomColor<3&&(this.randomColor="rgba(40, 90, 90, 1)")}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateNumber(){return this.width/4}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){Math.abs(this.rotateNumber)===this.maxRotateNumber&&(y.state.page.current="pve"),this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const i=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],e=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+i,this.mouseDownPosition[1]+e];const s=this.rotateNumber+i;this.rotateNumber=s,s>this.maxRotateNumber&&(this.rotateNumber=this.maxRotateNumber),s<-this.maxRotateNumber&&(this.rotateNumber=-this.maxRotateNumber)}async init(){await Promise.all([W.load(),A.load(),f.load()]),L(),this.loading=!1}render(){if(y.state.loading){this.loadingNumber=this.loadingNumber+1;const t=240,i=t/4,e=this.loadingNumber%t;e<=i&&(this.rotateNumber=e),e>i&&e<=3*i&&(this.rotateNumber=2*i-e),e>3*i&&e<=4*i&&(this.rotateNumber=e-4*i),this.rotateNumber=this.rotateNumber*(this.maxRotateNumber/i)}if(!y.state.loading){if(0!==this.rotateNumber&&!this.mouseDownPosition){const t=16;this.rotateNumber<0&&(this.rotateNumber=this.rotateNumber/t<-this.minDiff?this.rotateNumber-this.rotateNumber/t:0),this.rotateNumber>0&&(this.rotateNumber=this.rotateNumber/t>this.minDiff?this.rotateNumber-this.rotateNumber/t:0)}w.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),w.addEventListener("touchmove",this.eventMove.bind(this)),w.addEventListener("touchend",this.eventUp.bind(this))}c.ctx.save(),u({x:0,y:0,width:c.width,height:c.height}),c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fill(),l({...this.option,radius:8}),c.ctx.fillStyle=this.randomColor,c.ctx.fill(),c.ctx.globalAlpha=1,c.ctx.translate(this.x+.5*this.width,this.y+.5*this.height),c.ctx.rotate(this.rotateNumber/200),c.ctx.translate(-(this.x+.5*this.width),-(this.y+.5*this.height)),l({...this.option,radius:8}),c.ctx.clip(),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),c.ctx.globalAlpha=Math.min((this.maxRotateNumber-Math.abs(this.rotateNumber))/this.maxRotateNumber,1),c.ctx.textAlign="center",c.ctx.textBaseline="middle",c.ctx.font=`900 ${.05*this.width}px Courier`,c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fillText("魔女的冒险 污秽篇",this.x+.5*this.width,this.y+.4*this.height),y.state.loading&&c.ctx.fillText("加载资源中",this.x+.5*this.width,this.y+.6*this.height),y.state.loading||c.ctx.fillText("滑动 开始游戏",this.x+.5*this.width,this.y+.6*this.height),l({x:this.x+.1*this.width,y:this.y+.5*this.height-1,width:.8*this.width,height:2,radius:2}),c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fill(),c.ctx.globalAlpha=Math.min(Math.abs(this.rotateNumber)/this.maxRotateNumber,1),r(A.get("home"),this.option),c.ctx.restore()}});class B{constructor(){this.content=[],this.mouseDownPosition=null,this.visible=!1,this.visibleTime=0}get minDiff(){return.01}get maxVisibleTime(){return 42}render(){if(!this.visible){const t=16;this.visibleTime=this.visibleTime/t>this.minDiff?this.visibleTime-this.visibleTime/t:0}if(this.visible){const t=16;this.visibleTime=(this.maxVisibleTime-this.visibleTime)/t>this.minDiff?this.visibleTime+(this.maxVisibleTime-this.visibleTime)/t:this.maxVisibleTime}c.ctx.save(),0!==this.visibleTime&&(c.ctx.globalAlpha=this.visibleTime/this.maxVisibleTime,u({x:0,y:0,width:c.width,height:c.height}),c.ctx.fillStyle="rgba(0, 0, 0, 0.5)",c.ctx.fill(),l({x:(c.width-c.maxWidth)/2,y:c.height-this.visibleTime-24,width:c.maxWidth,height:this.visibleTime+24,radius:[8,8,0,0]}),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),this.content.forEach(((t,i)=>{var e=72,s=30,h=(c.width-e)/2,n=c.height-this.visibleTime;h+=(i-(this.content.length/2-.5))*(e+4),t.active&&(l({x:h,y:n,width:e,height:s,radius:4}),c.ctx.fillStyle="rgba(40, 90, 90, 1)",c.ctx.fill()),t.active||(h+=c.ctx.lineWidth/2,n+=c.ctx.lineWidth/2,e-=c.ctx.lineWidth,s-=c.ctx.lineWidth,l({x:h,y:n,width:e,height:s,radius:4}),c.ctx.strokeStyle="rgba(40, 90, 90, 1)",c.ctx.stroke()),c.ctx.textAlign="center",c.ctx.textBaseline="middle",c.ctx.font="900 10px Courier",c.ctx.fillStyle=t.active?"rgba(255, 255, 255, 1)":"rgba(40, 90, 90, 1)",c.ctx.fillText(t.name,h+e/2,n+s/2),w.addEventListener("touchstart",t.event,{ifTouchCover:{x:h,y:n,width:e,height:s},stop:!0,priority:900})}))),c.ctx.globalAlpha=1;const t={y:c.height-this.visibleTime-12,width:180,height:2,radius:1};t.x=(c.width-t.width)/2,l(t),c.ctx.fillStyle=`rgba(${Math.ceil(255-this.visibleTime/this.maxVisibleTime*255)}, ${Math.ceil(255-this.visibleTime/this.maxVisibleTime*255)}, ${Math.ceil(255-this.visibleTime/this.maxVisibleTime*255)}, 1)`,c.ctx.fill(),c.ctx.restore(),w.addEventListener("touchstart",(()=>this.visible=!1),{priority:898}),w.addEventListener("touchstart",(()=>this.visible=!this.visible),{ifTouchCover:{...t,y:t.y-4,height:t.height+8},stop:!0,priority:899})}}class F{constructor(){this.showIf,this.touchEvent=new Function,this.touchEventPriority=100,this.alphaTime=0,this.alphaTimeSpeed=1/32,this.text,this.textOffsetY=0,this.textTextAlign="center"}render(){if(this.showIf&&this.alphaTime<1&&(this.alphaTime=h(this.alphaTime+this.alphaTimeSpeed)),!this.showIf&&this.alphaTime>0&&(this.alphaTime=h(this.alphaTime-this.alphaTimeSpeed)),c.ctx.save(),c.ctx.globalAlpha=.5*this.alphaTime,u({x:0,y:0,width:c.width,height:c.height}),c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fill(),this.text&&"object"==typeof this.text){c.ctx.globalAlpha=1*this.alphaTime;const[t,...i]=this.text;c.ctx.fillStyle="rgba(255, 255, 255, 1)",l({x:(c.width-240)/2,y:c.height/2-1+this.textOffsetY,width:240,height:2,radius:2}),c.ctx.fill(),c.ctx.textAlign="center",c.ctx.textBaseline="middle",c.ctx.font="900 14px courier",c.ctx.fillText(t,c.width/2,c.height/2-24+this.textOffsetY),c.ctx.font="900 12px courier",i.forEach(((t,i)=>{c.ctx.textAlign=this.textTextAlign,"left"===this.textTextAlign&&c.ctx.fillText(t,(c.width-240)/2+24,c.height/2+24*(i+1)+this.textOffsetY),"center"===this.textTextAlign&&c.ctx.fillText(t,c.width/2,c.height/2+24*(i+1)+this.textOffsetY)}))}c.ctx.restore(),this.alphaTime>0&&w.addEventListener("touchstart",this.touchEvent,{stop:!0,priority:this.touchEventPriority})}}class X{constructor(){this.x,this.y,this.width,this.height,this.witch,this.previous,this.next,this.mouseDownPosition=null,this.rotateTime=0,this.offsetYTime=0,this.previousFadeTime=0,this.restoreStatus,this.useEvent=new Function}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateTime(){return this.width/4}get maxOffsetYTime(){return this.height/4}get skillDescriptionHeight(){var t;if(this.rotateTime>0&&(t=this.witch.skill[0]),this.rotateTime<0&&(t=this.witch.skill[1]),!t)return 0;c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`;const i=d({width:.9*this.width,text:t.description,onlyread:!0});return(.06*this.width*(i-1)+.08*this.width)*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1)}get characteristicDescriptionHeight(){if(this.offsetYTime<=0)return 0;const t=d({width:.9*this.width,text:this.witch.characteristic[0].description,onlyread:!0}),i=d({width:.9*this.width,text:this.witch.characteristic[1].description,onlyread:!0});return(.02*this.width+.06*this.width*(t-1)+.06*this.width*i+.04*this.width)*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1)}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.rotateTime===this.maxRotateTime&&this.useEvent("right"),this.rotateTime===-this.maxRotateTime&&this.useEvent("left"),this.offsetYTime===this.maxOffsetYTime&&this.useEvent("bottom"),this.offsetYTime===-this.maxOffsetYTime&&this.useEvent("top"),this.mouseDownPosition=null,this.restoreStatus=null}eventMove(t){if(!this.mouseDownPosition)return;const i=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],e=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+i,this.mouseDownPosition[1]+e];const s=this.rotateTime+i,h=this.offsetYTime+e;return Math.abs(i)>Math.abs(e)&&Math.abs(s)>2&&(this.restoreStatus="rotate"),Math.abs(i)<Math.abs(e)&&Math.abs(h)>2&&(this.restoreStatus="offsetY"),"rotate"===this.restoreStatus?(this.rotateTime=s,s>this.maxRotateTime&&(this.rotateTime=this.maxRotateTime),void(s<-this.maxRotateTime&&(this.rotateTime=-this.maxRotateTime))):"offsetY"===this.restoreStatus?(this.offsetYTime=h,h>this.maxOffsetYTime&&(this.offsetYTime=this.maxOffsetYTime),void(h<-this.maxOffsetYTime&&(this.offsetYTime=-this.maxOffsetYTime))):void 0}render(){if("rotate"!==this.restoreStatus){const t=16;this.rotateTime<0&&(this.rotateTime=this.rotateTime/t<-this.minDiff?this.rotateTime-this.rotateTime/t:0),this.rotateTime>0&&(this.rotateTime=this.rotateTime/t>this.minDiff?this.rotateTime-this.rotateTime/t:0)}if("offsetY"!==this.restoreStatus){const t=16;this.offsetYTime<0&&(this.offsetYTime=this.offsetYTime/t<-this.minDiff?this.offsetYTime-this.offsetYTime/t:0),this.offsetYTime>0&&(this.offsetYTime=this.offsetYTime/t>this.minDiff?this.offsetYTime-this.offsetYTime/t:0)}if(this.previousFadeTime<1&&(this.previousFadeTime=h(this.previousFadeTime+.02)),c.ctx.save(),l({...this.option,radius:8}),c.ctx.fillStyle="rgba(40, 90, 90, 1)",c.ctx.fill(),0!==this.rotateTime){var i;this.rotateTime>0&&(i=this.witch.skill[0]),this.rotateTime<0&&(i=this.witch.skill[1]),c.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)";const t=[i.name,i.type];this.rotateTime>0&&(c.ctx.textAlign="start",c.ctx.textBaseline="top",t.forEach(((t,i)=>{l({x:this.x+.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(t,this.x+.07*this.width,this.y+.045*this.width+i*this.width*.08)})),c.ctx.textBaseline="bottom",l({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("使用",this.x+.07*this.width,this.y+this.height-.045*this.width),c.ctx.textAlign="center",d({x:this.x+this.width/2,y:this.y+this.height+.04*this.width+.04*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`切换 / ${this.next[0].name}`})),this.rotateTime<0&&(c.ctx.textAlign="end",c.ctx.textBaseline="top",t.forEach(((t,i)=>{l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(t,this.x+this.width-.07*this.width,this.y+.045*this.width+i*this.width*.08)})),c.ctx.textBaseline="bottom",l({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("使用",this.x+this.width-.07*this.width,this.y+this.height-.045*this.width),c.ctx.textAlign="center",d({x:this.x+this.width/2,y:this.y+this.height+.04*this.width+.04*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`切换 / ${this.next[1].name}`})),c.ctx.textBaseline="bottom",c.ctx.textAlign="center";const e=d({width:.9*this.width,text:i.description,onlyread:!0});d({x:this.x+this.width/2,y:this.y-.06*this.width*(e-1)-.08*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:i.description})}if(this.offsetYTime<0&&(c.ctx.globalAlpha=Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),c.ctx.textBaseline="bottom",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.textAlign="start",l({x:this.x+.04*this.width,y:this.y+this.height-.17*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`Exp ${Math.ceil(this.witch.exp)} / ${100*Math.pow(2,this.witch.level)}`,this.x+.07*this.width,this.y+this.height-.125*this.width),l({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`Lv ${Math.ceil(this.witch.level)}`,this.x+.07*this.width,this.y+this.height-.045*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("升级",this.x+this.width-.07*this.width,this.y+this.height-.045*this.width)),this.offsetYTime>0){c.ctx.globalAlpha=Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.textAlign="start",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`${this.witch.characteristic[0].name} ${t(this.witch.characteristic[0].level)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`${this.witch.characteristic[1].name} ${t(this.witch.characteristic[1].level)}`,this.x+.07*this.width,this.y+.125*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("重生",this.x+this.width-.07*this.width,this.y+.045*this.width),c.ctx.textBaseline="bottom",c.ctx.textAlign="start";const i=d({width:.9*this.width,text:this.witch.characteristic[0].description,onlyread:!0});d({x:this.x+.05*this.width,y:this.y-.06*this.width*(i-1)-.04*this.width*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`${this.witch.characteristic[0].name} ${t(this.witch.characteristic[0].level)} : ${this.witch.characteristic[0].description}`});const e=d({width:.9*this.width,text:this.witch.characteristic[1].description,onlyread:!0});d({x:this.x+.05*this.width,y:this.y-.02*this.width-.06*this.width*(i-1)-.06*this.width*e-.04*this.width*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`${this.witch.characteristic[1].name} ${t(this.witch.characteristic[1].level)} : ${this.witch.characteristic[1].description}`})}c.ctx.translate(this.x+.5*this.width,this.y+2*this.height),c.ctx.rotate(this.rotateTime/400),c.ctx.translate(0,this.offsetYTime),c.ctx.translate(-(this.x+.5*this.width),-(this.y+2*this.height)),l({...this.option,radius:8}),c.ctx.clip(),c.ctx.globalAlpha=1,c.ctx.fillStyle="rgba(40, 40, 90, 1)",c.ctx.fill(),c.ctx.globalAlpha=Math.min((this.maxRotateTime-Math.abs(this.rotateTime))/this.maxRotateTime,1),u({...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),r(this.witch.imageDOM,{...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`清醒 ${Math.ceil(this.witch.purity)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`理性 ${Math.ceil(this.witch.rational)}`,this.x+.07*this.width,this.y+.125*this.width),l({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`感性 ${Math.ceil(this.witch.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.witch.name,this.x+this.width-.07*this.width,this.y+.045*this.width),l({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.witch.type,this.x+this.width-.07*this.width,this.y+.125*this.width),this.previousFadeTime<1&&this.previous&&(c.ctx.globalAlpha=1-this.previousFadeTime,r(this.previous.imageDOM,{...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`清醒 ${Math.ceil(this.previous.purity)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`理性 ${Math.ceil(this.previous.rational)}`,this.x+.07*this.width,this.y+.125*this.width),l({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`感性 ${Math.ceil(this.previous.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.previous.name,this.x+this.width-.07*this.width,this.y+.045*this.width),l({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.previous.type,this.x+this.width-.07*this.width,this.y+.125*this.width)),i&&(c.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),r(i.imageDOM,this.option)),c.ctx.restore(),w.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),w.addEventListener("touchmove",this.eventMove.bind(this)),w.addEventListener("touchend",this.eventUp.bind(this))}}class V{constructor(){this.x,this.y,this.width,this.height,this.monster,this.skill,this.skillIf,this.skillTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get skillDescriptionHeight(){if(!this.skill)return 0;c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`;const t=d({width:.9*this.width,text:this.skill.description,onlyread:!0});return(.04*this.width+.06*this.width*t)*this.skillTime}render(){this.skillIf&&this.skillTime<1&&(this.skillTime=h(this.skillTime+.05)),!this.skillIf&&this.skillTime>0&&(this.skillTime=h(this.skillTime-.05)),c.ctx.save(),l({...this.option,radius:8}),c.ctx.fillStyle="rgba(90, 0, 40, 1)",c.ctx.fill(),u({...this.option,y:this.y+.12*this.width,height:this.height-.2*this.width}),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),r(this.monster.imageDOM,{...this.option,y:this.y+.12*this.width,height:this.height-.2*this.width}),c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.textAlign="start",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`污秽 ${Math.ceil(this.monster.dirty)}`,this.x+.07*this.width,this.y+.045*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.monster.name,this.x+this.width-.07*this.width,this.y+.045*this.width),c.ctx.globalAlpha=this.skillTime,c.ctx.textAlign="center",d({x:this.x+this.width/2,y:this.y+this.height+.04*this.width*this.skillTime,width:.9*this.width,wrapSpace:.06*this.width,text:this.skill.description}),c.ctx.restore()}}const q=$(class{constructor(){this.InstanceNavigation=new B,this.InstanceNavigation.content=[{name:"战斗",active:!0},{name:"仓库",event:()=>y.state.page.current="store"}],this.InstanceMask=new F,this.InstanceWitch=new X,this.InstanceWitch.width=Math.min(.75*c.width,.75*c.maxWidth),this.InstanceWitch.height=Math.min(.75*c.width,.75*c.maxWidth),this.InstanceWitch.x=.5*(c.width-this.InstanceWitch.width),this.InstanceWitch.y=c.height/2,this.InstanceMonster=new V,this.InstanceMonster.width=Math.min(.75*c.width,.75*c.maxWidth),this.InstanceMonster.height=Math.min(.6*c.width,.6*c.maxWidth),this.InstanceMonster.x=.5*(c.width-this.InstanceWitch.width),this.InstanceMonster.y=c.height/2-this.InstanceMonster.height,this.init()}async init(){this.team=C(y.state.info.team.map((t=>y.state.info.library.find((i=>i.key===t.key))))),this.monster=Y.map((t=>({...t,level:0}))).reduce(((t,i)=>{const e=[...t],s={...Y.find((t=>i.key===t.key)),...i};return s.dirty=s.dirty*Math.pow(1.2,i.level),s.dirty_=s.dirty,s.buff=[],s.buff_=[],s.characteristic=R(s.characteristic),s.characteristic.forEach((t=>t.function(t,s))),e.push(s),e}),[]),this.InstanceMonster.monster=o(this.monster,1)[0],this.InstanceMask.showIf=!1,this.InstanceWitch.showIf=!1,this.round()}async round(t){t&&(this.InstanceWitch.previous=this.InstanceWitch.witch,this.InstanceWitch.witch=t,this.InstanceWitch.previousFadeTime=0),t||(this.InstanceWitch.witch=o(this.team,1)[0]),1===this.team.length&&(this.InstanceWitch.next=[this.team[0],this.team[0]]),2===this.team.length&&(this.InstanceWitch.next=[this.team.filter((t=>t.key!==this.InstanceWitch.witch.key))[0],this.team.filter((t=>t.key!==this.InstanceWitch.witch.key))[0]]),this.team.length>2&&(this.InstanceWitch.next=o(this.team.filter((t=>t.key!==this.InstanceWitch.witch.key)),2)),this.InstanceMonster.skill=o(this.InstanceMonster.monster.skill,1)[0],this.InstanceMonster.skillIf=!0,this.InstanceWitch.useEvent=async t=>{var i,e;return"right"===t&&(i=this.InstanceWitch.witch.skill[0],e=this.InstanceWitch.next[0]),"left"===t&&(i=this.InstanceWitch.witch.skill[1],e=this.InstanceWitch.next[1]),this.InstanceMask.showIf=!0,this.InstanceMask.text=["战斗中",`${this.InstanceWitch.witch.name} 使用 ${i.name}`],await s(64),this.InstanceMonster.skillIf=!1,this.InstanceMask.showIf=!1,await s(32),this.InstanceMask.showIf=!0,this.InstanceMask.text=["战斗中"],await this.compute(this.InstanceWitch.witch,this.InstanceMonster.monster,i,this.InstanceMonster.skill),await s(64),0===this.InstanceMonster.monster.dirty?(this.InstanceMask.showIf=!1,await s(32),this.InstanceMask.showIf=!0,this.InstanceMask.text=["战斗胜利","点击任意处 重新战斗"],this.InstanceMask.touchEvent=()=>{this.InstanceMask.showIf=!1,this.InstanceMask.touchEvent=null,this.init()},void this.computeReward()):(this.team=this.team.filter((t=>t.purity>0)),0===this.team.length?(this.InstanceMask.showIf=!1,await s(32),this.InstanceMask.showIf=!0,this.InstanceMask.text=["战斗失败","点击任意处 继续战斗"],void(this.InstanceMask.touchEvent=()=>{this.InstanceMask.showIf=!1,this.InstanceMask.touchEvent=null,this.init()})):(this.InstanceMask.touchEvent=async()=>{this.InstanceMask.touchEvent=()=>{this.InstanceMask.showIf=!1,this.InstanceMask.touchEvent=null},this.InstanceMask.showIf=!1,await s(32),null!==this.InstanceMask.touchEvent&&(this.InstanceMask.showIf=!0,this.InstanceMask.text=["战斗中",`切换 / ${this.InstanceWitch.witch.name} -> ${e.name}`])},await s(64),void await this.round(e)))}}async compute(t,i,e,s){const h=e.function(t,i,this.team);for(;h.length;){const t=h.shift(),i=i=>{const e={...t,target:i};e.target.buff.forEach((t=>t.value(e))),"Cure"===e.effect&&n(Math.min(e.value,e.target.purity_-e.target.purity),32,(t=>e.target.purity=e.target.purity+t)),"Damage-Dirty"===e.effect&&(this.InstanceMask.text.push(`${e.target.name} 受到伤害 ${Math.ceil(Math.min(e.value,e.target.dirty))}`),n(Math.min(e.value,e.target.dirty),32,(t=>e.target.dirty=e.target.dirty-t))),"Buff"===e.effect&&e.target.buff.push(e),"Improve-Rational"===e.effect&&n(e.value,32,(t=>e.target.rational=e.target.rational+t))};t.target.forEach((t=>i(t)))}const o=s.function(i,t,this.team);for(;o.length;){const t=o.shift(),i=i=>{const e={...t,target:i};e.target.buff.forEach((t=>t.value(e))),"Cure"===e.effect&&n(Math.min(e.value,e.target.dirty_-e.target.dirty),32,(t=>e.target.dirty=e.target.dirty+t)),"Damage-Purity"===e.effect&&(this.InstanceMask.text.push(`${e.target.name} 受到伤害 ${Math.ceil(Math.min(e.value,e.target.purity))}`),n(Math.min(e.value,e.target.purity),32,(t=>e.target.purity=e.target.purity-t)))};t.target.forEach((t=>i(t)))}new Array(...this.team,i).forEach((t=>{t.buff.forEach((i=>{i.time=i.time-1,0===i.time&&(t.buff=t.buff.filter((t=>t!==i)))}))}))}computeReward(){this.InstanceMonster.monster.reward.forEach((t=>{"exp"===t.type&&y.state.info.team.forEach((i=>{const e=y.state.info.library.find((t=>t.key===i.key));e.exp=e.exp+t.vlaue,y.state.setInfo()}))}))}render(){this.InstanceMonster.y=c.height/2-1.1*this.InstanceMonster.height-this.InstanceMonster.skillDescriptionHeight-this.InstanceWitch.skillDescriptionHeight-this.InstanceWitch.characteristicDescriptionHeight,this.InstanceMonster.render(),this.InstanceWitch.render(),this.InstanceMask.render(),this.InstanceNavigation.render()}});class U{constructor(){this.x,this.y,this.width,this.height,this.contentWidth=null,this.contentHeight=null,this.scrollPosition=[0,0],this.mouseDownPosition=null,this.stickTime=[0,0],this.stickTimeOut=null}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}eventDown(t){this.stickTime=[0,0],this.stickTimeOut=null;try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null,clearTimeout(this.stickTimeOut),this.stickTimeOut=null}eventMove(t){if(!this.mouseDownPosition)return;const i=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],e=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+i,this.mouseDownPosition[1]+e];var s=this.scrollPosition[0]-i,h=this.scrollPosition[1]-e;this.contentWidth||(s=this.scrollPosition[0]),this.contentHeight||(h=this.scrollPosition[1]),this.scrollPosition=[s,h],s=this.stickTime[0]-i,h=this.stickTime[1]-e,this.contentWidth||(s=this.stickTime[0]),this.contentHeight||(h=this.stickTime[1]),this.stickTime=[s,h],this.stickTimeOut||(this.stickTimeOut=setTimeout((()=>this.stickTime=[0,0]),200))}render(t){if(!this.mouseDownPosition){const t=16;this.scrollPosition[0]<0&&(this.scrollPosition[0]=this.scrollPosition[0]/t<-this.minDiff?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.scrollPosition[1]<0&&(this.scrollPosition[1]=this.scrollPosition[1]/t<-this.minDiff?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.scrollPosition[0]>0&&((this.contentWidth-this.width<0||this.contentWidth-this.width==0)&&(this.scrollPosition[0]=this.scrollPosition[0]/t>this.minDiff?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.contentWidth-this.width>0&&this.scrollPosition[0]>this.contentWidth-this.width&&(this.scrollPosition[0]=(this.scrollPosition[0]-(this.contentWidth-this.width))/t>this.minDiff?this.scrollPosition[0]-(this.scrollPosition[0]-(this.contentWidth-this.width))/t:this.contentWidth-this.width)),this.scrollPosition[1]>0&&((this.contentHeight-this.height<0||this.contentHeight-this.height==0)&&(this.scrollPosition[1]=this.scrollPosition[1]/t>this.minDiff?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.contentHeight-this.height>0&&this.scrollPosition[1]>this.contentHeight-this.height&&(this.scrollPosition[1]=(this.scrollPosition[1]-(this.contentHeight-this.height))/t>this.minDiff?this.scrollPosition[1]-(this.scrollPosition[1]-(this.contentHeight-this.height))/t:this.contentHeight-this.height))}if(!this.mouseDownPosition){const t=16;if(this.stickTime[0]>0){const i=this.stickTime[0]/t>this.minDiff?this.stickTime[0]/t:0;this.scrollPosition[0]=this.scrollPosition[0]+i,this.stickTime[0]=this.stickTime[0]-i}if(this.stickTime[0]<0){const i=this.stickTime[0]/t<-this.minDiff?this.stickTime[0]/t:0;this.scrollPosition[0]=this.scrollPosition[0]+i,this.stickTime[0]=this.stickTime[0]-i}if(this.stickTime[1]>0){const i=this.stickTime[1]/t>this.minDiff?this.stickTime[1]/t:0;this.scrollPosition[1]=this.scrollPosition[1]+i,this.stickTime[1]=this.stickTime[1]-i}if(this.stickTime[1]<0){const i=this.stickTime[1]/t<-this.minDiff?this.stickTime[1]/t:0;this.scrollPosition[1]=this.scrollPosition[1]+i,this.stickTime[1]=this.stickTime[1]-i}}c.ctx.save();const i={x:this.x,y:this.y,width:this.width,height:this.height};u(i),c.ctx.clip(),t(this.scrollPosition),c.ctx.restore(),w.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:i}),w.addEventListener("touchmove",this.eventMove.bind(this)),w.addEventListener("touchend",this.eventUp.bind(this))}}class G{constructor(){this.x,this.y,this.width,this.height,this.offsetX=0,this.offsetY=0,this.activeIf,this.activeTime=0,this.witch,this.touchEvent=null,this.touchArea=null,this.touchTimeout=null}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!a(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}render(){this.activeIf&&this.activeTime<1&&(this.activeTime=h(this.activeTime+.05)),!this.activeIf&&this.activeTime>0&&(this.activeTime=h(this.activeTime-.05));const{x:t,y:i,width:e,height:s}=this.option;c.ctx.save(),l({x:t,y:i,width:e,height:s,radius:4}),c.ctx.fillStyle="rgba(40, 40, 90, 1)",c.ctx.fill(),c.ctx.clip(),u({x:t,y:this.y+.15*this.height*(1-this.activeTime),width:e,height:this.height-.3*this.height*(1-this.activeTime)}),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),r(this.witch.imageDOM,{...this.option,y:this.y+.2*this.height*(1-this.activeTime),height:this.height-.4*this.height*(1-this.activeTime)}),this.witch.inTeam&&(l({x:t+.05*s,y:i+.05*s,width:.05*s,height:.05*s,radius:.05*s/2}),c.ctx.fillStyle="rgba(0, 0, 0, 1)",c.ctx.fill()),c.ctx.restore(),w.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),w.addEventListener("touchmove",this.eventMove.bind(this)),w.addEventListener("touchend",this.eventUp.bind(this))}}class Q{constructor(){this.x,this.y,this.width,this.height,this.witch,this.active,this.touchEvent,this.InstanceScroll=new U,this.InstanceWitch=[]}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}load(){this.witch=C(y.state.info.library).map((t=>(t.inTeam=y.state.info.team.find((i=>i.key===t.key)),t))).sort(((t,i)=>t.key-i.key)).sort(((t,i)=>{const e=t.inTeam?1:0;return(i.inTeam?1:0)-e}))}init(){this.InstanceScroll.x=this.x,this.InstanceScroll.y=this.y,this.InstanceScroll.width=this.width,this.InstanceScroll.height=this.height,this.InstanceScroll.contentWidth=(.65*this.height+.05*this.height)*this.witch.length-.05*this.height,this.InstanceWitch=this.witch.map(((t,i)=>{const e=new G;return e.width=.65*this.height,e.height=this.height,e.x=this.x+i*(e.width+.05*this.height),e.y=this.y,e.witch=t,e.touchAble=!0,e.touchArea=this.InstanceScroll.option,e.touchEvent=()=>this.touchEvent(t),e}))}render(){this.InstanceScroll.render((t=>{this.InstanceWitch.forEach((i=>{i.offsetX=0-t[0],((t,i)=>{const{x:e,y:s,width:h,height:n}=t,{x:o,y:a,width:c,height:r}=i;return e+h>o&&e<o+c&&s+n>a&&s<a+r})(i.option,this.InstanceScroll.option)&&i.render()}))}))}}class z{constructor(){this.x,this.y,this.width,this.height,this.witch,this.previous,this.mouseDownPosition=null,this.rotateTime=0,this.offsetYTime=0,this.previousFadeTime=0,this.restoreStatus,this.useEvent=new Function}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get minDiff(){return.01}get maxRotateTime(){return this.width/4}get maxOffsetYTime(){return this.height/4}get skillDescriptionHeight(){var t;if(this.rotateTime>0&&(t=this.witch.skill[0]),this.rotateTime<0&&(t=this.witch.skill[1]),!t)return 0;c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`;const i=d({width:.9*this.width,text:t.description,onlyread:!0});return(.06*this.width*(i-1)+.08*this.width)*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1)}get characteristicDescriptionHeight(){if(this.offsetYTime<=0)return 0;const t=d({width:.9*this.width,text:this.witch.characteristic[0].description,onlyread:!0}),i=d({width:.9*this.width,text:this.witch.characteristic[1].description,onlyread:!0});return(.02*this.width+.06*this.width*(t-1)+.06*this.width*i+.04*this.width)*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1)}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.rotateTime===this.maxRotateTime&&this.useEvent("right"),this.rotateTime===-this.maxRotateTime&&this.useEvent("left"),this.offsetYTime===this.maxOffsetYTime&&this.useEvent("bottom"),this.offsetYTime===-this.maxOffsetYTime&&this.useEvent("top"),this.mouseDownPosition=null,this.restoreStatus=null}eventMove(t){if(!this.mouseDownPosition)return;const i=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],e=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+i,this.mouseDownPosition[1]+e];const s=this.rotateTime+i,h=this.offsetYTime+e;return Math.abs(i)>Math.abs(e)&&Math.abs(s)>2&&(this.restoreStatus="rotate"),Math.abs(i)<Math.abs(e)&&Math.abs(h)>2&&(this.restoreStatus="offsetY"),"rotate"===this.restoreStatus?(this.rotateTime=s,s>this.maxRotateTime&&(this.rotateTime=this.maxRotateTime),void(s<-this.maxRotateTime&&(this.rotateTime=-this.maxRotateTime))):"offsetY"===this.restoreStatus?(this.offsetYTime=h,h>this.maxOffsetYTime&&(this.offsetYTime=this.maxOffsetYTime),void(h<-this.maxOffsetYTime&&(this.offsetYTime=-this.maxOffsetYTime))):void 0}render(){if("rotate"!==this.restoreStatus){const t=16;this.rotateTime<0&&(this.rotateTime=this.rotateTime/t<-this.minDiff?this.rotateTime-this.rotateTime/t:0),this.rotateTime>0&&(this.rotateTime=this.rotateTime/t>this.minDiff?this.rotateTime-this.rotateTime/t:0)}if("offsetY"!==this.restoreStatus){const t=16;this.offsetYTime<0&&(this.offsetYTime=this.offsetYTime/t<-this.minDiff?this.offsetYTime-this.offsetYTime/t:0),this.offsetYTime>0&&(this.offsetYTime=this.offsetYTime/t>this.minDiff?this.offsetYTime-this.offsetYTime/t:0)}if(this.previousFadeTime<1&&(this.previousFadeTime=h(this.previousFadeTime+.02)),c.ctx.save(),l({...this.option,radius:8}),c.ctx.fillStyle="rgba(40, 90, 90, 1)",c.ctx.fill(),0!==this.rotateTime){var i;this.rotateTime>0&&(i=this.witch.skill[0]),this.rotateTime<0&&(i=this.witch.skill[1]),c.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)";const t=[i.name,i.type];this.rotateTime>0&&(c.ctx.textAlign="start",c.ctx.textBaseline="top",t.forEach(((t,i)=>{l({x:this.x+.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(t,this.x+.07*this.width,this.y+.045*this.width+i*this.width*.08)})),c.ctx.textBaseline="bottom",l({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("装载",this.x+.07*this.width,this.y+this.height-.045*this.width)),this.rotateTime<0&&(c.ctx.textAlign="end",c.ctx.textBaseline="top",t.forEach(((t,i)=>{l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width+i*this.width*.08,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(t,this.x+this.width-.07*this.width,this.y+.045*this.width+i*this.width*.08)})),c.ctx.textBaseline="bottom",l({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("卸载",this.x+this.width-.07*this.width,this.y+this.height-.045*this.width)),c.ctx.textBaseline="bottom",c.ctx.textAlign="center";const e=d({width:.9*this.width,text:i.description,onlyread:!0});d({x:this.x+this.width/2,y:this.y-.06*this.width*(e-1)-.08*this.width*Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:i.description})}if(this.offsetYTime<0&&(c.ctx.globalAlpha=Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),c.ctx.textBaseline="bottom",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.textAlign="start",l({x:this.x+.04*this.width,y:this.y+this.height-.17*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`Exp ${Math.ceil(this.witch.exp)} / ${100*Math.pow(2,this.witch.level)}`,this.x+.07*this.width,this.y+this.height-.125*this.width),l({x:this.x+.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`Lv ${Math.ceil(this.witch.level)}`,this.x+.07*this.width,this.y+this.height-.045*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+this.height-.09*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("升级",this.x+this.width-.07*this.width,this.y+this.height-.045*this.width)),this.offsetYTime>0){c.ctx.globalAlpha=Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.textAlign="start",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`${this.witch.characteristic[0].name} ${t(this.witch.characteristic[0].level)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`${this.witch.characteristic[1].name} ${t(this.witch.characteristic[1].level)}`,this.x+.07*this.width,this.y+.125*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText("重生",this.x+this.width-.07*this.width,this.y+.045*this.width),c.ctx.textBaseline="bottom",c.ctx.textAlign="start";const i=d({width:.9*this.width,text:this.witch.characteristic[0].description,onlyread:!0});d({x:this.x+.05*this.width,y:this.y-.06*this.width*(i-1)-.04*this.width*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`${this.witch.characteristic[0].name} ${t(this.witch.characteristic[0].level)} : ${this.witch.characteristic[0].description}`});const e=d({width:.9*this.width,text:this.witch.characteristic[1].description,onlyread:!0});d({x:this.x+.05*this.width,y:this.y-.02*this.width-.06*this.width*(i-1)-.06*this.width*e-.04*this.width*Math.min(Math.abs(this.offsetYTime)/this.maxOffsetYTime,1),width:.9*this.width,wrapSpace:.06*this.width,text:`${this.witch.characteristic[1].name} ${t(this.witch.characteristic[1].level)} : ${this.witch.characteristic[1].description}`})}c.ctx.translate(this.x+.5*this.width,this.y+2*this.height),c.ctx.rotate(this.rotateTime/400),c.ctx.translate(0,this.offsetYTime),c.ctx.translate(-(this.x+.5*this.width),-(this.y+2*this.height)),l({...this.option,radius:8}),c.ctx.clip(),c.ctx.globalAlpha=1,c.ctx.fillStyle="rgba(40, 40, 90, 1)",c.ctx.fill(),c.ctx.globalAlpha=Math.min((this.maxRotateTime-Math.abs(this.rotateTime))/this.maxRotateTime,1),u({...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.fillStyle="rgba(255, 255, 255, 1)",c.ctx.fill(),r(this.witch.imageDOM,{...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`清醒 ${Math.ceil(this.witch.purity)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`理性 ${Math.ceil(this.witch.rational)}`,this.x+.07*this.width,this.y+.125*this.width),l({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`感性 ${Math.ceil(this.witch.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.witch.name,this.x+this.width-.07*this.width,this.y+.045*this.width),l({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.witch.type,this.x+this.width-.07*this.width,this.y+.125*this.width),this.previousFadeTime<1&&this.previous&&(c.ctx.globalAlpha=1-this.previousFadeTime,r(this.previous.imageDOM,{...this.option,y:this.y+.28*this.width,height:this.height-.36*this.width}),c.ctx.textAlign="start",c.ctx.textBaseline="top",c.ctx.font=`900 ${.04*this.width}px courier`,c.ctx.fillStyle="rgba(255, 255, 255, 1)",l({x:this.x+.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`清醒 ${Math.ceil(this.previous.purity)}`,this.x+.07*this.width,this.y+.045*this.width),l({x:this.x+.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`理性 ${Math.ceil(this.previous.rational)}`,this.x+.07*this.width,this.y+.125*this.width),l({x:this.x+.04*this.width,y:this.y+.2*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(`感性 ${Math.ceil(this.previous.perceptual)}`,this.x+.07*this.width,this.y+.205*this.width),c.ctx.textAlign="end",l({x:this.x+this.width-.04*this.width,y:this.y+.04*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.previous.name,this.x+this.width-.07*this.width,this.y+.045*this.width),l({x:this.x+this.width-.04*this.width,y:this.y+.12*this.width,width:2,height:.05*this.width,radius:1}),c.ctx.fill(),c.ctx.fillText(this.previous.type,this.x+this.width-.07*this.width,this.y+.125*this.width)),i&&(c.ctx.globalAlpha=Math.min(Math.abs(this.rotateTime)/this.maxRotateTime,1),r(i.imageDOM,this.option)),c.ctx.restore(),w.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),w.addEventListener("touchmove",this.eventMove.bind(this)),w.addEventListener("touchend",this.eventUp.bind(this))}}const K=$(class{constructor(){this.InstanceNavigation=new B,this.InstanceNavigation.content=[{name:"战斗",event:()=>y.state.page.current="pve"},{name:"仓库",active:!0}],this.InstanceMask=new F,this.InstanceList=new Q,this.InstanceList.width=Math.min(c.width-24,1080),this.InstanceList.height=Math.min(.5*c.width,.5*c.maxWidth),this.InstanceList.x=(c.width-this.InstanceList.width)/2,this.InstanceList.y=12+c.safeArea.top,this.InstanceList.load(),this.InstanceList.init(),this.InstanceList.touchEvent=t=>{this.InstanceWitch.witch!==t&&(this.InstanceWitch.previous=this.InstanceWitch.witch,this.InstanceWitch.witch=t,this.InstanceWitch.previousFadeTime=0,this.InstanceList.InstanceWitch.forEach((i=>i.activeIf=i.witch===t)))},this.InstanceList.InstanceWitch.forEach((t=>t.activeIf=t.witch.key===this.InstanceList.witch[0].key)),this.InstanceWitch=new z,this.InstanceWitch.width=Math.min(.75*c.width,.75*c.maxWidth),this.InstanceWitch.height=Math.min(.75*c.width,.75*c.maxWidth),this.InstanceWitch.x=.5*(c.width-this.InstanceWitch.width),this.InstanceWitch.y=c.height/2-.05*this.InstanceWitch.height,this.InstanceWitch.useEvent=async i=>{if("left"===i&&(y.state.info.team=y.state.info.team.filter((t=>t.key!==this.InstanceWitch.witch.key)),g.play("卸载成功")),"right"===i){if(4===y.state.info.team.length)return void g.play("装载失败 超过最大数量");if(y.state.info.team.find((t=>t.key===this.InstanceWitch.witch.key)))return void g.play("已装载");y.state.info.team.push({key:this.InstanceWitch.witch.key}),g.play("装载成功")}if("top"===i){if(this.InstanceWitch.witch.exp<100*Math.pow(2,this.InstanceWitch.witch.level))return void g.play("升级失败 经验值不足"+100*Math.pow(2,this.InstanceWitch.witch.level));const t={...this.InstanceWitch.witch},i=y.state.info.library.find((t=>t.key===this.InstanceWitch.witch.key));i.exp=i.exp-100*Math.pow(2,i.level),i.level=i.level+1,this.InstanceWitch.witch=C([i])[0],this.InstanceMask.showIf=!0,this.InstanceMask.textTextAlign="left",this.InstanceMask.text=["等级提升",`等级 ${Math.ceil(t.level)} -> ${Math.ceil(this.InstanceWitch.witch.level)}`,`经验 ${Math.ceil(t.exp)} -> ${Math.ceil(this.InstanceWitch.witch.exp)}`,`清醒 ${Math.ceil(t.purity)} -> ${Math.ceil(this.InstanceWitch.witch.purity)}`,`理性 ${Math.ceil(t.rational)} -> ${Math.ceil(this.InstanceWitch.witch.rational)}`,`感性 ${Math.ceil(t.perceptual)} -> ${Math.ceil(this.InstanceWitch.witch.perceptual)}`],this.InstanceMask.touchEvent=()=>{this.InstanceMask.showIf=!1,this.InstanceMask.text=null,this.InstanceMask.touchEvent=null}}if("bottom"===i){if(this.InstanceWitch.witch.exp<100)return void g.play("升级失败 经验值不足 100");const i=o(N,2),e=()=>{var t=Math.random();return t<1&&t>.9999&&(t=8),t<1&&t>.999&&(t=7),t<1&&t>.995&&(t=6),t<1&&t>.98&&(t=5),t<1&&t>.94&&(t=4),t<1&&t>.86&&(t=3),t<1&&t>.6&&(t=2),t<1&&t>0&&(t=1),t};i[0].level=e(),i[1].level=e();const s={...this.InstanceWitch.witch},h=y.state.info.library.find((t=>t.key===this.InstanceWitch.witch.key));h.exp=h.exp-100,h.characteristic=[{key:i[0].key,level:i[0].level},{key:i[1].key,level:i[1].level}],this.InstanceWitch.witch=C([h])[0],this.InstanceMask.showIf=!0,this.InstanceMask.textTextAlign="left",this.InstanceMask.text=["性格重生",`${this.InstanceWitch.witch.characteristic[1].name} ${t(this.InstanceWitch.witch.characteristic[1].level)} : ${this.InstanceWitch.witch.characteristic[1].description}`,`${this.InstanceWitch.witch.characteristic[0].name} ${t(this.InstanceWitch.witch.characteristic[0].level)} : ${this.InstanceWitch.witch.characteristic[0].description}`,`经验 ${Math.ceil(s.exp)} -> ${Math.ceil(this.InstanceWitch.witch.exp)}`,`清醒 ${Math.ceil(s.purity)} -> ${Math.ceil(this.InstanceWitch.witch.purity)}`,`理性 ${Math.ceil(s.rational)} -> ${Math.ceil(this.InstanceWitch.witch.rational)}`,`感性 ${Math.ceil(s.perceptual)} -> ${Math.ceil(this.InstanceWitch.witch.perceptual)}`],this.InstanceMask.touchEvent=()=>{this.InstanceMask.showIf=!1,this.InstanceMask.text=null,this.InstanceMask.touchEvent=null}}this.InstanceList.load(),this.InstanceList.init(),this.InstanceList.InstanceWitch.forEach((t=>t.activeIf=t.witch.key===this.InstanceWitch.witch.key)),this.InstanceWitch.witch=this.InstanceList.witch.find((t=>t.key===this.InstanceWitch.witch.key)),y.state.setInfo()},this.InstanceWitch.witch=this.InstanceList.witch[0]}render(){this.InstanceList.render(),this.InstanceWitch.render(),this.InstanceMask.render(),this.InstanceNavigation.render()}});new class{constructor(){this.animationFrameId,this.instance,this.init(),this.loopStart()}render(){if(c.ctx.clearRect(0,0,c.width,c.height),w.clearEventListener(),"home"!==y.state.page&&y.state.loading)return;const t=y.state.page.map[y.state.page.current];t&&(this.instance instanceof t||(this.instance=new t),this.instance.render(),g.render(),f.render())}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}async init(){y.state={page:{current:i("path")?i("path"):"home",map:{home:H,pve:q,store:K}},info:null,setInfo:async()=>{localStorage.setItem("info",JSON.stringify(y.state.info))},getInfo:async()=>{localStorage.removeItem("info");const t=localStorage.getItem("info");if(t&&(y.state.info=JSON.parse(t)),!t){const t={library:j.map((t=>({key:t.key,level:0,exp:0,characteristic:[{key:1,level:1},{key:2,level:1}]}))),team:j.map((t=>({key:t.key}))).filter(((t,i)=>i<4))};y.state.info=t}},loading:!0,sound:{ifBackground:!1,ifSource:!1},cache:null},y.state.getInfo(),await Promise.all([W.load(),A.load(),f.load()]),L(),y.state.loading=!1}}})()})();