(()=>{var t={652:()=>{!function(){const t=canvas.width,e=canvas.height;canvas.width=Math.round(2*t),canvas.height=Math.round(2*e),canvas.style.width=t+"px",canvas.style.height=e+"px",window.dpr=2,canvas.getContext("2d").scale(2,2)}()},37:()=>{window.fontFamily="Courier"},70:()=>{!function(){try{wx}catch{return}!function(t){const e={};function i(n){if(e[n])return e[n].exports;const o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){n.addEventListener=n.canvas.addEventListener=function(t,e){n.document.addEventListener(t,e)},n.removeEventListener=n.canvas.removeEventListener=function(t,e){n.document.removeEventListener(t,e)};const t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(const t in n){const e=Object.getOwnPropertyDescriptor(o,t);e&&!0!==e.configurable||Object.defineProperty(window,t,{value:n[t]})}for(const t in n.document){const e=Object.getOwnPropertyDescriptor(o.document,t);e&&!0!==e.configurable||Object.defineProperty(o.document,t,{value:n.document[t]})}window.parent=window}else{for(const t in n)o[t]=n[t];o.window=n,window=o,window.top=window.parent=window}}())},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;const n=i(2);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));const o=i(3);Object.keys(o).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return o[t]}})}));const s=p(i(9)),a=p(i(10)),h=p(i(17)),r=p(i(18)),l=p(i(19)),c=p(i(11)),d=p(i(12)),f=p(i(20)),u=p(i(4)),w=p(i(21)),m=p(i(22));function p(t){return t&&t.__esModule?t:{default:t}}e.document=a.default,e.navigator=h.default,e.XMLHttpRequest=r.default,e.WebSocket=l.default,e.Image=c.default,e.Audio=d.default,e.FileReader=f.default,e.HTMLElement=u.default,e.localStorage=w.default,e.location=m.default;const g=new s.default;e.canvas=g,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=wx.getSystemInfoSync(),n=i.screenWidth,o=i.screenHeight,s=i.devicePixelRatio,a=e.innerWidth=n,h=e.innerHeight=o;e.devicePixelRatio=s,e.screen={availWidth:a,availHeight:h},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;const n=(o=i(4))&&o.__esModule?o:{default:o};var o;function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return h(e,t),e}(n.default),e.HTMLCanvasElement=function(t){function e(){return s(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return h(e,t),e}(n.default)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(s=i(5))&&s.__esModule?s:{default:s};var s;const a=i(8),h=i(2);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}const c=function(t){function e(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,e);const i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.className="",i.childern=[],i.style={width:`${h.innerWidth}px`,height:`${h.innerHeight}px`},i.insertBefore=a.noop,i.innerHTML="",i.tagName=t.toUpperCase(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:h.innerWidth,height:h.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){const t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){const t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}(o.default);e.default=c},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(6))&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var o;const s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){const t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){const e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),e}(((o=i(7))&&o.__esModule?o:{default:o}).default);e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let o=n.get(this);o||(o={},n.set(this,o)),o[t]||(o[t]=[]),o[t].push(e),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){const i=n.get(this)[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}}},{key:"dispatchEvent",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.get(this)[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}}]),t}();e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=wx.createCanvas();return t.type="canvas",t.__proto__.__proto__=new n.default("canvas"),t.getContext,t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t},i(3);const n=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}o(i(10))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=r(i(4)),s=r(i(11)),a=r(i(12)),h=r(i(9));function r(t){return t&&t.__esModule?t:{default:t}}i(15);const l={};var c={readyState:"complete",visibilityState:"visible",documentElement:n,hidden:!1,style:{},location:n.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new o.default("head"),body:new o.default("body"),createElement:function(t){return"canvas"===t?new h.default:"audio"===t?new a.default:"img"===t?new s.default:new o.default(t)},getElementById:function(t){return t===n.canvas.id?n.canvas:null},getElementsByTagName:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[n.canvas]:[]},querySelector:function(t){return"head"===t?c.head:"body"===t?c.body:"canvas"===t||t===`#${n.canvas.id}`?n.canvas:null},querySelectorAll:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[n.canvas]:[]},addEventListener:function(t,e){l[t]||(l[t]=[]),l[t].push(e)},removeEventListener:function(t,e){const i=l[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}},dispatchEvent:function(t){const e=l[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}};e.default=c},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=(s=i(13))&&s.__esModule?s:{default:s};var s;const a=new WeakMap,h=new WeakMap,r=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4,i.readyState=0,h.set(i,"");const n=wx.createInnerAudioContext();return a.set(i,n),n.onCanplay((function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=2})),n.onPlay((function(){i.dispatchEvent({type:"play"})})),n.onPause((function(){i.dispatchEvent({type:"pause"})})),n.onEnded((function(){i.dispatchEvent({type:"ended"}),i.readyState=4})),n.onError((function(){i.dispatchEvent({type:"error"})})),t&&(a.get(i).src=t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){a.get(this).play()}},{key:"pause",value:function(){a.get(this).pause()}},{key:"canPlayType",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){const t=new e;return t.loop=a.get(this).loop,t.autoplay=a.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return a.get(this).currentTime},set:function(t){a.get(this).seek(t)}},{key:"src",get:function(){return h.get(this)},set:function(t){h.set(this,t),a.get(this).src=t}},{key:"loop",get:function(){return a.get(this).loop},set:function(t){a.get(this).loop=t}},{key:"autoplay",get:function(){return a.get(this).autoplay},set:function(t){a.get(this).autoplay=t}},{key:"paused",get:function(){return a.get(this).paused}}]),e}(o.default));e.default=r},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(14))&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var o;const s=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}(((o=i(4))&&o.__esModule?o:{default:o}).default);e.default=s},function(t,e,i){i(16)},function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),o=(s=i(10))&&s.__esModule?s:{default:s};var s;const a=i(8),h=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=n.canvas,this.currentTarget=n.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=a.noop,this.stopPropagation=a.noop,this.type=e};function r(t){return function(e){const i=new h(t);i.touches=e.touches,i.targetTouches=Array.prototype.slice.call(e.touches),i.changedTouches=e.changedTouches,i.timeStamp=e.timeStamp,o.default.dispatchEvent(i)}}wx.onTouchStart(r("touchstart")),wx.onTouchMove(r("touchmove")),wx.onTouchEnd(r("touchend")),wx.onTouchCancel(r("touchcancel"))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),o={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:n.noop,watchPosition:n.noop,clearWatch:n.noop}};e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,h=new WeakMap;function r(t){if("function"==typeof this[`on${t}`]){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this[`on${t}`].apply(this,i)}}function l(t){this.readyState=t,r.call(this,"readystatechange")}const c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,s.set(this,{"content-type":"application/x-www-form-urlencoded"}),a.set(this,{})}return i(t,[{key:"abort",value:function(){const t=h.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){const t=a.get(this);return Object.keys(t).map((function(e){return`${e}: ${t[e]}`})).join("\n")}},{key:"getResponseHeader",value:function(t){return a.get(this)[t]}},{key:"open",value:function(e,i){o.set(this,e),n.set(this,i),l.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){const e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:i,url:n.get(this),method:o.get(this),header:s.get(this),responseType:this.responseType,success:function(i){let n=i.data;const o=i.statusCode,s=i.header;if("string"!=typeof n&&!(n instanceof ArrayBuffer))try{n=JSON.stringify(n)}catch(t){}if(e.status=o,a.set(e,s),r.call(e,"loadstart"),l.call(e,t.HEADERS_RECEIVED),l.call(e,t.LOADING),e.response=n,n instanceof ArrayBuffer){e.responseText="";const t=new Uint8Array(n),i=t.byteLength;for(let n=0;n<i;n++)e.responseText+=String.fromCharCode(t[n])}else e.responseText=n;l.call(e,t.DONE),r.call(e,"load"),r.call(e,"loadend")},fail:function(t){const i=t.errMsg;-1!==i.indexOf("abort")?r.call(e,"abort"):r.call(e,"error",i),r.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){const i=s.get(this);i[t]=e,s.set(this,i)}}]),t}();c.UNSEND=0,c.OPENED=1,c.HEADERS_RECEIVED=2,c.LOADING=3,c.DONE=4,e.default=c},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}const o=new WeakMap,s=function(){function t(e){const i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError(`Failed to construct 'WebSocket': The URL '${e}' is invalid`);this.url=e,this.readyState=t.CONNECTING;const a=wx.connectSocket({url:e,protocols:Array.isArray(s)?s:[s]});return o.set(this,a),a.onClose((function(e){i.readyState=t.CLOSED,"function"==typeof i.onclose&&i.onclose(e)})),a.onMessage((function(t){"function"==typeof i.onmessage&&i.onmessage(t)})),a.onOpen((function(){i.readyState=t.OPEN,"function"==typeof i.onopen&&i.onopen()})),a.onError((function(t){"function"==typeof i.onerror&&i.onerror(new Error(t.errMsg))})),this}return i(t,[{key:"close",value:function(e,i){this.readyState=t.CLOSING,o.get(this).close({code:e,reason:i})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError(`Failed to send message: The data ${t} is invalid`);o.get(this).send({data:t})}}]),t}();s.CONNECTING=0,s.OPEN=1,s.CLOSING=2,s.CLOSED=3,e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=i},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={href:"game.js",reload:function(){}}}])}()},293:()=>{!function(){try{if(wx)return}catch{}window.wx={_web:!0,getSystemInfoSync:()=>({safeArea:{top:0},windowWidth:document.querySelector("canvas").clientWidth,windowHeight:document.querySelector("canvas").clientHeight})};const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.background="black",void 0===window.ontouchstart&&(t.style["max-width"]=.5*window.document.documentElement.clientHeight+"px");const e=document.createElement("canvas");e.width=t.clientWidth,e.height=t.clientHeight,e.style.display="block",e.style.touchAction="none",t.appendChild(e),window.canvas=e}()},6:()=>{!function(){const t=Symbol("_Allow");function e(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function i(t){this.state=t,this.MonitorINS=new e(this)}e.prototype.dispatch=function(){this.monitorQueue.forEach(((e,i)=>{const n=this.dependentQueue[i],o=this.executeDependent(e.dependent);return o===t||Array.isArray(o)&&Array.isArray(n)&&(s=o,a=n,Array.isArray(s)&&Array.isArray(a)&&(s.length!==a.length||s.filter(((t,e)=>t===a[e])).length!==s.length))||!Array.isArray(o)&&!Array.isArray(n)&o!==n?(this.executeEvent(e.event),void(this.dependentQueue[i]=o)):void(this.dependentQueue[i]=o);var s,a}))},e.prototype.register=function(e,i=t){const n={event:e,dependent:i};return this.monitorQueue.push(n),this.dependentQueue.push(this.executeDependent(i)),()=>{this.monitorQueue.forEach(((t,e)=>{t===n&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},e.prototype.executeEvent=function(t){t(this.ImitationINS.state)},e.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},i.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},i.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},i.prototype.register=function(){return this.MonitorINS.register(...arguments)},i.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const n=new i;window.Imitation=n}()}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";i(70),i(293),i(652),i(37),i(6);const t=i.p+"static/music_3fc1533a1a964121b783582911d683330.jpg",e=i.p+"static/music_5c3cdbd72894434e891ce792de441feb0.jpg",n=i.p+"static/music_62a838eadcd148ec84a68cbebc66d1950.jpg",o=i.p+"static/music_691867e77bc4438dadad338613ecec940.jpg",s=i.p+"static/music_82d9bb357935407ab72677c14eddc1750.jpg",a=i.p+"static/music_98a7a38ce58546a7841d18c96e41e3760.jpg",h=i.p+"static/music_b58bc7e6350d4e65ae6c082cb02b39e30.jpg",r=i.p+"static/music_e53de317c5b14c4699320ad8d5119e0f0.jpg",l=i.p+"static/music_e68a943eab4c4a17b71a5c7f1c7928600.jpg",c=i.p+"static/music_e6ebd8cf5e444600b4887df07e9db65b0.jpg",d=(i.p,i.p+"static/music_f230097248bb4b588904d2e905fa0ff00.jpg"),f=i.p+"static/tiku_0e09cd58d1436c3c7a8701080c6974de723474910660bfbf73dd97a83fbd6090.jpg",u=i.p+"static/tiku_2370518a7d30c7bf6b02aefe4ee7713788317991416cd96a6a299a24a70273fd.jpg",w=i.p+"static/tiku_26d8971fa322a02278bbd05db933493de77be04391edf756b5569172a3177c63.jpg",m=i.p+"static/tiku_3367fcf4fe5f579474168c512d4587950f62caf6702c5920ce200956789b89c5.jpg",p=i.p+"static/tiku_79de25fc9f3d427a1d82b509b0c39cef8e91eda06c79ddeab882ba309e7a4c90.jpg",g=i.p+"static/tiku_853447bbb37c404df8ecfdd5ac629e820895ccea0d8aa1dc08e64b0a6441b3a4.jpg",y=i.p+"static/tiku_88b679ecc03021e56b0bb0c1b3fe9e79e6c740f1ab962bf84dd6def3146194be.jpg",x=i.p+"static/tiku_8be693403c572c95b6cb6b6eff7fd493813b31a77492e8a9666deb1661a07b75.jpg",v=i.p+"static/tiku_976720a8be03f2a484db9437b80b829ccd754f092681f00b3b4307d6e88f9ef7.jpg",T=i.p+"static/tiku_c9b0f210524d514e89f2416586430140a5abca547de232d7877c0af258fa2191.jpg",b=i.p+"static/tiku_e2cd4f29dbec9563c6a415cec238cb947e7332c74f73104325e06b926150b37a.jpg",I=i.p+"static/tiku_faa32e072f102bc653036b6f46fb58c34aa0fea084ec672919a43c9d40821dcf.jpg",A=new class{constructor(){var i;this.map={"background-home":t,"background-transition":e,"background-page":o,"money-1":n,"money-2":n,"money-3":n,"explore-1":s,"explore-2":s,"shop-1":a,"shop-2":a,"shop-3":a,"shop-4":a,"shop-5":a,"master-1":h,"master-2":r,"master-3":l,"master-4":c,"master-5":d,"card-1":f,"card-2":u,"card-3":w,"card-4":m,"card-5":p,"card-6":g,"card-7":y,"card-8":x,"card-9":v,"card-10":T,"card-11":b,"card-12":I},i=this.map,Object.entries(i).forEach((t=>{const e=new Image;e.src=i[t[0]],i[t[0]]=e}))}get(t){return this.map[t]||console.error(t),this.map[t]}},S=(t,e)=>Math.floor(t*Math.pow(1.2,e-1));var P=[{key:1,name:"金币"},{key:2,name:"晶石"}],C=[{key:1,name:"故事 I",description:"可能包含: 金币 20 - 50 枚",difficulty:1,type:"alltime",boss:{master:{key:1,level:1},card:[{key:1,level:1},{key:2,level:1}]},reward:()=>[{money:!0,key:1,number:Math.floor(31*Math.random())+20}]},{key:2,name:"梦境 I",description:"可能包含: 小火把 Exp 5 - 20, 大火把 Exp 5 - 20",difficulty:2,type:"alltime",boss:{master:{key:2,level:2},card:[{key:1,level:3},{key:2,level:3},{key:3,level:3}]},reward:()=>[{card:!0,key:1,exp:Math.floor(16*Math.random())+5},{card:!0,key:2,exp:Math.floor(16*Math.random())+5}]}],k=[{key:1,name:"火系基础礼盒I",description:"可能包含: 小火把 Exp 0 - 20, 大火把 Exp 0 - 20",type:"alltime",money:{key:1,number:388},reward:()=>[{card:!0,key:1,exp:Math.floor(21*Math.random())},{card:!0,key:2,exp:Math.floor(21*Math.random())}]},{key:2,name:"火系基础礼盒II",description:"可能包含: 火焰领主 Exp 50 - 100, 炎魔 Exp 50 - 100",type:"alltime",money:{key:1,number:388},reward:()=>[{master:!0,key:2,exp:Math.floor(51*Math.random()+50)},{master:!0,key:3,exp:Math.floor(51*Math.random()+50)}]},{key:3,name:"新手礼盒I",description:"可能包含: 祭司 Exp 50 - 150",type:"alltime",money:{key:1,number:188},reward:()=>[{master:!0,key:1,exp:Math.floor(101*Math.random()+50)}]}],M=[{key:1,name:"祭司",HP:t=>S(1e4,t),ATTACT:t=>S(800,t),ACTION:2,skill:[{name:"庇护 I",description:t=>"使用卡牌后, 回复 2% HP",function:(t,e,i,n,o)=>{const s=Math.floor(.02*n.master.HP_);i.push({roleMessage:`${e.name} HP + ${s}`,target:"self"}),i.push({effect:"HP",target:"self",value:s})}},{name:"庇护 II",description:t=>"使用卡牌后, 提升 2% 基础ATTACT",function:(t,e,i,n,o)=>{const s=Math.floor(.02*n.master.ATTACT_);i.push({roleMessage:`${e.name} ATTACT + ${s}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:s})}}]},{key:2,name:"火焰领主",HP:t=>S(1e4,t),ATTACT:t=>S(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}}]},{key:3,name:"炎魔",HP:t=>S(8e3,t),ATTACT:t=>S(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}},{name:"火焰控制",description:t=>"使用火焰系卡牌后, 提升 5% ATTACT",function:(t,e,i,n,o)=>{if("火焰"===t.race){const t=Math.floor(.05*n.master.ATTACT);i.push({roleMessage:`${e.name} ATTACT + ${t}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:t})}}}]},{key:4,name:"丛林守护者",HP:t=>S(12e3,t),ATTACT:t=>S(680,t),ACTION:2,skill:[{name:"自然之力",description:t=>"使用卡牌后, 回复 4% HP, 并有 25% 几率提升一次牌库随机一张卡牌的等级",function:(t,e,i,n,o)=>{if("自然"===t.race){const o=Math.floor(.04*n.master.HP_);if(i.push({roleMessage:`${e.name} HP + ${o}`,target:"self"}),i.push({effect:"HP",target:"self",value:o}),Math.random()>.5){const e=D(n.card.team,1)[0];i.push({roleMessage:`{skill.name} ${e.name} LEVEL + 1`,target:"opposite"}),i.push({effect:"LEVEL",target:"self",key:t.key,number:1})}}}}]}],E=[{key:1,name:"小火把",type:"进攻",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并附加给目标 1 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:1}]}},{key:2,name:"大火把",type:"进攻",race:"火焰",description:t=>`造成 ${50+2.5*(t-1)}%ATTACT 伤害, 并附加给目标 2 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(.5+.025*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:2}]}},{key:3,name:"点燃",type:"进攻",race:"火焰",description:t=>`造成目标 '燃' 层数 * ${35+2*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT*(.35+.02*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:4,name:"火焰冲击",type:"进攻",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 若目标拥有 '燃' 则伤害 * 1.5`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.find((t=>"燃"===t))?e.master.ATTACT*(1+.05*(t.level-1))*1.5:e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:5,name:"火焰聚能",type:"辅助",race:"火焰",description:t=>`消耗对手的所有 '燃' , 提升自身 '燃' 层数 * ${10+.5*(t-1)} 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"BUFF",target:"opposite",name:"燃",number:-i.master.buff.filter((t=>"燃"===t)).length}]}},{key:6,name:"火球术",type:"进攻",race:"火焰",description:t=>`造成 ${120+6*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1.2+.06*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:7,name:"火球燃烧",type:"进攻",race:"火焰",description:t=>`造成 ${60+3*(t-1)} 伤害, 提升一次牌库 '火球术' 等级`,function:(t,e,i)=>{const n=[],o=Math.floor(e.master.ATTACT*(.6+.03*(t.level-1)));return n.push({message:[t.name,j(t.level)].join(" ")}),n.push({roleMessage:`${t.name} HP - ${o}`,target:"opposite"}),n.push({animation:"red-hit",target:"opposite"}),n.push({effect:"HP",target:"opposite",value:-o}),e.card.team.some((t=>6===t.key))&&(n.push({roleMessage:`${t.name} 火球术 LEVEL + 1`,target:"self"}),n.push({effect:"LEVEL",target:"self",key:6,number:1})),n}},{key:8,name:"自燃",type:"辅助",race:"火焰",description:t=>`扣除自身当前生命值 10%, 提升 ${20+1*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.2+.01*(t.level-1))),o=Math.floor(.1*e.master.HP);return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{roleMessage:`${t.name} HP - ${o}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"HP",target:"self",value:-o}]}},{key:9,name:"火焰蓄能",type:"辅助",race:"火焰",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:10,name:"自然治愈",type:"治疗",race:"自然",description:t=>`回复 ${10+.5*(t-1)}% HP`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"HP",target:"self",value:n}]}},{key:11,name:"自然蓄能",type:"辅助",race:"自然",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:12,name:"缠绕",type:"进攻",race:"自然",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并降低目标 5% ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1))),o=Math.floor(.05*i.master.ATTACT);return[{message:[t.name,j(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{roleMessage:`${t.name} ATTACT - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"ATTACT",target:"opposite",value:-o}]}}];P.forEach((t=>t.imageDOM=A.get("money-"+t.key))),C.forEach((t=>t.imageDOM=A.get("explore-"+t.key))),k.forEach((t=>t.imageDOM=A.get("shop-"+t.key))),M.forEach((t=>t.imageDOM=A.get("master-"+t.key))),E.forEach((t=>t.imageDOM=A.get("card-"+t.key)));const _=t=>t.reduce(((t,e)=>{const i=[...t],n=E.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),$=t=>t.reduce(((t,e)=>{const i=[...t],n=M.find((t=>e.key===t.key));return i.push({...n,...e,HP:n.HP(e.level),ATTACT:n.ATTACT(e.level),HP_:n.HP(e.level),ATTACT_:n.ATTACT(e.level)}),i}),[]),O=t=>t.reduce(((t,e)=>{const i=[...t],n=P.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),j=t=>1===t?"I":2===t?"II":3===t?"III":4===t?"IV":5===t?"V":6===t?"VI":7===t?"VII":8===t?"VIII":9===t?"IX":10===t?"X":11===t?"XI":12===t?"XII":13===t?"XIII":14===t?"XIV":15===t?"XV":16===t?"XVI":void 0,H=async(t,e)=>{var i=0;const n=e=>{i===t&&e(),i!==t&&(i+=1,requestAnimationFrame((()=>n(e))))};e&&n(e),e||await new Promise((t=>n(t)))},N=t=>Number(Number(t).toFixed(4)),D=(t,e)=>{var i=[],n=[...t];return new Array(e).fill().forEach((()=>{const t=Math.floor(Math.random()*n.length);n[t]&&(i.push(n[t]),n=n.filter(((e,i)=>i!==t)))})),i},R=(t,e)=>{const i=e.x,n=e.y,o=e.width,s=e.height;var a=t.x||t.touches[0].clientX,h=t.y||t.touches[0].clientY;try{const t=canvas.getBoundingClientRect();a-=t.left,h-=t.top}catch{}return a>=i&&a<=i+o&&h>=n&&h<=n+s},F=(t,e)=>{const{x:i,y:n,width:o,height:s}=t,{x:a,y:h,width:r,height:l}=e;return i+o>a&&i<a+r&&n+s>h&&n<h+l},B=canvas.getContext("2d"),L=(t,e)=>{const i=e.x,n=e.y,o=e.width,s=e.height;var a=0,h=0,r=t.width,l=t.height;const c=Math.max(o/t.width,s/t.height),d=t.width*c-o,f=t.height*c-s;d&&(a=d/2/c,r-=d/c),f&&(h=f/2/c,l-=f/c),B.drawImage(t,a,h,r,l,i,n,o,s)},X=t=>{const e=t.x,i=t.y,n=t.width,o=t.height,s=Array.isArray(t.radius)?t.radius:new Array(4).fill(t.radius);B.beginPath(),B.moveTo(e,i+s[0]),B.arcTo(e,i,e+s[0],i,s[0]),B.lineTo(e+n-s[1],i),B.arcTo(e+n,i,e+n,i+s[1],s[1]),B.lineTo(e+n,i+o-s[2]),B.arcTo(e+n,i+o,e+n-s[2],i+o,s[2]),B.lineTo(e+s[3],i+o),B.arcTo(e,i+o,e,i+o-s[3],s[3]),B.closePath()},W=t=>{const e=t.x,i=t.y,n=t.width,o=t.height;B.beginPath(),B.moveTo(e,i),B.lineTo(e+n,i),B.lineTo(e+n,i+o),B.lineTo(e,i+o),B.closePath()},Y=t=>{const e=t.x,i=t.y,n=t.width,o=t.wrapSpace,s=t.text;var a="",h=[];s.split("").forEach((t=>{B.measureText(a+t).width>n&&(h.push(a),a=""),a+=t})),h.push(a),h.forEach(((t,n)=>{B.fillText(t,e,i+n*o)}))},U=canvas.getContext("2d"),q=wx.getSystemInfoSync().windowWidth,V=wx.getSystemInfoSync().windowHeight,G=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=N(this.opacity+.05),this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=N(this.opacity-.05),this.count=this.count+1),this.count>60)return window.Imitation.state.page.current=window.Imitation.state.page.next,void(window.Imitation.state.page.next="");U.globalAlpha=this.opacity,L(A.get("background-transition"),{x:0,y:0,width:q,height:V}),U.globalAlpha=1}},Q=canvas.getContext("2d"),z=wx.getSystemInfoSync().windowWidth,K=wx.getSystemInfoSync().windowHeight,J=class{constructor(){}drawButtonExplore(){const t={x:z/2-60,y:K-240,width:120,height:40,radius:8};Q.textAlign="center",Q.textBaseline="middle",Q.font=`900 14px ${window.fontFamily}`,X(t),Q.fillStyle="rgba(255, 255, 255, 1)",Q.fill(),Q.fillStyle="rgba(0, 0, 0, 1)",Q.fillText("探索",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="explore"}),{ifTouchCover:t})}drawButtonStore(){const t={x:z/2-60,y:K-180,width:120,height:40,radius:8};Q.textAlign="center",Q.textBaseline="middle",Q.font=`900 14px ${window.fontFamily}`,X(t),Q.fillStyle="rgba(255, 255, 255, 1)",Q.fill(),Q.fillStyle="rgba(0, 0, 0, 1)",Q.fillText("编队",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="store"}),{ifTouchCover:t})}drawButtonShop(){const t={x:z/2-60,y:K-120,width:120,height:40,radius:8};Q.textAlign="center",Q.textBaseline="middle",Q.font=`900 14px ${window.fontFamily}`,X(t),Q.fillStyle="rgba(255, 255, 255, 1)",Q.fill(),Q.fillStyle="rgba(0, 0, 0, 1)",Q.fillText("商店",t.x+t.width/2,t.y+t.height/2),window.Imitation.state.function.event("touchstart",(()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="shop"}),{ifTouchCover:t})}render(){L(A.get("background-home"),{x:0,y:0,width:z,height:K}),this.drawButtonExplore(),this.drawButtonStore(),this.drawButtonShop()}},Z=canvas.getContext("2d");class tt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.contentWidth=t.contentWidth,this.contentHeight=t.contentHeight,this.scrollPosition=t.scrollPosition||[0,0],this.mouseDownPosition=null}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var n=this.scrollPosition[0]-e,o=this.scrollPosition[1]-i;this.contentWidth||(n=this.scrollPosition[0]),this.contentHeight||(o=this.scrollPosition[1]),this.scrollPosition=[n,o]}render(t){if(!this.mouseDownPosition){const t=16;this.scrollPosition[0]<0&&(this.scrollPosition[0]=this.scrollPosition[0]/t<-1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.scrollPosition[1]<0&&(this.scrollPosition[1]=this.scrollPosition[1]/t<-1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.scrollPosition[0]>0&&((this.contentWidth-this.width<0||this.contentWidth-this.width==0)&&(this.scrollPosition[0]=this.scrollPosition[0]/t>1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.contentWidth-this.width>0&&this.scrollPosition[0]>this.contentWidth-this.width&&(this.scrollPosition[0]=(this.scrollPosition[0]-(this.contentWidth-this.width))/t>1/t?this.scrollPosition[0]-(this.scrollPosition[0]-(this.contentWidth-this.width))/t:this.contentWidth-this.width)),this.scrollPosition[1]>0&&((this.contentHeight-this.height<0||this.contentHeight-this.height==0)&&(this.scrollPosition[1]=this.scrollPosition[1]/t>1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.contentHeight-this.height>0&&this.scrollPosition[1]>this.contentHeight-this.height&&(this.scrollPosition[1]=(this.scrollPosition[1]-(this.contentHeight-this.height))/t>1/t?this.scrollPosition[1]-(this.scrollPosition[1]-(this.contentHeight-this.height))/t:this.contentHeight-this.height))}Z.save();const e={x:this.x,y:this.y,width:this.width,height:this.height};W(e),Z.clip(),t(this.scrollPosition),Z.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:e}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}const et=canvas.getContext("2d"),it=wx.getSystemInfoSync().windowWidth,nt=wx.getSystemInfoSync().windowHeight;class ot{constructor(t){this.content=t.content,this.itemWidth=t.itemWidth||72,this.itemHeight=t.itemHeight||30,this.itemRadius=t.itemRadius||6,this.itemBackgroundColor=t.itemBackgroundColor||["rgba(255, 255, 255, 1)","rgba(0, 0, 0, 1)"],this.itemTextColor=t.itemTextColor||["rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"]}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get height(){return this.content.length*this.itemHeight+12*(this.content.length-1)+24}drawBackground(){X({x:12,y:nt-this.height-12,width:it-24,height:this.height,radius:4}),et.fillStyle="rgba(255, 255, 255, 0.5)",et.fill()}drawContent(){et.textAlign="center",et.textBaseline="middle",et.font=`900 10px ${window.fontFamily}`,this.content.forEach(((t,e)=>{const i={left:0,right:0};t.forEach((t=>{var n={};n.y=nt-36-this.itemHeight-e*this.itemHeight-12*(e-1),n.width=t.width||this.itemWidth,n.height=t.height||this.itemHeight,n.radius=t.radius||this.itemRadius,n.backgroundColor=t.backgroundColor||this.itemBackgroundColor,n.textColor=t.textColor||this.itemTextColor,"left"===t.justifyContent&&(n.x=24+i[t.justifyContent]*(n.width+12)),"right"===t.justifyContent&&(n.x=it-24-i[t.justifyContent]*(n.width+12)-n.width),i[t.justifyContent]=i[t.justifyContent]+1,n.x=t.x||n.x,n={...n,...t},et.fillStyle=n.active?n.backgroundColor[1]:n.backgroundColor[0],X(n),et.fill(),et.fillStyle=n.active?n.textColor[1]:n.textColor[0],et.fillText(n.text,n.x+n.width/2,n.y+n.height/2),window.Imitation.state.function.event("touchstart",(t=>n.event?n.event(t):null),{ifTouchCover:n})}))}))}render(){et.save(),this.drawBackground(),this.drawContent(),et.restore()}}const st=canvas.getContext("2d"),at=wx.getSystemInfoSync().safeArea.top,ht=wx.getSystemInfoSync().windowWidth,rt=wx.getSystemInfoSync().windowHeight;class lt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.explore=t.explore,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.35*i,s=.07*i,a=t+.03*i,h=e+.03*i;X({x:a,y:h,width:o,height:s,radius:.02*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="center",st.textBaseline="middle",st.font=`900 ${.025*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",st.fillText("EXPLORE 探索",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.03*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="center",st.textBaseline="middle",st.font=`900 ${.025*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",st.fillText(o.name,h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.explore;st.save(),X({x:t,y:e,width:i,height:n,radius:8}),st.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),st.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),st.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class ct{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.explore=t.explore,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="center",st.textBaseline="middle",st.font=`900 ${.045*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",st.fillText("EXPLORE 探索",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="center",st.textBaseline="middle",st.font=`900 ${.045*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",st.fillText(o.name,h+s/2,r+a/2)}drawDifficulty(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="center",st.textBaseline="middle",st.font=`900 ${.045*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",st.fillText(`难度 ${o.difficulty}`,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.explore,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),st.fillStyle="rgba(255, 255, 255, 0.75)",st.fill(),st.textAlign="start",st.textBaseline="top",st.font=`900 ${.045*i}px ${window.fontFamily}`,st.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.explore;st.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),st.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),st.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawDifficulty(),this.drawDescription(),st.restore()}}const dt=class{constructor(){this.preview=null,this.type="alltime",this.explore,this.InstanceNavigation,this.InstanceScroll,this.InstanceExplore,this.InstanceExplorePreview,this.init()}get exploreHeight(){const t=this.explore.length;return(ht-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.explore=window.Imitation.state.explore.filter((t=>t.type===this.type)),this.instanceNavigation(),this.instanceScroll(),this.instanceExplore(),this.instanceExplorePreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{justifyContent:"right",text:"探索"}],[...new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).map(((t,e)=>({active:t[0]===this.type,justifyContent:"left",text:t[1],event:()=>{this.type=t[0],this.init()}})))]]};this.InstanceNavigation=new ot(t)}instanceScroll(){const t={x:12,y:12+at,width:ht-24,height:rt-this.InstanceNavigation.height-36-at,contentHeight:this.exploreHeight};this.InstanceScroll=new tt(t)}instanceExplore(){this.InstanceExplore=this.explore.map(((t,e)=>{const i={width:ht-24,explore:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(ht-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+at,new lt(i)}))}instanceExplorePreview(){const t={};t.width=.7*ht,t.height=1.35*t.width,t.x=.15*ht,t.y=(rt-1.5*t.width)/2-60,this.InstanceExplorePreview=new ct(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceExplore.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){var t=[];this.InstanceExplorePreview.explore=this.preview,this.InstanceExplorePreview.render(),st.textAlign="center",st.textBaseline="middle",st.font=`900 12px ${window.fontFamily}`;const e={width:108,height:36,radius:8,y:this.InstanceExplorePreview.y+this.InstanceExplorePreview.height+24};e.x=(ht-e.width)/2,X(e),st.fillStyle="rgba(255, 255, 255, 1)",st.fill(),st.fillStyle="rgba(0, 0, 0, 1)",st.fillText("进入",e.x+e.width/2,e.y+e.height/2),window.Imitation.state.function.event("touchstart",(()=>this.enter(this.preview)),{ifTouchCover:e}),t.push(e),window.Imitation.state.function.event("touchstart",(e=>{t.some((t=>R(e,t)))||(this.preview=null,this.InstanceExplorePreview.novaTime=0)}))}enter(t){window.Imitation.state.battle={self:{master:{...$([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:_(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...$([t.boss.master])[0],buff:[]},card:{team:_(t.boss.card),hand:[]},AI:t.AI},reward:t.reward},window.Imitation.state.battle.self.card.team.length<8?window.Imitation.state.function.message("卡组数量满足8张","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(window.Imitation.state.page.current="transition",window.Imitation.state.page.next="pve")}render(){L(A.get("background-page"),{x:0,y:0,width:ht,height:rt}),this.InstanceNavigation.render(),this.preview&&this.drawPreview(),this.preview||this.drawScroll()}},ft=canvas.getContext("2d"),ut=wx.getSystemInfoSync().safeArea.top,wt=wx.getSystemInfoSync().windowWidth,mt=wx.getSystemInfoSync().windowHeight,pt=(t,e,i)=>{const n=new Array(e).fill(t/e),o=()=>{requestAnimationFrame((()=>{i(n.shift()),n[0]&&o()}))};o()};class gt{constructor(){this.width=Math.min(.7*wt,.5*(mt-ut)),this.height=1.35*this.width,this.x=(wt-this.width)/2,this.y=(mt-ut-this.height)/2,this.card,this.nova=!1,this.novaTime=0,this.novaOverTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}play(t){this.card=t,this.nova=!0}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle="rgba(0, 0, 0, 1)",ft.fillText("CARD 卡牌",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i,l=.03*i,c=[o.name,j(o.level)];o.number&&c.push("x"+o.number),X({x:h,y:r,width:s,height:a,radius:l}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle="rgba(0, 0, 0, 1)",ft.fillText(c.join(" "),h+s/2,r+a/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle="rgba(0, 0, 0, 1)",ft.fillText(o.race+" · "+o.type,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),ft.textAlign="start",ft.textBaseline="top",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description(o.level)})}render(){if(this.nova&&this.novaTime<1&&(this.novaTime=N(this.novaTime+.05)),1===this.novaTime&&(this.novaOverTime=this.novaOverTime+1,this.nova=!1),!this.nova&&this.novaTime>0&&40===this.novaOverTime&&(this.novaTime=N(this.novaTime-.05)),0===this.novaTime)return void(this.novaOverTime=0);const t=this.card,{x:e,y:i,width:n,height:o}=this.option;ft.save(),ft.globalAlpha=this.novaTime,W({x:0,y:0,width:wt,height:mt}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),X({x:e,y:i,width:n,height:o,radius:.04*n}),ft.clip(),L(t.imageDOM,{x:e,y:i,width:n,height:o}),this.drawTitle(),this.drawName(),this.drawRaceType(),this.drawDescription(),ft.restore()}}class yt{constructor(){this.queqe=[],this.time=60}play(t){this.queqe.push({...t,time:this.time})}render(){this.queqe.forEach((t=>{const e=t.fontSize,i=t.text,n=(t.time-this.time)/4,o=(t.time-this.time)/2;ft.save(),ft.globalAlpha=t.time/this.time,ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${e}px ${window.fontFamily}`;const s=ft.measureText(i).width+48;X({x:t.x-s/2+n,y:t.y-e+o,width:s,height:2*e,radius:.5*e}),ft.fillStyle="rgba(255, 255, 255, 0.75)",ft.fill(),ft.fillStyle="rgba(0, 0, 0, 1)",ft.fillText(i,t.x+n,t.y+o),ft.restore(),t.time=N(t.time-1),0===t.time&&(this.queqe=this.queqe.filter((t=>t.time)))}))}}class xt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.novaTime=0,this.card=t.card}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const t=this.x,e=this.y,i=this.width,n=this.height;ft.save(),ft.globalAlpha=this.novaTime,X({x:t,y:e,width:i,height:n,radius:.04*i}),ft.clip(),ft.fillStyle="rgba(0, 0, 0, 0.5)",ft.fill(),ft.restore()}}class vt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.touchStart=t.touchStart,this.touchEnd=t.touchEnd,this.mouseDownPosition=null,this.novaTime=0,this.ifTouchEndTime=0,this.mouseDownPositionTime=0}get ifTouchEnd(){return this.offsetY<0-this.height/2}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}get optionDiff(){const t=.5*-this.width,e=.5*-this.height,i=this.width,n=this.height;return{x:this.x+this.offsetX+t*this.mouseDownPositionTime,y:this.y+this.offsetY+e*this.mouseDownPositionTime,width:this.width+i*this.mouseDownPositionTime,height:this.height+n*this.mouseDownPositionTime}}get color(){const t=this.ifTouchEndTime,e=[0,0,0];return[`rgba(${Math.floor(255-t*(255-e[0]))}, ${Math.floor(255-t*(255-e[1]))}, ${Math.floor(255-t*(255-e[2]))}, 0.75)`,`rgba(${Math.floor(t*(255-e[0])+e[0])}, ${Math.floor(t*(255-e[1])+e[1])}, ${Math.floor(t*(255-e[2])+e[2])}, 1)`]}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.ifTouchEnd&&this.touchEnd(),this.mouseDownPosition=null,this.offsetX=0,this.offsetY=0}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i],this.offsetX=this.offsetX+e,this.offsetY=this.offsetY+i}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=.5*i,a=.12*i,h=t+.05*i,r=e+.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),ft.fillStyle=o[0],ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle=o[1],ft.fillText("CARD 卡牌",h+s/2,r+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.5*i,h=.12*i,r=t+i-a-.05*i,l=e+n-h-.05*i,c=.03*i,d=[s.name,j(s.level)];s.number&&d.push("x"+s.number),X({x:r,y:l,width:a,height:h,radius:c}),ft.fillStyle=o[0],ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle=o[1],ft.fillText(d.join(" "),r+a/2,l+h/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.9*i,h=.12*i,r=t+.05*i,l=e+.22*i;X({x:r,y:l,width:a,height:h,radius:.03*i}),ft.fillStyle=o[0],ft.fill(),ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle=o[1],ft.fillText(s.race+" · "+s.type,r+a/2,l+h/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.color,s=this.card,a=.9*i,h=t+.05*i,r=e+.56*i;X({x:h,y:r,width:a,height:.57*i,radius:.03*i}),ft.fillStyle=o[0],ft.fill(),ft.textAlign="start",ft.textBaseline="top",ft.font=`900 ${.045*i}px ${window.fontFamily}`,ft.fillStyle=o[1],Y({x:h+.05*i,y:r+.05*i,width:a-.1*i,wrapSpace:.075*i,text:s.description(s.level)})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05)),this.mouseDownPosition&&this.mouseDownPositionTime<1&&(this.mouseDownPositionTime=N(this.mouseDownPositionTime+.05)),!this.mouseDownPosition&&this.mouseDownPositionTime>0&&(this.mouseDownPositionTime=N(this.mouseDownPositionTime-.05)),this.ifTouchEnd&&this.ifTouchEndTime<1&&(this.ifTouchEndTime=N(this.ifTouchEndTime+.05)),!this.ifTouchEnd&&this.ifTouchEndTime>0&&(this.ifTouchEndTime=N(this.ifTouchEndTime-.05));const t=this.card,{x:e,y:i,width:n,height:o}=this.option;ft.save(),ft.translate(e+n/2,i+o/2),ft.scale(this.mouseDownPositionTime+1,this.mouseDownPositionTime+1),ft.translate(-(e+n/2),-(i+o/2)),ft.globalAlpha=this.novaTime,X({x:e,y:i,width:n,height:o,radius:.04*n}),ft.clip(),L(t.imageDOM,{x:e,y:i,width:n,height:o}),this.drawTitle(),this.drawName(),0!==this.mouseDownPositionTime&&(ft.globalAlpha=this.mouseDownPositionTime,this.drawRaceType(),this.drawDescription()),ft.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Tt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.type=t.type,this.information=t.information,this.useCard=t.useCard,this.InstanceCards=[],this.touchCard,this.show="card"}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawBackground(){const{x:t,y:e,width:i,height:n,information:o}=this;ft.save(),X({x:t,y:e,width:i,height:n,radius:this.width/2}),ft.clip(),L(o.master.imageDOM,{x:t,y:e,width:i,height:n}),ft.restore()}drawTitle(){const{x:t,y:e,width:i,height:n,information:o}=this,s={width:.4*i,height:.12*i};s.x=t+i/2-s.width/2,s.y=e+.02*i,s.radius=s.height/4,ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.04*i}px ${window.fontFamily}`,X(s),ft.fillStyle="rgba(255, 255, 255, 1)",ft.fill(),ft.fillStyle="rgba(0, 0, 0, 1)",ft.fillText([o.master.name,j(o.master.level)].join(" "),s.x+s.width/2,s.y+s.height/2)}drawACTION(){const{x:t,y:e,width:i,height:n,information:o}=this,s={width:.04*i,height:.04*i};s.x=t+i/2+.2*i+.04*i,s.y=e+.06*i,s.radius=s.height/2,o.master._ACTION&&o.master._ACTION>0&&new Array(o.master._ACTION).fill().forEach(((t,e)=>{const n={...s,x:s.x+e*(s.width+.04*i)};X(n),ft.fillStyle="rgba(255, 255, 255, 1)",ft.fill()}))}drawHA(){const{x:t,y:e,width:i,height:n,information:o}=this;ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 ${.04*i}px ${window.fontFamily}`;const s={width:1.2*i,height:.12*i};s.x=t+(i-s.width)/2,s.y=e+n-s.height-.02*i,s.radius=s.height/2,ft.save(),X(s),ft.clip(),ft.fillStyle="rgba(0, 0, 0, 0.5)",ft.fill(),W({...s,width:o.master.HP/o.master.HP_*s.width}),ft.fillStyle="rgba(185, 0, 0, 1)",ft.fill(),ft.restore(),ft.fillStyle="rgba(255, 255, 255, 1)",ft.fillText(`HP ${Math.floor(o.master.HP)} / ${o.master.HP_} - ATTACT ${Math.floor(o.master.ATTACT)}`,s.x+s.width/2,s.y+s.height/2)}drawBuff(){const{x:t,y:e,width:i,height:n,information:o}=this;ft.textAlign="center",ft.textBaseline="middle",ft.fillStyle="rgba(0, 0, 0, 1)",ft.font=`900 ${.03*i}px ${window.fontFamily}`;var s=o.master.buff.reduce(((t,e)=>{const i=t.find((t=>t.name===e));return i&&(i.number=i.number+1),i||t.push({name:e,number:1}),t}),[]);0===s.length&&(s=[{name:"BUFF"}]),s.forEach(((o,a)=>{const h={width:.16*i,height:.08*i},r=a-(s.length/2-.5);h.radius=h.height/4,h.x=t+(i-h.width)/2+r*(h.width+.02*i),h.y=e+n+.02*i,X(h),ft.fillStyle="rgba(0, 0, 0, 0.75)",ft.fill(),ft.fillStyle="rgba(255, 255, 255, 1)",ft.fillText(o.number?`${o.name} X${o.number}`:o.name,h.x+h.width/2,h.y+h.height/2)}))}drawCard(){const t=this.width,e=this.height,i=this.x-(t-this.width)/2,n=this.y;this.InstanceCards=this.InstanceCards.filter((t=>this.information.card.hand.find((e=>e===t.card)))),this.information.card.hand.forEach(((o,s)=>{const a=s-(this.information.card.hand.length/2-.5),h={};h.width=.42*t,h.height=1.35*h.width,h.x=i+(t-h.width)/2+a*t*.45,h.y=n+(e-h.height)/2,h.touchStart=()=>this.touchCard=o,h.touchEnd=()=>this.useCard(o);const r=this.InstanceCards.find((t=>t.card===o));if(r&&(r.x=h.x),!r){const t="self"===this.type?vt:xt;this.InstanceCards.push(new t({card:o,...h}))}})),this.InstanceCards.forEach((t=>t.card!==this.touchCard?t.render():null)),this.InstanceCards.forEach((t=>t.card===this.touchCard?t.render():null))}render(){this.drawBackground(),this.drawTitle(),this.drawACTION(),this.drawHA(),this.drawBuff(),this.drawCard()}}const bt=class{constructor(){this.currentUseCard=!1,this.currentRole,this.round=.5,this.auto=!1,this.InstanceNavigation,this.InstanceRoleSelf,this.InstanceRoleOpposite,this.InstanceRoleMessage=new yt,this.InstanceCardMessage=new gt,this.instanceNavigation(),this.instanceRoleSelf(),this.instanceRoleOpposite(),this.currentRole=this.InstanceRoleSelf,this.roundStart()}instanceRoleSelf(){const t=(mt-this.InstanceNavigation.height-36-ut)/2,e={width:Math.min(.75*wt,.75*t),height:Math.min(.75*wt,.75*t),type:"self",information:window.Imitation.state.battle.self,useCard:this.useCard};e.x=(wt-e.width)/2,e.y=mt-this.InstanceNavigation.height-24-t+(t-e.height)/2,this.InstanceRoleSelf=new Tt(e)}instanceRoleOpposite(){const t=(mt-this.InstanceNavigation.height-36-ut)/2,e={width:Math.min(.75*wt,.75*t),height:Math.min(.75*wt,.75*t),type:"opposite",information:window.Imitation.state.battle.opposite,useCard:this.useCard};e.x=(wt-e.width)/2,e.y=(t-e.height)/2+24+ut,this.InstanceRoleOpposite=new Tt(e)}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"退出战斗",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="explore"}},{justifyContent:"left",text:"自动战斗",active:this.auto,event:()=>{this.auto=!this.auto,this.instanceNavigation(),this.oppositeAI()}},{justifyContent:"right",text:"结束回合",event:this.roundOver}]]};this.InstanceNavigation=new ot(t)}drawRound(){const t={width:120,height:12};t.y=12+ut,t.x=(wt-t.width)/2,ft.textAlign="center",ft.textBaseline="middle",ft.font=`900 24px ${window.fontFamily}`,ft.fillStyle="rgba(0, 0, 0, 0.5)",ft.fillText("ROUND",t.x+t.width/2,t.y+t.height/2),ft.font=`900 14px ${window.fontFamily}`,ft.fillStyle="rgba(255, 255, 255, 1)",ft.fillText(`${Math.floor(this.round)}/99`,t.x+t.width/2,t.y+t.height/2+2)}pumpCard=(t,e)=>{2===e.information.card.hand.length&&e.information.card.cemetery.push(t),e.information.card.hand.length<2&&e.information.card.hand.push(t)};useCard=async t=>{if(this.currentUseCard)return;const e=this.currentRole,[i,n]=e===this.InstanceRoleSelf?[this.InstanceRoleSelf,this.InstanceRoleOpposite]:[this.InstanceRoleOpposite,this.InstanceRoleSelf];this.currentUseCard=!0,i.information.card.hand=i.information.card.hand.filter((e=>e!==t)),i.information.master._ACTION=i.information.master._ACTION-1,this.InstanceCardMessage.play(t),await H(120);var o=t.function(t,i.information,n.information);i.information.master.skill.forEach((e=>e.function(t,e,o,i.information,n.information)));for(var s=0,a=0;o.length;){const e=o.shift();if(e.custom&&e.custom(t,o,i.information,n.information),e.message&&window.Imitation.state.function.message(e.message,"rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),e.animation&&("self"===e.target&&window.Imitation.state.function.animation(e.animation,(t=>[i.x+i.width/2-t.width/2,i.y+i.height/2-t.height/2])),"opposite"===e.target&&window.Imitation.state.function.animation(e.animation,(t=>[n.x+n.width/2-t.width/2,n.y+n.height/2-t.height/2]))),e.roleMessage&&("self"===e.target&&(H(30*s,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:i.x+i.width/2,y:i.y+i.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),s+=1),"opposite"===e.target&&(H(30*a,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:n.x+n.width/2,y:n.y+n.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),a+=1)),e.effect){if("HP"===e.effect&&("self"===e.target&&pt(e.value,32,(t=>i.information.master.HP=Math.min(i.information.master.HP+t,i.information.master.HP_))),"opposite"===e.target&&pt(e.value,32,(t=>n.information.master.HP=Math.min(n.information.master.HP+t,n.information.master.HP_)))),"ATTACT"===e.effect&&("self"===e.target&&pt(e.value,32,(t=>i.information.master.ATTACT=i.information.master.ATTACT+t)),"opposite"===e.target&&pt(e.value,32,(t=>n.information.master.ATTACT=n.information.master.ATTACT+t))),"BUFF"===e.effect){if("self"===e.target&&(e.number>0&&i.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;i.information.master.buff=i.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}if("opposite"===e.target&&(e.number>0&&n.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;n.information.master.buff=n.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}}(e.effect="LEVEL")&&("self"===e.target&&i.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})),"opposite"===e.target&&n.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})))}}await H(120),this.roundContinue()};oppositeAI=async()=>{const t=this.currentRole;var e;t.information.AI&&(e=t.information.AI(t.information,this.InstanceRoleSelf.information)),t.information.AI||(e=D(t.information.card.hand,1)[0]),await H(60),await this.useCard(e),await H(60)};roundStart=async()=>{this.round=this.round+.5;const t=this.currentRole;t.information.roundCache=null,t.information.master._ACTION=t.information.master.ACTION,t.information.card.hand=D(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()};roundContinue=async()=>{const t=this.currentRole;t.information.master._ACTION>0&&(t.information.card.hand=D(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()),0===t.information.master._ACTION&&this.roundOver(),this.currentUseCard=!1};roundOver=async()=>{const t=this.currentRole;return t.information.master._ACTION=0,t.information.card.hand=[],this.currentRole===this.InstanceRoleSelf?(this.currentRole=this.InstanceRoleOpposite,void await this.roundStart()):this.currentRole===this.InstanceRoleOpposite?(this.currentRole=this.InstanceRoleSelf,void await this.roundStart()):void 0};battlerOver=()=>{if(this.InstanceRoleOpposite.information.master.HP<=0){const t=window.Imitation.state.battle.reward();return window.Imitation.state.function.message("战斗胜利","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:t,back:"explore",title:"战斗胜利"},window.Imitation.state.page.current="transition",void(window.Imitation.state.page.next="reward")}if(this.InstanceRoleSelf.information.master.HP<=0)return window.Imitation.state.function.message("战斗失败","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:[],back:"explore",title:"战斗失败"},window.Imitation.state.page.current="transition",void(window.Imitation.state.page.next="reward")};render(){L(A.get("background-page"),{x:0,y:0,width:wt,height:mt}),this.drawRound(),this.InstanceNavigation.render(),this.InstanceRoleOpposite.render(),this.InstanceRoleSelf.render(),this.InstanceCardMessage.render(),this.InstanceRoleMessage.render(),this.battlerOver()}},It=canvas.getContext("2d"),At=wx.getSystemInfoSync().safeArea.top,St=wx.getSystemInfoSync().windowWidth,Pt=wx.getSystemInfoSync().windowHeight;class Ct{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+.05*i,r=e+.05*i,l=.03*i;It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,X({x:h,y:r,width:s,height:a,radius:l}),It.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",It.fill(),It.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",It.fillText("CARD 卡牌",h+s/2,r+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i,l=.03*i,c=[o.name,j(o.level)];X({x:h,y:r,width:s,height:a,radius:l}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText(c.join(" "),h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.card;It.save(),X({x:t,y:e,width:i,height:n,radius:8}),It.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),It.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),It.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class kt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.card=t.card,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText("CARD 卡牌",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText([o.name,j(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),h+s/2,r+a/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText(o.race+" · "+o.type,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="start",It.textBaseline="top",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description(o.level)})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.card;It.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),It.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),It.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawRaceType(),this.drawDescription(),It.restore()}}class Mt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.master=t.master,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.35*i,a=.07*i,h=t+.03*i,r=e+.03*i,l=.02*i;It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.025*i}px ${window.fontFamily}`,X({x:h,y:r,width:s,height:a,radius:l}),It.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",It.fill(),It.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",It.fillText("MASTER 队长",h+s/2,r+a/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.03*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.025*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText([o.name,j(o.level)].join(" "),h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.master;It.save(),X({x:t,y:e,width:i,height:n,radius:8}),It.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),It.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),It.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Et{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.master=t.master,this.skillIndex=0,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText("MASTER 队长",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText([o.name,j(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),h+s/2,r+a/2)}drawHP(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText("HP "+o.HP,h+s/2,r+a/2)}drawATTACT(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=.12*i,h=t+.05*i,r=e+.39*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="center",It.textBaseline="middle",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",It.fillText("ATTACT "+o.ATTACT,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),It.fillStyle="rgba(255, 255, 255, 0.75)",It.fill(),It.textAlign="start",It.textBaseline="top",It.font=`900 ${.045*i}px ${window.fontFamily}`,It.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.skill[this.skillIndex].description(o.level)})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.master;It.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),It.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),It.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawHP(),this.drawATTACT(),this.drawDescription(),It.restore()}}const _t=class{constructor(){this.preview=null,this.type="card",this.master,this.card,this.InstanceNavigation,this.InstanceScroll,this.InstanceMasterList,this.InstanceMasterPreview,this.InstanceCardList,this.InstanceCardPreview,this.init()}get masterHeight(){const t=this.master.length;return(St-60)/4*1.35*t+(t?12*(t-1):0)}get cardHeight(){const t=Math.ceil(this.card.length/4);return(St-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.master=[],this.card=[],"card"===this.type&&(this.master=$([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))]).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key===t.key,t))),this.card=_(window.Imitation.state.info.library.card).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i}))),"master"===this.type&&(this.master=$(window.Imitation.state.info.library.master).map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key===t.key,t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i})),this.card=_(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>(t.inTeam=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))).sort(((t,e)=>t.key-e.key))),this.instanceNavigation(),this.instanceScroll(),this.instanceMasterList(),this.instanceCardList(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{justifyContent:"right",text:"编队"}],[...new Array(window.Imitation.state.info.team.length).fill().map(((t,e)=>({width:42,active:e===window.Imitation.state.info.teamIndex,justifyContent:"left",text:j(e+1),event:()=>{window.Imitation.state.info.teamIndex=e,this.init()}}))),{active:!0,justifyContent:"right",text:"card"===this.type?"卡牌":"队长",event:()=>{this.type="card"===this.type?"master":"card",this.init()}}]]};this.InstanceNavigation=new ot(t)}instanceScroll(){const t={x:12,y:12+At,width:St-24,height:Pt-this.InstanceNavigation.height-36-At,contentHeight:this.masterHeight+this.cardHeight+12};this.InstanceScroll=new tt(t)}instanceMasterList(){this.InstanceMasterList=this.master.map(((t,e)=>{const i={width:St-24,master:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(St-60)/4*1.35,i.x=12,"master"===this.type&&(i.y=24+e*(i.height+12)+this.cardHeight+At),"card"===this.type&&(i.y=12+e*(i.height+12)+At),new Mt(i)}))}instanceCardList(){this.InstanceCardList=this.card.map(((t,e)=>{const i={width:(St-60)/4,card:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),"master"===this.type&&(i.y=12+parseInt(e/4)*(i.height+12)+At),"card"===this.type&&(i.y=24+parseInt(e/4)*(i.height+12)+this.masterHeight+At),new Ct(i)}))}instanceCardPreview(){const t={};t.width=.7*St,t.height=1.35*t.width,t.x=.15*St,t.y=(Pt-1.5*t.width)/2-60,this.InstanceCardPreview=new kt(t)}instanceMasterPreview(){const t={};t.width=.7*St,t.height=1.35*t.width,t.x=.15*St,t.y=(Pt-1.5*t.width)/2-60,this.InstanceMasterPreview=new Et(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceCardList.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMasterList.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){var t=[];const e=this.InstanceMasterPreview.y+this.InstanceMasterPreview.height;if(this.InstanceCardList.find((t=>t.card===this.preview))){this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.render();const i={y:e+24,width:108,height:36,radius:8};i.x=(St-i.width)/2,It.textAlign="center",It.textBaseline="middle",It.font=`900 12px ${window.fontFamily}`,X(i),It.fillStyle="rgba(255, 255, 255, 1)",It.fill(),It.fillStyle="rgba(0, 0, 0, 1)",this.preview.inTeam&&(It.fillText("卸载",i.x+i.width/2,i.y+i.height/2),window.Imitation.state.function.event("touchstart",(()=>this.unloadCard(this.preview)),{ifTouchCover:i})),this.preview.inTeam||(It.fillText("装载",i.x+i.width/2,i.y+i.height/2),window.Imitation.state.function.event("touchstart",(()=>this.loadCard(this.preview)),{ifTouchCover:i})),t.push(i)}if(this.InstanceMasterList.find((t=>t.master===this.preview))&&(this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.render(),this.preview.skill.forEach(((e,i)=>{const n={x:St/2-40,y:this.InstanceMasterPreview.y-42,width:72,height:30,radius:8};It.textAlign="center",It.textBaseline="middle",It.font=`900 10px ${window.fontFamily}`;const o=this.preview.skill.length,s=(i-(o/2-.5))*(n.width+12);n.x=n.x+s,X(n),It.fillStyle=i===this.InstanceMasterPreview.skillIndex?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",It.fill(),It.fillStyle=i===this.InstanceMasterPreview.skillIndex?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",It.fillText(e.name,n.x+n.width/2,n.y+n.height/2),window.Imitation.state.function.event("touchstart",(()=>this.InstanceMasterPreview.skillIndex=i),{ifTouchCover:n}),t.push(n)})),!this.preview.inTeam)){const i={y:e+24,width:108,height:36,radius:8};i.x=(St-i.width)/2,It.textAlign="center",It.textBaseline="middle",It.font=`900 12px ${window.fontFamily}`,X(i),It.fillStyle="rgba(255, 255, 255, 1)",It.fill(),It.fillStyle="rgba(0, 0, 0, 1)",It.fillText("装载",i.x+i.width/2,i.y+i.height/2),window.Imitation.state.function.event("touchstart",(()=>this.loadMaster(this.preview)),{ifTouchCover:i}),t.push(i)}window.Imitation.state.function.event("touchstart",(e=>{t.some((t=>R(e,t)))||(this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0)}))}loadCard(t){const e=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));8!==e.length?i?window.Imitation.state.function.message("卡牌已装载","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(i||e.push({key:t.key}),this.init(),this.preview=null,window.Imitation.state.function.message("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.saveInfo()):window.Imitation.state.function.message("超出卡组数量限制","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}unloadCard(t){const e=window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));i?(e.splice(e.indexOf(i),1),this.init(),this.preview=null,window.Imitation.state.function.message("卸载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.saveInfo()):window.Imitation.state.function.message("未装载当前卡牌","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}loadMaster(t){window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key=t.key,this.init(),this.preview=null,window.Imitation.state.function.message("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.function.saveInfo()}render(){L(A.get("background-page"),{x:0,y:0,width:St,height:Pt}),this.InstanceNavigation.render(),this.preview&&this.drawPreview(),this.preview||this.drawScroll()}},$t=canvas.getContext("2d"),Ot=wx.getSystemInfoSync().safeArea.top,jt=wx.getSystemInfoSync().windowWidth,Ht=wx.getSystemInfoSync().windowHeight;class Nt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.shop=t.shop,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.35*i,s=.07*i,a=t+.03*i,h=e+.03*i;X({x:a,y:h,width:o,height:s,radius:.02*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.025*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText("SHOP 礼盒",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.03*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.025*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText(o.name,h+s/2,r+a/2)}drawExtra(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.13*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.025*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText([o.money.name,o.money.number].join(" "),h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.shop;$t.save(),X({x:t,y:e,width:i,height:n,radius:8}),$t.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),$t.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawExtra(),$t.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Dt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.shop=t.shop,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.045*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText("SHOP 礼盒",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.045*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText(o.name,h+s/2,r+a/2)}drawMoney(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 ${.045*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText([o.money.name,o.money.number].join(" "),h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.shop,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),$t.fillStyle="rgba(255, 255, 255, 0.75)",$t.fill(),$t.textAlign="start",$t.textBaseline="top",$t.font=`900 ${.045*i}px ${window.fontFamily}`,$t.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.shop;$t.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),$t.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),$t.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawMoney(),this.drawDescription(),$t.restore()}}const Rt=class{constructor(){this.preview=null,this.money=1,this.type="alltime",this.shop,this.InstanceNavigation,this.InstanceScroll,this.InstanceShop,this.InstanceShopPreview,this.init()}get shopHeight(){const t=this.shop.length;return(jt-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.shop=window.Imitation.state.shop.filter((t=>t.type===this.type)),this.instanceNavigation(),this.instanceScroll(),this.instanceShop(),this.instanceShopPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next="home"}},{justifyContent:"right",text:"商店"}],[...new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).map(((t,e)=>({active:t[0]===this.type,justifyContent:"left",text:t[1],event:()=>{this.type=t[0],this.init()}}))),...O(window.Imitation.state.info.money).filter((t=>t.key===this.money)).map((t=>({active:!0,justifyContent:"right",text:`${t.name} ¥${t.number}`,width:108,event:()=>1===this.money?(this.money=2,void this.init()):2===this.money?(this.money=1,void this.init()):void 0})))]]};this.InstanceNavigation=new ot(t)}instanceScroll(){const t={x:12,y:12+Ot,width:jt-24,height:Ht-this.InstanceNavigation.height-36-Ot,contentHeight:this.shopHeight};this.InstanceScroll=new tt(t)}instanceShop(){this.InstanceShop=this.shop.map(((t,e)=>{const i={width:jt-24,shop:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(jt-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+Ot,new Nt(i)}))}instanceShopPreview(){const t={width:.7*jt,shop:this.preview};t.height=1.35*t.width,t.x=.15*jt,t.y=(Ht-1.5*t.width)/2-60,this.InstanceShopPreview=new Dt(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceShop.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){var t=[];this.InstanceShopPreview.shop=this.preview,this.InstanceShopPreview.render(),$t.textAlign="center",$t.textBaseline="middle",$t.font=`900 12px ${window.fontFamily}`;const e={width:108,height:36,radius:8,y:this.InstanceShopPreview.y+this.InstanceShopPreview.height+24};e.x=(jt-e.width)/2,X(e),$t.fillStyle="rgba(255, 255, 255, 1)",$t.fill(),$t.fillStyle="rgba(0, 0, 0, 1)",$t.fillText("购买",e.x+e.width/2,e.y+e.height/2),window.Imitation.state.function.event("touchstart",(()=>{this.buy(this.preview),this.preview=null,this.InstanceShopPreview.novaTime=0}),{ifTouchCover:e}),t.push(e),window.Imitation.state.function.event("touchstart",(e=>{t.some((t=>R(e,t)))||(this.preview=null,this.InstanceShopPreview.novaTime=0)}))}buy(t){const e=window.Imitation.state.info.money.find((e=>e.key===t.money.key));if(e.number<t.money.number)return void window.Imitation.state.function.message("货币不足","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)");e.number=e.number-t.money.number;const i=t.reward();window.Imitation.state.function.message("购买成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),window.Imitation.state.reward={value:i,back:"shop",title:"购买获得"},window.Imitation.state.page.current="transition",window.Imitation.state.page.next="reward"}render(){L(A.get("background-page"),{x:0,y:0,width:jt,height:Ht}),this.InstanceNavigation.render(),this.preview||this.drawScroll(),this.preview&&this.drawPreview()}},Ft=canvas.getContext("2d"),Bt=wx.getSystemInfoSync().safeArea.top,Lt=wx.getSystemInfoSync().windowWidth,Xt=wx.getSystemInfoSync().windowHeight;class Wt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.money=t.money,this.novaTime=0}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=(this.money,.35*i),s=.07*i,a=t+.03*i,h=e+.03*i;X({x:a,y:h,width:o,height:s,radius:.02*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.025*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("MONEY 货币",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.money,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.03*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.025*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText(`${o.name} ${o.number}`,h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.money;Ft.save(),X({x:t,y:e,width:i,height:n,radius:8}),Ft.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),Ft.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),Ft.restore()}}class Yt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("CARD 卡牌",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText(o.name,h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.card;Ft.save(),X({x:t,y:e,width:i,height:n,radius:8}),Ft.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),Ft.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),Ft.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Ut{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.card=t.card,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("CARD 卡牌",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText([o.name,o.exp].join(" "),h+s/2,r+a/2)}drawRaceType(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText(o.race+" · "+o.type,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.card,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="start",Ft.textBaseline="top",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.description(o.level)})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.card;Ft.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),Ft.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),this.drawTitle(),this.drawName(),this.drawRaceType(),this.drawDescription(),Ft.restore()}}class qt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.master=t.master,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!R(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=(this.master,.35*i),s=.07*i,a=t+.03*i,h=e+.03*i;X({x:a,y:h,width:o,height:s,radius:.02*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.025*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("MASTER 队长",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.35*i,a=.07*i,h=t+i-s-.03*i,r=e+n-a-.03*i;X({x:h,y:r,width:s,height:a,radius:.02*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.025*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText(o.name,h+s/2,r+a/2)}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.master;Ft.save(),X({x:t,y:e,width:i,height:n,radius:8}),Ft.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),Ft.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),Ft.restore(),window.Imitation.state.function.event("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),window.Imitation.state.function.event("touchmove",this.eventMove.bind(this)),window.Imitation.state.function.event("touchend",this.eventUp.bind(this))}}class Vt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.master=t.master,this.skillIndex=0,this.novaTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawTitle(){const{x:t,y:e,width:i,height:n}=this.option,o=.5*i,s=.12*i,a=t+.05*i,h=e+.05*i;X({x:a,y:h,width:o,height:s,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("MASTER 队长",a+o/2,h+s/2)}drawName(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.5*i,a=.12*i,h=t+i-s-.05*i,r=e+n-a-.05*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText([o.name,o.exp].join(" "),h+s/2,r+a/2)}drawHP(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=.12*i,h=t+.05*i,r=e+.22*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("HP "+o.HP,h+s/2,r+a/2)}drawATTACT(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=.12*i,h=t+.05*i,r=e+.39*i;X({x:h,y:r,width:s,height:a,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Ft.fillText("ATTACT "+o.ATTACT,h+s/2,r+a/2)}drawDescription(){const{x:t,y:e,width:i,height:n}=this.option,o=this.master,s=.9*i,a=t+.05*i,h=e+.56*i;X({x:a,y:h,width:s,height:.57*i,radius:.03*i}),Ft.fillStyle="rgba(255, 255, 255, 0.75)",Ft.fill(),Ft.textAlign="start",Ft.textBaseline="top",Ft.font=`900 ${.045*i}px ${window.fontFamily}`,Ft.fillStyle="rgba(0, 0, 0, 1)",Y({x:a+.05*i,y:h+.05*i,width:s-.1*i,wrapSpace:.075*i,text:o.skill[this.skillIndex].description(o.level)})}render(){this.novaTime<1&&(this.novaTime=N(this.novaTime+.05));const{x:t,y:e,width:i,height:n}=this.option,o=this.master;Ft.save(),X({x:t,y:e,width:i,height:n,radius:.04*i}),Ft.clip(),L(o.imageDOM,{x:t,y:e,width:i,height:n}),this.drawTitle(),this.drawName(),this.drawHP(),this.drawATTACT(),this.drawDescription(),Ft.restore()}}const Gt=class{constructor(){this.preview=null,this.type,this.card=[],this.master=[],this.money=[],this.InstanceNavigation,this.InstanceScroll,this.InstanceCard,this.InstanceCardPreview,this.InstanceMaster,this.InstanceMasterPreview,this.InstanceMoney,this.init(),this.compute()}get masterHeight(){const t=this.master.length;return(Lt-60)/4*1.35*t+(t?12*(t-1):0)}get cardHeight(){const t=Math.ceil(this.card.length/4);return(Lt-60)/4*1.35*t+(t?12*(t-1):0)}get moneyHeight(){const t=Math.ceil(this.money.length/4);return(Lt-60)/4*1.35*t+(t?12*(t-1):0)}init(){this.card=[],this.master=[],this.money=[],!this.type&&window.Imitation.state.reward.value.some((t=>t.card))&&(this.type="card"),!this.type&&window.Imitation.state.reward.value.some((t=>t.master))&&(this.type="master"),!this.type&&window.Imitation.state.reward.value.some((t=>t.money))&&(this.type="money"),"card"===this.type&&(this.card=_(window.Imitation.state.reward.value.filter((t=>t.card)).map((t=>({...t,level:1}))))),"master"===this.type&&(this.master=$(window.Imitation.state.reward.value.filter((t=>t.master)).map((t=>({...t,level:1}))))),"money"===this.type&&(this.money=O(window.Imitation.state.reward.value.filter((t=>t.money)))),this.instanceNavigation(),this.instanceScroll(),this.instanceCard(),this.instanceMaster(),this.instanceMoney(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{window.Imitation.state.page.current="transition",window.Imitation.state.page.next=window.Imitation.state.reward.back}},{justifyContent:"right",text:window.Imitation.state.reward.title}],[...new Array(["card","卡牌"],["master","队长"],["money","资源"]).filter((t=>window.Imitation.state.reward.value.some((e=>e[t[0]])))).map(((t,e)=>({active:t[0]===this.type,justifyContent:"left",text:t[1],event:()=>{this.type=t[0],this.init()}})))]]};this.InstanceNavigation=new ot(t)}instanceScroll(){const t={x:12,y:12+Bt,width:Lt-24,height:Xt-this.InstanceNavigation.height-36-Bt,contentHeight:this.masterHeight+this.cardHeight+this.moneyHeight+12};this.InstanceScroll=new tt(t)}instanceMaster(){this.InstanceMaster=this.master.map(((t,e)=>{const i={width:Lt-24,master:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=(Lt-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+Bt,new qt(i)}))}instanceCard(){this.InstanceCard=this.card.map(((t,e)=>{const i={width:(Lt-60)/4,card:t,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=t};return i.height=1.35*i.width,i.x=12+parseInt(e%4)*(i.width+12),i.y=12+parseInt(e/4)*(i.height+12)+Bt,new Yt(i)}))}instanceMoney(){this.InstanceMoney=this.money.map(((t,e)=>{const i={width:Lt-24,money:t};return i.height=(Lt-60)/4*1.35,i.x=12,i.y=12+e*(i.height+12)+Bt,new Wt(i)}))}instanceCardPreview(){const t={width:.7*Lt,card:this.preview};t.height=1.35*t.width,t.x=.15*Lt,t.y=(Xt-1.5*t.width)/2-60,this.InstanceCardPreview=new Ut(t)}instanceMasterPreview(){const t={width:.7*Lt,card:this.preview};t.height=1.35*t.width,t.x=.15*Lt,t.y=(Xt-1.5*t.width)/2-60,this.InstanceMasterPreview=new Vt(t)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceMaster.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceCard.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMoney.forEach((t=>{t.offsetY=0-e;const i=F(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){var t=[];this.InstanceCard.find((t=>t.card===this.preview))&&(this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.render()),this.InstanceMaster.find((t=>t.master===this.preview))&&(this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.render(),this.preview.skill.forEach(((e,i)=>{const n={x:Lt/2-40,y:this.InstanceMasterPreview.y-42,width:72,height:30,radius:8};Ft.textAlign="center",Ft.textBaseline="middle",Ft.font=`900 10px ${window.fontFamily}`;const o=this.preview.skill.length,s=(i-(o/2-.5))*n.width*1.1;n.x=n.x+s,X(n),Ft.fillStyle=i===this.InstanceMasterPreview.skillIndex?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",Ft.fill(),Ft.fillStyle=i===this.InstanceMasterPreview.skillIndex?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",Ft.fillText(e.name,n.x+n.width/2,n.y+n.height/2),window.Imitation.state.function.event("touchstart",(t=>{this.InstanceMasterPreview.skillIndex=i}),{ifTouchCover:n}),t.push(n)}))),window.Imitation.state.function.event("touchstart",(t=>{this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0}))}compute(){const t=window.Imitation.state.info.library;window.Imitation.state.reward.value.forEach((e=>{if(e.card){const i=t.card.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.card.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}if(e.master){const i=t.master.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.master.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}})),window.Imitation.state.function.saveInfo()}render(){L(A.get("background-page"),{x:0,y:0,width:Lt,height:Xt}),this.InstanceNavigation.render(),this.preview&&this.drawPreview(),this.preview||this.drawScroll()}},Qt=canvas.getContext("2d"),zt=(wx.getSystemInfoSync().safeArea.top,wx.getSystemInfoSync().windowWidth),Kt=wx.getSystemInfoSync().windowHeight;class Jt{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeoutRef=null,this.show=!1,this.opacity=0,this.width=Math.min(zt-24,200),this.height=32,this.x=(zt-this.width)/2,this.y=Kt}send(t,e="rgba(255, 255, 255, 1)",i="rgba(0, 0, 0, 1)"){clearTimeout(this.timeoutRef),this.message=t,this.backgroundColor=e,this.textColor=i,this.show=!0,this.timeoutRef=H(60,(()=>{this.show=!1,this.timeoutRef=null}))}render(){this.show&&this.opacity<1&&(this.opacity=N(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=N(this.opacity-.05)),this.show&&this.y>Kt-44&&(this.y=N(this.y-4)),!this.show&&this.y<Kt&&(this.y=N(this.y+4)),(this.show||0!==this.opacity)&&(Qt.save(),Qt.globalAlpha=this.opacity,Qt.textAlign="center",Qt.textBaseline="middle",Qt.font=`900 10px ${window.fontFamily}`,Qt.fillStyle=this.backgroundColor,X({x:this.x,y:this.y,width:this.width,height:this.height,radius:8}),Qt.fill(),Qt.fillStyle=this.textColor,Qt.fillText(this.message,this.x+this.width/2,this.y+this.height/2),Qt.restore())}}const Zt=i.p+"static/0.png",te=i.p+"static/1.png",ee=i.p+"static/2.png",ie=i.p+"static/3.png",ne=i.p+"static/4.png",oe=i.p+"static/5.png",se=canvas.getContext("2d");class ae{constructor(){var t;this.map={"red-hit":[Zt,Zt,te,te,ee,ee,ie,ie,ne,ne,oe,oe]},this.queqe=[],t=this.map,Object.entries(t).forEach((t=>{t[1].forEach(((e,i)=>{const n=new Image;n.src=t[1][i],t[1][i]=n}))}))}play(t,e){this.map[t]&&this.queqe.push({index:0,imgs:this.map[t],option:e,option:e})}render(){this.queqe.forEach(((t,e)=>{const i=t.imgs[t.index];i&&(se.drawImage(i,...t.option(i)),t.index=t.index+1),i||this.queqe.splice(e,1)}))}}const he=new class{constructor(){this.map={},this.audioQueue=new Array(8).fill().map((t=>new Audio))}play(t,e=!1){const i=this.audioQueue.find((t=>!t.playing));i.onended=()=>i.playing=!1,i.playing=!0,i.loop=e,i.src=this.map[t],i.play()}},re=new class{constructor(){this.event=[],this.init()}init=()=>{const t=(t,e)=>{this.event.filter((t=>t.type===e)).sort(((t,e)=>e.priority-t.priority)).reduce(((t,e)=>e.option&&e.option.stop?null:[...t,e]),[]).forEach((e=>{e.option&&e.option.ifTouchCover&&!R(t,e.option.ifTouchCover)||e.callback(t)}))};new Array("touchstart","touchmove","touchend","mousedown","mousemove","mouseup").forEach((e=>{canvas.addEventListener(e,(i=>t(i,e)),{passive:!0})}))};addEventListener=(t,e,i)=>{try{window.wx._web&&void 0===window.ontouchstart&&"touchstart"===t&&(t="mousedown"),window.wx._web&&void 0===window.ontouchmove&&"touchmove"===t&&(t="mousemove"),window.wx._web&&void 0===window.ontouchend&&"touchend"===t&&(t="mouseup")}catch{}this.event.push({type:t,callback:e,option:i})};removeEventListener=(t,e)=>{this.event=this.event.filter((i=>i.type!==t&&i.callback!==e))};clearEventListener=()=>{this.event=[]}},le=canvas.getContext("2d");new class{constructor(){this.loadingInformation=!1,this.animationFrameId,this.instance,this.instanceMessage=new Jt,this.instanceAnimation=new ae,this.ImitationInit(),this.loopStart()}render(){le.clearRect(0,0,canvas.width,canvas.height),re.clearEventListener();const t=window.Imitation.state.page.map[window.Imitation.state.page.current];this.instance instanceof t||(this.instance=new t),this.instance.render(),this.instanceMessage.render(),this.instanceAnimation.render()}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}ImitationInit(){window.Imitation.state={page:{current:"home",next:"",map:{transition:G,home:J,explore:dt,pve:bt,store:_t,shop:Rt,reward:Gt}},function:{render:this.render,loopStart:this.loopStart,loopEnd:this.loopEnd,message:(...t)=>this.instanceMessage.send(...t),animation:(...t)=>this.instanceAnimation.play(...t),sound:(...t)=>he.play(...t),event:(...t)=>re.addEventListener(...t),saveInfo:()=>{localStorage.setItem("info",JSON.stringify(window.Imitation.state.info))}},info:null,battle:null,explore:C,shop:k.map((t=>(t.money=O([t.money])[0],t))),reward:null},window.wx._web&&window.location.search&&(window.Imitation.state.page.current=window.location.search.replace("?","")),localStorage.removeItem("info");const t=localStorage.getItem("info");if(t&&(window.Imitation.state.info=JSON.parse(t)),!t){const t={library:{master:M.map((t=>({key:t.key,level:1,exp:0}))),card:E.map((t=>({key:t.key,level:1,exp:0})))},team:[{master:{key:3},card:E.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:E.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:E.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:E.map((t=>({key:t.key}))).filter(((t,e)=>e<8))}],teamIndex:0,money:[{key:1,number:88888},{key:2,number:12888}]};window.Imitation.state.info=t,window.Imitation.state.function.saveInfo()}"pve"===window.Imitation.state.page.current&&(window.Imitation.state.battle={self:{master:{...$([window.Imitation.state.info.library.master.find((t=>t.key===window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:_(window.Imitation.state.info.team[window.Imitation.state.info.teamIndex].card.map((t=>({...t,...window.Imitation.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...$([C[0].boss.master])[0],buff:[]},card:{team:_(C[0].boss.card),hand:[]},AI:C[0].AI},reward:C[0].reward})}}})()})();