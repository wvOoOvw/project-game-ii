(()=>{var t={70:()=>{!function(){try{wx}catch{return}!function(t){const e={};function i(n){if(e[n])return e[n].exports;const s=e[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){n.addEventListener=n.canvas.addEventListener=function(t,e){n.document.addEventListener(t,e)},n.removeEventListener=n.canvas.removeEventListener=function(t,e){n.document.removeEventListener(t,e)};const t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(const t in n){const e=Object.getOwnPropertyDescriptor(s,t);e&&!0!==e.configurable||Object.defineProperty(window,t,{value:n[t]})}for(const t in n.document){const e=Object.getOwnPropertyDescriptor(s.document,t);e&&!0!==e.configurable||Object.defineProperty(s.document,t,{value:n.document[t]})}window.parent=window}else{for(const t in n)s[t]=n[t];s.window=n,window=s,window.top=window.parent=window}}())},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;const n=i(2);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));const s=i(3);Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})}));const o=m(i(9)),a=m(i(10)),r=m(i(17)),h=m(i(18)),c=m(i(19)),l=m(i(11)),d=m(i(12)),u=m(i(20)),f=m(i(4)),p=m(i(21)),g=m(i(22));function m(t){return t&&t.__esModule?t:{default:t}}e.document=a.default,e.navigator=r.default,e.XMLHttpRequest=h.default,e.WebSocket=c.default,e.Image=l.default,e.Audio=d.default,e.FileReader=u.default,e.HTMLElement=f.default,e.localStorage=p.default,e.location=g.default;const x=new o.default;e.canvas=x,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=wx.getSystemInfoSync(),n=i.screenWidth,s=i.screenHeight,o=i.devicePixelRatio,a=e.innerWidth=n,r=e.innerHeight=s;e.devicePixelRatio=o,e.screen={availWidth:a,availHeight:r},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;const n=(s=i(4))&&s.__esModule?s:{default:s};var s;function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return o(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return r(e,t),e}(n.default),e.HTMLCanvasElement=function(t){function e(){return o(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return r(e,t),e}(n.default)},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(o=i(5))&&o.__esModule?o:{default:o};var o;const a=i(8),r=i(2);function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}const l=function(t){function e(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";h(this,e);const i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.className="",i.childern=[],i.style={width:`${r.innerWidth}px`,height:`${r.innerHeight}px`},i.insertBefore=a.noop,i.innerHTML="",i.tagName=t.toUpperCase(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:r.innerWidth,height:r.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){const t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){const t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}(s.default);e.default=l},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(6))&&n.__esModule?n:{default:n}).default);e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s;const o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){const t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){const e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),e}(((s=i(7))&&s.__esModule?s:{default:s}).default);e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};let s=n.get(this);s||(s={},n.set(this,s)),s[t]||(s[t]=[]),s[t].push(e),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){const i=n.get(this)[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}}},{key:"dispatchEvent",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.get(this)[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}}]),t}();e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const t=wx.createCanvas();return t.type="canvas",t.__proto__.__proto__=new n.default("canvas"),t.getContext,t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t},i(3);const n=s(i(4));function s(t){return t&&t.__esModule?t:{default:t}}s(i(10))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=h(i(4)),o=h(i(11)),a=h(i(12)),r=h(i(9));function h(t){return t&&t.__esModule?t:{default:t}}i(15);const c={};var l={readyState:"complete",visibilityState:"visible",documentElement:n,hidden:!1,style:{},location:n.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new s.default("head"),body:new s.default("body"),createElement:function(t){return"canvas"===t?new r.default:"audio"===t?new a.default:"img"===t?new o.default:new s.default(t)},getElementById:function(t){return t===n.canvas.id?n.canvas:null},getElementsByTagName:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[n.canvas]:[]},querySelector:function(t){return"head"===t?l.head:"body"===t?l.body:"canvas"===t||t===`#${n.canvas.id}`?n.canvas:null},querySelectorAll:function(t){return"head"===t?[l.head]:"body"===t?[l.body]:"canvas"===t?[n.canvas]:[]},addEventListener:function(t,e){c[t]||(c[t]=[]),c[t].push(e)},removeEventListener:function(t,e){const i=c[t];if(i&&i.length>0)for(let t=i.length;t--;t>0)if(i[t]===e){i.splice(t,1);break}},dispatchEvent:function(t){const e=c[t.type];if(e)for(let i=0;i<e.length;i++)e[i](t)}};e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(o=i(13))&&o.__esModule?o:{default:o};var o;const a=new WeakMap,r=new WeakMap,h=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);const i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4,i.readyState=0,r.set(i,"");const n=wx.createInnerAudioContext();return a.set(i,n),n.onCanplay((function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=2})),n.onPlay((function(){i.dispatchEvent({type:"play"})})),n.onPause((function(){i.dispatchEvent({type:"pause"})})),n.onEnded((function(){i.dispatchEvent({type:"ended"}),i.readyState=4})),n.onError((function(){i.dispatchEvent({type:"error"})})),t&&(a.get(i).src=t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){a.get(this).play()}},{key:"pause",value:function(){a.get(this).pause()}},{key:"canPlayType",value:function(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){const t=new e;return t.loop=a.get(this).loop,t.autoplay=a.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return a.get(this).currentTime},set:function(t){a.get(this).seek(t)}},{key:"src",get:function(){return r.get(this)},set:function(t){r.set(this,t),a.get(this).src=t}},{key:"loop",get:function(){return a.get(this).loop},set:function(t){a.get(this).loop=t}},{key:"autoplay",get:function(){return a.get(this).autoplay},set:function(t){a.get(this).autoplay=t}},{key:"paused",get:function(){return a.get(this).paused}}]),e}(s.default));e.default=h},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const s=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((n=i(14))&&n.__esModule?n:{default:n}).default);e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var s;const o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}(((s=i(4))&&s.__esModule?s:{default:s}).default);e.default=o},function(t,e,i){i(16)},function(t,e,i){const n=function(t){if(t&&t.__esModule)return t;{const e={};if(null!=t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}}(i(1)),s=(o=i(10))&&o.__esModule?o:{default:o};var o;const a=i(8),r=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=n.canvas,this.currentTarget=n.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=a.noop,this.stopPropagation=a.noop,this.type=e};function h(t){return function(e){const i=new r(t);i.touches=e.touches,i.targetTouches=Array.prototype.slice.call(e.touches),i.changedTouches=e.changedTouches,i.timeStamp=e.timeStamp,s.default.dispatchEvent(i)}}wx.onTouchStart(h("touchstart")),wx.onTouchMove(h("touchmove")),wx.onTouchEnd(h("touchend")),wx.onTouchCancel(h("touchcancel"))},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),s={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:n.noop,watchPosition:n.noop,clearWatch:n.noop}};e.default=s},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=new WeakMap,s=new WeakMap,o=new WeakMap,a=new WeakMap,r=new WeakMap;function h(t){if("function"==typeof this[`on${t}`]){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this[`on${t}`].apply(this,i)}}function c(t){this.readyState=t,h.call(this,"readystatechange")}const l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,o.set(this,{"content-type":"application/x-www-form-urlencoded"}),a.set(this,{})}return i(t,[{key:"abort",value:function(){const t=r.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){const t=a.get(this);return Object.keys(t).map((function(e){return`${e}: ${t[e]}`})).join("\n")}},{key:"getResponseHeader",value:function(t){return a.get(this)[t]}},{key:"open",value:function(e,i){s.set(this,e),n.set(this,i),c.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){const e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:i,url:n.get(this),method:s.get(this),header:o.get(this),responseType:this.responseType,success:function(i){let n=i.data;const s=i.statusCode,o=i.header;if("string"!=typeof n&&!(n instanceof ArrayBuffer))try{n=JSON.stringify(n)}catch(t){}if(e.status=s,a.set(e,o),h.call(e,"loadstart"),c.call(e,t.HEADERS_RECEIVED),c.call(e,t.LOADING),e.response=n,n instanceof ArrayBuffer){e.responseText="";const t=new Uint8Array(n),i=t.byteLength;for(let n=0;n<i;n++)e.responseText+=String.fromCharCode(t[n])}else e.responseText=n;c.call(e,t.DONE),h.call(e,"load"),h.call(e,"loadend")},fail:function(t){const i=t.errMsg;-1!==i.indexOf("abort")?h.call(e,"abort"):h.call(e,"error",i),h.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){const i=o.get(this);i[t]=e,o.set(this,i)}}]),t}();l.UNSEND=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=function(){function t(t,e){for(let i=0;i<e.length;i++){const n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}const s=new WeakMap,o=function(){function t(e){const i=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError(`Failed to construct 'WebSocket': The URL '${e}' is invalid`);this.url=e,this.readyState=t.CONNECTING;const a=wx.connectSocket({url:e,protocols:Array.isArray(o)?o:[o]});return s.set(this,a),a.onClose((function(e){i.readyState=t.CLOSED,"function"==typeof i.onclose&&i.onclose(e)})),a.onMessage((function(t){"function"==typeof i.onmessage&&i.onmessage(t)})),a.onOpen((function(){i.readyState=t.OPEN,"function"==typeof i.onopen&&i.onopen()})),a.onError((function(t){"function"==typeof i.onerror&&i.onerror(new Error(t.errMsg))})),this}return i(t,[{key:"close",value:function(e,i){this.readyState=t.CLOSING,s.get(this).close({code:e,reason:i})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError(`Failed to send message: The data ${t} is invalid`);s.get(this).send({data:t})}}]),t}();o.CONNECTING=0,o.OPEN=1,o.CLOSING=2,o.CLOSED=3,e.default=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=i},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={href:"game.js",reload:function(){}}}])}()}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{"use strict";i(70);const t=new class{constructor(){this.canvas_,this.create(),this.flex()}create(){try{if(wx)return this.canvas_=window.canvas}catch{}const t=document.querySelector("body");t.style.padding="0",t.style.margin="auto",t.style.left=0,t.style.right=0,t.style.top=0,t.style.bottom=0,t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.background="black";const e=document.createElement("canvas");this.canvas_=e,t.appendChild(e)}flex(){const t=this.safeArea;this.canvas_.style.display="block",this.canvas_.style.touchAction="none",this.canvas_.style.position="absolute",this.canvas_.width=t.width,this.canvas_.height=t.height,this.canvas_.style.top=t.top+"px",this.canvas_.style.left=t.left+"px";const e=this.canvas_.width,i=this.canvas_.height;this.canvas_.width=2*e,this.canvas_.height=2*i,this.canvas_.style.width=e+"px",this.canvas_.style.height=i+"px",this.canvas_.getContext("2d").scale(2,2)}get canvas(){try{if(wx)return window.canvas}catch{}return this.canvas_}get ctx(){try{if(wx)return window.canvas.getContext("2d")}catch{}return this.canvas_.getContext("2d")}get width(){try{if(wx)return window.canvas.clientWidth}catch{}return this.canvas_.clientWidth}get height(){try{if(wx)return window.canvas.clientHeight}catch{}return this.canvas_.clientHeight}get safeArea(){try{if(wx)return wx.getSystemInfoSync().safeArea}catch{}const t=void 0===window.ontouchstart?.5*window.document.documentElement.clientHeight:window.document.documentElement.clientWidth,e=window.document.documentElement.clientHeight,i=e;return{top:0,left:window.document.documentElement.clientWidth/2-t/2,right:window.document.documentElement.clientWidth/2+t/2,bottom:i,width:t,height:e}}},e=i.p+"static/0.png",n=i.p+"static/1.png",s=i.p+"static/2.png",o=i.p+"static/3.png",a=i.p+"static/4.png",r=i.p+"static/5.png",h=new class{constructor(){this.map={"red-hit":[e,e,n,n,s,s,o,o,a,a,r,r]},this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>Promise.all(t[1].map(((e,i)=>new Promise((e=>{const n=new Image;n.src=t[1][i],n.onload=e,t[1][i]=n}))))))))}play(t,e){this.map[t]||console.error(t),this.queqe.push({key:t,src:this.map[t],option:e,index:0})}stop(t){this.queqe=this.queqe.filter((e=>e.key!==t))}clear(){this.queqe=[]}find(t){return this.queqe.filter((e=>e.key===t))}render(){this.queqe.forEach(((e,i)=>{const n=e.src[e.index];n&&(t.ctx.drawImage(n,...e.option(n)),e.index=e.index+1),n||this.queqe.splice(i,1)}))}},c=new class{constructor(){this.event=[];const e=(t,e)=>{const i=this.event.filter((t=>t.type===e)).sort(((t,e)=>e.priority-t.priority));var n=!1;i.forEach((e=>{n||e.option&&e.option.ifTouchCover&&!ct(t,e.option.ifTouchCover)||(e.option&&e.option.stop&&(n=!0),"function"==typeof e.callback&&e.callback(t))}))};new Array("touchstart","touchmove","touchend","mousedown","mousemove","mouseup").forEach((i=>{t.canvas.addEventListener(i,(t=>e(t,i)),{passive:!0})}))}addEventListener=(t,e,i)=>{try{void 0===window.ontouchstart&&"touchstart"===t&&(t="mousedown"),void 0===window.ontouchmove&&"touchmove"===t&&(t="mousemove"),void 0===window.ontouchend&&"touchend"===t&&(t="mouseup")}catch{}this.event.push({type:t,callback:e,option:i})};removeEventListener=(t,e)=>{this.event=this.event.filter((i=>i.type!==t&&i.callback!==e))};clearEventListener=()=>{this.event=[]}},l=Symbol("_Allow");function d(t){this.ImitationINS=t,this.dependentQueue=[],this.monitorQueue=[]}function u(t){this.state=t,this.MonitorINS=new d(this)}d.prototype.dispatch=function(){this.monitorQueue.forEach(((t,e)=>{const i=this.dependentQueue[e],n=this.executeDependent(t.dependent);return n===l||Array.isArray(n)&&Array.isArray(i)&&(s=n,o=i,Array.isArray(s)&&Array.isArray(o)&&(s.length!==o.length||s.filter(((t,e)=>t===o[e])).length!==s.length))||!Array.isArray(n)&&!Array.isArray(i)&n!==i?(this.executeEvent(t.event),void(this.dependentQueue[e]=n)):void(this.dependentQueue[e]=n);var s,o}))},d.prototype.register=function(t,e=l){const i={event:t,dependent:e};return this.monitorQueue.push(i),this.dependentQueue.push(this.executeDependent(e)),()=>{this.monitorQueue.forEach(((t,e)=>{t===i&&(this.monitorQueue=this.monitorQueue.filter(((t,i)=>i!==e)),this.dependentQueue=this.dependentQueue.filter(((t,i)=>i!==e)))}))}},d.prototype.executeEvent=function(t){t(this.ImitationINS.state)},d.prototype.executeDependent=function(t){return"function"==typeof t?t(this.ImitationINS.state):t},u.prototype.setState=function(t){this.state="function"==typeof t?t(this.state):t,this.dispatch()},u.prototype.assignState=function(t){this.state=Object.assign(this.state,"function"==typeof t?t(this.state):t),this.dispatch()},u.prototype.register=function(){return this.MonitorINS.register(...arguments)},u.prototype.dispatch=function(){return this.MonitorINS.dispatch(...arguments)};const f=new u,p=(e,i)=>{const n=i.x,s=i.y,o=i.width,a=i.height;var r=0,h=0,c=e.width,l=e.height;const d=Math.max(o/e.width,a/e.height),u=e.width*d-o,f=e.height*d-a;u&&(r=u/2/d,c-=u/d),f&&(h=f/2/d,l-=f/d),t.ctx.drawImage(e,r,h,c,l,n,s,o,a)},g=(e,i)=>{var n=i.x,s=i.y,o=i.width,a=i.height;const r=a/e.height,h=e.width*r;n+=(o-h)/2,t.ctx.drawImage(e,n,s,h,a)},m=e=>{const i=e.x,n=e.y,s=e.width,o=e.height,a=Array.isArray(e.radius)?e.radius:new Array(4).fill(e.radius);t.ctx.beginPath(),t.ctx.moveTo(i,n+a[0]),t.ctx.arcTo(i,n,i+a[0],n,a[0]),t.ctx.lineTo(i+s-a[1],n),t.ctx.arcTo(i+s,n,i+s,n+a[1],a[1]),t.ctx.lineTo(i+s,n+o-a[2]),t.ctx.arcTo(i+s,n+o,i+s-a[2],n+o,a[2]),t.ctx.lineTo(i+a[3],n+o),t.ctx.arcTo(i,n+o,i,n+o-a[3],a[3]),t.ctx.closePath()},x=e=>{const i=e.x,n=e.y,s=e.width,o=e.height,a=Array.isArray(e.radius)?e.radius:new Array(4).fill(e.radius);t.ctx.beginPath(),t.ctx.moveTo(i,n+a[0]),t.ctx.lineTo(i+a[0],n),t.ctx.lineTo(i+s-a[1],n),t.ctx.lineTo(i+s,n+a[1]),t.ctx.lineTo(i+s,n+o-a[2]),t.ctx.lineTo(i+s-a[1],n+o),t.ctx.lineTo(i+a[3],n+o),t.ctx.lineTo(i,n+o-a[3]),t.ctx.closePath()},y=e=>{const i=e.x,n=e.y,s=e.width,o=e.height;t.ctx.beginPath(),t.ctx.moveTo(i,n),t.ctx.lineTo(i+s,n),t.ctx.lineTo(i+s,n+o),t.ctx.lineTo(i,n+o),t.ctx.closePath()},w=e=>{const i=e.x,n=e.y,s=e.width,o=e.wrapSpace,a=e.text;var r="",h=[];a.split("").forEach((e=>{t.ctx.measureText(r+e).width>s&&(h.push(r),r=""),r+=e})),h.push(r),h.forEach(((e,s)=>{t.ctx.fillText(e,i,n+s*o)}))},v=new class{constructor(){this.message="",this.backgroundColor="rgba(255, 255, 255, 1)",this.textColor="rgba(0, 0, 0, 1)",this.timeoutRef=null,this.show=!1,this.opacity=0,this.width=Math.min(t.width-24,200),this.height=32,this.x=(t.width-this.width)/2,this.y=t.height}play(t,e="rgba(255, 255, 255, 1)",i="rgba(0, 0, 0, 1)"){clearTimeout(this.timeoutRef),this.message=t,this.backgroundColor=e,this.textColor=i,this.show=!0,this.timeoutRef=at(60,(()=>{this.show=!1,this.timeoutRef=null}))}render(){this.show&&this.opacity<1&&(this.opacity=rt(this.opacity+.05)),!this.show&&this.opacity>0&&(this.opacity=rt(this.opacity-.05)),this.show&&this.y>t.height-44&&(this.y=rt(this.y-4)),!this.show&&this.y<t.height&&(this.y=rt(this.y+4)),(this.show||0!==this.opacity)&&(t.ctx.save(),t.ctx.globalAlpha=this.opacity,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 10px Courier",t.ctx.fillStyle=this.backgroundColor,m({x:this.x,y:this.y,width:this.width,height:this.height,radius:8}),t.ctx.fill(),t.ctx.fillStyle=this.textColor,t.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2),t.ctx.restore())}},T=i.p+"static/aiyafala.37be7922.png",b=i.p+"static/background-blur.d92af6bc.jpg",A=i.p+"static/background.29e6b3be.jpg",I=i.p+"static/chen.b65023b5.png",C=i.p+"static/cuoe.c908ed3c.png",k=i.p+"static/fengdi.72b31ee1.png",S=i.p+"static/hei.6cc6018a.png",E=i.p+"static/heijian.e5f9b0d1.png",P=i.p+"static/huang.a3fc17ce.png",M=i.p+"static/kongxian.de9b3926.png",_=i.p+"static/linguang.acf5bd67.png",O=i.p+"static/nengtianshi.3189957b.png",j=i.p+"static/nian.afb4fd28.png",H=i.p+"static/niyan.0a121257.png",N=i.p+"static/saileiya.1d6838fc.png",D=i.p+"static/senran.4ce470a9.png",$=i.p+"static/shan.ec3e6c6d.png",L=i.p+"static/shier.4eb733a9.png",R=i.p+"static/tuijin.5a8f324f.png",B=i.p+"static/w.86ab2d3c.png",q=(i.p,i.p+"static/yanwei.29b3239c.png"),X=(i.p,i.p+"static/yinhui.3c5f7f39.png"),W=new class{constructor(){this.map={"background-transition":A,"background-home":b,"background-page":b,"background-loading":b,"money-1":B,"money-2":B,"money-3":B,"explore-1":O,"explore-2":O,"shop-1":M,"shop-2":M,"shop-3":M,"shop-4":M,"shop-5":M,"master-1":I,"master-2":C,"master-3":k,"master-4":_,"master-5":j,"card-1":H,"card-2":N,"card-3":D,"card-4":$,"card-5":L,"card-6":R,"card-7":q,"card-8":X,"card-9":P,"card-10":T,"card-11":S,"card-12":E}}load(){return Promise.all(Object.entries(this.map).map((t=>new Promise((e=>{const i=new Image;i.onload=e,i.src=this.map[t[0]],this.map[t[0]]=i})))))}get(t){return this.map[t]||console.error(t),this.map[t]}},Y=i.p+"static/1011_ch4_act1.mp3",F=(i.p,i.p+"static/Vo1002_Lup01.mp3"),U=i.p+"static/bgm.m4a",V=i.p+"static/pve.m4a",G=new class{constructor(){this.map={"background-main":U,"background-pve":V,"master-main-1":F,"master-main-2":F,"master-main-3":F,"master-main-4":F,"master-main-5":F,"master-action-1":Y,"master-action-2":Y,"master-action-3":Y,"master-action-4":Y,"master-action-5":Y,"card-main-1":F,"card-main-2":F,"card-main-3":F,"card-main-4":F,"card-main-5":F,"card-main-6":F,"card-main-7":F,"card-main-8":F,"card-main-9":F,"card-main-10":F,"card-main-11":F,"card-main-12":F,"card-action-1":Y,"card-action-2":Y,"card-action-3":Y,"card-action-4":Y,"card-action-5":Y,"card-action-6":Y,"card-action-7":Y,"card-action-8":Y,"card-action-9":Y,"card-action-10":Y,"card-action-11":Y,"card-action-12":Y},this.queqe=[]}load(){return Promise.all(Object.entries(this.map).map((t=>Promise.race([new Promise((e=>{const i=new Audio;i.onloadeddata=e,i.src=this.map[t[0]],i.load()})),new Promise((t=>{setTimeout((()=>t()),1e3)}))]))))}play(t,e){this.map[t]||console.error(t),this.queqe.push({key:t,option:e,Audio:new Audio(this.map[t])})}stop(t){this.queqe.forEach((e=>{e.key===t&&(e.stop=!0)}))}clear(){this.queqe=[]}find(t){return this.queqe.filter((e=>e.key===t))}render(){this.queqe.forEach(((t,e)=>{Object.assign(t.Audio,t.option),t.Audio.onplay=()=>t.play=!0,t.Audio.onpause=()=>this.queqe=this.queqe.filter((e=>e!==t));try{t.stop&&t.Audio.pause(),t.play||t.Audio.play()}catch{}}))}},Q=(t,e)=>Math.floor(t*Math.pow(1.2,e-1));var z=[{key:1,name:"金币"},{key:2,name:"晶石"}],K=[{key:1,name:"故事 I",description:"可能包含: 金币 20 - 50 枚",difficulty:1,type:"alltime",boss:{master:{key:1,level:1},card:[{key:1,level:1},{key:2,level:1}]},reward:()=>[{money:!0,key:1,number:Math.floor(31*Math.random())+20}]},{key:2,name:"梦境 I",description:"可能包含: 小火把 Exp 5 - 20, 大火把 Exp 5 - 20",difficulty:2,type:"alltime",boss:{master:{key:2,level:2},card:[{key:1,level:3},{key:2,level:3},{key:3,level:3}]},reward:()=>[{card:!0,key:1,exp:Math.floor(16*Math.random())+5},{card:!0,key:2,exp:Math.floor(16*Math.random())+5}]}],J=[{key:1,name:"火系基础礼盒I",description:"可能包含: 小火把 Exp 0 - 20, 大火把 Exp 0 - 20",type:"alltime",money:{key:1,number:388},reward:()=>[{card:!0,key:1,exp:Math.floor(21*Math.random())},{card:!0,key:2,exp:Math.floor(21*Math.random())}]},{key:2,name:"火系基础礼盒II",description:"可能包含: 火焰领主 Exp 50 - 100, 炎魔 Exp 50 - 100",type:"alltime",money:{key:1,number:388},reward:()=>[{master:!0,key:2,exp:Math.floor(51*Math.random()+50)},{master:!0,key:3,exp:Math.floor(51*Math.random()+50)}]},{key:3,name:"新手礼盒I",description:"可能包含: 祭司 Exp 50 - 150",type:"alltime",money:{key:1,number:188},reward:()=>[{master:!0,key:1,exp:Math.floor(101*Math.random()+50)}]}],Z=[{key:1,name:"祭司",HP:t=>Q(1e4,t),ATTACT:t=>Q(800,t),ACTION:2,skill:[{name:"庇护 I",description:t=>"使用卡牌后, 回复 2% HP",function:(t,e,i,n,s)=>{const o=Math.floor(.02*n.master.HP_);i.push({roleMessage:`${e.name} HP + ${o}`,target:"self"}),i.push({effect:"HP",target:"self",value:o})}},{name:"庇护 II",description:t=>"使用卡牌后, 提升 2% 基础ATTACT",function:(t,e,i,n,s)=>{const o=Math.floor(.02*n.master.ATTACT_);i.push({roleMessage:`${e.name} ATTACT + ${o}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:o})}}]},{key:2,name:"火焰领主",HP:t=>Q(1e4,t),ATTACT:t=>Q(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,s)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}}]},{key:3,name:"炎魔",HP:t=>Q(8e3,t),ATTACT:t=>Q(800,t),ACTION:2,skill:[{name:"欲火",description:t=>"使用火焰系卡牌后, 给予对方 25%ATTACT 的伤害",function:(t,e,i,n,s)=>{if("火焰"===t.race){const t=Math.floor(.25*n.master.ATTACT);i.push({roleMessage:`${e.name} HP - ${t}`,target:"opposite"}),i.push({effect:"HP",target:"opposite",value:-t})}}},{name:"火焰控制",description:t=>"使用火焰系卡牌后, 提升 5% ATTACT",function:(t,e,i,n,s)=>{if("火焰"===t.race){const t=Math.floor(.05*n.master.ATTACT);i.push({roleMessage:`${e.name} ATTACT + ${t}`,target:"self"}),i.push({effect:"ATTACT",target:"self",value:t})}}}]},{key:4,name:"丛林守护者",HP:t=>Q(12e3,t),ATTACT:t=>Q(680,t),ACTION:2,skill:[{name:"自然之力",description:t=>"使用卡牌后, 回复 4% HP, 并有 25% 几率提升一次牌库随机一张卡牌的等级",function:(t,e,i,n,s)=>{if("自然"===t.race){const s=Math.floor(.04*n.master.HP_);if(i.push({roleMessage:`${e.name} HP + ${s}`,target:"self"}),i.push({effect:"HP",target:"self",value:s}),Math.random()>.5){const e=ht(n.card.team,1)[0];i.push({roleMessage:`{skill.name} ${e.name} LEVEL + 1`,target:"opposite"}),i.push({effect:"LEVEL",target:"self",key:t.key,number:1})}}}}]}],tt=[{key:1,name:"小火把",type:"进攻 状态",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并附加给目标 1 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:1}]}},{key:2,name:"大火把",type:"进攻 状态",race:"火焰",description:t=>`造成 ${50+2.5*(t-1)}%ATTACT 伤害, 并附加给目标 2 层 '燃'`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(.5+.025*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"BUFF",target:"opposite",name:"燃",number:2}]}},{key:3,name:"点燃",type:"进攻",race:"火焰",description:t=>`造成目标 '燃' 层数 * ${35+2*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT*(.35+.02*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:4,name:"火焰冲击",type:"进攻",race:"火焰",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 若目标拥有 '燃' 则伤害 * 1.5`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.find((t=>"燃"===t))?e.master.ATTACT*(1+.05*(t.level-1))*1.5:e.master.ATTACT*(1+.05*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:5,name:"火焰聚能",type:"增益",race:"火焰",description:t=>`消耗对手的所有 '燃' , 提升自身 '燃' 层数 * ${10+.5*(t-1)} 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(i.master.buff.filter((t=>"燃"===t)).length*e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"BUFF",target:"opposite",name:"燃",number:-i.master.buff.filter((t=>"燃"===t)).length}]}},{key:6,name:"火球术",type:"进攻",race:"火焰",description:t=>`造成 ${120+6*(t-1)}%ATTACT 伤害`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1.2+.06*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n}]}},{key:7,name:"火球燃烧",type:"进攻 提升",race:"火焰",description:t=>`造成 ${60+3*(t-1)} 伤害, 提升一次牌库 '火球术' 等级`,function:(t,e,i)=>{const n=[],s=Math.floor(e.master.ATTACT*(.6+.03*(t.level-1)));return n.push({message:[t.name,st(t.level)].join(" ")}),n.push({roleMessage:`${t.name} HP - ${s}`,target:"opposite"}),n.push({animation:"red-hit",target:"opposite"}),n.push({effect:"HP",target:"opposite",value:-s}),e.card.team.some((t=>6===t.key))&&(n.push({roleMessage:`${t.name} 火球术 LEVEL + 1`,target:"self"}),n.push({effect:"LEVEL",target:"self",key:6,number:1})),n}},{key:8,name:"自燃",type:"辅助",race:"火焰",description:t=>`扣除自身当前生命值 10%, 提升 ${20+1*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.2+.01*(t.level-1))),s=Math.floor(.1*e.master.HP);return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{roleMessage:`${t.name} HP - ${s}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n},{effect:"HP",target:"self",value:-s}]}},{key:9,name:"火焰蓄能",type:"辅助",race:"火焰",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:10,name:"自然治愈",type:"治疗",race:"自然",description:t=>`回复 ${10+.5*(t-1)}% HP`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"HP",target:"self",value:n}]}},{key:11,name:"自然蓄能",type:"辅助",race:"自然",description:t=>`提升 ${10+.5*(t-1)}% 基础ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT_*(.1+.005*(t.level-1)));return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} ATTACT + ${n}`,target:"self"},{animation:"red-hit",target:"self"},{effect:"ATTACT",target:"self",value:n}]}},{key:12,name:"缠绕",type:"进攻",race:"自然",description:t=>`造成 ${100+5*(t-1)}%ATTACT 伤害, 并降低目标 5% ATTACT`,function:(t,e,i)=>{const n=Math.floor(e.master.ATTACT*(1+.05*(t.level-1))),s=Math.floor(.05*i.master.ATTACT);return[{message:[t.name,st(t.level)].join(" ")},{roleMessage:`${t.name} HP - ${n}`,target:"opposite"},{roleMessage:`${t.name} ATTACT - ${n}`,target:"opposite"},{animation:"red-hit",target:"opposite"},{effect:"HP",target:"opposite",value:-n},{effect:"ATTACT",target:"opposite",value:-s}]}}];const et=t=>t.reduce(((t,e)=>{const i=[...t],n=tt.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),it=t=>t.reduce(((t,e)=>{const i=[...t],n=Z.find((t=>e.key===t.key));return i.push({...n,...e,HP:n.HP(e.level),ATTACT:n.ATTACT(e.level),HP_:n.HP(e.level),ATTACT_:n.ATTACT(e.level)}),i}),[]),nt=t=>t.reduce(((t,e)=>{const i=[...t],n=z.find((t=>e.key===t.key));return i.push({...n,...e}),i}),[]),st=t=>1===t?"I":2===t?"II":3===t?"III":4===t?"IV":5===t?"V":6===t?"VI":7===t?"VII":8===t?"VIII":9===t?"IX":10===t?"X":11===t?"XI":12===t?"XII":13===t?"XIII":14===t?"XIV":15===t?"XV":16===t?"XVI":void 0,ot=t=>{try{if(wx)return null}catch{}return new URL(location.href).searchParams.get(t)},at=async(t,e)=>{var i=0;const n=e=>{i===t&&e(),i!==t&&(i+=1,requestAnimationFrame((()=>n(e))))};e&&n(e),e||await new Promise((t=>n(t)))},rt=t=>Number(Number(t).toFixed(4)),ht=(t,e)=>{var i=[],n=[...t];return new Array(e).fill().forEach((()=>{const t=Math.floor(Math.random()*n.length);n[t]&&(i.push(n[t]),n=n.filter(((e,i)=>i!==t)))})),i},ct=(e,i)=>{const n=i.x,s=i.y,o=i.width,a=i.height;var r=e.x||e.touches[0].clientX,h=e.y||e.touches[0].clientY;try{const e=t.safeArea;r-=e.left,h-=e.top}catch{}return r>=n&&r<=n+o&&h>=s&&h<=s+a},lt=(t,e)=>{const{x:i,y:n,width:s,height:o}=t,{x:a,y:r,width:h,height:c}=e;return i+s>a&&i<a+h&&n+o>r&&n<r+c},dt=class{constructor(){this.opacity=0,this.count=0}render(){if(this.count<=20&&(this.opacity=rt(this.opacity+.05),this.count=this.count+1),this.count>20&&this.count<=40&&(this.count=this.count+1),this.count>40&&this.count<=60&&(this.opacity=rt(this.opacity-.05),this.count=this.count+1),this.count>60)return f.state.page.current=f.state.page.next,void(f.state.page.next="");t.ctx.globalAlpha=this.opacity,p(W.get("background-transition"),{x:0,y:0,width:t.width,height:t.height}),t.ctx.globalAlpha=1}},ut=class{constructor(){this.time=0}render(){this.time=this.time+1/32,y({x:0,y:0,width:t.width,height:t.height}),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 14px Courier",t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(`加载中${new Array(Math.floor(this.time%4)).fill(".").join("")}`,t.width/2,t.height/2)}},ft=class{constructor(){}render(){p(W.get("background-home"),{x:0,y:0,width:t.width,height:t.height}),new Array(["商店","shop"],["探索","explore"],["编队","store"]).forEach(((e,i)=>{const n={x:t.width/2-60,y:t.height-120-60*i,width:120,height:40,radius:8};t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 14px Courier",x(n),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(e[0],n.x+n.width/2,n.y+n.height/2),c.addEventListener("touchstart",(()=>{f.state.page.current="transition",f.state.page.next=e[1]}),{ifTouchCover:n})})),new Array(["音乐","soundBackground"],["音效","soundSource"]).forEach(((e,i)=>{const n={y:12,width:64,height:28,radius:4};n.x=12+i*(12+n.width),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 10px Courier",x(n),t.ctx.fillStyle=f.state[e[1]]?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle=f.state[e[1]]?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText(e[0],n.x+n.width/2,n.y+n.height/2),c.addEventListener("touchstart",(()=>{f.state[e[1]]=!f.state[e[1]]}),{ifTouchCover:n})}))}};class pt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.contentWidth=t.contentWidth,this.contentHeight=t.contentHeight,this.scrollPosition=t.scrollPosition||[0,0],this.mouseDownPosition=null}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY]}catch{}}eventUp(t){this.mouseDownPosition=null}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i];var n=this.scrollPosition[0]-e,s=this.scrollPosition[1]-i;this.contentWidth||(n=this.scrollPosition[0]),this.contentHeight||(s=this.scrollPosition[1]),this.scrollPosition=[n,s]}render(e){if(!this.mouseDownPosition){const t=16;this.scrollPosition[0]<0&&(this.scrollPosition[0]=this.scrollPosition[0]/t<-1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.scrollPosition[1]<0&&(this.scrollPosition[1]=this.scrollPosition[1]/t<-1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.scrollPosition[0]>0&&((this.contentWidth-this.width<0||this.contentWidth-this.width==0)&&(this.scrollPosition[0]=this.scrollPosition[0]/t>1/t?this.scrollPosition[0]-this.scrollPosition[0]/t:0),this.contentWidth-this.width>0&&this.scrollPosition[0]>this.contentWidth-this.width&&(this.scrollPosition[0]=(this.scrollPosition[0]-(this.contentWidth-this.width))/t>1/t?this.scrollPosition[0]-(this.scrollPosition[0]-(this.contentWidth-this.width))/t:this.contentWidth-this.width)),this.scrollPosition[1]>0&&((this.contentHeight-this.height<0||this.contentHeight-this.height==0)&&(this.scrollPosition[1]=this.scrollPosition[1]/t>1/t?this.scrollPosition[1]-this.scrollPosition[1]/t:0),this.contentHeight-this.height>0&&this.scrollPosition[1]>this.contentHeight-this.height&&(this.scrollPosition[1]=(this.scrollPosition[1]-(this.contentHeight-this.height))/t>1/t?this.scrollPosition[1]-(this.scrollPosition[1]-(this.contentHeight-this.height))/t:this.contentHeight-this.height))}t.ctx.save();const i={x:this.x,y:this.y,width:this.width,height:this.height};y(i),t.ctx.clip(),e(this.scrollPosition),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:i}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class gt{constructor(t){this.content=t.content,this.itemWidth=t.itemWidth||64,this.itemHeight=t.itemHeight||30,this.itemRadius=t.itemRadius||4,this.itemBackgroundColor=t.itemBackgroundColor||["rgba(255, 255, 255, 1)","rgba(0, 0, 0, 1)"],this.itemTextColor=t.itemTextColor||["rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"]}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get height(){return this.content.length*this.itemHeight+12*(this.content.length-1)+24}drawBackground(){m({x:12,y:t.height-this.height-12,width:t.width-24,height:this.height,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 0.5)",t.ctx.fill()}drawContent(){t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 10px Courier",this.content.forEach(((e,i)=>{const n={left:0,right:0};e.forEach(((s,o)=>{var a={};if(a.y=t.height-36-this.itemHeight-i*this.itemHeight-12*(i-1),a.width=s.width||this.itemWidth,a.height=s.height||this.itemHeight,a.radius=s.radius||this.itemRadius,a.backgroundColor=s.backgroundColor||this.itemBackgroundColor,a.textColor=s.textColor||this.itemTextColor,"left"===s.justifyContent&&(a.x=24+n[s.justifyContent]*(a.width+12)),"right"===s.justifyContent&&(a.x=t.width-24-n[s.justifyContent]*(a.width+12)-a.width),"center"===s.justifyContent){a.x=(t.width-a.width)/2;const i=(o-(e.length/2-.5))*(a.width+12);a.x=a.x+i}n[s.justifyContent]=n[s.justifyContent]+1,a.x=s.x||a.x,a={...a,...s},t.ctx.fillStyle=a.active?a.backgroundColor[1]:a.backgroundColor[0],m(a),t.ctx.fill(),t.ctx.fillStyle=a.active?a.textColor[1]:a.textColor[0],t.ctx.fillText(a.text,a.x+a.width/2,a.y+a.height/2),c.addEventListener("touchstart",(t=>a.event?a.event(t):null),{ifTouchCover:a})}))}))}render(){t.ctx.save(),this.drawBackground(),this.drawContent(),t.ctx.restore()}}class mt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.novaTime=0}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),t.ctx.globalAlpha=this.novaTime,x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(0, 0, 0, 0.5)",t.ctx.fill(),t.ctx.restore()}}class xt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=0,this.offsetY=0,this.card=t.card,this.touchStart=t.touchStart,this.touchEnd=t.touchEnd,this.mouseDownPosition=null,this.novaTime=0,this.ifTouchEndTime=0,this.mouseDownPositionTime=0}get ifTouchEnd(){return this.offsetY<0-this.height/2}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}get color(){const t=this.ifTouchEndTime,e=[0,0,0];return[`rgba(${Math.floor(255-t*(255-e[0]))}, ${Math.floor(255-t*(255-e[1]))}, ${Math.floor(255-t*(255-e[2]))}, 0.75)`,`rgba(${Math.floor(t*(255-e[0])+e[0])}, ${Math.floor(t*(255-e[1])+e[1])}, ${Math.floor(t*(255-e[2])+e[2])}, 1)`]}eventDown(t){try{this.mouseDownPosition=[t.x||t.touches[0].clientX,t.y||t.touches[0].clientY],this.touchStart()}catch{}}eventUp(t){this.ifTouchEnd&&this.touchEnd(),this.mouseDownPosition=null,this.offsetX=0,this.offsetY=0}eventMove(t){if(!this.mouseDownPosition)return;const e=(t.pageX||t.targetTouches[0].pageX)-this.mouseDownPosition[0],i=(t.pageY||t.targetTouches[0].pageY)-this.mouseDownPosition[1];this.mouseDownPosition=[this.mouseDownPosition[0]+e,this.mouseDownPosition[1]+i],this.offsetX=this.offsetX+e,this.offsetY=this.offsetY+i}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=this.color,a=.5*n,r=.12*n,h=e+.05*n,c=i+.05*n;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle=o[0],t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle=o[1],t.ctx.fillText("CARD 卡牌",h+a/2,c+r/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.color,a=this.card,r=.5*n,h=.12*n,c=e+n-r-.05*n,l=i+s-h-.05*n,d=h/2,u=[a.name,st(a.level)];a.number&&u.push("x"+a.number),x({x:c,y:l,width:r,height:h,radius:d}),t.ctx.fillStyle=o[0],t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle=o[1],t.ctx.fillText(u.join(" "),c+r/2,l+h/2)}drawRace(){const{x:e,y:i,width:n,height:s}=this.option,o=this.color,a=this.card,r=.9*n,h=.12*n,c=e+.05*n,l=i+.22*n;x({x:c,y:l,width:r,height:h,radius:2}),t.ctx.fillStyle=o[0],t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle=o[1],t.ctx.fillText(a.race,c+r/2,l+h/2)}drawType(){const{x:e,y:i,width:n,height:s}=this.option,o=this.color,a=this.card,r=.9*n,h=.12*n,c=e+.05*n,l=i+.39*n;x({x:c,y:l,width:r,height:h,radius:2}),t.ctx.fillStyle=o[0],t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle=o[1],t.ctx.fillText(a.type,c+r/2,l+h/2)}drawDescription(){const{x:e,y:i,width:n,height:s}=this.option,o=this.color,a=this.card,r=.9*n,h=e+.05*n,c=i+.56*n;x({x:h,y:c,width:r,height:.57*n,radius:2}),t.ctx.fillStyle=o[0],t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle=o[1],w({x:h+.05*n,y:c+.05*n,width:r-.1*n,wrapSpace:.075*n,text:a.description(a.level)})}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),this.mouseDownPosition&&this.mouseDownPositionTime<1&&(this.mouseDownPositionTime=rt(this.mouseDownPositionTime+.05)),!this.mouseDownPosition&&this.mouseDownPositionTime>0&&(this.mouseDownPositionTime=rt(this.mouseDownPositionTime-.05)),this.ifTouchEnd&&this.ifTouchEndTime<1&&(this.ifTouchEndTime=rt(this.ifTouchEndTime+.05)),!this.ifTouchEnd&&this.ifTouchEndTime>0&&(this.ifTouchEndTime=rt(this.ifTouchEndTime-.05));const e=this.card,{x:i,y:n,width:s,height:o}=this.option;t.ctx.save(),t.ctx.translate(i+s/2,n+o/2),t.ctx.scale(this.mouseDownPositionTime+1,this.mouseDownPositionTime+1),t.ctx.translate(-(i+s/2),-(n+o/2)),t.ctx.globalAlpha=this.novaTime,x({x:i,y:n,width:s,height:o,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),p(e.imageDOM,{x:i,y:n,width:s,height:o}),0!==this.mouseDownPositionTime&&(t.ctx.globalAlpha=this.mouseDownPositionTime,this.drawTitle(),this.drawName(),this.drawRace(),this.drawType(),this.drawDescription()),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class yt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.money=t.money,this.novaTime=0}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=(this.money,.35*n),a=.07*n,r=e+.03*n,h=i+.03*n;x({x:r,y:h,width:o,height:a,radius:a/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText("MONEY 货币",r+o/2,h+a/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.money,a=.35*n,r=.2*s,h=e+n-a-.1*s,c=i+s-r-.1*s;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText([master.name,o.number].join(" "),h+a/2,c+r/2)}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option,o=this.money;t.ctx.save(),x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),p(o.imageDOM,{x:e,y:i,width:n,height:s}),t.ctx.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),t.ctx.restore()}}class wt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.explore=t.explore,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!ct(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.explore;p(s.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=this.explore,a=.35*n,r=.2*s,h=e+.1*s,c=i+.1*s,l=r/2;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText("EXPLORE 探索",h+a/2,c+r/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.explore,a=.35*n,r=.2*s,h=e+n-a-.1*s,c=i+s-r-.1*s;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(o.name,h+a/2,c+r/2)}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),this.drawImage(),t.ctx.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class vt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.shop=t.shop,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!ct(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.shop;p(s.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=this.shop,a=.35*n,r=.2*s,h=e+.1*s,c=i+.1*s,l=r/2;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText("SHOP 礼盒",h+a/2,c+r/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.shop,a=.35*n,r=.2*s,h=e+n-a-.1*s,c=i+s-r-.1*s;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(o.name,h+a/2,c+r/2)}drawExtra(){const{x:e,y:i,width:n,height:s}=this.option,o=this.shop,a=.35*n,r=.2*s,h=e+n-a-.1*s,c=i+s-r-.4*s;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText([o.money.name,o.money.number].join(" "),h+a/2,c+r/2)}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),this.drawImage(),t.ctx.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),this.drawExtra(),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class Tt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.card=t.card,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!ct(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.card;p(s.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.5*n,r=.12*n,h=e+.05*n,c=i+.05*n,l=r/2;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText("CARD 卡牌",h+a/2,c+r/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.5*n,r=.12*n,h=e+n-a-.05*n,c=i+s-r-.05*n,l=r/2,d=[o.name,st(o.level)];x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(d.join(" "),h+a/2,c+r/2)}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),this.drawImage(),t.ctx.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class bt{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.master=t.master,this.novaTime=0,this.touchEvent=t.touchEvent,this.touchArea=t.touchArea,this.touchTimeout}get option(){return{x:this.x+this.offsetX,y:this.y+this.offsetY,width:this.width,height:this.height}}eventDown(t){this.touchArea&&!ct(t,this.touchArea)||(this.touchTimeout=!0)}eventUp(t){!0===this.touchTimeout&&this.touchEvent(),this.touchTimeout=!1}eventMove(t){this.touchTimeout=!1}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.master;p(s.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=this.master,a=.35*n,r=.2*s,h=e+.1*s,c=i+.1*s,l=r/2;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle=o.inTeam?"rgba(0, 0, 0, 0.75)":"rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.fillStyle=o.inTeam?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText("MASTER 队长",h+a/2,c+r/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.master,a=.35*n,r=.2*s,h=e+n-a-.1*s,c=i+s-r-.1*s;x({x:h,y:c,width:a,height:r,radius:r/2}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.075*s}px Courier`,t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText([o.name,st(o.level)].join(" "),h+a/2,c+r/2)}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05));const{x:e,y:i,width:n,height:s}=this.option;t.ctx.save(),x({x:e,y:i,width:n,height:s,radius:8}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.clip(),this.drawImage(),t.ctx.globalAlpha=this.novaTime,this.drawTitle(),this.drawName(),t.ctx.restore(),c.addEventListener("touchstart",this.eventDown.bind(this),{ifTouchCover:this.option}),c.addEventListener("touchmove",this.eventMove.bind(this)),c.addEventListener("touchend",this.eventUp.bind(this))}}class At{constructor(){this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.skillIndex=0,this.novaTime=0,this.explore,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.explore;g(s.imageDOM,{x:t,y:e+.025*n,width:i,height:.35*n})}drawContent(){const{x:e,y:i,width:n,height:s}=this.option,o=this.explore;t.ctx.font=`900 ${.014*s}px Courier`;const a=["EXPLORE 探索",o.name,["难度",o.difficulty].join(" ")];a.forEach(((i,o)=>{const a=.04*s,r=e+.05*n,h=.4*s+.02*s+o*s*.06;x({x:r,y:h,width:n-.1*n,height:a,radius:a/2}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="middle",t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(i,r+a,h+a/2)}));{const i=n-.04*s,r=.31*s,h=e+.05*n,l=.4*s+.02*s+a.length*s*.06;x({x:h,y:l,width:i,height:r,radius:.02*s}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.fillStyle="rgba(0, 0, 0, 1)",w({x:h+.04*s,y:l+.02*s,width:i-.08*s,wrapSpace:.021*s,text:o.description}),this.extra&&this.extra.forEach(((e,i)=>{var n=.12*s,o=.04*s,a=(t.width-n)/2,h=l+r+.02*s;t.ctx.textAlign="center",t.ctx.textBaseline="middle";const d=this.extra.length;x({x:a+=(i-(d/2-.5))*(n+.02*s),y:h,width:n,height:o,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(e.name,a+n/2,h+o/2),c.addEventListener("touchstart",(()=>e.event()),{ifTouchCover:{x:a,y:h,width:n,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),t.ctx.save(),t.ctx.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),t.ctx.restore(),c.addEventListener("touchstart",this.close)}}class It{constructor(){this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.skillIndex=0,this.novaTime=0,this.shop,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.shop;g(s.imageDOM,{x:t,y:e+.025*n,width:i,height:.35*n})}drawContent(){const{x:e,y:i,width:n,height:s}=this.option,o=this.shop;t.ctx.font=`900 ${.014*s}px Courier`;const a=["SHOP 礼盒",o.name,[o.money.name,":","售价",o.money.number,"/","拥有",f.state.info.money.find((t=>t.key===o.money.key)).number].join(" ")];a.forEach(((i,o)=>{const a=.04*s,r=e+.05*n,h=.4*s+.02*s+o*s*.06;x({x:r,y:h,width:n-.1*n,height:a,radius:a/2}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="middle",t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(i,r+a,h+a/2)}));{const i=n-.04*s,r=.31*s,h=e+.05*n,l=.4*s+.02*s+a.length*s*.06;x({x:h,y:l,width:i,height:r,radius:.02*s}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.fillStyle="rgba(0, 0, 0, 1)",w({x:h+.04*s,y:l+.02*s,width:i-.08*s,wrapSpace:.021*s,text:o.description}),this.extra&&this.extra.forEach(((e,i)=>{var n=.12*s,o=.04*s,a=(t.width-n)/2,h=l+r+.02*s;t.ctx.textAlign="center",t.ctx.textBaseline="middle";const d=this.extra.length;x({x:a+=(i-(d/2-.5))*(n+.02*s),y:h,width:n,height:o,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(e.name,a+n/2,h+o/2),c.addEventListener("touchstart",(()=>e.event()),{ifTouchCover:{x:a,y:h,width:n,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),t.ctx.save(),t.ctx.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),t.ctx.restore(),c.addEventListener("touchstart",this.close)}}class Ct{constructor(){this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.skillIndex=0,this.novaTime=0,this.card,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.card;g(s.imageDOM,{x:t,y:e+.025*n,width:i,height:.35*n})}drawContent(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card;t.ctx.font=`900 ${.014*s}px Courier`;const a=["CARD 卡牌",[o.name,st(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),[o.race].join(" "),[o.type].join(" ")];a.forEach(((i,o)=>{const a=.04*s,r=e+.05*n,h=.4*s+.02*s+o*s*.06;x({x:r,y:h,width:n-.1*n,height:a,radius:a/2}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="middle",t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(i,r+a,h+a/2)}));{const i=n-.1*n,r=.25*s,h=e+.05*n,l=.4*s+.02*s+a.length*s*.06;x({x:h,y:l,width:i,height:r,radius:.02*s}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.fillStyle="rgba(0, 0, 0, 1)",w({x:h+.04*s,y:l+.02*s,width:i-.08*s,wrapSpace:.021*s,text:o.description(o.level)}),this.extra&&this.extra.forEach(((e,i)=>{var n=.12*s,o=.04*s,a=(t.width-n)/2,h=l+r+.02*s;t.ctx.textAlign="center",t.ctx.textBaseline="middle";const d=this.extra.length;x({x:a+=(i-(d/2-.5))*(n+.02*s),y:h,width:n,height:o,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(e.name,a+n/2,h+o/2),c.addEventListener("touchstart",(()=>e.event()),{ifTouchCover:{x:a,y:h,width:n,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),t.ctx.save(),t.ctx.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),t.ctx.restore(),c.addEventListener("touchstart",this.close)}}class kt{constructor(){this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.skillIndex=0,this.novaTime=0,this.master,this.close,this.extra}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawImage(){const{x:t,y:e,width:i,height:n}=this.option,s=this.master;g(s.imageDOM,{x:t,y:e+.025*n,width:i,height:.35*n})}drawContent(){const{x:e,y:i,width:n,height:s}=this.option,o=this.master,a=this.skillIndex;t.ctx.font=`900 ${.014*s}px Courier`;const r=["MASTER 队长",[o.name,st(o.level),o.exp/Math.pow(2,o.level-1)+"%"].join(" "),["HP",o.HP].join(" "),["ATTACT",o.ATTACT].join(" ")];r.forEach(((i,o)=>{const a=.04*s,r=e+.05*n,h=.4*s+.02*s+o*s*.06;x({x:r,y:h,width:n-.1*n,height:a,radius:a/2}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="middle",t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(i,r+a,h+a/2)}));{const i=n-.1*n,h=.25*s,l=e+.05*n,d=.4*s+.02*s+r.length*s*.06;x({x:l,y:d,width:i,height:h,radius:.02*s}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.fillStyle="rgba(0, 0, 0, 1)",w({x:l+.04*s,y:d+.02*s,width:i-.08*s,wrapSpace:.021*s,text:o.skill[this.skillIndex].description(o.level)}),o.skill.forEach(((e,i)=>{var n=.12*s,r=.04*s,l=(t.width-n)/2,u=d+h-r-12;t.ctx.textAlign="center",t.ctx.textBaseline="middle";const f=o.skill.length;x({x:l+=(i-(f/2-.5))*(n+.02*s),y:u,width:n,height:r,radius:4}),t.ctx.fillStyle=i===a?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle=i===a?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",t.ctx.fillText(e.name,l+n/2,u+r/2),c.addEventListener("touchstart",(()=>this.skillIndex=i),{ifTouchCover:{x:l,y:u,width:n,height:r},stop:!0})})),this.extra&&this.extra.forEach(((e,i)=>{var n=.12*s,o=.04*s,a=(t.width-n)/2,r=d+h+.02*s;t.ctx.textAlign="center",t.ctx.textBaseline="middle";const l=this.extra.length;x({x:a+=(i-(l/2-.5))*(n+.02*s),y:r,width:n,height:o,radius:4}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(e.name,a+n/2,r+o/2),c.addEventListener("touchstart",(()=>e.event()),{ifTouchCover:{x:a,y:r,width:n,height:o},stop:!0})}))}}render(){this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),t.ctx.save(),t.ctx.globalAlpha=this.novaTime,this.drawImage(),this.drawContent(),t.ctx.restore(),c.addEventListener("touchstart",this.close)}}const St=class{constructor(){this.preview=null,this.type="alltime",this.explore,this.InstanceNavigation,this.InstanceScroll,this.InstanceExplore,this.InstanceExplorePreview,this.init()}get exploreHeight(){const e=this.explore.length;return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}init(){this.explore=f.state.explore.filter((t=>t.type===this.type)),this.instanceNavigation(),this.instanceScroll(),this.instanceExplore(),this.instanceExplorePreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{f.state.page.current="transition",f.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"alltime"!==this.type||(t="week_"+(new Date).getDay()),t||this.type!=="week_"+(new Date).getDay()||(t="alltime"),this.type=t,this.init()}},{justifyContent:"right",text:"探索"}]]};this.InstanceNavigation=new gt(t)}instanceScroll(){const e={x:12,y:12,width:t.width-24,height:t.height-this.InstanceNavigation.height-36,contentHeight:this.exploreHeight};this.InstanceScroll=new pt(e)}instanceExplore(){this.InstanceExplore=this.explore.map(((e,i)=>{const n={width:t.width-24,explore:e,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=e};return n.height=(t.width-60)/4*1.35,n.x=12,n.y=12+i*(n.height+12),new wt(n)}))}instanceExplorePreview(){const e={};e.width=.7*t.width,e.height=1.35*e.width,e.x=.15*t.width,e.y=(t.height-1.5*e.width)/2-60,this.InstanceExplorePreview=new At(e)}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceExplore.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){this.preview.inTeam||(this.InstanceExplorePreview.extra=[{name:"战斗",event:()=>this.enter(this.preview)}]),this.InstanceExplorePreview.close=t=>{this.preview=null,this.InstanceExplorePreview.novaTime=0,this.InstanceExplore.forEach((t=>t.novaTime=0))},this.InstanceExplorePreview.explore=this.preview,this.InstanceExplorePreview.render()}enter(t){f.state.battle={self:{master:{...it([f.state.info.library.master.find((t=>t.key===f.state.info.team[f.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:et(f.state.info.team[f.state.info.teamIndex].card.map((t=>({...t,...f.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...it([t.boss.master])[0],buff:[]},card:{team:et(t.boss.card),hand:[]},AI:t.AI},reward:t.reward},f.state.battle.self.card.team.length<8?v.play("卡组数量满足8张","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(f.state.page.current="transition",f.state.page.next="pve")}render(){p(W.get("background-page"),{x:0,y:0,width:t.width,height:t.height}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},Et=(t,e,i)=>{const n=new Array(e).fill(t/e),s=()=>{requestAnimationFrame((()=>{i(n.shift()),n[0]&&s()}))};s()};class Pt{constructor(){this.width=Math.min(.7*t.width,.5*t.height),this.height=1.35*this.width,this.x=(t.width-this.width)/2,this.y=(t.height-this.height)/2,this.card,this.nova=!1,this.novaTime=0,this.novaOverTime=0}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}play(t){this.card=t,this.nova=!0}drawTitle(){const{x:e,y:i,width:n,height:s}=this.option,o=.5*n,a=.12*n,r=e+.05*n,h=i+.05*n;x({x:r,y:h,width:o,height:a,radius:a/2}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText("CARD 卡牌",r+o/2,h+a/2)}drawName(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.5*n,r=.12*n,h=e+n-a-.05*n,c=i+s-r-.05*n,l=r/2,d=[o.name,st(o.level)];o.number&&d.push("x"+o.number),x({x:h,y:c,width:a,height:r,radius:l}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(d.join(" "),h+a/2,c+r/2)}drawRace(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.9*n,r=.12*n,h=e+.05*n,c=i+.22*n;x({x:h,y:c,width:a,height:r,radius:4}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(o.race,h+a/2,c+r/2)}drawType(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.9*n,r=.12*n,h=e+.05*n,c=i+.39*n;x({x:h,y:c,width:a,height:r,radius:4}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(o.type,h+a/2,c+r/2)}drawDescription(){const{x:e,y:i,width:n,height:s}=this.option,o=this.card,a=.9*n,r=e+.05*n,h=i+.56*n;x({x:r,y:h,width:a,height:.57*n,radius:4}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.textAlign="start",t.ctx.textBaseline="top",t.ctx.font=`900 ${.045*n}px Courier`,t.ctx.fillStyle="rgba(255, 255, 255, 1)",w({x:r+.05*n,y:h+.05*n,width:a-.1*n,wrapSpace:.075*n,text:o.description(o.level)})}render(){if(this.nova&&this.novaTime<1&&(this.novaTime=rt(this.novaTime+.05)),1===this.novaTime&&(this.novaOverTime=this.novaOverTime+1,this.nova=!1),!this.nova&&this.novaTime>0&&40===this.novaOverTime&&(this.novaTime=rt(this.novaTime-.05)),0===this.novaTime)return void(this.novaOverTime=0);const e=this.card,{x:i,y:n,width:s,height:o}=this.option;t.ctx.save(),t.ctx.globalAlpha=this.novaTime,y({x:0,y:0,width:t.width,height:t.height}),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),x({x:i,y:n,width:s,height:o,radius:16}),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill(),p(e.imageDOM,{x:i,y:n,width:s,height:o}),this.drawTitle(),this.drawName(),this.drawRace(),this.drawType(),this.drawDescription(),t.ctx.restore()}}class Mt{constructor(){this.queqe=[],this.time=60}play(t){this.queqe.push({...t,time:this.time})}render(){this.queqe.forEach((e=>{const i=e.fontSize,n=e.text,s=(e.time-this.time)/4,o=(e.time-this.time)/2;t.ctx.save(),t.ctx.globalAlpha=e.time/this.time,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${i}px Courier`;const a=t.ctx.measureText(n).width+48;x({x:e.x-a/2+s,y:e.y-i+o,width:a,height:2*i,radius:.2*i}),t.ctx.fillStyle="rgba(255, 255, 255, 0.75)",t.ctx.fill(),t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.fillText(n,e.x+s,e.y+o),t.ctx.restore(),e.time=rt(e.time-1),0===e.time&&(this.queqe=this.queqe.filter((t=>t.time)))}))}}class _t{constructor(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.type=t.type,this.information=t.information,this.useCard=t.useCard,this.InstanceCards=[],this.touchCard}get option(){return{x:this.x,y:this.y,width:this.width,height:this.height}}drawBackground(){const{x:t,y:e,width:i,height:n,information:s}=this;g(s.master.imageDOM,{x:t,y:e,width:i,height:n})}drawTitle(){const{x:e,y:i,width:n,height:s,information:o}=this,a={width:.4*n,height:.12*n};a.x=e+n/2-a.width/2,a.y=i+.02*n,a.radius=a.height/8,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.04*n}px Courier`,m(a),t.ctx.fillStyle="rgba(0, 0, 0, 0.5)",t.ctx.fill(),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText([o.master.name,st(o.master.level)].join(" "),a.x+a.width/2,a.y+a.height/2)}drawACTION(){const{x:e,y:i,width:n,height:s,information:o}=this,a={width:.04*n,height:.04*n};a.x=e+n/2+.2*n+.04*n,a.y=i+.06*n,a.radius=a.height/2,o.master._ACTION&&o.master._ACTION>0&&new Array(o.master._ACTION).fill().forEach(((e,i)=>{const s={...a,x:a.x+i*(a.width+.04*n)};x(s),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fill()}))}drawHA(){const{x:e,y:i,width:n,height:s,information:o}=this;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font=`900 ${.04*n}px Courier`;const a={width:1.2*n,height:.12*n};a.x=e+(n-a.width)/2,a.y=i+s-a.height-.02*n,a.radius=a.height/2,t.ctx.save(),m(a),t.ctx.clip(),t.ctx.fillStyle="rgba(0, 0, 0, 0.5)",t.ctx.fill(),y({...a,width:o.master.HP/o.master.HP_*a.width}),t.ctx.fillStyle="rgba(185, 0, 0, 0.5)",t.ctx.fill(),t.ctx.restore(),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(`HP ${Math.floor(o.master.HP)} / ${o.master.HP_} - ATTACT ${Math.floor(o.master.ATTACT)}`,a.x+a.width/2,a.y+a.height/2)}drawBuff(){const{x:e,y:i,width:n,height:s,information:o}=this;t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.fillStyle="rgba(0, 0, 0, 1)",t.ctx.font=`900 ${.03*n}px Courier`;var a=o.master.buff.reduce(((t,e)=>{const i=t.find((t=>t.name===e));return i&&(i.number=i.number+1),i||t.push({name:e,number:1}),t}),[]);0===a.length&&(a=[{name:"BUFF"}]),a.forEach(((o,r)=>{const h={width:.16*n,height:.08*n},c=r-(a.length/2-.5);h.x=e+(n-h.width)/2+c*(h.width+.02*n),h.y=i+s+.02*n,h.radius=h.height/8,m(h),t.ctx.fillStyle="rgba(0, 0, 0, 0.75)",t.ctx.fill(),t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(o.number?`${o.name} X${o.number}`:o.name,h.x+h.width/2,h.y+h.height/2)}))}drawCard(){const t=this.width,e=this.height,i=this.x-(t-this.width)/2,n=this.y;this.InstanceCards=this.InstanceCards.filter((t=>this.information.card.hand.find((e=>e===t.card)))),this.information.card.hand.forEach(((s,o)=>{const a=o-(this.information.card.hand.length/2-.5),r={};r.width=.42*t,r.height=1.35*r.width,r.x=i+(t-r.width)/2+a*t*.45,r.y=n+(e-r.height)/2,r.touchStart=()=>this.touchCard=s,r.touchEnd=()=>this.useCard(s),r.card=s,r.type=this.type;const h=this.InstanceCards.find((t=>t.card===s));h&&(h.x=r.x),h||("self"===this.type&&this.InstanceCards.push(new xt(r)),"opposite"===this.type&&this.InstanceCards.push(new mt(r)))})),this.InstanceCards.forEach((t=>t.card!==this.touchCard?t.render():null)),this.InstanceCards.forEach((t=>t.card===this.touchCard?t.render():null))}render(){this.drawBackground(),this.drawTitle(),this.drawACTION(),this.drawHA(),this.drawBuff(),this.drawCard()}}class Ot{constructor(){this.round}render(){const e={width:120,height:12,y:12};e.x=(t.width-e.width)/2,t.ctx.textAlign="center",t.ctx.textBaseline="middle",t.ctx.font="900 24px Courier",t.ctx.fillStyle="rgba(0, 0, 0, 0.5)",t.ctx.fillText("ROUND",e.x+e.width/2,e.y+e.height/2),t.ctx.font="900 14px Courier",t.ctx.fillStyle="rgba(255, 255, 255, 1)",t.ctx.fillText(`${Math.floor(this.round)}/99`,e.x+e.width/2,e.y+e.height/2+2)}}const jt=class{constructor(){this.currentUseCard=!1,this.currentRole,this.round=.5,this.auto=!1,this.log=[],this.InstanceRound=new Ot,this.InstanceNavigation,this.InstanceRoleSelf,this.InstanceRoleOpposite,this.InstanceRoleMessage=new Mt,this.InstanceCardMessage=new Pt,this.instanceNavigation(),this.instanceRoleSelf(),this.instanceRoleOpposite(),this.currentRole=this.InstanceRoleSelf,this.roundStart()}instanceRoleSelf(){const e=(t.height-this.InstanceNavigation.height-36)/2,i={width:Math.min(.75*t.width,.75*e),height:Math.min(.75*t.width,.75*e),type:"self",information:f.state.battle.self,useCard:this.useCard};i.x=(t.width-i.width)/2,i.y=t.height-this.InstanceNavigation.height-24-e+(e-i.height)/2,this.InstanceRoleSelf=new _t(i)}instanceRoleOpposite(){const e=(t.height-this.InstanceNavigation.height-36)/2,i={width:Math.min(.75*t.width,.75*e),height:Math.min(.75*t.width,.75*e),type:"opposite",information:f.state.battle.opposite,useCard:this.useCard};i.x=(t.width-i.width)/2,i.y=(e-i.height)/2+24,this.InstanceRoleOpposite=new _t(i)}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"退出战斗",event:()=>{f.state.page.current="transition",f.state.page.next="explore"}},{justifyContent:"left",text:"自动战斗",active:this.auto,event:()=>{this.auto=!this.auto,this.instanceNavigation(),this.oppositeAI()}},{justifyContent:"right",text:"结束回合",event:this.roundOver}]]};this.InstanceNavigation=new gt(t)}pumpCard=(t,e)=>{2===e.information.card.hand.length&&e.information.card.cemetery.push(t),e.information.card.hand.length<2&&e.information.card.hand.push(t)};useCard=async t=>{if(this.currentUseCard)return;const e=this.currentRole,[i,n]=e===this.InstanceRoleSelf?[this.InstanceRoleSelf,this.InstanceRoleOpposite]:[this.InstanceRoleOpposite,this.InstanceRoleSelf];this.currentUseCard=!0,i.information.card.hand=i.information.card.hand.filter((e=>e!==t)),i.information.master._ACTION=i.information.master._ACTION-1,this.InstanceCardMessage.play(t),f.state.soundSource&&G.play(t.soundAction),await at(120);var s=t.function(t,i.information,n.information);i.information.master.skill.forEach((e=>e.function(t,e,s,i.information,n.information)));for(var o=0,a=0;s.length;){const e=s.shift();if(e.custom&&e.custom(t,s,i.information,n.information),e.message&&v.play(e.message,"rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),e.animation&&("self"===e.target&&h.play(e.animation,(t=>[i.x+i.width/2-t.width/2,i.y+i.height/2-t.height/2])),"opposite"===e.target&&h.play(e.animation,(t=>[n.x+n.width/2-t.width/2,n.y+n.height/2-t.height/2]))),e.roleMessage&&("self"===e.target&&(at(30*o,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:i.x+i.width/2,y:i.y+i.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),o+=1),"opposite"===e.target&&(at(30*a,(()=>{this.InstanceRoleMessage.play({text:e.roleMessage,x:n.x+n.width/2,y:n.y+n.height/2,fontSize:.04*this.InstanceRoleSelf.width})})),a+=1)),e.effect){if("HP"===e.effect&&("self"===e.target&&Et(e.value,32,(t=>i.information.master.HP=Math.min(i.information.master.HP+t,i.information.master.HP_))),"opposite"===e.target&&Et(e.value,32,(t=>n.information.master.HP=Math.min(n.information.master.HP+t,n.information.master.HP_)))),"ATTACT"===e.effect&&("self"===e.target&&Et(e.value,32,(t=>i.information.master.ATTACT=i.information.master.ATTACT+t)),"opposite"===e.target&&Et(e.value,32,(t=>n.information.master.ATTACT=n.information.master.ATTACT+t))),"BUFF"===e.effect){if("self"===e.target&&(e.number>0&&i.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;i.information.master.buff=i.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}if("opposite"===e.target&&(e.number>0&&n.information.master.buff.push(...new Array(e.number).fill(e.name)),e.number<0)){let t=0;n.information.master.buff=n.information.master.buff.filter((i=>i!==e.name||t===e.number||(t-=1,!1)))}}(e.effect="LEVEL")&&("self"===e.target&&i.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})),"opposite"===e.target&&n.information.card.team.forEach((t=>{t.key===e.key&&(t.level=t.level+e.number)})))}}this.log.push({card:t,user:e===this.InstanceRoleSelf?"self":"opposite",round:this.round}),await at(120),this.roundContinue()};oppositeAI=async()=>{const t=this.currentRole;var e;t.information.AI&&(e=t.information.AI(t.information,this.InstanceRoleSelf.information)),t.information.AI||(e=ht(t.information.card.hand,1)[0]),await at(60),await this.useCard(e),await at(60)};roundStart=async()=>{this.round=this.round+.5;const t=this.currentRole;t.information.roundCache=null,t.information.master._ACTION=t.information.master.ACTION,t.information.card.hand=ht(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()};roundContinue=async()=>{const t=this.currentRole;t.information.master._ACTION>0&&(t.information.card.hand=ht(t.information.card.team,2),(t===this.InstanceRoleOpposite||this.auto)&&this.oppositeAI()),0===t.information.master._ACTION&&this.roundOver(),this.currentUseCard=!1};roundOver=async()=>{const t=this.currentRole;return t.information.master._ACTION=0,t.information.card.hand=[],this.currentRole===this.InstanceRoleSelf?(this.currentRole=this.InstanceRoleOpposite,void await this.roundStart()):this.currentRole===this.InstanceRoleOpposite?(this.currentRole=this.InstanceRoleSelf,void await this.roundStart()):void 0};battlerOver=()=>{if(this.InstanceRoleOpposite.information.master.HP<=0){const t=f.state.battle.reward();return v.play("战斗胜利","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.reward={value:t,back:"explore",title:"战斗胜利"},f.state.page.current="transition",void(f.state.page.next="reward")}if(this.InstanceRoleSelf.information.master.HP<=0)return v.play("战斗失败","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.reward={value:[],back:"explore",title:"战斗失败"},f.state.page.current="transition",void(f.state.page.next="reward")};render(){p(W.get("background-page"),{x:0,y:0,width:t.width,height:t.height}),this.InstanceRound.round=this.round,this.InstanceRound.render(),this.InstanceNavigation.render(),this.InstanceRoleOpposite.render(),this.InstanceRoleSelf.render(),this.InstanceCardMessage.render(),this.InstanceRoleMessage.render(),this.battlerOver()}},Ht=class{constructor(){this.preview=null,this.type="card",this.master,this.card,this.InstanceNavigation,this.InstanceScroll,this.InstanceMasterList,this.InstanceMasterPreview,this.InstanceCardList,this.InstanceCardPreview,this.init()}get masterHeight(){const e=this.master.length;return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}get cardHeight(){const e=Math.ceil(this.card.length/4);return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}init(){this.master=[],this.card=[],"card"===this.type&&(this.master=it([f.state.info.library.master.find((t=>t.key===f.state.info.team[f.state.info.teamIndex].master.key))]).map((t=>(t.inTeam=f.state.info.team[f.state.info.teamIndex].master.key===t.key,t))),this.card=et(f.state.info.library.card).map((t=>(t.inTeam=f.state.info.team[f.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i}))),"master"===this.type&&(this.master=it(f.state.info.library.master).map((t=>(t.inTeam=f.state.info.team[f.state.info.teamIndex].master.key===t.key,t))).sort(((t,e)=>t.key-e.key)).sort(((t,e)=>{const i=t.inTeam?1:0;return(e.inTeam?1:0)-i})),this.card=et(f.state.info.team[f.state.info.teamIndex].card.map((t=>(t.inTeam=f.state.info.team[f.state.info.teamIndex].card.some((e=>e.key===t.key)),t))).map((t=>({...t,...f.state.info.library.card.find((e=>e.key===t.key))})))).sort(((t,e)=>t.key-e.key)),this.card.length<8&&this.card.push(...new Array(8-this.card.length).fill())),this.instanceNavigation(),this.instanceScroll(),this.instanceMasterList(),this.instanceCardList(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{f.state.page.current="transition",f.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["card","卡牌"],["master","队长"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"card"!==this.type||(t="master"),t||"master"!==this.type||(t="card"),this.type=t,this.init()}},{active:!0,justifyContent:"left",text:st(f.state.info.teamIndex+1),event:()=>{f.state.info.teamIndex=f.state.info.team[f.state.info.teamIndex+1]?f.state.info.teamIndex+1:0,this.init()}},{justifyContent:"right",text:"编队"}]]};this.InstanceNavigation=new gt(t)}instanceScroll(){const e={x:12,y:12,width:t.width-24,height:t.height-this.InstanceNavigation.height-36,contentHeight:this.masterHeight+this.cardHeight+12};this.InstanceScroll=new pt(e)}instanceMasterList(){this.InstanceMasterList=this.master.map(((e,i)=>{const n={};return n.width=t.width-24,n.master=e,n.touchAble=!0,n.touchArea=this.InstanceScroll.option,n.touchEvent=()=>{this.preview=e,f.state.soundSource&&G.play(e.soundMain)},n.height=(t.width-60)/4*1.35,n.x=12,"master"===this.type&&(n.y=24+i*(n.height+12)+this.cardHeight),"card"===this.type&&(n.y=12+i*(n.height+12)),new bt(n)}))}instanceCardList(){this.InstanceCardList=this.card.map(((e,i)=>{const n={};return n.width=(t.width-60)/4,n.height=1.35*n.width,n.x=12+parseInt(i%4)*(n.width+12),"master"===this.type&&(n.y=12+parseInt(i/4)*(n.height+12)),"card"===this.type&&(n.y=24+parseInt(i/4)*(n.height+12)+this.masterHeight),n.card=e,n.touchAble=!0,n.touchArea=this.InstanceScroll.option,n.touchEvent=()=>{this.preview=e,f.state.soundSource&&G.play(e.soundMain)},e?new Tt(n):e?void 0:new mt(n)}))}instanceCardPreview(){this.InstanceCardPreview=new Ct}instanceMasterPreview(){this.InstanceMasterPreview=new kt}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceCardList.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMasterList.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=()=>{this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0,this.InstanceCardList.forEach((t=>t.novaTime=0)),this.InstanceMasterList.forEach((t=>t.novaTime=0))};this.InstanceCardList.find((t=>t.card===this.preview))&&(this.preview.inTeam&&(this.InstanceCardPreview.extra=[{name:"卸载",event:()=>this.unloadCard(this.preview)}]),this.preview.inTeam||(this.InstanceCardPreview.extra=[{name:"装载",event:()=>this.loadCard(this.preview)}]),this.InstanceCardPreview.close=t,this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.render()),this.InstanceMasterList.find((t=>t.master===this.preview))&&(this.preview.inTeam||(this.InstanceMasterPreview.extra=[{name:"装载",event:()=>this.loadMaster(this.preview)}]),this.InstanceMasterPreview.close=t,this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.render())}loadCard(t){const e=f.state.info.team[f.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));8!==e.length?i?v.play("卡牌已装载","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)"):(i||e.push({key:t.key}),this.init(),this.preview=null,v.play("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.function.setInfo()):v.play("超出卡组数量限制","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}unloadCard(t){const e=f.state.info.team[f.state.info.teamIndex].card,i=e.find((e=>e.key===t.key));i?(e.splice(e.indexOf(i),1),this.init(),this.preview=null,v.play("卸载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.function.setInfo()):v.play("未装载当前卡牌","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)")}loadMaster(t){f.state.info.team[f.state.info.teamIndex].master.key=t.key,this.init(),this.preview=null,v.play("装载成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.function.setInfo()}render(){p(W.get("background-page"),{x:0,y:0,width:t.width,height:t.height}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},Nt=class{constructor(){this.preview=null,this.money=1,this.type="alltime",this.shop,this.InstanceNavigation,this.InstanceScroll,this.InstanceShop,this.InstanceShopPreview,this.init()}get shopHeight(){const e=this.shop.length;return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}init(){this.shop=f.state.shop.filter((t=>t.type===this.type)).map((t=>(t.money=nt([t.money])[0],t))),this.instanceNavigation(),this.instanceScroll(),this.instanceShop(),this.instanceShopPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{f.state.page.current="transition",f.state.page.next="home"}},{active:!0,justifyContent:"left",text:new Array(["alltime","常驻"],["week_"+(new Date).getDay(),"周活动"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"alltime"!==this.type||(t="week_"+(new Date).getDay()),t||this.type!=="week_"+(new Date).getDay()||(t="alltime"),this.type=t,this.init()}},{justifyContent:"right",text:"商店"}]]};this.InstanceNavigation=new gt(t)}instanceScroll(){const e={x:12,y:12,width:t.width-24,height:t.height-this.InstanceNavigation.height-36,contentHeight:this.shopHeight};this.InstanceScroll=new pt(e)}instanceShop(){this.InstanceShop=this.shop.map(((e,i)=>{const n={width:t.width-24,shop:e,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=e};return n.height=(t.width-60)/4*1.35,n.x=12,n.y=12+i*(n.height+12),new vt(n)}))}instanceShopPreview(){this.InstanceShopPreview=new It}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceShop.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=()=>{this.buy(this.preview),this.preview=null,this.InstanceShopPreview.novaTime=0};this.preview.inTeam||(this.InstanceShopPreview.extra=[{name:"购买",event:()=>t()}]),this.InstanceShopPreview.close=t=>{this.preview=null,this.InstanceShopPreview.novaTime=0,this.InstanceShop.forEach((t=>t.novaTime=0))},this.InstanceShopPreview.shop=this.preview,this.InstanceShopPreview.render()}buy(t){const e=f.state.info.money.find((e=>e.key===t.money.key));if(e.number<t.money.number)return void v.play("货币不足","rgba(255, 50 ,50, 1)","rgba(255, 255, 255, 1)");e.number=e.number-t.money.number;const i=t.reward();v.play("购买成功","rgba(0, 0, 0, 1)","rgba(255, 255, 255, 1)"),f.state.reward={value:i,back:"shop",title:"购买获得"},f.state.page.current="transition",f.state.page.next="reward"}render(){p(W.get("background-page"),{x:0,y:0,width:t.width,height:t.height}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}},Dt=class{constructor(){this.preview=null,this.type,this.card=[],this.master=[],this.money=[],this.InstanceNavigation,this.InstanceScroll,this.InstanceCard,this.InstanceCardPreview,this.InstanceMaster,this.InstanceMasterPreview,this.InstanceMoney,this.init(),this.compute()}get masterHeight(){const e=this.master.length;return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}get cardHeight(){const e=Math.ceil(this.card.length/4);return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}get moneyHeight(){const e=Math.ceil(this.money.length/4);return(t.width-60)/4*1.35*e+(e?12*(e-1):0)}init(){this.card=[],this.master=[],this.money=[],!this.type&&f.state.reward.value.some((t=>t.card))&&(this.type="card"),!this.type&&f.state.reward.value.some((t=>t.master))&&(this.type="master"),!this.type&&f.state.reward.value.some((t=>t.money))&&(this.type="money"),"card"===this.type&&(this.card=et(f.state.reward.value.filter((t=>t.card)).map((t=>({...t,level:1}))))),"master"===this.type&&(this.master=it(f.state.reward.value.filter((t=>t.master)).map((t=>({...t,level:1}))))),"money"===this.type&&(this.money=nt(f.state.reward.value.filter((t=>t.money)))),this.instanceNavigation(),this.instanceScroll(),this.instanceCard(),this.instanceMaster(),this.instanceMoney(),this.instanceCardPreview(),this.instanceMasterPreview()}instanceNavigation(){const t={content:[[{justifyContent:"left",text:"返回",event:()=>{f.state.page.current="transition",f.state.page.next=f.state.reward.back}},{active:!0,justifyContent:"left",text:new Array(["card","卡牌"],["master","队长"],["money","资源"]).find((t=>t[0]===this.type))[1],event:()=>{var t;t||"card"!==this.type||(t="master"),t||"master"!==this.type||(t="money"),t||"money"!==this.type||(t="card"),this.type=t,this.init()}},{justifyContent:"right",text:f.state.reward.title}]]};this.InstanceNavigation=new gt(t)}instanceScroll(){const e={x:12,y:12,width:t.width-24,height:t.height-this.InstanceNavigation.height-36,contentHeight:this.masterHeight+this.cardHeight+this.moneyHeight+12};this.InstanceScroll=new pt(e)}instanceMaster(){this.InstanceMaster=this.master.map(((e,i)=>{const n={width:t.width-24,master:e,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=e};return n.height=(t.width-60)/4*1.35,n.x=12,n.y=12+i*(n.height+12),new bt(n)}))}instanceCard(){this.InstanceCard=this.card.map(((e,i)=>{const n={width:(t.width-60)/4,card:e,touchAble:!0,touchArea:this.InstanceScroll.option,touchEvent:()=>this.preview=e};return n.height=1.35*n.width,n.x=12+parseInt(i%4)*(n.width+12),n.y=12+parseInt(i/4)*(n.height+12),new Tt(n)}))}instanceMoney(){this.InstanceMoney=this.money.map(((e,i)=>{const n={width:t.width-24,money:e};return n.height=(t.width-60)/4*1.35,n.x=12,n.y=12+i*(n.height+12),new yt(n)}))}instanceCardPreview(){this.InstanceCardPreview=new Ct}instanceMasterPreview(){this.InstanceMasterPreview=new kt}drawScroll(){this.InstanceScroll.render((t=>{const e=t[1];this.InstanceMaster.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceCard.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)})),this.InstanceMoney.forEach((t=>{t.offsetY=0-e;const i=lt(t.option,this.InstanceScroll.option);i&&t.render(),i||(t.novaTime=0)}))}))}drawPreview(){const t=t=>{this.preview=null,this.InstanceMasterPreview.skillIndex=0,this.InstanceMasterPreview.novaTime=0,this.InstanceCardPreview.novaTime=0,this.InstanceCard.forEach((t=>t.novaTime=0)),this.InstanceMaster.forEach((t=>t.novaTime=0)),this.InstanceMoney.forEach((t=>t.novaTime=0))};this.InstanceCard.find((t=>t.card===this.preview))&&(this.InstanceCardPreview.card=this.preview,this.InstanceCardPreview.close=t,this.InstanceCardPreview.render()),this.InstanceMaster.find((t=>t.master===this.preview))&&(this.InstanceMasterPreview.master=this.preview,this.InstanceMasterPreview.close=t,this.InstanceMasterPreview.render())}compute(){const t=f.state.info.library;f.state.reward.value.forEach((e=>{if(e.card){const i=t.card.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.card.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}if(e.master){const i=t.master.find((t=>t.key===e.key));i&&(i.exp=i.exp+e.exp),i||t.master.push({key:e.key,level:1,exp:e.exp});const n=t.card.find((t=>t.key===e.key));for(;n.exp>=100*Math.pow(2,n.level-1);)n.exp=n.exp-100*Math.pow(2,n.level-1),n.level=n.level+1}})),f.state.function.setInfo()}render(){p(W.get("background-page"),{x:0,y:0,width:t.width,height:t.height}),this.preview&&this.drawPreview(),this.preview||(this.InstanceNavigation.render(),this.drawScroll())}};new class{constructor(){this.animationFrameId,this.instance,this.init(),this.loopStart()}render(){t.ctx.clearRect(0,0,t.width,t.height),c.clearEventListener();const e=f.state.page.map[f.state.page.current];e&&(this.instance instanceof e||(this.instance=new e),this.instance.render(),v.render(),h.render(),f.state.soundBackground||(G.stop("background-main"),G.stop("background-pve")),f.state.soundBackground&&"pve"===f.state.page.current&&"transition"!==f.state.page.current&&(G.stop("background-main"),0===G.find("background-pve").length&&G.play("background-pve",{loop:!0})),f.state.soundBackground&&"pve"!==f.state.page.current&&"transition"!==f.state.page.current&&(G.stop("background-pve"),0===G.find("background-main").length&&G.play("background-main",{loop:!0})),G.render())}loopStart(){this.animationFrameId=requestAnimationFrame((()=>{this.render(),this.loopStart()}))}loopEnd(){cancelAnimationFrame(this.animationFrameId)}async init(){f.state={page:{current:"",next:"",map:{transition:dt,loading:ut,home:ft,explore:St,pve:jt,store:Ht,shop:Nt,reward:Dt}},function:{setInfo:async()=>{localStorage.setItem("info",JSON.stringify(f.state.info))},getInfo:async()=>{localStorage.removeItem("info");const t=localStorage.getItem("info");t&&(f.state.info=JSON.parse(t)),t||f.state.function.initInfo()},initInfo:async()=>{const t={library:{master:Z.map((t=>({key:t.key,level:1,exp:0}))),card:tt.map((t=>({key:t.key,level:1,exp:0})))},team:[{master:{key:3},card:tt.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:tt.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:tt.map((t=>({key:t.key}))).filter(((t,e)=>e<8))},{master:{key:1},card:tt.map((t=>({key:t.key}))).filter(((t,e)=>e<8))}],teamIndex:0,money:[{key:1,number:88888},{key:2,number:12888}]};f.state.info=t}},info:null,battle:null,explore:K,shop:J,reward:null,soundBackground:!1,soundSource:!1},f.state.function.getInfo(),f.state.page.current="loading",await Promise.all([G.load(),W.load(),h.load()]),z.forEach((t=>t.imageDOM=W.get("money-"+t.key))),K.forEach((t=>t.imageDOM=W.get("explore-"+t.key))),J.forEach((t=>t.imageDOM=W.get("shop-"+t.key))),Z.forEach((t=>t.imageDOM=W.get("master-"+t.key))),tt.forEach((t=>t.imageDOM=W.get("card-"+t.key))),Z.forEach((t=>t.soundMain="master-main-"+t.key)),tt.forEach((t=>t.soundMain="card-main-"+t.key)),Z.forEach((t=>t.soundAction="master-action-"+t.key)),tt.forEach((t=>t.soundAction="card-action-"+t.key)),await at(60),f.state.page.current="transition",f.state.page.next=ot("path")?ot("path"):"home","pve"===ot("path")&&(f.state.battle={self:{master:{...it([f.state.info.library.master.find((t=>t.key===f.state.info.team[f.state.info.teamIndex].master.key))])[0],buff:[]},card:{team:et(f.state.info.team[f.state.info.teamIndex].card.map((t=>({...t,...f.state.info.library.card.find((e=>e.key===t.key))})))),hand:[]}},opposite:{master:{...it([K[0].boss.master])[0],buff:[]},card:{team:et(K[0].boss.card),hand:[]},AI:K[0].AI},reward:K[0].reward})}}})()})();